((self||window).webpackJsonp=(self||window).webpackJsonp||[]).push([[3],{1623:function(e,t,a){e.exports=a.p+"4fff67aa927fc4ecb16298f61b0cf84a.jpg"},1624:function(e,t,a){e.exports=a.p+"b592e228bf0641d6b4f0b79e664177ab.jpg"},1625:function(e,t,a){e.exports=a.p+"c6ab0a71c7048eb83585b34bd32f4ee0.jpg"},1626:function(e,t,a){e.exports=a.p+"27faaa4b21b2a66ac3496b20640e571f.jpg"},1627:function(e,t,a){"use strict";var i,n=(i=a(20))&&i.__esModule?i:{default:i};var r=a(24).default,o=a(8).default,s=a(10).default,l=a(202).default,u=a(22).default,d=a(186).default,c=a(623),f=new r,h=function(e){if(!o(e))throw new s(n.default.t("map.cesium.devError"));this._cesium=e,this._screenPositionX="-1000px",this._screenPositionY="-1000px",this._tweens=e.scene.tweens,this._container=e.viewer.container,this.position=void 0,this.showSelection=!0,this.transform="",this.opacity=1,u.track(this,["position","_screenPositionX","_screenPositionY","_scale","rotate","showSelection","transform","opacity"]),this.isVisible=void 0,u.defineProperty(this,"isVisible",{get:function(){return this.showSelection&&o(this.position)}}),this.computeScreenSpacePosition=function(t,a){return d.wgs84ToWindowCoordinates(e.scene,t,a)};var t=document.createElement("div");t.className="selection-indicator",this._container.appendChild(t),this._selectionIndicatorElement=t;var a=document.createElement("img");a.setAttribute("src",c),a.setAttribute("alt",""),a.setAttribute("width",50),a.setAttribute("height",50),t.appendChild(a);var i=this;function r(){t.style.top=i._screenPositionY,t.style.left=i._screenPositionX,t.style.transform=i.transform,t.style.opacity=i.opacity}r(),this._subscriptions=[],this._subscriptions.push(u.getObservable(this,"_screenPositionX").subscribe(r)),this._subscriptions.push(u.getObservable(this,"_screenPositionY").subscribe(r)),this._subscriptions.push(u.getObservable(this,"transform").subscribe(r)),this._subscriptions.push(u.getObservable(this,"opacity").subscribe(r))};h.prototype.destroy=function(){this._selectionIndicatorElement.parentNode.removeChild(this._selectionIndicatorElement),this._subscriptions.forEach((function(e){e.dispose()}))},h.prototype.update=function(){if(this.showSelection&&o(this.position)){var e=this.computeScreenSpacePosition(this.position,f);if(o(e)){var t=this._container,a=t.clientWidth,i=t.clientHeight,n=this._selectionIndicatorElement.clientWidth,r=.5*n;e.x=Math.min(Math.max(e.x,-n),a+n)-r,e.y=Math.min(Math.max(e.y,-n),i+n)-r,this._screenPositionX=Math.floor(e.x+.25)+"px",this._screenPositionY=Math.floor(e.y+.25)+"px"}else this._screenPositionX="-1000px",this._screenPositionY="-1000px"}},h.prototype.animateAppear=function(){if(o(this._selectionIndicatorTween)){if(this._selectionIndicatorIsAppearing)return;this._selectionIndicatorTween.cancelTween(),this._selectionIndicatorTween=void 0}this._selectionIndicatorIsAppearing=!0;var e=this;this._selectionIndicatorTween=this._tweens.add({startObject:{scale:2,opacity:0,rotate:-180},stopObject:{scale:1,opacity:1,rotate:0},duration:.8,easingFunction:l.EXPONENTIAL_OUT,update:function(t){e.opacity=t.opacity,e.transform="scale("+t.scale+") rotate("+t.rotate+"deg)"},complete:function(){e._selectionIndicatorTween=void 0},cancel:function(){e._selectionIndicatorTween=void 0}})},h.prototype.animateDepart=function(){if(o(this._selectionIndicatorTween)){if(!this._selectionIndicatorIsAppearing)return;this._selectionIndicatorTween.cancelTween(),this._selectionIndicatorTween=void 0}this._selectionIndicatorIsAppearing=!1;var e=this;this._selectionIndicatorTween=this._tweens.add({startObject:{scale:1,opacity:1},stopObject:{scale:1.5,opacity:0},duration:.8,easingFunction:l.EXPONENTIAL_OUT,update:function(t){e.opacity=t.opacity,e.transform="scale("+t.scale+") rotate(0deg)"},complete:function(){e._selectionIndicatorTween=void 0},cancel:function(){e._selectionIndicatorTween=void 0}})},Object.defineProperties(h.prototype,{container:{get:function(){return this._container}},selectionIndicatorElement:{get:function(){return this._selectionIndicatorElement}},scene:{get:function(){return this._scene}}}),e.exports=h},196:function(e,t,a){"use strict";t.a=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2})},287:function(e,t,a){"use strict";var i=a(8),n=(a(10),a(23)),r=a(144),o=a(131),s=a(39);function l(){this._eventHelper=new r.default,this._definitionChanged=new n.default,this._intervals=new o.default,this._intervals.changedEvent.addEventListener(l.prototype._intervalsChanged,this)}Object.defineProperties(l.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),l.prototype.getValue=function(e,t){var a=this._intervals.findDataForIntervalContainingDate(e);if(Object(i.default)(a))return a.getValue(e,t)},l.prototype.equals=function(e){return this===e||e instanceof l&&this._intervals.equals(e._intervals,s.default.equals)},l.prototype._intervalsChanged=function(){!function(e,t,a,n){function r(){a.raiseEvent(e)}var o=[];t.removeAll();for(var s=n.length,l=0;l<s;l++){var u=n.get(l);Object(i.default)(u.data)&&-1===o.indexOf(u.data)&&t.add(u.data.definitionChanged,r)}}(this,this._eventHelper,this._definitionChanged,this._intervals),this._definitionChanged.raiseEvent(this)},t.a=l},366:function(e,t,a){"use strict";var i=a(9),n=a(8),r=(a(10),a(23)),o=a(140),s=a(287),l=a(39);function u(e){this._referenceFrame=Object(i.default)(e,o.a.FIXED),this._definitionChanged=new r.default,this._composite=new s.a,this._composite.definitionChanged.addEventListener(u.prototype._raiseDefinitionChanged,this)}Object.defineProperties(u.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(e){this._referenceFrame=e}}}),u.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,o.a.FIXED,t)},u.prototype.getValueInReferenceFrame=function(e,t,a){var i=this._composite._intervals.findDataForIntervalContainingDate(e);if(Object(n.default)(i))return i.getValueInReferenceFrame(e,t,a)},u.prototype.equals=function(e){return this===e||e instanceof u&&this._referenceFrame===e._referenceFrame&&this._composite.equals(e._composite,l.default.equals)},u.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=u},367:function(e,t,a){"use strict";var i=a(8),n=(a(10),a(23)),r=a(39);function o(e){var t=e._targetProperty;if(!Object(i.default)(t)){var a=e._targetEntity;if(!Object(i.default)(a)){if(a=e._targetCollection.getById(e._targetId),!Object(i.default)(a))return void(e._targetEntity=e._targetProperty=void 0);a.definitionChanged.addEventListener(s.prototype._onTargetEntityDefinitionChanged,e),e._targetEntity=a}var n=e._targetPropertyNames;t=e._targetEntity;for(var r=0,o=n.length;r<o&&Object(i.default)(t);++r)t=t[n[r]];e._targetProperty=t}return t}function s(e,t,a){this._targetCollection=e,this._targetId=t,this._targetPropertyNames=a,this._targetProperty=void 0,this._targetEntity=void 0,this._definitionChanged=new n.default,e.collectionChanged.addEventListener(s.prototype._onCollectionChanged,this)}Object.defineProperties(s.prototype,{isConstant:{get:function(){return r.default.isConstant(o(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){var e=o(this);return Object(i.default)(e)?e.referenceFrame:void 0}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return o(this)}}}),s.fromString=function(e,t){for(var a,i=[],n=!0,r=!1,o="",l=0;l<t.length;++l){var u=t.charAt(l);r?(o+=u,r=!1):"\\"===u?r=!0:n&&"#"===u?(a=o,n=!1,o=""):n||"."!==u?o+=u:(i.push(o),o="")}return i.push(o),new s(e,a,i)},s.prototype.getValue=function(e,t){var a=o(this);return Object(i.default)(a)?a.getValue(e,t):void 0},s.prototype.getValueInReferenceFrame=function(e,t,a){var n=o(this);return Object(i.default)(n)?n.getValueInReferenceFrame(e,t,a):void 0},s.prototype.getType=function(e){var t=o(this);return Object(i.default)(t)?t.getType(e):void 0},s.prototype.equals=function(e){if(this===e)return!0;var t=this._targetPropertyNames,a=e._targetPropertyNames;if(this._targetCollection!==e._targetCollection||this._targetId!==e._targetId||t.length!==a.length)return!1;for(var i=this._targetPropertyNames.length,n=0;n<i;n++)if(t[n]!==a[n])return!1;return!0},s.prototype._onTargetEntityDefinitionChanged=function(e,t,a,n){Object(i.default)(this._targetProperty)&&this._targetPropertyNames[0]===t&&(this._targetProperty=void 0,this._definitionChanged.raiseEvent(this))},s.prototype._onCollectionChanged=function(e,t,a){var n=this._targetEntity;Object(i.default)(n)&&-1!==a.indexOf(n)?(n.definitionChanged.removeEventListener(s.prototype._onTargetEntityDefinitionChanged,this),this._targetEntity=this._targetProperty=void 0):Object(i.default)(n)||(n=o(this),Object(i.default)(n)&&this._definitionChanged.raiseEvent(this))},t.a=s},368:function(e,t,a){"use strict";var i=a(94),n=a(33),r=a(12),o=(a(15),a(35)),s=a(9),l=a(8),u=(a(10),a(51)),d=a(52),c=a(64),f=a(86),h=a(46),m=a(78),p=new r.default;function _(e){var t=(e=Object(s.default)(e,s.default.EMPTY_OBJECT)).minimum,a=e.maximum,i=Object(s.default)(e.vertexFormat,m.default.DEFAULT);this._minimum=r.default.clone(t),this._maximum=r.default.clone(a),this._vertexFormat=i,this._offsetAttribute=e.offsetAttribute,this._workerName="createBoxGeometry"}_.fromDimensions=function(e){var t=(e=Object(s.default)(e,s.default.EMPTY_OBJECT)).dimensions,a=r.default.multiplyByScalar(t,.5,new r.default);return new _({minimum:r.default.negate(a,new r.default),maximum:a,vertexFormat:e.vertexFormat,offsetAttribute:e.offsetAttribute})},_.fromAxisAlignedBoundingBox=function(e){return new _({minimum:e.minimum,maximum:e.maximum})},_.packedLength=2*r.default.packedLength+m.default.packedLength+1,_.pack=function(e,t,a){return a=Object(s.default)(a,0),r.default.pack(e._minimum,t,a),r.default.pack(e._maximum,t,a+r.default.packedLength),m.default.pack(e._vertexFormat,t,a+2*r.default.packedLength),t[a+2*r.default.packedLength+m.default.packedLength]=Object(s.default)(e._offsetAttribute,-1),t};var g,v=new r.default,y=new r.default,b=new m.default,w={minimum:v,maximum:y,vertexFormat:b,offsetAttribute:void 0};_.unpack=function(e,t,a){t=Object(s.default)(t,0);var i=r.default.unpack(e,t,v),n=r.default.unpack(e,t+r.default.packedLength,y),o=m.default.unpack(e,t+2*r.default.packedLength,b),u=e[t+2*r.default.packedLength+m.default.packedLength];return Object(l.default)(a)?(a._minimum=r.default.clone(i,a._minimum),a._maximum=r.default.clone(n,a._maximum),a._vertexFormat=m.default.clone(o,a._vertexFormat),a._offsetAttribute=-1===u?void 0:u,a):(w.offsetAttribute=-1===u?void 0:u,new _(w))},_.createGeometry=function(e){var t=e._minimum,a=e._maximum,s=e._vertexFormat;if(!r.default.equals(t,a)){var m,_,g=new c.a;if(s.position&&(s.st||s.normal||s.tangent||s.bitangent)){if(s.position&&((_=new Float64Array(72))[0]=t.x,_[1]=t.y,_[2]=a.z,_[3]=a.x,_[4]=t.y,_[5]=a.z,_[6]=a.x,_[7]=a.y,_[8]=a.z,_[9]=t.x,_[10]=a.y,_[11]=a.z,_[12]=t.x,_[13]=t.y,_[14]=t.z,_[15]=a.x,_[16]=t.y,_[17]=t.z,_[18]=a.x,_[19]=a.y,_[20]=t.z,_[21]=t.x,_[22]=a.y,_[23]=t.z,_[24]=a.x,_[25]=t.y,_[26]=t.z,_[27]=a.x,_[28]=a.y,_[29]=t.z,_[30]=a.x,_[31]=a.y,_[32]=a.z,_[33]=a.x,_[34]=t.y,_[35]=a.z,_[36]=t.x,_[37]=t.y,_[38]=t.z,_[39]=t.x,_[40]=a.y,_[41]=t.z,_[42]=t.x,_[43]=a.y,_[44]=a.z,_[45]=t.x,_[46]=t.y,_[47]=a.z,_[48]=t.x,_[49]=a.y,_[50]=t.z,_[51]=a.x,_[52]=a.y,_[53]=t.z,_[54]=a.x,_[55]=a.y,_[56]=a.z,_[57]=t.x,_[58]=a.y,_[59]=a.z,_[60]=t.x,_[61]=t.y,_[62]=t.z,_[63]=a.x,_[64]=t.y,_[65]=t.z,_[66]=a.x,_[67]=t.y,_[68]=a.z,_[69]=t.x,_[70]=t.y,_[71]=a.z,g.position=new d.a({componentDatatype:o.a.DOUBLE,componentsPerAttribute:3,values:_})),s.normal){var v=new Float32Array(72);v[0]=0,v[1]=0,v[2]=1,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=1,v[9]=0,v[10]=0,v[11]=1,v[12]=0,v[13]=0,v[14]=-1,v[15]=0,v[16]=0,v[17]=-1,v[18]=0,v[19]=0,v[20]=-1,v[21]=0,v[22]=0,v[23]=-1,v[24]=1,v[25]=0,v[26]=0,v[27]=1,v[28]=0,v[29]=0,v[30]=1,v[31]=0,v[32]=0,v[33]=1,v[34]=0,v[35]=0,v[36]=-1,v[37]=0,v[38]=0,v[39]=-1,v[40]=0,v[41]=0,v[42]=-1,v[43]=0,v[44]=0,v[45]=-1,v[46]=0,v[47]=0,v[48]=0,v[49]=1,v[50]=0,v[51]=0,v[52]=1,v[53]=0,v[54]=0,v[55]=1,v[56]=0,v[57]=0,v[58]=1,v[59]=0,v[60]=0,v[61]=-1,v[62]=0,v[63]=0,v[64]=-1,v[65]=0,v[66]=0,v[67]=-1,v[68]=0,v[69]=0,v[70]=-1,v[71]=0,g.normal=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:v})}if(s.st){var y=new Float32Array(48);y[0]=0,y[1]=0,y[2]=1,y[3]=0,y[4]=1,y[5]=1,y[6]=0,y[7]=1,y[8]=1,y[9]=0,y[10]=0,y[11]=0,y[12]=0,y[13]=1,y[14]=1,y[15]=1,y[16]=0,y[17]=0,y[18]=1,y[19]=0,y[20]=1,y[21]=1,y[22]=0,y[23]=1,y[24]=1,y[25]=0,y[26]=0,y[27]=0,y[28]=0,y[29]=1,y[30]=1,y[31]=1,y[32]=1,y[33]=0,y[34]=0,y[35]=0,y[36]=0,y[37]=1,y[38]=1,y[39]=1,y[40]=0,y[41]=0,y[42]=1,y[43]=0,y[44]=1,y[45]=1,y[46]=0,y[47]=1,g.st=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:2,values:y})}if(s.tangent){var b=new Float32Array(72);b[0]=1,b[1]=0,b[2]=0,b[3]=1,b[4]=0,b[5]=0,b[6]=1,b[7]=0,b[8]=0,b[9]=1,b[10]=0,b[11]=0,b[12]=-1,b[13]=0,b[14]=0,b[15]=-1,b[16]=0,b[17]=0,b[18]=-1,b[19]=0,b[20]=0,b[21]=-1,b[22]=0,b[23]=0,b[24]=0,b[25]=1,b[26]=0,b[27]=0,b[28]=1,b[29]=0,b[30]=0,b[31]=1,b[32]=0,b[33]=0,b[34]=1,b[35]=0,b[36]=0,b[37]=-1,b[38]=0,b[39]=0,b[40]=-1,b[41]=0,b[42]=0,b[43]=-1,b[44]=0,b[45]=0,b[46]=-1,b[47]=0,b[48]=-1,b[49]=0,b[50]=0,b[51]=-1,b[52]=0,b[53]=0,b[54]=-1,b[55]=0,b[56]=0,b[57]=-1,b[58]=0,b[59]=0,b[60]=1,b[61]=0,b[62]=0,b[63]=1,b[64]=0,b[65]=0,b[66]=1,b[67]=0,b[68]=0,b[69]=1,b[70]=0,b[71]=0,g.tangent=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:b})}if(s.bitangent){var w=new Float32Array(72);w[0]=0,w[1]=1,w[2]=0,w[3]=0,w[4]=1,w[5]=0,w[6]=0,w[7]=1,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=1,w[14]=0,w[15]=0,w[16]=1,w[17]=0,w[18]=0,w[19]=1,w[20]=0,w[21]=0,w[22]=1,w[23]=0,w[24]=0,w[25]=0,w[26]=1,w[27]=0,w[28]=0,w[29]=1,w[30]=0,w[31]=0,w[32]=1,w[33]=0,w[34]=0,w[35]=1,w[36]=0,w[37]=0,w[38]=1,w[39]=0,w[40]=0,w[41]=1,w[42]=0,w[43]=0,w[44]=1,w[45]=0,w[46]=0,w[47]=1,w[48]=0,w[49]=0,w[50]=1,w[51]=0,w[52]=0,w[53]=1,w[54]=0,w[55]=0,w[56]=1,w[57]=0,w[58]=0,w[59]=1,w[60]=0,w[61]=0,w[62]=1,w[63]=0,w[64]=0,w[65]=1,w[66]=0,w[67]=0,w[68]=1,w[69]=0,w[70]=0,w[71]=1,g.bitangent=new d.a({componentDatatype:o.a.FLOAT,componentsPerAttribute:3,values:w})}(m=new Uint16Array(36))[0]=0,m[1]=1,m[2]=2,m[3]=0,m[4]=2,m[5]=3,m[6]=6,m[7]=5,m[8]=4,m[9]=7,m[10]=6,m[11]=4,m[12]=8,m[13]=9,m[14]=10,m[15]=8,m[16]=10,m[17]=11,m[18]=14,m[19]=13,m[20]=12,m[21]=15,m[22]=14,m[23]=12,m[24]=18,m[25]=17,m[26]=16,m[27]=19,m[28]=18,m[29]=16,m[30]=20,m[31]=21,m[32]=22,m[33]=20,m[34]=22,m[35]=23}else(_=new Float64Array(24))[0]=t.x,_[1]=t.y,_[2]=t.z,_[3]=a.x,_[4]=t.y,_[5]=t.z,_[6]=a.x,_[7]=a.y,_[8]=t.z,_[9]=t.x,_[10]=a.y,_[11]=t.z,_[12]=t.x,_[13]=t.y,_[14]=a.z,_[15]=a.x,_[16]=t.y,_[17]=a.z,_[18]=a.x,_[19]=a.y,_[20]=a.z,_[21]=t.x,_[22]=a.y,_[23]=a.z,g.position=new d.a({componentDatatype:o.a.DOUBLE,componentsPerAttribute:3,values:_}),(m=new Uint16Array(36))[0]=4,m[1]=5,m[2]=6,m[3]=4,m[4]=6,m[5]=7,m[6]=1,m[7]=0,m[8]=3,m[9]=1,m[10]=3,m[11]=2,m[12]=1,m[13]=6,m[14]=5,m[15]=1,m[16]=2,m[17]=6,m[18]=2,m[19]=3,m[20]=7,m[21]=2,m[22]=7,m[23]=6,m[24]=3,m[25]=0,m[26]=4,m[27]=3,m[28]=4,m[29]=7,m[30]=0,m[31]=1,m[32]=5,m[33]=0,m[34]=5,m[35]=4;var C=r.default.subtract(a,t,p),O=.5*r.default.magnitude(C);if(Object(l.default)(e._offsetAttribute)){var x=_.length,T=new Uint8Array(x/3),E=e._offsetAttribute===f.a.NONE?0:1;Object(i.a)(T,E),g.applyOffset=new d.a({componentDatatype:o.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})}return new u.a({attributes:g,indices:m,primitiveType:h.a.TRIANGLES,boundingSphere:new n.default(r.default.ZERO,O),offsetAttribute:e._offsetAttribute})}},_.getUnitBox=function(){return Object(l.default)(g)||(g=_.createGeometry(_.fromDimensions({dimensions:new r.default(1,1,1),vertexFormat:m.default.POSITION_ONLY}))),g},t.a=_},369:function(e,t,a){"use strict";var i=a(74),n=a(9),r=a(8),o=a(18);a(10);function s(e){e=Object(n.default)(e,n.default.EMPTY_OBJECT),this._primitives=[],this._guid=Object(i.default)(),this._zIndex=void 0,this.show=Object(n.default)(e.show,!0),this.destroyPrimitives=Object(n.default)(e.destroyPrimitives,!0)}function l(e,t){return e._primitives.indexOf(t)}Object.defineProperties(s.prototype,{length:{get:function(){return this._primitives.length}}}),s.prototype.add=function(e,t){var a=Object(r.default)(t),i=e._external=e._external||{};return(i._composites=i._composites||{})[this._guid]={collection:this},a?this._primitives.splice(t,0,e):this._primitives.push(e),e},s.prototype.remove=function(e){if(this.contains(e)){var t=this._primitives.indexOf(e);if(-1!==t)return this._primitives.splice(t,1),delete e._external._composites[this._guid],this.destroyPrimitives&&e.destroy(),!0}return!1},s.prototype.removeAndDestroy=function(e){var t=this.remove(e);return t&&!this.destroyPrimitives&&e.destroy(),t},s.prototype.removeAll=function(){for(var e=this._primitives,t=e.length,a=0;a<t;++a)delete e[a]._external._composites[this._guid],this.destroyPrimitives&&e[a].destroy();this._primitives=[]},s.prototype.contains=function(e){return!!(Object(r.default)(e)&&e._external&&e._external._composites&&e._external._composites[this._guid])},s.prototype.raise=function(e){if(Object(r.default)(e)){var t=l(this,e),a=this._primitives;if(t!==a.length-1){var i=a[t];a[t]=a[t+1],a[t+1]=i}}},s.prototype.raiseToTop=function(e){if(Object(r.default)(e)){var t=l(this,e),a=this._primitives;t!==a.length-1&&(a.splice(t,1),a.push(e))}},s.prototype.lower=function(e){if(Object(r.default)(e)){var t=l(this,e),a=this._primitives;if(0!==t){var i=a[t];a[t]=a[t-1],a[t-1]=i}}},s.prototype.lowerToBottom=function(e){if(Object(r.default)(e)){var t=l(this,e),a=this._primitives;0!==t&&(a.splice(t,1),a.unshift(e))}},s.prototype.get=function(e){return this._primitives[e]},s.prototype.update=function(e){if(this.show)for(var t=this._primitives,a=0;a<t.length;++a)t[a].update(e)},s.prototype.prePassesUpdate=function(e){for(var t=this._primitives,a=0;a<t.length;++a){var i=t[a];Object(r.default)(i.prePassesUpdate)&&i.prePassesUpdate(e)}},s.prototype.updateForPass=function(e,t){for(var a=this._primitives,i=0;i<a.length;++i){var n=a[i];Object(r.default)(n.updateForPass)&&n.updateForPass(e,t)}},s.prototype.postPassesUpdate=function(e){for(var t=this._primitives,a=0;a<t.length;++a){var i=t[a];Object(r.default)(i.postPassesUpdate)&&i.postPassesUpdate(e)}},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this.removeAll(),Object(o.default)(this)},t.a=s},511:function(e,t,a){"use strict";var i=a(8),n=(a(10),a(27)),r=a(23),o=a(140),s=a(39);function l(e){this._definitionChanged=new r.default,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object.defineProperties(l.prototype,{isConstant:{get:function(){return s.default.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return Object(i.default)(this._value)?this._value.referenceFrame:o.a.FIXED}}}),l.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,o.a.FIXED,t)},l.prototype.setValue=function(e){this._value!==e&&(this._value=e,Object(i.default)(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),Object(i.default)(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))},l.prototype.getValueInReferenceFrame=function(e,t,a){if(Object(i.default)(this._value))return a=this._value.getValueInReferenceFrame(e,t,a),Object(i.default)(a)?n.default.WGS84.scaleToGeodeticSurface(a,a):void 0},l.prototype.equals=function(e){return this===e||e instanceof l&&this._value===e._value},l.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},t.a=l},512:function(e,t,a){"use strict";var i=a(94),n=a(33),r=a(24),o=a(12),s=a(35),l=a(9),u=a(8),d=(a(10),a(27)),c=a(51),f=a(52),h=a(64),m=a(86),p=a(47),_=a(14),g=a(46),v=a(78),y=new o.default,b=new o.default,w=new o.default,C=new o.default,O=new o.default,x=new o.default(1,1,1),T=Math.cos,E=Math.sin;function A(e){e=Object(l.default)(e,l.default.EMPTY_OBJECT);var t=Object(l.default)(e.radii,x),a=Object(l.default)(e.innerRadii,t),i=Object(l.default)(e.minimumClock,0),n=Object(l.default)(e.maximumClock,_.default.TWO_PI),r=Object(l.default)(e.minimumCone,0),s=Object(l.default)(e.maximumCone,_.default.PI),u=Math.round(Object(l.default)(e.stackPartitions,64)),d=Math.round(Object(l.default)(e.slicePartitions,64)),c=Object(l.default)(e.vertexFormat,v.default.DEFAULT);this._radii=o.default.clone(t),this._innerRadii=o.default.clone(a),this._minimumClock=i,this._maximumClock=n,this._minimumCone=r,this._maximumCone=s,this._stackPartitions=u,this._slicePartitions=d,this._vertexFormat=v.default.clone(c),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipsoidGeometry"}A.packedLength=2*o.default.packedLength+v.default.packedLength+7,A.pack=function(e,t,a){return a=Object(l.default)(a,0),o.default.pack(e._radii,t,a),a+=o.default.packedLength,o.default.pack(e._innerRadii,t,a),a+=o.default.packedLength,v.default.pack(e._vertexFormat,t,a),a+=v.default.packedLength,t[a++]=e._minimumClock,t[a++]=e._maximumClock,t[a++]=e._minimumCone,t[a++]=e._maximumCone,t[a++]=e._stackPartitions,t[a++]=e._slicePartitions,t[a]=Object(l.default)(e._offsetAttribute,-1),t};var P,S=new o.default,D=new o.default,F=new v.default,M={radii:S,innerRadii:D,vertexFormat:F,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};A.unpack=function(e,t,a){t=Object(l.default)(t,0);var i=o.default.unpack(e,t,S);t+=o.default.packedLength;var n=o.default.unpack(e,t,D);t+=o.default.packedLength;var r=v.default.unpack(e,t,F);t+=v.default.packedLength;var s=e[t++],d=e[t++],c=e[t++],f=e[t++],h=e[t++],m=e[t++],p=e[t];return Object(u.default)(a)?(a._radii=o.default.clone(i,a._radii),a._innerRadii=o.default.clone(n,a._innerRadii),a._vertexFormat=v.default.clone(r,a._vertexFormat),a._minimumClock=s,a._maximumClock=d,a._minimumCone=c,a._maximumCone=f,a._stackPartitions=h,a._slicePartitions=m,a._offsetAttribute=-1===p?void 0:p,a):(M.minimumClock=s,M.maximumClock=d,M.minimumCone=c,M.maximumCone=f,M.stackPartitions=h,M.slicePartitions=m,M.offsetAttribute=-1===p?void 0:p,new A(M))},A.createGeometry=function(e){var t=e._radii;if(!(t.x<=0||t.y<=0||t.z<=0)){var a=e._innerRadii;if(!(a.x<=0||a.y<=0||a.z<=0)){var l,v,x=e._minimumClock,A=e._maximumClock,P=e._minimumCone,S=e._maximumCone,D=e._vertexFormat,F=e._slicePartitions+1,M=e._stackPartitions+1;(F=Math.round(F*Math.abs(A-x)/_.default.TWO_PI))<2&&(F=2),(M=Math.round(M*Math.abs(S-P)/_.default.PI))<2&&(M=2);var I=0,R=[P],N=[x];for(l=0;l<M;l++)R.push(P+l*(S-P)/(M-1));for(R.push(S),v=0;v<F;v++)N.push(x+v*(A-x)/(F-1));N.push(A);var L=R.length,j=N.length,V=0,U=1,B=a.x!==t.x||a.y!==t.y||a.z!==t.z,z=!1,H=!1,k=!1;B&&(U=2,P>0&&(z=!0,V+=F-1),S<Math.PI&&(H=!0,V+=F-1),(A-x)%_.default.TWO_PI?(k=!0,V+=2*(M-1)+1):V+=1);var G=j*L*U,W=new Float64Array(3*G),Y=Object(i.a)(new Array(G),!1),X=Object(i.a)(new Array(G),!1),Q=F*M*U,q=6*(Q+V+1-(F+M)*U),Z=p.a.createTypedArray(Q,q),K=D.normal?new Float32Array(3*G):void 0,J=D.tangent?new Float32Array(3*G):void 0,$=D.bitangent?new Float32Array(3*G):void 0,ee=D.st?new Float32Array(2*G):void 0,te=new Array(L),ae=new Array(L);for(l=0;l<L;l++)te[l]=E(R[l]),ae[l]=T(R[l]);var ie=new Array(j),ne=new Array(j);for(v=0;v<j;v++)ne[v]=T(N[v]),ie[v]=E(N[v]);for(l=0;l<L;l++)for(v=0;v<j;v++)W[I++]=t.x*te[l]*ne[v],W[I++]=t.y*te[l]*ie[v],W[I++]=t.z*ae[l];var re,oe,se,le,ue=G/2;if(B)for(l=0;l<L;l++)for(v=0;v<j;v++)W[I++]=a.x*te[l]*ne[v],W[I++]=a.y*te[l]*ie[v],W[I++]=a.z*ae[l],Y[ue]=!0,l>0&&l!==L-1&&0!==v&&v!==j-1&&(X[ue]=!0),ue++;for(I=0,l=1;l<L-2;l++)for(re=l*j,oe=(l+1)*j,v=1;v<j-2;v++)Z[I++]=oe+v,Z[I++]=oe+v+1,Z[I++]=re+v+1,Z[I++]=oe+v,Z[I++]=re+v+1,Z[I++]=re+v;if(B){var de=L*j;for(l=1;l<L-2;l++)for(re=de+l*j,oe=de+(l+1)*j,v=1;v<j-2;v++)Z[I++]=oe+v,Z[I++]=re+v,Z[I++]=re+v+1,Z[I++]=oe+v,Z[I++]=re+v+1,Z[I++]=oe+v+1}if(B){if(z)for(le=L*j,l=1;l<j-2;l++)Z[I++]=l,Z[I++]=l+1,Z[I++]=le+l+1,Z[I++]=l,Z[I++]=le+l+1,Z[I++]=le+l;if(H)for(se=L*j-j,le=L*j*U-j,l=1;l<j-2;l++)Z[I++]=se+l+1,Z[I++]=se+l,Z[I++]=le+l,Z[I++]=se+l+1,Z[I++]=le+l,Z[I++]=le+l+1}if(k){for(l=1;l<L-2;l++)le=j*L+j*l,se=j*l,Z[I++]=le,Z[I++]=se+j,Z[I++]=se,Z[I++]=le,Z[I++]=le+j,Z[I++]=se+j;for(l=1;l<L-2;l++)le=j*L+j*(l+1)-1,se=j*(l+1)-1,Z[I++]=se+j,Z[I++]=le,Z[I++]=se,Z[I++]=se+j,Z[I++]=le+j,Z[I++]=le}var ce=new h.a;D.position&&(ce.position=new f.a({componentDatatype:s.a.DOUBLE,componentsPerAttribute:3,values:W}));var fe,he=0,me=0,pe=0,_e=0,ge=G/2,ve=d.default.fromCartesian3(t),ye=d.default.fromCartesian3(a);if(D.st||D.normal||D.tangent||D.bitangent){for(l=0;l<G;l++){fe=Y[l]?ye:ve;var be=o.default.fromArray(W,3*l,y),we=fe.geodeticSurfaceNormal(be,b);if(X[l]&&o.default.negate(we,we),D.st){var Ce=r.default.negate(we,O);ee[he++]=Math.atan2(Ce.y,Ce.x)/_.default.TWO_PI+.5,ee[he++]=Math.asin(we.z)/Math.PI+.5}if(D.normal&&(K[me++]=we.x,K[me++]=we.y,K[me++]=we.z),D.tangent||D.bitangent){var Oe,xe=w,Te=0;if(Y[l]&&(Te=ge),Oe=!z&&l>=Te&&l<Te+2*j?o.default.UNIT_X:o.default.UNIT_Z,o.default.cross(Oe,we,xe),o.default.normalize(xe,xe),D.tangent&&(J[pe++]=xe.x,J[pe++]=xe.y,J[pe++]=xe.z),D.bitangent){var Ee=o.default.cross(we,xe,C);o.default.normalize(Ee,Ee),$[_e++]=Ee.x,$[_e++]=Ee.y,$[_e++]=Ee.z}}}D.st&&(ce.st=new f.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:2,values:ee})),D.normal&&(ce.normal=new f.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:K})),D.tangent&&(ce.tangent=new f.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:J})),D.bitangent&&(ce.bitangent=new f.a({componentDatatype:s.a.FLOAT,componentsPerAttribute:3,values:$}))}if(Object(u.default)(e._offsetAttribute)){var Ae=W.length,Pe=new Uint8Array(Ae/3),Se=e._offsetAttribute===m.a.NONE?0:1;Object(i.a)(Pe,Se),ce.applyOffset=new f.a({componentDatatype:s.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Pe})}return new c.a({attributes:ce,indices:Z,primitiveType:g.a.TRIANGLES,boundingSphere:n.default.fromEllipsoid(ve),offsetAttribute:e._offsetAttribute})}}},A.getUnitEllipsoid=function(){return Object(u.default)(P)||(P=A.createGeometry(new A({radii:new o.default(1,1,1),vertexFormat:v.default.POSITION_ONLY}))),P},t.a=A},761:function(e,t,a){"use strict";function i(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var n=a(33).default,r=a(88).default,o=a(24).default,s=a(12).default,l=a(30).default,u=a(14).default,d=a(9).default,c=a(8).default,f=a(18).default,h=a(10).default,m=a(27).default,p=a(145).default,_=a(199).default,g=a(96).default,v=a(351).default,y=a(372).default,b=a(42).default,w=a(22).default,C=a(147),O=a(28).default,x=a(29).default,T=a(344).default,E=a(186).default,A=a(211).default,P=a(133).default,S=a(62).default,D=a(16).default,F=a(144).default,M=a(130).default,I=a(1627),R=a(226),N=a(417),L=a(25),j=a(405),V=a(37),U=a(426),B=a(172),z=a(20).default,H=function(e,t){N.call(this,e),this.viewer=t,this.scene=t.scene,this.stoppedRendering=!1,this.verboseRendering=!1,this.canShowSplitter=!0,this.dataSourceDisplay=void 0,this._lastClockTime=new b(0,0),this._lastCameraViewMatrix=new O,this._lastCameraMoveTime=0,this._selectionIndicator=new I(this),this._removePostRenderListener=this.scene.postRender.addEventListener(ie.bind(void 0,this)),this._removeInfoBoxCloseListener=void 0,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this._pauseMapInteractionCount=0,this.scene.imagerySplitPosition=this.terria.splitPosition,this.supportsPolylinesOnTerrain=this.scene.context.depthTexture,t.screenSpaceEventHandler.setInputAction(function(e){this.pickFromScreenPosition(e.position)}.bind(this),A.LEFT_CLICK);var a=this.viewer.canvas;if(a.addEventListener("mousemove",this._boundNotifyRepaintRequired,!1),a.addEventListener("mousedown",this._boundNotifyRepaintRequired,!1),a.addEventListener("mouseup",this._boundNotifyRepaintRequired,!1),a.addEventListener("touchstart",this._boundNotifyRepaintRequired,!1),a.addEventListener("touchend",this._boundNotifyRepaintRequired,!1),a.addEventListener("touchmove",this._boundNotifyRepaintRequired,!1),c(window.PointerEvent)&&(a.addEventListener("pointerdown",this._boundNotifyRepaintRequired,!1),a.addEventListener("pointerup",this._boundNotifyRepaintRequired,!1),a.addEventListener("pointermove",this._boundNotifyRepaintRequired,!1)),this._wheelEvent=void 0,"onwheel"in a?this._wheelEvent="wheel":c(document.onmousewheel)?this._wheelEvent="mousewheel":this._wheelEvent="DOMMouseScroll",a.addEventListener(this._wheelEvent,this._boundNotifyRepaintRequired,!1),window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),c(this.viewer.infoBox)&&(this._removeInfoBoxCloseListener=this.viewer.infoBox.viewModel.closeClicked.addEventListener(this._boundNotifyRepaintRequired)),c(this.viewer._clockViewModel)){var i=this.viewer._clockViewModel;this._shouldAnimateSubscription=w.getObservable(i,"shouldAnimate").subscribe(this._boundNotifyRepaintRequired),this._currentTimeSubscription=w.getObservable(i,"currentTime").subscribe(this._boundNotifyRepaintRequired)}c(this.viewer.timeline)&&this.viewer.timeline.addEventListener("settime",this._boundNotifyRepaintRequired,!1),this._selectedFeatureSubscription=w.getObservable(this.terria,"selectedFeature").subscribe((function(){ne(this)}),this),this._splitterPositionSubscription=w.getObservable(this.terria,"splitPosition").subscribe((function(){this.scene&&(this.scene.imagerySplitPosition=this.terria.splitPosition,this.notifyRepaintRequired())}),this),this._showSplitterSubscription=w.getObservable(e,"showSplitter").subscribe((function(){this.updateAllItemsForSplitter()}),this);var n=this;this._originalLoadWithXhr=C.load,C.load=function(e,t,a,i,r,o,s,l,u){o.promise.always(n._boundNotifyRepaintRequired),n._originalLoadWithXhr(e,t,a,i,r,o,s,l,u)},this._originalScheduleTask=P.prototype.scheduleTask,P.prototype.scheduleTask=function(e,t){var a=n._originalScheduleTask.call(this,e,t);if(!c(this._originalWorkerMessageSinkRepaint)){this._originalWorkerMessageSinkRepaint=this._worker.onmessage;var i=this;this._worker.onmessage=function(e){i._originalWorkerMessageSinkRepaint(e),n.isDestroyed()?(i._worker.onmessage=i._originalWorkerMessageSinkRepaint,i._originalWorkerMessageSinkRepaint=void 0):n.notifyRepaintRequired()}}return a},this.eventHelper=new F,this.eventHelper.add(this.scene.renderError,(function(t,a){this.terria.error.raiseEvent(new V({sender:this,title:z.t("models.cesiumTerrain.errorRenderingTitle"),message:z.t("models.cesiumTerrain.errorRenderingTitle",{appName:e.appName,email:'<a href="mailto:'+e.supportEmail+'">'+e.supportEmail+"</a>."})+"<pre>"+_(a)+"</pre>"})),this.terria.viewerMode=B.Leaflet}),this),this.eventHelper.add(this.scene.globe.tileLoadProgressEvent,this.updateTilesLoadingCount.bind(this)),ne(this)};L(N,H),H.prototype.destroy=function(){return c(this._selectionIndicator)&&(this._selectionIndicator.destroy(),this._selectionIndicator=void 0),c(this._removePostRenderListener)&&(this._removePostRenderListener(),this._removePostRenderListener=void 0),c(this._removeInfoBoxCloseListener)&&this._removeInfoBoxCloseListener(),c(this._shouldAnimateSubscription)&&(this._shouldAnimateSubscription.dispose(),this._shouldAnimateSubscription=void 0),c(this._currentTimeSubscription)&&(this._currentTimeSubscription.dispose(),this._currentTimeSubscription=void 0),c(this.viewer.timeline)&&this.viewer.timeline.removeEventListener("settime",this._boundNotifyRepaintRequired,!1),c(this._selectedFeatureSubscription)&&(this._selectedFeatureSubscription.dispose(),this._selectedFeatureSubscription=void 0),c(this._splitterPositionSubscription)&&(this._splitterPositionSubscription.dispose(),this._splitterPositionSubscription=void 0),c(this._showSplitterSubscription)&&(this._showSplitterSubscription.dispose(),this._showSplitterSubscription=void 0),this.viewer.canvas.removeEventListener("mousemove",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("mousedown",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("mouseup",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchstart",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchend",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("touchmove",this._boundNotifyRepaintRequired,!1),c(window.PointerEvent)&&(this.viewer.canvas.removeEventListener("pointerdown",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("pointerup",this._boundNotifyRepaintRequired,!1),this.viewer.canvas.removeEventListener("pointermove",this._boundNotifyRepaintRequired,!1)),this.viewer.canvas.removeEventListener(this._wheelEvent,this._boundNotifyRepaintRequired,!1),window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),window.removeEventListener("resize",this._setViewerResolution,!1),C.load=this._originalLoadWithXhr,P.prototype.scheduleTask=this._originalScheduleTask,this.eventHelper.removeAll(),N.disposeCommonListeners(this),f(this)},H.prototype.isDestroyed=function(){return!1};var k=new s,G=new O,W=new s,Y=new s,X=new s,Q=new s,q=new l,Z=new l,K=new l,J=new l;H.prototype.getCurrentExtent=function(){var e=this.scene,t=e.camera,a=e.canvas.clientWidth,i=e.canvas.clientHeight,n=new o(a/2,i/2),r=e.camera.getPickRay(n),l=e.globe.pick(r,e);if(!c(l))return this.terria.homeView.rectangle;var d=this.scene.globe.ellipsoid,f=.5*e.camera.frustum.fovy,h=Math.atan(Math.tan(f)*e.camera.frustum.aspectRatio),m=s.subtract(t.positionWC,l,k),p=s.magnitude(m),_=p*Math.tan(h),g=p*Math.tan(f),v=new s(-_,-g,0),y=new s(_,-g,0),b=new s(_,g,0),w=new s(-_,g,0),C=S.eastNorthUpToFixedFrame(l,d,G),T=O.multiplyByPoint(C,v,W),E=O.multiplyByPoint(C,y,Y),A=O.multiplyByPoint(C,b,X),P=O.multiplyByPoint(C,w,Q),D=d.cartesianToCartographic(T,q),F=d.cartesianToCartographic(E,Z),M=d.cartesianToCartographic(A,K),I=d.cartesianToCartographic(P,J);F.longitude<D.longitude&&(F.longitude+=u.TWO_PI),M.longitude<I.longitude&&(M.longitude+=u.TWO_PI);var R=new x(u.convertLongitudeRange(Math.min(D.longitude,I.longitude)),Math.min(D.latitude,F.latitude),u.convertLongitudeRange(Math.max(M.longitude,F.longitude)),Math.max(M.latitude,I.latitude));return R.center=l,R},H.prototype.getContainer=function(){return this.viewer.container},H.prototype.zoomTo=function(e,t){if(!c(e))throw new h("target is required.");t=d(t,3);var a=this;return a.lastTarget=e,D().then((function(){if(e instanceof x){var i=a.scene.camera,n=i.getRectangleCameraCoordinates(e),r=m.WGS84.cartesianToCartographic(n),o=a.scene.globe.terrainProvider,s=[x.center(e)];return T(o,6,s).then((function(n){if(a.lastTarget===e){var o={longitude:r.longitude,latitude:r.latitude,height:r.height+n[0].height},s=m.WGS84.cartographicToCartesian(o);i.flyTo({duration:t,destination:s})}}))}if(c(e.entities)){if(e.isLoading&&c(e.loadingEvent)){var l=D.defer(),u=e.loadingEvent.addEventListener((function(){u(),l.resolve()}));return l.promise.then((function(){if(a.lastTarget===e)return ee(a,e,t)}))}return ee(a,e)}return c(e.readyPromise)?e.readyPromise.then((function(){c(e.boundingSphere)&&a.lastTarget===e&&te(a,e,t)})):c(e.boundingSphere)?te(a,e):void(c(e.position)?a.scene.camera.flyTo({duration:t,destination:e.position,orientation:{direction:e.direction,up:e.up}}):a.scene.camera.flyTo({duration:t,destination:e.rectangle}))})).then((function(){a.notifyRepaintRequired()}))};var $=new n;function ee(e,t,a){return j((function(){for(var i=e.dataSourceDisplay,o=t.entities.values,s=[],l=0,u=o.length;l<u;l++){var d=r.PENDING;try{d=i.getBoundingSphere(o[l],!1,$)}catch(e){}if(d===r.PENDING)return!1;d!==r.FAILED&&s.push(n.clone($))}var c=n.fromBoundingSpheres(s);return e.scene.camera.flyToBoundingSphere(c,{duration:a}),!0}),{pollInterval:100,timeout:5e3})}function te(e,t,a){var i=t.boundingSphere,r=t.modelMatrix;r&&(i=n.transform(i,r)),e.scene.camera.flyToBoundingSphere(i,{offset:new v(0,-.5,i.radius),duration:a})}function ae(e){return c(e.items)?e.items.length:1}function ie(e,t){var a=g(),i=e.scene;O.equalsEpsilon(e._lastCameraViewMatrix,i.camera.viewMatrix,1e-5)||(e._lastCameraMoveTime=a);var n=a-e._lastCameraMoveTime<1e3,o=i.globe._surface,l=!o._tileProvider.ready||o._tileLoadQueueHigh.length>0||o._tileLoadQueueMedium.length>0||o._tileLoadQueueLow.length>0||o._debug.tilesWaitingForChildren>0;n||l||e.viewer.clock.shouldAnimate||0!==e.scene.tweens.length||(e.verboseRendering&&console.log("stopping rendering @ "+g()),e.viewer.useDefaultRenderLoop=!1,e.stoppedRendering=!0),O.clone(i.camera.viewMatrix,e._lastCameraViewMatrix);var u=e.terria.selectedFeature;if(c(u)){var d;if(c(e.dataSourceDisplay)){var f=c(u.cesiumEntity)?u.cesiumEntity:u;e.dataSourceDisplay.getBoundingSphere(f,!0,$)===r.DONE&&(d=s.clone($.center))}!c(d)&&c(u.position)&&(d=u.position.getValue(e.terria.clock.currentTime)),c(d)&&(e._selectionIndicator.position=d)}e._selectionIndicator.update()}function ne(e){var t=e.terria.selectedFeature;e._highlightFeature(t),c(t)&&c(t.position)?(e._selectionIndicator.position=t.position.getValue(e.terria.clock.currentTime),e._selectionIndicator.animateAppear()):e._selectionIndicator.animateDepart(),e._selectionIndicator.update()}H.prototype.captureScreenshot=function(){var e=D.defer(),t=this.scene.postRender.addEventListener((function(){t();try{var a=this.scene.canvas,i=a;if(this.terria.showSplitter){(i=document.createElement("canvas")).width=a.width,i.height=a.height;var n=i.getContext("2d");n.drawImage(a,0,0);var r=this.terria.splitPosition*a.width;n.strokeStyle=this.terria.baseMapContrastColor,n.beginPath(),n.moveTo(r,0),n.lineTo(r,a.height),n.stroke()}e.resolve(i.toDataURL("image/png"))}catch(t){e.reject(t)}}),this);return this.scene.render(this.terria.clock.currentTime),e.promise},H.prototype.notifyRepaintRequired=function(){this.verboseRendering&&!this.viewer.useDefaultRenderLoop&&console.log("starting rendering @ "+g()),this._lastCameraMoveTime=g(),this.viewer.useDefaultRenderLoop=!0},H.prototype.computePositionOnScreen=function(e,t){return E.wgs84ToWindowCoordinates(this.scene,e,t)},H.prototype.addAttribution=function(e){e&&this.scene.frameState.creditDisplay.addDefaultCredit(e)},H.prototype.removeAttribution=function(e){e&&this.scene.frameState.creditDisplay.removeDefaultCredit(e)},H.prototype.getAllAttribution=function(){return this.scene.frameState.creditDisplay._currentFrameCredits.screenCredits.values.concat(this.scene.frameState.creditDisplay._currentFrameCredits.lightboxCredits.values).map((function(e){return e.html}))},H.prototype.updateLayerOrderToKeepOnTop=function(){for(var e=this.terria.nowViewing.items,t=this.scene,a=e.length-1;a>=0;a--)e[a].imageryLayer&&e[a].keepOnTop&&t.imageryLayers.raiseToTop(e[a].imageryLayer)},H.prototype.updateLayerOrderAfterReorder=function(){},H.prototype.raise=function(e){var t=this.terria.nowViewing.items,a=t[e],i=t[e-1];if(c(i.items)||c(i.imageryLayer)){var n,r,o,s=ae(i);if(c(a.items))for(n=a.items.length-1;n>=0;--n)if(o=a.items[n],c(o.imageryLayer))for(r=0;r<s;++r)this.scene.imageryLayers.raise(o.imageryLayer);if(c(a.imageryLayer))for(r=0;r<s;++r)this.scene.imageryLayers.raise(a.imageryLayer)}},H.prototype.lower=function(e){var t=this.terria.nowViewing.items,a=t[e],i=t[e+1];if(c(i.items)||c(i.imageryLayer)){var n,r,o,s=ae(i);if(c(a.items))for(n=0;n<a.items.length;++n)if(o=a.items[n],c(o.imageryLayer))for(r=0;r<s;++r)this.scene.imageryLayers.lower(o.imageryLayer);if(c(a.imageryLayer))for(r=0;r<s;++r)this.scene.imageryLayers.lower(a.imageryLayer)}},H.prototype.lowerToBottom=function(e){if(c(e.items))for(var t=e.items.length-1;t>=0;--t){var a=e.items[t];this.lowerToBottom(a)}c(e._imageryLayer)&&this.terria.cesium.scene.imageryLayers.lowerToBottom(e._imageryLayer)},H.prototype.adjustDisclaimer=function(){},H.prototype.pickFromLocation=function(e,t,a,i){var n=this.scene.globe.ellipsoid.cartographicToCartesian(l.fromDegrees(e.lng,e.lat,e.height)),r=m.WGS84.cartesianToCartographic(n),o=[],s=[];if(this.terria.allowFeatureInfoRequests)for(var u=this.scene.imageryLayers.length-1;u>=0;u--){var d=this.scene.imageryLayers.get(u),f=d._imageryProvider;if(f.url&&t[f.url]){var h=t[f.url];o.push(f.pickFeatures(h.x,h.y,h.level,r.longitude,r.latitude)),s.push(d)}}var p=this._buildPickedFeatures(t,n,a,o,s,r.height,i),_=this.terria.mapInteractionModeStack;c(_)&&_.length>0?_[_.length-1].pickedFeatures=p:this.terria.pickedFeatures=p},H.prototype.pickFromScreenPosition=function(e,t){var a=this.scene.camera.getPickRay(e),i=this.scene.globe.pick(a,this.scene),n=m.WGS84.cartesianToCartographic(i),r=this.pickVectorFeatures(e),o=this._attachProviderCoordHooks(),s=this.terria.allowFeatureInfoRequests?this.scene.imageryLayers.pickImageryLayerFeatures(a,this.scene):Promise.resolve(),l=this._buildPickedFeatures(o,i,r,[s],void 0,n.height,t),u=this.terria.mapInteractionModeStack;c(u)&&u.length>0?u[u.length-1].pickedFeatures=l:this.terria.pickedFeatures=l},H.prototype.pickVectorFeatures=function(e){for(var t=[],a=this.scene.drillPick(e),n=0;n<a.length;++n){var r=a[n],o=r.id;if(!(o&&o.entityCollection&&o.entityCollection.owner&&o.entityCollection.owner.name===N._featureHighlightName))if(!c(o)&&c(r.primitive)&&(o=r.primitive.id),o instanceof p&&-1===t.indexOf(o)){var s=R.fromEntityCollectionOrEntity(o);t.push(s)}else if(r.primitive&&r.primitive._catalogItem&&r.primitive._catalogItem.getFeaturesFromPickResult){var l=r.primitive._catalogItem.getFeaturesFromPickResult(e,r);l&&(Array.isArray(l)?t.push.apply(t,i(l)):t.push(l))}}return t},H.prototype._attachProviderCoordHooks=function(){for(var e={},t=function(t,a,i,n,r,o,s){var l=a.call(t,i,n,r,o,s);return t.url&&(e[t.url]={x:i,y:n,level:r}),t.pickFeatures=a,l},a=0;a<this.scene.imageryLayers.length;a++){var i=this.scene.imageryLayers.get(a).imageryProvider;i.pickFeatures=t.bind(void 0,i,i.pickFeatures)}return e},H.prototype._buildPickedFeatures=function(e,t,a,i,n,r,o){o=d(o,!1);var s=new U;return s.providerCoords=e,s.pickPosition=t,s.allFeaturesAvailablePromise=D.all(i).then(function(e){s.isLoading=!1,s.features=e.reduce(function(e,a,i){if(!c(a))return e;var l=a.map(function(e){return c(n)&&(e.imageryLayer=n[i]),c(e.position)||(e.position=m.WGS84.cartesianToCartographic(t)),c(e.position.height)&&0!==e.position.height||(e.position.height=r),this._createFeatureFromImageryLayerFeature(e)}.bind(this));if(this.terria.showSplitter&&!o){var u=this.computePositionOnScreen(s.pickPosition),d=this.terria.getSplitterSideForScreenPosition(u);l=l.filter((function(e){var t=e.imageryLayer.splitDirection;return t===d||t===M.NONE}))}return e.concat(l)}.bind(this),d(a,[]))}.bind(this)).otherwise((function(){s.isLoading=!1,s.error="An unknown error occurred while picking features."})),s},H.prototype.addImageryProvider=function(e){var t=this.scene,a=e.imageryProvider.errorEvent;c(a)&&a.addEventListener(e.onLoadError);var i=new y(e.imageryProvider,{show:!1,alpha:e.opacity,rectangle:e.clipToRectangle?e.rectangle:void 0,isRequired:e.isRequiredForRendering});return t.imageryLayers.add(i,e.layerIndex),this.updateLayerOrderToKeepOnTop(),i},H.prototype.removeImageryLayer=function(e){this.scene.imageryLayers.remove(e.layer)},H.prototype.showImageryLayer=function(e){e.layer.show=!0},H.prototype.hideImageryLayer=function(e){e.layer.show=!1},H.prototype.isImageryLayerShown=function(e){return e.layer.show},H.prototype.updateItemForSplitter=function(e){c(e.splitDirection)&&c(e.imageryLayer)&&(e.terria.showSplitter?e.imageryLayer.splitDirection=e.splitDirection:e.imageryLayer.splitDirection=M.NONE,e._nextLayer&&(e._nextLayer.splitDirection=e.imageryLayer.splitDirection),this.notifyRepaintRequired())},H.prototype.pauseMapInteraction=function(){++this._pauseMapInteractionCount,1===this._pauseMapInteractionCount&&(this.scene.screenSpaceCameraController.enableInputs=!1)},H.prototype.resumeMapInteraction=function(){var e=this;--this._pauseMapInteractionCount,0===this._pauseMapInteractionCount&&setTimeout((function(){0===e._pauseMapInteractionCount&&(e.scene.screenSpaceCameraController.enableInputs=!0)}),0)},e.exports=H},763:function(e,t,a){"use strict";a.r(t);var i=a(116),n=a(12),r=a(398),o=a(9),s=a(8),l=a(18),u=a(10),d=a(27),c=a(70),f=a(199),h=a(407),m=a(277),p=a(774),_=a(757);var g=function(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.style,_.default.AERIAL);return new p.default({assetId:t})},v=a(33),y=a(30),b=a(21),w=a(354),C=a(23),O=a(130),x=a(158),T=a(118),E=a(127),A=a(29),P=a(38),S=a(59),D=a(61),F="uniform vec4 u_initialColor;\n\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_DAY_NIGHT_ALPHA\nuniform float u_dayTextureNightAlpha[TEXTURE_UNITS];\nuniform float u_dayTextureDayAlpha[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SPLIT\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\n\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\nuniform highp sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n\n#ifdef SPLIT_TERRAIN\nuniform float u_terrainSplitDirection;\n#endif\n\n#if defined(FOG) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\nuniform float u_minimumBrightness;\n#endif\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n\n#ifdef TRANSLUCENT\nuniform vec4 u_frontFaceAlphaByDistance;\nuniform vec4 u_backFaceAlphaByDistance;\nuniform vec4 u_translucencyRectangle;\n#endif\n\n#ifdef UNDERGROUND_COLOR\nuniform vec4 u_undergroundColor;\nuniform vec4 u_undergroundColorAlphaByDistance;\n#endif\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nfloat interpolateByDistance(vec4 nearFarScalar, float distance)\n{\n    float startDistance = nearFarScalar.x;\n    float startValue = nearFarScalar.y;\n    float endDistance = nearFarScalar.z;\n    float endValue = nearFarScalar.w;\n    float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);\n    return mix(startValue, endValue, t);\n}\n#endif\n\n#if defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT) || defined(APPLY_MATERIAL)\nvec4 alphaBlend(vec4 sourceColor, vec4 destinationColor)\n{\n    return sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);\n}\n#endif\n\n#ifdef TRANSLUCENT\nbool inTranslucencyRectangle()\n{\n    return\n        v_textureCoordinates.x > u_translucencyRectangle.x &&\n        v_textureCoordinates.x < u_translucencyRectangle.z &&\n        v_textureCoordinates.y > u_translucencyRectangle.y &&\n        v_textureCoordinates.y < u_translucencyRectangle.w;\n}\n#endif\n\nvec4 sampleAndBlend(\n    vec4 previousColor,\n    sampler2D textureToSample,\n    vec2 tileTextureCoordinates,\n    vec4 textureCoordinateRectangle,\n    vec4 textureCoordinateTranslationAndScale,\n    float textureAlpha,\n    float textureNightAlpha,\n    float textureDayAlpha,\n    float textureBrightness,\n    float textureContrast,\n    float textureHue,\n    float textureSaturation,\n    float textureOneOverGamma,\n    float split,\n    vec4 colorToAlpha,\n    float nightBlend)\n{\n    // This crazy step stuff sets the alpha to 0.0 if this following condition is true:\n    //    tileTextureCoordinates.s < textureCoordinateRectangle.s ||\n    //    tileTextureCoordinates.s > textureCoordinateRectangle.p ||\n    //    tileTextureCoordinates.t < textureCoordinateRectangle.t ||\n    //    tileTextureCoordinates.t > textureCoordinateRectangle.q\n    // In other words, the alpha is zero if the fragment is outside the rectangle\n    // covered by this texture.  Would an actual 'if' yield better performance?\n    vec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n    alphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\n    textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    textureAlpha *= mix(textureDayAlpha, textureNightAlpha, nightBlend);\n#endif\n\n    vec2 translation = textureCoordinateTranslationAndScale.xy;\n    vec2 scale = textureCoordinateTranslationAndScale.zw;\n    vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\n    vec4 value = texture2D(textureToSample, textureCoordinates);\n    vec3 color = value.rgb;\n    float alpha = value.a;\n\n#ifdef APPLY_COLOR_TO_ALPHA\n    vec3 colorDiff = abs(color.rgb - colorToAlpha.rgb);\n    colorDiff.r = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\n    alpha = czm_branchFreeTernary(colorDiff.r < colorToAlpha.a, 0.0, alpha);\n#endif\n\n#if !defined(APPLY_GAMMA)\n    vec4 tempColor = czm_gammaCorrect(vec4(color, alpha));\n    color = tempColor.rgb;\n    alpha = tempColor.a;\n#else\n    color = pow(color, vec3(textureOneOverGamma));\n#endif\n\n#ifdef APPLY_SPLIT\n    float splitPosition = czm_imagerySplitPosition;\n    // Split to the left\n    if (split < 0.0 && gl_FragCoord.x > splitPosition) {\n       alpha = 0.0;\n    }\n    // Split to the right\n    else if (split > 0.0 && gl_FragCoord.x < splitPosition) {\n       alpha = 0.0;\n    }\n#endif\n\n#ifdef APPLY_BRIGHTNESS\n    color = mix(vec3(0.0), color, textureBrightness);\n#endif\n\n#ifdef APPLY_CONTRAST\n    color = mix(vec3(0.5), color, textureContrast);\n#endif\n\n#ifdef APPLY_HUE\n    color = czm_hue(color, textureHue);\n#endif\n\n#ifdef APPLY_SATURATION\n    color = czm_saturation(color, textureSaturation);\n#endif\n\n    float sourceAlpha = alpha * textureAlpha;\n    float outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\n    outAlpha += sign(outAlpha) - 1.0;\n\n    vec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\n\n    // When rendering imagery for a tile in multiple passes,\n    // some GPU/WebGL implementation combinations will not blend fragments in\n    // additional passes correctly if their computation includes an unmasked\n    // divide-by-zero operation,\n    // even if it's not in the output or if the output has alpha zero.\n    //\n    // For example, without sanitization for outAlpha,\n    // this renders without artifacts:\n    //   if (outAlpha == 0.0) { outColor = vec3(0.0); }\n    //\n    // but using czm_branchFreeTernary will cause portions of the tile that are\n    // alpha-zero in the additional pass to render as black instead of blending\n    // with the previous pass:\n    //   outColor = czm_branchFreeTernary(outAlpha == 0.0, vec3(0.0), outColor);\n    //\n    // So instead, sanitize against divide-by-zero,\n    // store this state on the sign of outAlpha, and correct on return.\n\n    return vec4(outColor, max(outAlpha, 0.0));\n}\n\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n    return rgb;\n}\n\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\n\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist);\n#endif\n\nconst float fExposure = 2.0;\n\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\n    if (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\n        v_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n        {\n            discard;\n        }\n#endif\n\n#ifdef SPLIT_TERRAIN\n    float splitPosition = czm_imagerySplitPosition;\n    if (u_terrainSplitDirection < 0.0 && gl_FragCoord.x > splitPosition) {\n        discard;\n    } else if (u_terrainSplitDirection > 0.0 && gl_FragCoord.x < splitPosition) {\n        discard;\n    }\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    float clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\n\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\n    vec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));   // normalized surface normal in model coordinates\n    vec3 normalEC = czm_normal3D * normalMC;                                         // normalized surface normal in eye coordiantes\n#endif\n\n#if defined(APPLY_DAY_NIGHT_ALPHA) && defined(ENABLE_DAYNIGHT_SHADING)\n    float nightBlend = 1.0 - clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0, 0.0, 1.0);\n#else\n    float nightBlend = 0.0;\n#endif\n\n    // The clamp below works around an apparent bug in Chrome Canary v23.0.1241.0\n    // where the fragment shader sees textures coordinates < 0.0 and > 1.0 for the\n    // fragments on the edges of tiles even though the vertex shader is outputting\n    // coordinates strictly in the 0-1 range.\n    vec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0), nightBlend);\n\n#ifdef SHOW_TILE_BOUNDARIES\n    if (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\n        v_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n    {\n        color = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n#endif\n\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\n    float cameraDist;\n    if (czm_sceneMode == czm_sceneMode2D)\n    {\n        cameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n    }\n    else if (czm_sceneMode == czm_sceneModeColumbusView)\n    {\n        cameraDist = -czm_view[3].z;\n    }\n    else\n    {\n        cameraDist = length(czm_view[3]);\n    }\n    float fadeOutDist = u_lightingFadeDistance.x;\n    float fadeInDist = u_lightingFadeDistance.y;\n    if (czm_sceneMode != czm_sceneMode3D) {\n        vec3 radii = czm_ellipsoidRadii;\n        float maxRadii = max(radii.x, max(radii.y, radii.z));\n        fadeOutDist -= maxRadii;\n        fadeInDist -= maxRadii;\n    }\n    float fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\n    float fade = 0.0;\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n    vec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\n    vec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\n    vec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\n    waterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\n\n    float mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\n\n    if (mask > 0.0)\n    {\n        mat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\n\n        vec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\n        vec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\n\n        vec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\n\n        color = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n    }\n#endif\n\n#ifdef APPLY_MATERIAL\n    czm_materialInput materialInput;\n    materialInput.st = v_textureCoordinates.st;\n    materialInput.normalEC = normalize(v_normalEC);\n    materialInput.slope = v_slope;\n    materialInput.height = v_height;\n    materialInput.aspect = v_aspect;\n    czm_material material = czm_getMaterial(materialInput);\n    vec4 materialColor = vec4(material.diffuse, material.alpha);\n    color = alphaBlend(materialColor, color);\n#endif\n\n#ifdef ENABLE_VERTEX_LIGHTING\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\n    float diffuseIntensity = clamp(czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\n    diffuseIntensity = mix(1.0, diffuseIntensity, fade);\n    vec4 finalColor = vec4(color.rgb * czm_lightColor * diffuseIntensity, color.a);\n#else\n    vec4 finalColor = color;\n#endif\n\n#ifdef ENABLE_CLIPPING_PLANES\n    vec4 clippingPlanesEdgeColor = vec4(1.0);\n    clippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\n    float clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\n\n    if (clipDistance < clippingPlanesEdgeWidth)\n    {\n        finalColor = clippingPlanesEdgeColor;\n    }\n#endif\n\n#ifdef HIGHLIGHT_FILL_TILE\n    finalColor = vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    vec3 fogColor = colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\n#ifndef HDR\n    fogColor = vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#endif\n\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN)\n    vec3 atmosphereLightDirection = czm_sunDirectionWC;\n#else\n    vec3 atmosphereLightDirection = czm_lightDirectionWC;\n#endif\n\n#ifdef FOG\n#if defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING))\n    float darken = clamp(dot(normalize(czm_viewerPositionWC), atmosphereLightDirection), u_minimumBrightness, 1.0);\n    fogColor *= darken;\n#endif\n\n#ifdef HDR\n    const float modifier = 0.15;\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\n#else\n    finalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#endif\n\n#ifdef GROUND_ATMOSPHERE\n    if (!czm_backFacing())\n    {\n        vec3 groundAtmosphereColor = computeGroundAtmosphereColor(fogColor, finalColor, atmosphereLightDirection, cameraDist);\n        finalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n    }\n#endif\n\n#ifdef UNDERGROUND_COLOR\n    if (czm_backFacing())\n    {\n        float distanceFromEllipsoid = max(czm_eyeHeight, 0.0);\n        float distance = max(v_distance - distanceFromEllipsoid, 0.0);\n        float blendAmount = interpolateByDistance(u_undergroundColorAlphaByDistance, distance);\n        vec4 undergroundColor = vec4(u_undergroundColor.rgb, u_undergroundColor.a * blendAmount);\n        finalColor = alphaBlend(undergroundColor, finalColor);\n    }\n#endif\n\n#ifdef TRANSLUCENT\n    if (inTranslucencyRectangle())\n    {\n      vec4 alphaByDistance = gl_FrontFacing ? u_frontFaceAlphaByDistance : u_backFaceAlphaByDistance;\n      finalColor.a *= interpolateByDistance(alphaByDistance, v_distance);\n    }\n#endif\n\n    gl_FragColor = finalColor;\n}\n\n#ifdef GROUND_ATMOSPHERE\nvec3 computeGroundAtmosphereColor(vec3 fogColor, vec4 finalColor, vec3 atmosphereLightDirection, float cameraDist)\n{\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && defined(DYNAMIC_ATMOSPHERE_LIGHTING) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\n    float mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0), 1.0);\n    vec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\n    xy *= czm_viewport.zw * mpp * 0.5;\n\n    vec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\n    czm_ray ray = czm_ray(vec3(0.0), direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n\n    vec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\n    ellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\n    AtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true, atmosphereLightDirection);\n\n    vec3 groundAtmosphereColor = colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\n#ifndef HDR\n    groundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\n#endif\n\n    float fadeInDist = u_nightFadeDistance.x;\n    float fadeOutDist = u_nightFadeDistance.y;\n\n    float sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    sunlitAtmosphereIntensity = max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\n#endif\n\n    groundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\n    vec3 groundAtmosphereColor = fogColor;\n#endif\n\n#ifdef HDR\n    // Some tweaking to make HDR look better\n    groundAtmosphereColor = czm_saturation(groundAtmosphereColor, 1.6);\n#endif\n\n    return groundAtmosphereColor;\n}\n#endif\n\n#ifdef SHOW_REFLECTIVE_OCEAN\n\nfloat waveFade(float edge0, float edge1, float x)\n{\n    float y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return pow(1.0 - y, 5.0);\n}\n\nfloat linearFade(float edge0, float edge1, float x)\n{\n    return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\n// Based on water rendering by Jonas Wagner:\n// http://29a.ch/2012/7/19/webgl-terrain-rendering-water-fog\n\n// low altitude wave settings\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\n\n// high altitude wave settings\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\n\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\n    vec3 positionToEyeEC = -positionEyeCoordinates;\n    float positionToEyeECLength = length(positionToEyeEC);\n\n    // The double normalize below works around a bug in Firefox on Android devices.\n    vec3 normalizedPositionToEyeEC = normalize(normalize(positionToEyeEC));\n\n    // Fade out the waves as the camera moves far from the surface.\n    float waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n\n#ifdef SHOW_OCEAN_WAVES\n    // high altitude waves\n    float time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\n    vec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\n    vec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\n\n    // low altitude waves\n    time = czm_frameNumber * oceanAnimationSpeedLowAltitude;\n    noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\n    vec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\n\n    // blend the 2 wave layers based on distance to surface\n    float highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\n    float lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\n    vec3 normalTangentSpace =\n        (highAltitudeFade * normalTangentSpaceHighAltitude) +\n        (lowAltitudeFade * normalTangentSpaceLowAltitude);\n    normalTangentSpace = normalize(normalTangentSpace);\n\n    // fade out the normal perturbation as we move farther from the water surface\n    normalTangentSpace.xy *= waveIntensity;\n    normalTangentSpace = normalize(normalTangentSpace);\n#else\n    vec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 normalEC = enuToEye * normalTangentSpace;\n\n    const vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\n\n    // Use diffuse light to highlight the waves\n    float diffuseIntensity = czm_getLambertDiffuse(czm_lightDirectionEC, normalEC) * maskValue;\n    vec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n\n#ifdef SHOW_OCEAN_WAVES\n    // Where diffuse light is low or non-existent, use wave highlights based solely on\n    // the wave bumpiness and no particular light direction.\n    float tsPerturbationRatio = normalTangentSpace.z;\n    vec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\n    vec3 nonDiffuseHighlight = vec3(0.0);\n#endif\n\n    // Add specular highlights in 3D, and in all modes when zoomed in.\n    float specularIntensity = czm_getSpecular(czm_lightDirectionEC, normalizedPositionToEyeEC, normalEC, 10.0);\n    float surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\n    float specular = specularIntensity * surfaceReflectance;\n\n#ifdef HDR\n    specular *= 1.4;\n\n    float e = 0.2;\n    float d = 3.3;\n    float c = 1.7;\n\n    vec3 color = imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\n    vec3 color = imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\n\n    return vec4(color, imageryColor.a);\n}\n\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n",M="#ifdef QUANTIZATION_BITS12\nattribute vec4 compressed0;\nattribute float compressed1;\n#else\nattribute vec4 position3DAndHeight;\nattribute vec4 textureCoordAndEncodedNormals;\n#endif\n\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform mat4 u_modifiedModelViewProjection;\nuniform vec4 u_tileRectangle;\n\n// Uniforms for 2D Mercator projection\nuniform vec2 u_southAndNorthLatitude;\nuniform vec2 u_southMercatorYAndOneOverHeight;\n\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\n\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n\n#ifdef APPLY_MATERIAL\nvarying float v_slope;\nvarying float v_aspect;\nvarying float v_height;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\nvarying float v_distance;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying vec3 v_fogMieColor;\nvarying vec3 v_fogRayleighColor;\n#endif\n\n// These functions are generated at runtime.\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\nfloat get2DYPositionFraction(vec2 textureCoordinates);\n\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return u_modifiedModelViewProjection * vec4(position, 1.0);\n}\n\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\n{\n    // The width of a tile at level 11, in radians and assuming a single root tile, is\n    //   2.0 * czm_pi / pow(2.0, 11.0)\n    // We want to just linearly interpolate the 2D position from the texture coordinates\n    // when we're at this level or higher.  The constant below is the expression\n    // above evaluated and then rounded up at the 4th significant digit.\n    const float maxTileWidth = 0.003068;\n    float positionFraction = textureCoordinates.y;\n    float southLatitude = u_southAndNorthLatitude.x;\n    float northLatitude = u_southAndNorthLatitude.y;\n    if (northLatitude - southLatitude > maxTileWidth)\n    {\n        float southMercatorY = u_southMercatorYAndOneOverHeight.x;\n        float oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;\n\n        float currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\n        currentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\n        positionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\n    }\n    return positionFraction;\n}\n\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\n{\n    return textureCoordinates.y;\n}\n\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\n{\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\n    vec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\n    return u_modifiedModelViewProjection * rtcPosition2D;\n}\n\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, 0.0, textureCoordinates);\n}\n\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    return getPositionPlanarEarth(position, height, textureCoordinates);\n}\n\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\n{\n    // We do not do RTC while morphing, so there is potential for jitter.\n    // This is unlikely to be noticeable, though.\n    vec3 position3DWC = position + u_center3D;\n    float yPositionFraction = get2DYPositionFraction(textureCoordinates);\n    vec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\n    vec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\n    return czm_modelViewProjection * morphPosition;\n}\n\n#ifdef QUANTIZATION_BITS12\nuniform vec2 u_minMaxHeight;\nuniform mat4 u_scaleAndBias;\n#endif\n\nvoid main()\n{\n#ifdef QUANTIZATION_BITS12\n    vec2 xy = czm_decompressTextureCoordinates(compressed0.x);\n    vec2 zh = czm_decompressTextureCoordinates(compressed0.y);\n    vec3 position = vec3(xy, zh.x);\n    float height = zh.y;\n    vec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\n\n    height = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\n    position = (u_scaleAndBias * vec4(position, 1.0)).xyz;\n\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n    float encodedNormal = compressed1;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\n    float encodedNormal = 0.0;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = compressed0.w;\n#else\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = 0.0;\n#endif\n\n#else\n    // A single float per element\n    vec3 position = position3DAndHeight.xyz;\n    float height = position3DAndHeight.w;\n    vec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\n\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = textureCoordAndEncodedNormals.z;\n    float encodedNormal = textureCoordAndEncodedNormals.w;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = textureCoordAndEncodedNormals.z;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\n    float webMercatorT = textureCoordAndEncodedNormals.z;\n    float encodedNormal = 0.0;\n#else\n    float webMercatorT = textureCoordinates.y;\n    float encodedNormal = 0.0;\n#endif\n\n#endif\n\n    vec3 position3DWC = position + u_center3D;\n    gl_Position = getPosition(position, height, textureCoordinates);\n\n    v_textureCoordinates = vec3(textureCoordinates, webMercatorT);\n\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\n    v_positionMC = position3DWC;  // position in model coordinates\n    vec3 normalMC = czm_octDecode(encodedNormal);\n    v_normalMC = normalMC;\n    v_normalEC = czm_normal3D * v_normalMC;\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION) || defined(HDR)\n    v_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\n    v_positionMC = position3DWC;  // position in model coordinates\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\n    AtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(position3DWC, false, vec3(0.0));\n    v_fogMieColor = atmosFogColor.mie;\n    v_fogRayleighColor = atmosFogColor.rayleigh;\n#endif\n\n#if defined(FOG) || defined(GROUND_ATMOSPHERE) || defined(UNDERGROUND_COLOR) || defined(TRANSLUCENT)\n    v_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\n#endif\n\n#ifdef APPLY_MATERIAL\n    float northPoleZ = czm_ellipsoidRadii.z;\n    vec3 northPolePositionMC = vec3(0.0, 0.0, northPoleZ);\n    vec3 ellipsoidNormal = normalize(v_positionMC); // For a sphere this is correct, but not generally for an ellipsoid.\n    vec3 vectorEastMC = normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));\n    float dotProd = abs(dot(ellipsoidNormal, v_normalMC));\n    v_slope = acos(dotProd);\n    vec3 normalRejected = ellipsoidNormal * dotProd;\n    vec3 normalProjected = v_normalMC - normalRejected;\n    vec3 aspectVector = normalize(normalProjected);\n    v_aspect = acos(dot(aspectVector, vectorEastMC));\n    float determ = dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);\n    v_aspect = czm_branchFreeTernary(determ < 0.0, 2.0 * czm_pi - v_aspect, v_aspect);\n    v_height = height;\n#endif\n}\n",I="/*!\n * Atmosphere code:\n *\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Analytical Graphics, Inc.\n */\n\n // Atmosphere:\n //   Code:  http://sponeil.net/\n //   GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\nconst float Kr = 0.0025;\nconst float Km = 0.0015;\nconst float ESun = 15.0;\n\nconst float fKrESun = Kr * ESun;\nconst float fKmESun = Km * ESun;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float fKm4PI = Km * 4.0 * czm_pi;\n\n// Original: vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\nconst vec3 v3InvWavelength = vec3(5.60204474633241, 9.473284437923038, 19.64380261047721);\n\nconst float fScaleDepth = 0.25;\n\nstruct AtmosphereColor\n{\n    vec3 mie;\n    vec3 rayleigh;\n};\n\nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool dynamicLighting, vec3 lightDirectionWC)\n{\n    float fInnerRadius = czm_ellipsoidRadii.x;\n    float fOuterRadius = czm_ellipsoidRadii.x * 1.025;\n    float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n    float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n    float fScaleOverScaleDepth = fScale / fScaleDepth;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = v3Pos - czm_viewerPositionWC;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    float fCameraHeight = length(czm_viewerPositionWC);\n    float fCameraHeight2 = fCameraHeight * fCameraHeight;\n\n    // This next line is an ANGLE workaround. It is equivalent to B = 2.0 * dot(czm_viewerPositionWC, v3Ray),\n    // which is what it should be, but there are problems at the poles.\n    float B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\n    float C = fCameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\n    fFar -= fNear;\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n\n    // The light angle based on the scene's light source would be:\n    //    dot(lightDirectionWC, v3Pos) / length(v3Pos);\n    // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n\n    float fLightAngle = czm_branchFreeTernary(dynamicLighting, dot(lightDirectionWC, v3Pos) / length(v3Pos), 1.0);\n    float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0);\n    vec3 v3Attenuate = vec3(0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter = fDepth*fTemp - fCameraOffset;\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    AtmosphereColor color;\n    color.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n    color.rayleigh = v3Attenuate; // Calculate the attenuation factor for the ground\n\n    return color;\n}\n\n",R=a(16),N=a(450),L=a(76),j=a(447),V=a(44);function U(e,t,a,i,n){this.numberOfDayTextures=e,this.flags=t,this.material=a,this.shaderProgram=i,this.clippingShaderState=n}function B(){this.baseVertexShaderSource=void 0,this.baseFragmentShaderSource=void 0,this._shadersByTexturesFlags=[],this.material=void 0}B.prototype.getShaderProgram=function(e){var t=e.frameState,a=e.surfaceTile,i=e.numberOfDayTextures,n=e.applyBrightness,r=e.applyContrast,o=e.applyHue,l=e.applySaturation,u=e.applyGamma,d=e.applyAlpha,c=e.applyDayNightAlpha,f=e.applySplit,h=e.showReflectiveOcean,m=e.showOceanWaves,p=e.enableLighting,_=e.dynamicAtmosphereLighting,g=e.dynamicAtmosphereLightingFromSun,v=e.showGroundAtmosphere,y=e.perFragmentGroundAtmosphere,b=e.hasVertexNormals,w=e.useWebMercatorProjection,C=e.enableFog,O=e.enableClippingPlanes,x=e.clippingPlanes,T=e.clippedByBoundaries,E=e.splitTerrain,A=e.hasImageryLayerCutout,P=e.colorCorrect,S=e.highlightFillTile,D=e.colorToAlpha,F=e.showUndergroundColor,M=e.translucent,I=0,R="",B=a.renderedMesh.encoding;B.quantization===N.a.BITS12&&(I=1,R="QUANTIZATION_BITS12");var z=0,H="";T&&(z=1,H="TILE_LIMIT_RECTANGLE");var k=0,G="";A&&(k=1,G="APPLY_IMAGERY_CUTOUT");var W=t.mode,Y=W|n<<2|r<<3|o<<4|l<<5|u<<6|d<<7|h<<8|m<<9|p<<10|_<<11|g<<12|v<<13|y<<14|b<<15|w<<16|C<<17|I<<18|f<<19|O<<20|z<<21|k<<22|P<<23|S<<24|D<<25|F<<26|M<<27|c<<28|E<<29,X=0;Object(s.default)(x)&&x.length>0&&(X=O?x.clippingPlanesState:0);var Q=a.surfaceShader;if(Object(s.default)(Q)&&Q.numberOfDayTextures===i&&Q.flags===Y&&Q.material===this.material&&Q.clippingShaderState===X)return Q.shaderProgram;var q=this._shadersByTexturesFlags[i];if(Object(s.default)(q)||(q=this._shadersByTexturesFlags[i]=[]),Q=q[Y],!Object(s.default)(Q)||Q.material!==this.material||Q.clippingShaderState!==X){var Z=this.baseVertexShaderSource.clone(),K=this.baseFragmentShaderSource.clone();0!==X&&K.sources.unshift(Object(j.a)(x,t.context)),Z.defines.push(R),K.defines.push("TEXTURE_UNITS "+i,H,G),n&&K.defines.push("APPLY_BRIGHTNESS"),r&&K.defines.push("APPLY_CONTRAST"),o&&K.defines.push("APPLY_HUE"),l&&K.defines.push("APPLY_SATURATION"),u&&K.defines.push("APPLY_GAMMA"),d&&K.defines.push("APPLY_ALPHA"),c&&K.defines.push("APPLY_DAY_NIGHT_ALPHA"),h&&(K.defines.push("SHOW_REFLECTIVE_OCEAN"),Z.defines.push("SHOW_REFLECTIVE_OCEAN")),m&&K.defines.push("SHOW_OCEAN_WAVES"),D&&K.defines.push("APPLY_COLOR_TO_ALPHA"),F&&(Z.defines.push("UNDERGROUND_COLOR"),K.defines.push("UNDERGROUND_COLOR")),M&&(Z.defines.push("TRANSLUCENT"),K.defines.push("TRANSLUCENT")),p&&(b?(Z.defines.push("ENABLE_VERTEX_LIGHTING"),K.defines.push("ENABLE_VERTEX_LIGHTING")):(Z.defines.push("ENABLE_DAYNIGHT_SHADING"),K.defines.push("ENABLE_DAYNIGHT_SHADING"))),_&&(K.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING"),g&&K.defines.push("DYNAMIC_ATMOSPHERE_LIGHTING_FROM_SUN")),v&&(Z.defines.push("GROUND_ATMOSPHERE"),K.defines.push("GROUND_ATMOSPHERE"),y&&K.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE")),Z.defines.push("INCLUDE_WEB_MERCATOR_Y"),K.defines.push("INCLUDE_WEB_MERCATOR_Y"),C&&(Z.defines.push("FOG"),K.defines.push("FOG")),f&&K.defines.push("APPLY_SPLIT"),O&&K.defines.push("ENABLE_CLIPPING_PLANES"),E&&K.defines.push("SPLIT_TERRAIN"),P&&K.defines.push("COLOR_CORRECT"),S&&K.defines.push("HIGHLIGHT_FILL_TILE");var J="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates, float nightBlend)\n    {\n        vec4 color = initialColor;\n";A&&(J+="        vec4 cutoutAndColorResult;\n        bool texelUnclipped;\n");for(var $=0;$<i;++$)J+=A?"        cutoutAndColorResult = u_dayTextureCutoutRectangles["+$+"];\n        texelUnclipped = v_textureCoordinates.x < cutoutAndColorResult.x || cutoutAndColorResult.z < v_textureCoordinates.x || v_textureCoordinates.y < cutoutAndColorResult.y || cutoutAndColorResult.w < v_textureCoordinates.y;\n        cutoutAndColorResult = sampleAndBlend(\n":"        color = sampleAndBlend(\n",J+="            color,\n            u_dayTextures["+$+"],\n            u_dayTextureUseWebMercatorT["+$+"] ? textureCoordinates.xz : textureCoordinates.xy,\n            u_dayTextureTexCoordsRectangle["+$+"],\n            u_dayTextureTranslationAndScale["+$+"],\n            "+(d?"u_dayTextureAlpha["+$+"]":"1.0")+",\n            "+(c?"u_dayTextureNightAlpha["+$+"]":"1.0")+",\n"+(c?"u_dayTextureDayAlpha["+$+"]":"1.0")+",\n"+(n?"u_dayTextureBrightness["+$+"]":"0.0")+",\n            "+(r?"u_dayTextureContrast["+$+"]":"0.0")+",\n            "+(o?"u_dayTextureHue["+$+"]":"0.0")+",\n            "+(l?"u_dayTextureSaturation["+$+"]":"0.0")+",\n            "+(u?"u_dayTextureOneOverGamma["+$+"]":"0.0")+",\n            "+(f?"u_dayTextureSplit["+$+"]":"0.0")+",\n            "+(D?"u_colorsToAlpha["+$+"]":"vec4(0.0)")+",\n        nightBlend        );\n",A&&(J+="        color = czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\n");J+="        return color;\n    }",K.sources.push(J),Z.sources.push(function(e){var t;switch(e){case V.a.SCENE3D:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }";break;case V.a.SCENE2D:case V.a.COLUMBUS_VIEW:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }";break;case V.a.MORPHING:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }"}return t}(W)),Z.sources.push(function(e){return e?"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }":"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }"}(w));var ee=L.a.fromCache({context:t.context,vertexShaderSource:Z,fragmentShaderSource:K,attributeLocations:B.getAttributeLocations()});Q=q[Y]=new U(i,Y,this.material,ee,X)}return a.surfaceShader=Q,Q.shaderProgram},B.prototype.destroy=function(){var e,t,a=this._shadersByTexturesFlags;for(var i in a)if(a.hasOwnProperty(i)){var n=a[i];if(!Object(s.default)(n))continue;for(e in n)n.hasOwnProperty(e)&&(t=n[e],Object(s.default)(t)&&t.shaderProgram.destroy())}return Object(l.default)(this)};var z=B,H=a(340),k=a(24),G=a(50),W=a(40),Y=a(68),X=a(54),Q=a(63),q=a(121),Z=a(47),K=a(92),J=a(14),$=a(28),ee=a(117),te=a(98),ae=a(46),ie=a(449),ne=Object.freeze({NONE:-1,PARTIAL:0,FULL:1}),re=a(161),oe=a(107),se=a(75),le=a(82),ue=a(65),de=a(66),ce=a(53),fe=a(93),he=a(83),me=a(376),pe=a(266),_e=a(60),ge=a(219),ve=a(220),ye=a(175),be=a(165),we=a(67),Ce=a(84),Oe=a(152),xe=a(138),Te=a(185),Ee=a(268),Ae=Object.freeze({START:0,LOADING:1,DONE:2,FAILED:3}),Pe=Object.freeze({FAILED:0,UNLOADED:1,RECEIVING:2,RECEIVED:3,TRANSFORMING:4,TRANSFORMED:5,READY:6});function Se(){this.imagery=[],this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new G.a(0,0,1,1),this.terrainData=void 0,this.vertexArray=void 0,this.orientedBoundingBox=void 0,this.boundingVolumeSourceTile=void 0,this.tileBoundingRegion=void 0,this.occludeePointInScaledSpace=new n.default,this.terrainState=Pe.UNLOADED,this.mesh=void 0,this.fill=void 0,this.pickBoundingSphere=new v.default,this.surfaceShader=void 0,this.isClipped=!0,this.clippedByBoundaries=!1}function De(e,t,a,i,r,o){if(e.decodePosition(i,r,o),Object(s.default)(t)&&t!==V.a.SCENE3D){var l=a.ellipsoid.cartesianToCartographic(o);a.project(l,o),n.default.fromElements(o.z,o.x,o.y,o)}return o}Object.defineProperties(Se.prototype,{eligibleForUnloading:{get:function(){for(var e=this.terrainState,t=!(e===Pe.RECEIVING||e===Pe.TRANSFORMING),a=this.imagery,i=0,n=a.length;t&&i<n;++i){var r=a[i];t=!Object(s.default)(r.loadingImagery)||r.loadingImagery.state!==Ee.a.TRANSITIONING}return t}},renderedMesh:{get:function(){return Object(s.default)(this.vertexArray)?this.mesh:Object(s.default)(this.fill)?this.fill.mesh:void 0}}});var Fe=new n.default,Me=new n.default,Ie=new n.default,Re=new n.default;Se.prototype.pick=function(e,t,a,i,n){var r=this.renderedMesh;if(Object(s.default)(r)){for(var o=r.vertices,l=r.indices,u=r.encoding,d=l.length,c=Number.MAX_VALUE,f=0;f<d;f+=3){var h=l[f],m=l[f+1],p=l[f+2],_=De(u,t,a,o,h,Fe),g=De(u,t,a,o,m,Me),v=De(u,t,a,o,p,Ie),y=x.default.rayTriangleParametric(e,_,g,v,i);Object(s.default)(y)&&y<c&&y>=0&&(c=y)}return c!==Number.MAX_VALUE?E.default.getPoint(e,c,n):void 0}},Se.prototype.pickTriangle=function(e,t,a,i){var n=this.renderedMesh;if(Object(s.default)(n))for(var r=n.vertices,o=n.indices,l=n.encoding,u=o.length,d=0;d<u;d+=3){var c=o[d],f=o[d+1],h=o[d+2],m=De(l,t,a,r,c,Fe),p=De(l,t,a,r,f,Me),_=De(l,t,a,r,h,Ie),g=x.default.rayTriangle(e,m,p,_,i,Re);if(Object(s.default)(g))return{intersection:g,v0:m,v1:p,v2:_}}},Se.prototype.freeResources=function(){Object(s.default)(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0),this.terrainData=void 0,this.terrainState=Pe.UNLOADED,this.mesh=void 0,this.fill=this.fill&&this.fill.destroy();for(var e=this.imagery,t=0,a=e.length;t<a;++t)e[t].freeResources();this.imagery.length=0,this.freeVertexArray()},Se.prototype.freeVertexArray=function(){Se._freeVertexArray(this.vertexArray),this.vertexArray=void 0,Se._freeVertexArray(this.wireframeVertexArray),this.wireframeVertexArray=void 0},Se.initialize=function(e,t,a){var i=e.data;Object(s.default)(i)||(i=e.data=new Se),e.state===Ae.START&&(!function(e,t,a){var i=t.getTileDataAvailable(e.x,e.y,e.level);if(!Object(s.default)(i)&&Object(s.default)(e.parent)){var n=e.parent,r=n.data;Object(s.default)(r)&&Object(s.default)(r.terrainData)&&(i=r.terrainData.isChildAvailable(n.x,n.y,e.x,e.y))}!1===i&&(e.data.terrainState=Pe.FAILED);for(var o=0,l=a.length;o<l;++o){var u=a.get(o);u.show&&u._createTileImagerySkeletons(e,t)}}(e,t,a),e.state=Ae.LOADING)},Se.processStateMachine=function(e,t,a,i,r,o){Se.initialize(e,a,i);var l=e.data;if(e.state===Ae.LOADING&&function(e,t,a,i,r){var o=e.data,l=e.parent;if(o.terrainState===Pe.FAILED&&void 0!==l){void 0!==l.data&&void 0!==l.data.terrainData&&!1!==l.data.terrainData.canUpsample||Se.processStateMachine(l,t,a,i,!0)}o.terrainState===Pe.FAILED&&function(e,t,a,i,n,r,o){var l=t.parent;if(!l)return void(t.state=Ae.FAILED);var u=l.data.terrainData,d=l.x,c=l.y,f=l.level;if(!Object(s.default)(u))return;var h=u.upsample(i.tilingScheme,d,c,f,n,r,o);if(!Object(s.default)(h))return;e.terrainState=Pe.RECEIVING,Object(R.default)(h,(function(t){e.terrainData=t,e.terrainState=Pe.RECEIVED}),(function(){e.terrainState=Pe.FAILED}))}(o,e,0,a,e.x,e.y,e.level);o.terrainState===Pe.UNLOADED&&function(e,t,a,i,n){function r(t){e.terrainData=t,e.terrainState=Pe.RECEIVED,e.request=void 0}function o(){if(e.request.state===ve.a.CANCELLED)return e.terrainData=void 0,e.terrainState=Pe.UNLOADED,void(e.request=void 0);e.terrainState=Pe.FAILED,e.request=void 0;var r="Failed to obtain terrain tile X: "+a+" Y: "+i+" Level: "+n+".";t._requestError=be.default.handleError(t._requestError,t,t.errorEvent,r,a,i,n,l)}function l(){var l=new ge.a({throttle:!1,throttleByServer:!0,type:ye.a.TERRAIN});e.request=l;var u=t.requestTileGeometry(a,i,n,l);Object(s.default)(u)?(e.terrainState=Pe.RECEIVING,Object(R.default)(u,r,o)):(e.terrainState=Pe.UNLOADED,e.request=void 0)}l()}(o,a,e.x,e.y,e.level);o.terrainState===Pe.RECEIVED&&function(e,t,a,i,r,o){var l=a.tilingScheme,u=e.terrainData.createMesh(l,i,r,o,t.terrainExaggeration);if(!Object(s.default)(u))return;e.terrainState=Pe.TRANSFORMING,Object(R.default)(u,(function(t){e.mesh=t,e.orientedBoundingBox=ee.a.clone(t.orientedBoundingBox,e.orientedBoundingBox),e.occludeePointInScaledSpace=n.default.clone(t.occludeePointInScaledSpace,e.occludeePointInScaledSpace),e.terrainState=Pe.TRANSFORMED}),(function(){e.terrainState=Pe.FAILED}))}(o,t,a,e.x,e.y,e.level);o.terrainState===Pe.TRANSFORMED&&function(e,t,a,i,n,r,o){e.vertexArray=Se._createVertexArrayForMesh(t,e.mesh),e.terrainState=Pe.READY,e.fill=e.fill&&e.fill.destroy(o)}(o,t.context,0,e.x,e.y,e.level,r);if(o.terrainState>=Pe.RECEIVED&&void 0===o.waterMaskTexture&&a.hasWaterMask){if(void 0!==o.terrainData.waterMask)!function(e,t){var a,i=t.terrainData.waterMask,n=function(e){var t=e.cache.tile_waterMaskData;if(!Object(s.default)(t)){var a=D.a.create({context:e,pixelFormat:_e.a.LUMINANCE,pixelDatatype:we.a.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});a.referenceCount=1;var i=new Ce.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:xe.a.LINEAR,magnificationFilter:Oe.a.LINEAR});t={allWaterTexture:a,sampler:i,destroy:function(){this.allWaterTexture.destroy()}},e.cache.tile_waterMaskData=t}return t}(e),r=i.length;if(1===r){if(0===i[0])return;a=n.allWaterTexture}else{var o=Math.sqrt(r);(a=D.a.create({context:e,pixelFormat:_e.a.LUMINANCE,pixelDatatype:we.a.UNSIGNED_BYTE,source:{width:o,height:o,arrayBufferView:i},sampler:n.sampler,flipY:!1})).referenceCount=0}++a.referenceCount,t.waterMaskTexture=a,G.a.fromElements(0,0,1,1,t.waterMaskTranslationAndScale)}(t.context,o);else{var u=o._findAncestorTileWithTerrainData(e);Object(s.default)(u)&&Object(s.default)(u.data.waterMaskTexture)&&(o.waterMaskTexture=u.data.waterMaskTexture,++o.waterMaskTexture.referenceCount,o._computeWaterMaskTranslationAndScale(e,u,o.waterMaskTranslationAndScale))}}}(e,t,a,i,r),!o){var u=e.renderable;e.renderable=Object(s.default)(l.vertexArray);var d=l.terrainState===Pe.READY;e.upsampledFromParent=Object(s.default)(l.terrainData)&&l.terrainData.wasCreatedByUpsampling();var c=l.processImagery(e,a,t);if(d&&c){var f=e._loadedCallbacks,h={};for(var m in f)f.hasOwnProperty(m)&&(f[m](e)||(h[m]=f[m]));e._loadedCallbacks=h,e.state=Ae.DONE}u&&(e.renderable=!0)}},Se.prototype.processImagery=function(e,t,a,i){var n,r,o=e.data,l=e.upsampledFromParent,u=!1,d=!0,c=o.imagery;for(n=0,r=c.length;n<r;++n){var f=c[n];if(Object(s.default)(f.loadingImagery)){if(f.loadingImagery.state===Ee.a.PLACEHOLDER){var h=f.loadingImagery.imageryLayer;if(h.imageryProvider.ready){f.freeResources(),c.splice(n,1),h._createTileImagerySkeletons(e,t,n),--n,r=c.length;continue}l=!1}var m=f.processStateMachine(e,a,i);d=d&&m,u=u||m||Object(s.default)(f.readyImagery),l=l&&Object(s.default)(f.loadingImagery)&&(f.loadingImagery.state===Ee.a.FAILED||f.loadingImagery.state===Ee.a.INVALID)}else l=!1}return e.upsampledFromParent=l,e.renderable=e.renderable&&(u||d),d},Se._createVertexArrayForMesh=function(e,t){var a=t.vertices,i=oe.a.createVertexBuffer({context:e,typedArray:a,usage:se.a.STATIC_DRAW}),n=t.encoding.getAttributes(i),r=t.indices.indexBuffers||{},o=r[e.id];if(!Object(s.default)(o)||o.isDestroyed()){var l=t.indices;(o=oe.a.createIndexBuffer({context:e,typedArray:l,usage:se.a.STATIC_DRAW,indexDatatype:Z.a.fromSizeInBytes(l.BYTES_PER_ELEMENT)})).vertexArrayDestroyable=!1,o.referenceCount=1,r[e.id]=o,t.indices.indexBuffers=r}else++o.referenceCount;return new fe.a({context:e,attributes:n,indexBuffer:o})},Se._freeVertexArray=function(e){if(Object(s.default)(e)){var t=e.indexBuffer;e.destroy(),Object(s.default)(t)&&!t.isDestroyed()&&Object(s.default)(t.referenceCount)&&(--t.referenceCount,0===t.referenceCount&&t.destroy())}},Se.prototype._findAncestorTileWithTerrainData=function(e){for(var t=e.parent;Object(s.default)(t)&&(!Object(s.default)(t.data)||!Object(s.default)(t.data.terrainData)||t.data.terrainData.wasCreatedByUpsampling());)t=t.parent;return t},Se.prototype._computeWaterMaskTranslationAndScale=function(e,t,a){var i=t.rectangle,n=e.rectangle,r=n.width,o=n.height,s=r/i.width,l=o/i.height;return a.x=s*(n.west-i.west)/r,a.y=l*(n.south-i.south)/o,a.z=s,a.w=l,a};var Ne=Se,Le=a(372),je=a(73),Ve=a(114),Ue=a(97),Be=a(203),ze=a(221),He=a(516),ke=a(445),Ge=a(342),We=a(451),Ye={WEST:0,NORTH:1,EAST:2,SOUTH:3,NORTHWEST:4,NORTHEAST:5,SOUTHWEST:6,SOUTHEAST:7},Xe={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(e){return e>=Xe.RENDERED_AND_KICKED},originalResult:function(e){return 3&e},kick:function(e){return 4|e}},Qe=Xe;function qe(e){this.tile=e,this.frameLastUpdated=void 0,this.westMeshes=[],this.westTiles=[],this.southMeshes=[],this.southTiles=[],this.eastMeshes=[],this.eastTiles=[],this.northMeshes=[],this.northTiles=[],this.southwestMesh=void 0,this.southwestTile=void 0,this.southeastMesh=void 0,this.southeastTile=void 0,this.northwestMesh=void 0,this.northwestTile=void 0,this.northeastMesh=void 0,this.northeastTile=void 0,this.changedThisFrame=!0,this.visitedFrame=void 0,this.enqueuedFrame=void 0,this.mesh=void 0,this.vertexArray=void 0,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new G.a}qe.prototype.update=function(e,t,a){this.changedThisFrame&&(ht(e,t,this.tile,a),this.changedThisFrame=!1)},qe.prototype.destroy=function(e){Object(s.default)(this.vertexArray)&&(Object(s.default)(e)?e.push(this.vertexArray):Ne._freeVertexArray(this.vertexArray,e),this.vertexArray=void 0),Object(s.default)(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)};var Ze=new ke.a;function Ke(e,t,a,i,n,r,o,l,d){if(void 0!==i){for(var c=i;c&&(c._lastSelectionResultFrame!==n||Qe.wasKicked(c._lastSelectionResult)||Qe.originalResult(c._lastSelectionResult)===Qe.CULLED);){if(o)return;var f=c.parent;if(r>=Ye.NORTHWEST&&void 0!==f)switch(r){case Ye.NORTHWEST:c=c===f.northwestChild?f:void 0;break;case Ye.NORTHEAST:c=c===f.northeastChild?f:void 0;break;case Ye.SOUTHWEST:c=c===f.southwestChild?f:void 0;break;case Ye.SOUTHEAST:c=c===f.southeastChild?f:void 0}else c=f}if(void 0!==c)if(c._lastSelectionResult!==Qe.RENDERED){if(Qe.originalResult(i._lastSelectionResult)!==Qe.CULLED)switch(r){case Ye.WEST:Ke(e,t,a,i.northwestChild,n,r,!0,l,d),Ke(e,t,a,i.southwestChild,n,r,!0,l,d);break;case Ye.EAST:Ke(e,t,a,i.southeastChild,n,r,!0,l,d),Ke(e,t,a,i.northeastChild,n,r,!0,l,d);break;case Ye.SOUTH:Ke(e,t,a,i.southwestChild,n,r,!0,l,d),Ke(e,t,a,i.southeastChild,n,r,!0,l,d);break;case Ye.NORTH:Ke(e,t,a,i.northeastChild,n,r,!0,l,d),Ke(e,t,a,i.northwestChild,n,r,!0,l,d);break;case Ye.NORTHWEST:Ke(e,t,a,i.northwestChild,n,r,!0,l,d);break;case Ye.NORTHEAST:Ke(e,t,a,i.northeastChild,n,r,!0,l,d);break;case Ye.SOUTHWEST:Ke(e,t,a,i.southwestChild,n,r,!0,l,d);break;case Ye.SOUTHEAST:Ke(e,t,a,i.southeastChild,n,r,!0,l,d);break;default:throw new u.default("Invalid edge")}}else{if(Object(s.default)(c.data.vertexArray))return;!function(e,t,a,i,n,r,o,l){var u=i.data;if(void 0===u.fill)u.fill=new qe(i);else if(u.fill.visitedFrame===r)return;u.fill.enqueuedFrame!==r&&(u.fill.enqueuedFrame=r,u.fill.changedThisFrame=!1,o.enqueue(i));!function(e,t,a,i,n,r){var o,l,u,d,c,f,h,m=i.data.fill,p=a.data.fill;Object(s.default)(p)?(p.visitedFrame=t.frameNumber,p.changedThisFrame&&(ht(e,t,a,r),p.changedThisFrame=!1),o=a.data.fill.mesh):o=a.data.mesh;switch(n){case Ye.WEST:l=m.westMeshes,u=m.westTiles;break;case Ye.SOUTH:l=m.southMeshes,u=m.southTiles;break;case Ye.EAST:l=m.eastMeshes,u=m.eastTiles;break;case Ye.NORTH:l=m.northMeshes,u=m.northTiles;break;case Ye.NORTHWEST:return m.changedThisFrame=m.changedThisFrame||m.northwestMesh!==o,m.northwestMesh=o,void(m.northwestTile=a);case Ye.NORTHEAST:return m.changedThisFrame=m.changedThisFrame||m.northeastMesh!==o,m.northeastMesh=o,void(m.northeastTile=a);case Ye.SOUTHWEST:return m.changedThisFrame=m.changedThisFrame||m.southwestMesh!==o,m.southwestMesh=o,void(m.southwestTile=a);case Ye.SOUTHEAST:return m.changedThisFrame=m.changedThisFrame||m.southeastMesh!==o,m.southeastMesh=o,void(m.southeastTile=a)}if(a.level<=i.level)return m.changedThisFrame=m.changedThisFrame||l[0]!==o||1!==l.length,l[0]=o,u[0]=a,l.length=1,void(u.length=1);var _,g=a.rectangle,v=i.rectangle;switch(n){case Ye.WEST:for(_=(v.north-v.south)*J.default.EPSILON5,d=0;d<u.length&&(f=u[d],h=f.rectangle,!J.default.greaterThan(g.north,h.south,_));++d);for(c=d;c<u.length&&(f=u[c],h=f.rectangle,!J.default.greaterThanOrEquals(g.south,h.north,_));++c);break;case Ye.SOUTH:for(_=(v.east-v.west)*J.default.EPSILON5,d=0;d<u.length&&(f=u[d],h=f.rectangle,!J.default.lessThan(g.west,h.east,_));++d);for(c=d;c<u.length&&(f=u[c],h=f.rectangle,!J.default.lessThanOrEquals(g.east,h.west,_));++c);break;case Ye.EAST:for(_=(v.north-v.south)*J.default.EPSILON5,d=0;d<u.length&&(f=u[d],h=f.rectangle,!J.default.lessThan(g.south,h.north,_));++d);for(c=d;c<u.length&&(f=u[c],h=f.rectangle,!J.default.lessThanOrEquals(g.north,h.south,_));++c);break;case Ye.NORTH:for(_=(v.east-v.west)*J.default.EPSILON5,d=0;d<u.length&&(f=u[d],h=f.rectangle,!J.default.greaterThan(g.east,h.west,_));++d);for(c=d;c<u.length&&(f=u[c],h=f.rectangle,!J.default.greaterThanOrEquals(g.west,h.east,_));++c);}c-d==1?(m.changedThisFrame=m.changedThisFrame||l[d]!==o,l[d]=o,u[d]=a):(m.changedThisFrame=!0,l.splice(d,c-d,o),u.splice(d,c-d,a))}(e,t,a,i,n,l)}(e,t,a,c,r,n,l,d)}}}qe.updateFillTiles=function(e,t,a,i){var n=e._quadtree,r=n._levelZeroTiles,o=n._lastSelectionFrameNumber,l=Ze;l.clear();for(var u=0;u<t.length;++u){var d=t[u];Object(s.default)(d.data.vertexArray)&&l.enqueue(t[u])}for(var c=l.dequeue();void 0!==c;){var f=c.findTileToWest(r),h=c.findTileToSouth(r),m=c.findTileToEast(r),p=c.findTileToNorth(r);Ke(e,a,c,f,o,Ye.EAST,!1,l,i),Ke(e,a,c,h,o,Ye.NORTH,!1,l,i),Ke(e,a,c,m,o,Ye.WEST,!1,l,i),Ke(e,a,c,p,o,Ye.SOUTH,!1,l,i);var _=f.findTileToNorth(r),g=f.findTileToSouth(r),v=m.findTileToNorth(r),y=m.findTileToSouth(r);Ke(e,a,c,_,o,Ye.SOUTHEAST,!1,l,i),Ke(e,a,c,v,o,Ye.SOUTHWEST,!1,l,i),Ke(e,a,c,g,o,Ye.NORTHEAST,!1,l,i),Ke(e,a,c,y,o,Ye.NORTHWEST,!1,l,i),c=l.dequeue()}};var Je=new y.default,$e=new y.default,et=new n.default,tt=new n.default,at=new k.default,it=new k.default,nt=new k.default;function rt(){this.height=0,this.encodedNormal=new k.default}function ot(e,t,a,i,n,r,o,l,u){if(Object(s.default)(n))return n;var d;if(Object(s.default)(r)&&Object(s.default)(o))d=.5*(r.height+o.height);else if(Object(s.default)(r))d=r.height;else if(Object(s.default)(o))d=o.height;else if(Object(s.default)(l))d=l.height;else{var c=e.tile.data.tileBoundingRegion,f=0,h=0;Object(s.default)(c)&&(f=c.minimumHeight,h=c.maximumHeight),d=.5*(f+h)}return wt(e,t,a,i,d,u),u}var st={minimumHeight:0,maximumHeight:0},lt=new rt,ut=new rt,dt=new rt,ct=new rt,ft="undefined"!=typeof Uint8Array?new Uint8Array(81):void 0;function ht(e,t,a,i){Ne.initialize(a,e.terrainProvider,e._imageryLayers);var r=a.data,o=r.fill,l=a.rectangle,u=a.tilingScheme.ellipsoid,d=Ct(o,u,0,1,o.northwestTile,o.northwestMesh,o.northTiles,o.northMeshes,o.westTiles,o.westMeshes,dt),c=Ct(o,u,0,0,o.southwestTile,o.southwestMesh,o.westTiles,o.westMeshes,o.southTiles,o.southMeshes,lt),f=Ct(o,u,1,0,o.southeastTile,o.southeastMesh,o.southTiles,o.southMeshes,o.eastTiles,o.eastMeshes,ut),h=Ct(o,u,1,1,o.northeastTile,o.northeastMesh,o.eastTiles,o.eastMeshes,o.northTiles,o.northMeshes,ct);d=ot(o,u,0,1,d,c,h,f,dt),c=ot(o,u,0,0,c,d,f,h,lt),f=ot(o,u,1,1,f,c,h,d,ut),h=ot(o,u,1,1,h,f,d,c,ct);var m,p,_=c.height,g=f.height,y=d.height,b=h.height,w=Math.min(_,g,y,b),C=Math.max(_,g,y,b),O=.5*(w+C),x=e.getLevelMaximumGeometricError(a.level),T=u.maximumRadius-x,E=4*Math.acos(T/u.maximumRadius);if(E*=1.5,l.width>E&&C-w<=x){var A=new He.a({width:9,height:9,buffer:ft,structure:{heightOffset:C}});o.mesh=A._createMeshSync(a.tilingScheme,a.x,a.y,a.level,1)}else{var P=new Ge.a(void 0,void 0,void 0,void 0,!0,!0),S=$e;S.longitude=.5*(l.east+l.west),S.latitude=.5*(l.north+l.south),S.height=O,P.center=u.cartographicToCartesian(S,P.center);var D,F=5;for(m=0,p=(D=o.westMeshes).length;m<p;++m)F+=D[m].eastIndicesNorthToSouth.length;for(m=0,p=(D=o.southMeshes).length;m<p;++m)F+=D[m].northIndicesWestToEast.length;for(m=0,p=(D=o.eastMeshes).length;m<p;++m)F+=D[m].westIndicesSouthToNorth.length;for(m=0,p=(D=o.northMeshes).length;m<p;++m)F+=D[m].southIndicesEastToWest.length;var M=st;M.minimumHeight=w,M.maximumHeight=C;var I=P.getStride(),R=new Float32Array(F*I),N=0,L=N,j=N=xt(o,u,P,R,N=mt(u,l,P,R,N,0,1,d.height,d.encodedNormal,1,M),o.westTiles,o.westMeshes,Ye.EAST,M),V=N=xt(o,u,P,R,N=mt(u,l,P,R,N,0,0,c.height,c.encodedNormal,0,M),o.southTiles,o.southMeshes,Ye.NORTH,M),U=N=xt(o,u,P,R,N=mt(u,l,P,R,N,1,0,f.height,f.encodedNormal,0,M),o.eastTiles,o.eastMeshes,Ye.WEST,M);N=xt(o,u,P,R,N=mt(u,l,P,R,N,1,1,h.height,h.encodedNormal,1,M),o.northTiles,o.northMeshes,Ye.SOUTH,M),w=M.minimumHeight,C=M.maximumHeight;var B=ee.a.fromRectangle(l,w,C,a.tilingScheme.ellipsoid),z=re.a.geodeticLatitudeToMercatorAngle(l.south),H=1/(re.a.geodeticLatitudeToMercatorAngle(l.north)-z),G=(re.a.geodeticLatitudeToMercatorAngle(S.latitude)-z)*H;u.geodeticSurfaceNormalCartographic(Je,tt);var W=Be.a.octEncode(tt,at),Y=N;P.encode(R,N*I,B.center,k.default.fromElements(.5,.5,nt),O,W,G);var X,Q=++N,q=3*(Q-1),Z=q*(Q<256?1:2);if((R.length-Q*I)*Float32Array.BYTES_PER_ELEMENT>=Z){var K=Q*I*Float32Array.BYTES_PER_ELEMENT;X=Q<256?new Uint8Array(R.buffer,K,q):new Uint16Array(R.buffer,K,q)}else X=Q<256?new Uint8Array(q):new Uint16Array(q);R=new Float32Array(R.buffer,0,Q*I);var J=0;for(m=0;m<Q-2;++m)X[J++]=Y,X[J++]=m,X[J++]=m+1;X[J++]=Y,X[J++]=m,X[J++]=0;var $=[];for(m=j;m>=L;--m)$.push(m);var te=[];for(m=V;m>=j;--m)te.push(m);var ae=[];for(m=U;m>=V;--m)ae.push(m);var ie=[];for(ie.push(0),m=Y-1;m>=U;--m)ie.push(m);o.mesh=new We.a(P.center,R,X,q,Q,w,C,v.default.fromOrientedBoundingBox(B),function(e,t,a,i,r,o){var s=e.quadtree._occluders.ellipsoid,l=s.ellipsoid,u=St;return n.default.fromRadians(a.west,a.south,r,l,u[0]),n.default.fromRadians(a.east,a.south,r,l,u[1]),n.default.fromRadians(a.west,a.north,r,l,u[2]),n.default.fromRadians(a.east,a.north,r,l,u[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,i,o)}(e,B.center,l,w,C),P.getStride(),B,P,t.terrainExaggeration,$,te,ae,ie)}var ne=t.context;Object(s.default)(o.vertexArray)&&(Object(s.default)(i)?i.push(o.vertexArray):Ne._freeVertexArray(o.vertexArray)),o.vertexArray=Ne._createVertexArrayForMesh(ne,o.mesh),r.processImagery(a,e.terrainProvider,t,!0);var oe=o.waterMaskTexture;if(o.waterMaskTexture=void 0,e.terrainProvider.hasWaterMask){var se=r._findAncestorTileWithTerrainData(a);Object(s.default)(se)&&Object(s.default)(se.data.waterMaskTexture)&&(o.waterMaskTexture=se.data.waterMaskTexture,++o.waterMaskTexture.referenceCount,r._computeWaterMaskTranslationAndScale(a,se,o.waterMaskTranslationAndScale))}Object(s.default)(oe)&&(--oe.referenceCount,0===oe.referenceCount&&oe.destroy())}function mt(e,t,a,i,n,r,o,s,l,u,d){var c=Je;c.longitude=J.default.lerp(t.west,t.east,r),c.latitude=J.default.lerp(t.south,t.north,o),c.height=s;var f=e.cartographicToCartesian(c,et),h=it;return h.x=r,h.y=o,a.encode(i,n*a.getStride(),f,h,s,l,u),d.minimumHeight=Math.min(d.minimumHeight,s),d.maximumHeight=Math.max(d.maximumHeight,s),n+1}var pt=new A.default;function _t(e,t,a,i){var n=e.rectangle,r=t.rectangle;0===t.x&&1===a.x&&e.x===e.tilingScheme.getNumberOfXTilesAtLevel(e.level)-1?((n=A.default.clone(e.rectangle,pt)).west-=J.default.TWO_PI,n.east-=J.default.TWO_PI):0===e.x&&0===a.x&&t.x===t.tilingScheme.getNumberOfXTilesAtLevel(t.level)-1&&((n=A.default.clone(e.rectangle,pt)).west+=J.default.TWO_PI,n.east+=J.default.TWO_PI);var o=n.east-n.west,s=(r.west-n.west)/o,l=(r.east-n.west)/o,u=n.north-n.south,d=(r.south-n.south)/u,c=(r.north-n.south)/u,f=(a.x-s)/(l-s),h=(a.y-d)/(c-d);return Math.abs(f)<Math.EPSILON5?f=0:Math.abs(f-1)<Math.EPSILON5&&(f=1),Math.abs(h)<Math.EPSILON5?h=0:Math.abs(h-1)<Math.EPSILON5&&(h=1),i.x=f,i.y=h,i}var gt=new k.default;function vt(e,t,a,i,n){var r=e.encoding,o=e.vertices;if(n.height=r.decodeHeight(o,t),r.hasVertexNormals)r.getOctEncodedNormal(o,t,n.encodedNormal);else{var s=n.encodedNormal;s.x=0,s.y=0}}var yt=new k.default,bt=new n.default;function wt(e,t,a,i,n,r){r.height=n;var o=t.geodeticSurfaceNormalCartographic(Je,et);Be.a.octEncode(o,r.encodedNormal)}function Ct(e,t,a,i,n,r,o,l,u,d,c){var f;return Pt(e,t,l,o,!1,a,i,c)||Pt(e,t,d,u,!0,a,i,c)?c:At(n,r)?(vt(r,0===a?0===i?r.eastIndicesNorthToSouth[0]:r.southIndicesEastToWest[0]:0===i?r.northIndicesWestToEast[0]:r.westIndicesSouthToNorth[0],0,0,c),c):(f=0===a?0===i?Ot(e.westMeshes,e.westTiles,Ye.EAST,e.southMeshes,e.southTiles,Ye.NORTH,a,i):Ot(e.northMeshes,e.northTiles,Ye.SOUTH,e.westMeshes,e.westTiles,Ye.EAST,a,i):0===i?Ot(e.southMeshes,e.southTiles,Ye.NORTH,e.eastMeshes,e.eastTiles,Ye.WEST,a,i):Ot(e.eastMeshes,e.eastTiles,Ye.WEST,e.northMeshes,e.northTiles,Ye.SOUTH,a,i),Object(s.default)(f)?(wt(0,t,0,0,f,c),c):void 0)}function Ot(e,t,a,i,n,r,o,l){var u=Et(e,t,!1,a,o,l),d=Et(i,n,!0,r,o,l);return Object(s.default)(u)&&Object(s.default)(d)?.5*(u+d):Object(s.default)(u)?u:d}function xt(e,t,a,i,n,r,o,s,l){for(var u=0;u<r.length;++u)n=Tt(e,t,a,i,n,r[u],o[u],s,l);return n}function Tt(e,t,a,i,n,r,o,s,l){var u=r.rectangle;s===Ye.EAST&&0===e.tile.x?((u=A.default.clone(r.rectangle,pt)).west-=J.default.TWO_PI,u.east-=J.default.TWO_PI):s===Ye.WEST&&0===r.x&&((u=A.default.clone(r.rectangle,pt)).west+=J.default.TWO_PI,u.east+=J.default.TWO_PI);var d,c,f,h,m=e.tile.rectangle;switch(n>0&&(a.decodeTextureCoordinates(i,n-1,nt),d=nt.x,c=nt.y),s){case Ye.WEST:f=o.westIndicesSouthToNorth,h=!1;break;case Ye.NORTH:f=o.northIndicesWestToEast,h=!0;break;case Ye.EAST:f=o.eastIndicesNorthToSouth,h=!1;break;case Ye.SOUTH:f=o.southIndicesEastToWest,h=!0}var p,_,g=r,v=e.tile,y=o.encoding,b=o.vertices,w=a.getStride();y.hasWebMercatorT&&(p=re.a.geodeticLatitudeToMercatorAngle(m.south),_=1/(re.a.geodeticLatitudeToMercatorAngle(m.north)-p));for(var C=0;C<f.length;++C){var O=f[C],x=y.decodeTextureCoordinates(b,O,nt);_t(g,v,x,x);var T=x.x,E=x.y,P=h?T:E;if(!(P<0||P>1)&&!(Math.abs(T-d)<J.default.EPSILON5&&Math.abs(E-c)<J.default.EPSILON5)){var S=Math.abs(T)<J.default.EPSILON5||Math.abs(T-1)<J.default.EPSILON5,D=Math.abs(E)<J.default.EPSILON5||Math.abs(E-1)<J.default.EPSILON5;if(!S||!D){var F,M=y.decodePosition(b,O,et),I=y.decodeHeight(b,O);y.hasVertexNormals?F=y.getOctEncodedNormal(b,O,at):((F=at).x=0,F.y=0);var R=E;if(y.hasWebMercatorT){var N=J.default.lerp(m.south,m.north,E);R=(re.a.geodeticLatitudeToMercatorAngle(N)-p)*_}a.encode(i,n*w,M,x,I,F,R),l.minimumHeight=Math.min(l.minimumHeight,I),l.maximumHeight=Math.max(l.maximumHeight,I),++n}}}return n}function Et(e,t,a,i,n,r){var o,l,u;a?(o=0,l=e.length,u=1):(o=e.length-1,l=-1,u=-1);for(var d=o;d!==l;d+=u){var c=e[d];if(At(t[d],c)){var f;switch(i){case Ye.WEST:f=c.westIndicesSouthToNorth;break;case Ye.SOUTH:f=c.southIndicesEastToWest;break;case Ye.EAST:f=c.eastIndicesNorthToSouth;break;case Ye.NORTH:f=c.northIndicesWestToEast}var h=f[a?0:f.length-1];if(Object(s.default)(h))return c.encoding.decodeHeight(c.vertices,h)}}}function At(e,t){return Object(s.default)(t)&&(!Object(s.default)(e.data.fill)||!e.data.fill.changedThisFrame)}function Pt(e,t,a,i,r,o,s,l){var u,d,c,f,h,m=i[r?0:a.length-1],p=a[r?0:a.length-1];if(At(m,p)&&(0===o?0===s?(u=r?p.northIndicesWestToEast:p.eastIndicesNorthToSouth,d=r,c=r):(u=r?p.eastIndicesNorthToSouth:p.southIndicesEastToWest,d=!r,c=!1):0===s?(u=r?p.westIndicesSouthToNorth:p.northIndicesWestToEast,d=!r,c=!0):(u=r?p.southIndicesEastToWest:p.westIndicesSouthToNorth,d=r,c=!r),u.length>0)){h=u[f=r?0:u.length-1],p.encoding.decodeTextureCoordinates(p.vertices,h,nt);var _=_t(m,e.tile,nt,nt);if(_.x===o&&_.y===s)return vt(p,h,0,0,l),!0;if(!((f=Object(ze.a)(u,d?o:s,(function(t,a){p.encoding.decodeTextureCoordinates(p.vertices,t,nt);var i=_t(m,e.tile,nt,nt);return c?d?i.x-o:i.y-s:d?o-i.x:s-i.y})))<0))return vt(p,u[f],0,0,l),!0;if((f=~f)>0&&f<u.length)return function(e,t,a,i,r,o,s,l,u,d){var c,f=i.encoding,h=i.vertices,m=_t(t,a,f.decodeTextureCoordinates(h,r,nt),nt),p=_t(t,a,f.decodeTextureCoordinates(h,o,it),it);c=u?(s-m.x)/(p.x-m.x):(l-m.y)/(p.y-m.y);var _,g=f.decodeHeight(h,r),v=f.decodeHeight(h,o),y=a.rectangle;if(Je.longitude=J.default.lerp(y.west,y.east,s),Je.latitude=J.default.lerp(y.south,y.north,l),d.height=Je.height=J.default.lerp(g,v,c),f.hasVertexNormals){var b=f.getOctEncodedNormal(h,r,gt),w=f.getOctEncodedNormal(h,o,yt),C=Be.a.octDecode(b.x,b.y,et),O=Be.a.octDecode(w.x,w.y,bt);_=n.default.lerp(C,O,c,et),n.default.normalize(_,_),Be.a.octEncode(_,d.encodedNormal)}else _=e.geodeticSurfaceNormalCartographic(Je,et),Be.a.octEncode(_,d.encodedNormal)}(t,m,e.tile,p,u[f-1],u[f],o,s,d,l),!0}return!1}var St=[new n.default,new n.default,new n.default,new n.default];var Dt=qe,Ft=a(339);function Mt(e){this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=Ue.default.RECEIVE_ONLY,this.splitDirection=O.default.NONE,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this.undergroundColor=void 0,this.undergroundColorAlphaByDistance=void 0,this.materialUniformMap=void 0,this._materialUniformMap=void 0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new C.default,this._imageryLayers.layerAdded.addEventListener(Mt.prototype._onLayerAdded,this),this._imageryLayers.layerRemoved.addEventListener(Mt.prototype._onLayerRemoved,this),this._imageryLayers.layerMoved.addEventListener(Mt.prototype._onLayerMoved,this),this._imageryLayers.layerShownOrHidden.addEventListener(Mt.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new C.default,this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new b.default(0,0,.5,1),this._clippingPlanes=void 0,this.cartographicLimitRectangle=A.default.clone(A.default.MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1}function It(e,t){var a=e.loadingImagery;Object(s.default)(a)||(a=e.readyImagery);var i=t.loadingImagery;return Object(s.default)(i)||(i=t.readyImagery),a.imageryLayer._layerIndex-i.imageryLayer._layerIndex}function Rt(e,t){var a=t.globeTranslucencyState;if(a.translucent){var i=e.renderState.blending.enabled;a.pushDerivedCommands(e,i,t)}else t.commandList.push(e)}Object.defineProperties(Mt.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){this._baseColor=e,this._firstPassInitialColor=G.a.fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){this._quadtree=e}},ready:{get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){this._terrainProvider!==e&&(this._terrainProvider=e,Object(s.default)(this._quadtree)&&this._quadtree.invalidateAllTiles())}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){me.a.setOwner(e,this,"_clippingPlanes")}}}),Mt.prototype.update=function(e){this._imageryLayers._update()},Mt.prototype.initialize=function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile((function(e){e.data.imagery.sort(It)}))),function(e,t){var a=t.creditDisplay;e._terrainProvider.ready&&Object(s.default)(e._terrainProvider.credit)&&a.addCredit(e._terrainProvider.credit);for(var i=e._imageryLayers,n=0,r=i.length;n<r;++n){var o=i.get(n).imageryProvider;o.ready&&Object(s.default)(o.credit)&&a.addCredit(o.credit)}}(this,e);for(var t=this._vertexArraysToDestroy,a=t.length,i=0;i<a;++i)Ne._freeVertexArray(t[i]);t.length=0},Mt.prototype.beginUpdate=function(e){for(var t=this._tilesToRenderByTextureCount,a=0,i=t.length;a<i;++a){var n=t[a];Object(s.default)(n)&&(n.length=0)}var r=this._clippingPlanes;Object(s.default)(r)&&r.enabled&&r.update(e),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1},Mt.prototype.endUpdate=function(e){if(!Object(s.default)(this._renderState)){this._renderState=ce.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:pe.a.LESS}}),this._blendRenderState=ce.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:pe.a.LESS_OR_EQUAL},blending:he.a.ALPHA_BLEND});var t=Object(W.default)(this._renderState,!0);t.cull.enabled=!1,this._disableCullingRenderState=ce.a.fromCache(t),(t=Object(W.default)(this._blendRenderState,!0)).cull.enabled=!1,this._disableCullingBlendRenderState=ce.a.fromCache(t)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&Dt.updateFillTiles(this,this._quadtree._tilesToRender,e,this._vertexArraysToDestroy);for(var a=this._tilesToRenderByTextureCount,i=0,n=a.length;i<n;++i){var r=a[i];if(Object(s.default)(r))for(var o=0,l=r.length;o<l;++o){var u=r[o],d=u.data.tileBoundingRegion;da(this,u,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,d.minimumHeight)}}},Mt.prototype.updateForPick=function(e){for(var t=this._drawCommands,a=0,i=this._usedDrawCommands;a<i;++a)Rt(t[a],e)},Mt.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()},Mt.prototype.getLevelMaximumGeometricError=function(e){return this._terrainProvider.getLevelMaximumGeometricError(e)},Mt.prototype.loadTile=function(e,t){var a,i=t.data,n=!0;Object(s.default)(i)&&(n=i.boundingVolumeSourceTile!==t||t._lastSelectionResult===Qe.CULLED_BUT_NEEDED,a=i.terrainState),Ne.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,n),i=t.data,n&&a!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==ne.NONE&&i.boundingVolumeSourceTile===t&&(n=!1,Ne.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,n))};var Nt=new v.default,Lt=new A.default,jt=new A.default,Vt=new y.default;function Ut(e,t){if(t.west<t.east)return t;var a=A.default.clone(t,jt);return A.default.center(e,Vt).longitude>0?a.east=J.default.PI:a.west=-J.default.PI,a}function Bt(e,t){if(t.cameraUnderground)return!0;if(t.globeTranslucencyState.translucent)return!0;if(e.backFaceCulling)return!1;var a=e._clippingPlanes;return!(!Object(s.default)(a)||!a.enabled)||!A.default.equals(e.cartographicLimitRectangle,A.default.MAX_VALUE)}Mt.prototype.computeTileVisibility=function(e,t,a){var i=this.computeDistanceToTile(e,t);e._distance=i;var r=Bt(this,t);if(t.fog.enabled&&!r&&J.default.fog(i,t.fog.density)>=1)return ne.NONE;var o=e.data,l=o.tileBoundingRegion;if(void 0===o.boundingVolumeSourceTile)return ne.PARTIAL;var u=t.cullingVolume,d=o.orientedBoundingBox;!Object(s.default)(d)&&Object(s.default)(o.renderedMesh)&&(d=o.renderedMesh.boundingSphere3D),o.clippedByBoundaries=!1;var c=Ut(e.rectangle,this.cartographicLimitRectangle),f=A.default.simpleIntersection(c,e.rectangle,Lt);if(!Object(s.default)(f))return ne.NONE;if(A.default.equals(f,e.rectangle)||(o.clippedByBoundaries=!0),t.mode!==V.a.SCENE3D&&(d=Nt,v.default.fromRectangleWithHeights2D(e.rectangle,t.mapProjection,l.minimumHeight,l.maximumHeight,d),n.default.fromElements(d.center.z,d.center.x,d.center.y,d.center),t.mode===V.a.MORPHING&&Object(s.default)(o.renderedMesh)&&(d=v.default.union(o.renderedMesh.boundingSphere3D,d,d))),!Object(s.default)(d))return ne.PARTIAL;var h,m=this._clippingPlanes;if(Object(s.default)(m)&&m.enabled){var p=m.computeIntersectionWithBoundingVolume(d);if(e.isClipped=p!==K.default.INSIDE,p===K.default.OUTSIDE)return ne.NONE}var _=u.computeVisibility(d);if(_===K.default.OUTSIDE?h=ne.NONE:_===K.default.INTERSECTING?h=ne.PARTIAL:_===K.default.INSIDE&&(h=ne.FULL),h===ne.NONE)return h;var g=t.mode===V.a.SCENE3D&&t.camera.frustum instanceof te.a;if(t.mode===V.a.SCENE3D&&!g&&Object(s.default)(a)&&!r){var y=o.occludeePointInScaledSpace;return Object(s.default)(y)?a.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(y,l.minimumHeight)?h:ne.NONE:h}return h},Mt.prototype.canRefine=function(e){return!!Object(s.default)(e.data.terrainData)||void 0!==this.terrainProvider.getTileDataAvailable(2*e.x,2*e.y,e.level+1)};var zt=[],Ht=[];Mt.prototype.canRenderWithoutLosingDetail=function(e,t){var a=e.data,i=zt;i.length=this._imageryLayers.length;var n,r,o,l=!1,u=!1;for(Object(s.default)(a)&&(l=a.terrainState===Pe.READY,u=!0,n=a.imagery),r=0,o=i.length;r<o;++r)i[r]=u;if(Object(s.default)(n))for(r=0,o=n.length;r<o;++r){var d=n[r],c=d.loadingImagery,f=!Object(s.default)(c)||c.state===Ee.a.FAILED||c.state===Ee.a.INVALID,h=(d.loadingImagery||d.readyImagery).imageryLayer._layerIndex;i[h]=f&&i[h]}var m=this.quadtree._lastSelectionFrameNumber,p=Ht;for(p.length=0,p.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);p.length>0;){var _=p.pop(),g=_._lastSelectionResultFrame===m?_._lastSelectionResult:Qe.NONE;if(g===Qe.RENDERED){var v=_.data;if(!Object(s.default)(v))continue;if(!l&&_.data.terrainState===Pe.READY)return!1;var y=_.data.imagery;for(r=0,o=y.length;r<o;++r){var b=y[r],w=b.loadingImagery,C=!Object(s.default)(w)||w.state===Ee.a.FAILED||w.state===Ee.a.INVALID,O=(b.loadingImagery||b.readyImagery).imageryLayer._layerIndex;if(C&&!i[O])return!1}}else g===Qe.REFINED&&p.push(_.southwestChild,_.southeastChild,_.northwestChild,_.northeastChild)}return!0};var kt=new n.default;Mt.prototype.computeTileLoadPriority=function(e,t){var a=e.data;if(void 0===a)return 0;var i=a.orientedBoundingBox;if(void 0===i)return 0;var r=t.camera.positionWC,o=t.camera.directionWC,s=n.default.subtract(i.center,r,kt),l=n.default.magnitude(s);return l<J.default.EPSILON5?0:(n.default.divideByScalar(s,l,s),(1-n.default.dot(s,o))*e._distance)};var Gt=new $.default,Wt=new $.default,Yt=new G.a,Xt=new G.a,Qt=new G.a,qt=new n.default,Zt=new n.default,Kt=new n.default,Jt=new n.default;Mt.prototype.showTileThisFrame=function(e,t){for(var a=0,i=e.data.imagery,n=0,r=i.length;n<r;++n){var o=i[n];Object(s.default)(o.readyImagery)&&0!==o.readyImagery.imageryLayer.alpha&&++a}var l=this._tilesToRenderByTextureCount[a];Object(s.default)(l)||(l=[],this._tilesToRenderByTextureCount[a]=l),l.push(e);var u=e.data;Object(s.default)(u.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;var d=this._debug;++d.tilesRendered,d.texturesRendered+=a};var $t=[new n.default,new n.default,new n.default,new n.default];Mt.prototype.computeDistanceToTile=function(e,t){var a=function(e,t,a){var i=e.data;void 0===i&&(i=e.data=new Ne);void 0===i.tileBoundingRegion&&(i.tileBoundingRegion=new Ft.a({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:e.tilingScheme.ellipsoid,minimumHeight:0,maximumHeight:0}));var n=i.terrainData,r=i.mesh,o=i.tileBoundingRegion;if(void 0!==r&&void 0!==r.minimumHeight&&void 0!==r.maximumHeight)return o.minimumHeight=r.minimumHeight,o.maximumHeight=r.maximumHeight,e;if(void 0!==n&&void 0!==n._minimumHeight&&void 0!==n._maximumHeight)return o.minimumHeight=n._minimumHeight*a.terrainExaggeration,o.maximumHeight=n._maximumHeight*a.terrainExaggeration,e;o.minimumHeight=Number.NaN,o.maximumHeight=Number.NaN;var s=e.parent;for(;void 0!==s;){var l=s.data;if(void 0!==l){var u=l.mesh;if(void 0!==u&&void 0!==u.minimumHeight&&void 0!==u.maximumHeight)return o.minimumHeight=u.minimumHeight,o.maximumHeight=u.maximumHeight,s;var d=l.terrainData;if(void 0!==d&&void 0!==d._minimumHeight&&void 0!==d._maximumHeight)return o.minimumHeight=d._minimumHeight*a.terrainExaggeration,o.maximumHeight=d._maximumHeight*a.terrainExaggeration,s}s=s.parent}return}(e,this.terrainProvider,t),i=e.data,r=i.tileBoundingRegion;if(void 0===a)return 9999999999;if(i.boundingVolumeSourceTile!==a){i.boundingVolumeSourceTile=a;var o=e.rectangle;Object(s.default)(o)&&(i.orientedBoundingBox=ee.a.fromRectangle(e.rectangle,r.minimumHeight,r.maximumHeight,e.tilingScheme.ellipsoid,i.orientedBoundingBox),i.occludeePointInScaledSpace=function(e,t,a,i,r,o){var s=e.quadtree._occluders.ellipsoid,l=s.ellipsoid,u=$t;return n.default.fromRadians(a.west,a.south,r,l,u[0]),n.default.fromRadians(a.east,a.south,r,l,u[1]),n.default.fromRadians(a.west,a.north,r,l,u[2]),n.default.fromRadians(a.east,a.north,r,l,u[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,u,i,o)}(this,i.orientedBoundingBox.center,e.rectangle,r.minimumHeight,r.maximumHeight,i.occludeePointInScaledSpace))}var l=r.minimumHeight,u=r.maximumHeight;if(i.boundingVolumeSourceTile!==e){var d=t.camera.positionCartographic.height;Math.abs(d-l)>Math.abs(d-u)?(r.minimumHeight=l,r.maximumHeight=l):(r.minimumHeight=u,r.maximumHeight=u)}var c=r.distanceToCamera(t);return r.minimumHeight=l,r.maximumHeight=u,c},Mt.prototype.isDestroyed=function(){return!1},Mt.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),Object(l.default)(this)},Mt.prototype._onLayerAdded=function(e,t){if(e.show){var a=this._terrainProvider,i=this,n=e.imageryProvider,r=this._imageryLayersUpdatedEvent;n._reload=function(){e._imageryCache={},i._quadtree.forEachLoadedTile((function(t){if(!Object(s.default)(t._loadedCallbacks[e._layerIndex])){var i,n=t.data.imagery,r=n.length,l=-1,u=0;for(i=0;i<r;++i){var d=n[i];if(Object(o.default)(d.readyImagery,d.loadingImagery).imageryLayer===e)-1===l&&(l=i),++u;else if(-1!==l)break}if(-1!==l){var c=l+u;e._createTileImagerySkeletons(t,a,c)&&(t._loadedCallbacks[e._layerIndex]=function(e,t,a){return function(i){var n,r,l,u=-1,d=i.data.imagery,c=d.length;for(l=0;l<c;++l)if(n=d[l],(r=Object(o.default)(n.readyImagery,n.loadingImagery)).imageryLayer===t){u=l;break}if(-1!==u){var f=u+e;if(n=d[f],r=Object(s.default)(n)?Object(o.default)(n.readyImagery,n.loadingImagery):void 0,!Object(s.default)(r)||r.imageryLayer!==t)return!t._createTileImagerySkeletons(i,a,f);for(l=u;l<f;++l)d[l].freeResources();d.splice(u,e)}return!0}}(u,e,a),t.state=Ae.LOADING)}}}))},this._quadtree.forEachLoadedTile((function(t){e._createTileImagerySkeletons(t,a)&&(t.state=Ae.LOADING,0===t.level||t._lastSelectionResultFrame===i.quadtree._lastSelectionFrameNumber&&t._lastSelectionResult===Qe.RENDERED||(t.renderable=!1))})),this._layerOrderChanged=!0,r.raiseEvent()}},Mt.prototype._onLayerRemoved=function(e,t){this._quadtree.forEachLoadedTile((function(t){for(var a=t.data.imagery,i=-1,n=0,r=0,o=a.length;r<o;++r){var l=a[r],u=l.loadingImagery;if(Object(s.default)(u)||(u=l.readyImagery),u.imageryLayer===e)-1===i&&(i=r),l.freeResources(),++n;else if(-1!==i)break}-1!==i&&a.splice(i,n)})),Object(s.default)(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()},Mt.prototype._onLayerMoved=function(e,t,a){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()},Mt.prototype._onLayerShownOrHidden=function(e,t,a){a?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};var ea,ta,aa,ia=new $.default;function na(e,t){var a={u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){var t=e.context.uniformState.view,a=$.default.multiplyByPoint(t,this.properties.rtc,Zt);return $.default.setTranslation(t,a,Gt),Gt},u_modifiedModelViewProjection:function(){var t=e.context.uniformState.view,a=e.context.uniformState.projection,i=$.default.multiplyByPoint(t,this.properties.rtc,Zt);return $.default.setTranslation(t,i,Wt),$.default.multiply(a,Wt,Wt),Wt},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureNightAlpha:function(){return this.properties.dayTextureNightAlpha},u_dayTextureDayAlpha:function(){return this.properties.dayTextureDayAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){var a=t._clippingPlanes;return Object(s.default)(a)&&Object(s.default)(a.texture)?a.texture:e.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){var a=t._clippingPlanes;return Object(s.default)(a)?$.default.multiply(e.context.uniformState.view,a.modelMatrix,ia):$.default.IDENTITY},u_clippingPlanesEdgeStyle:function(){var e=this.properties.clippingPlanesEdgeColor;return e.alpha=this.properties.clippingPlanesEdgeWidth,e},u_minimumBrightness:function(){return e.fog.minimumBrightness},u_terrainSplitDirection:function(){return t.splitDirection},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},u_frontFaceAlphaByDistance:function(){return this.properties.frontFaceAlphaByDistance},u_backFaceAlphaByDistance:function(){return this.properties.backFaceAlphaByDistance},u_translucencyRectangle:function(){return this.properties.localizedTranslucencyRectangle},u_undergroundColor:function(){return this.properties.undergroundColor},u_undergroundColorAlphaByDistance:function(){return this.properties.undergroundColorAlphaByDistance},properties:{initialColor:new G.a(0,0,.5,1),fillHighlightColor:new b.default(0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new k.default(65e5,9e6),nightFadeDistance:new k.default(1e7,4e7),hsbShift:new n.default,center3D:void 0,rtc:new n.default,modifiedModelView:new $.default,tileRectangle:new G.a,dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureNightAlpha:[],dayTextureDayAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new k.default,southMercatorYAndOneOverHeight:new k.default,waterMask:void 0,waterMaskTranslationAndScale:new G.a,minMaxHeight:new k.default,scaleAndBias:new $.default,clippingPlanesEdgeColor:b.default.clone(b.default.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new G.a,frontFaceAlphaByDistance:new G.a,backFaceAlphaByDistance:new G.a,localizedTranslucencyRectangle:new G.a,undergroundColor:b.default.clone(b.default.TRANSPARENT),undergroundColorAlphaByDistance:new G.a}};return Object(s.default)(t.materialUniformMap)?Object(X.default)(a,t.materialUniformMap):a}function ra(e,t,a){var i,n,r=a.data;if(Object(s.default)(r.vertexArray)?(i=r.mesh,n=r.vertexArray):Object(s.default)(r.fill)&&Object(s.default)(r.fill.vertexArray)&&(i=r.fill.mesh,n=r.fill.vertexArray),Object(s.default)(i)&&Object(s.default)(n)){if(Object(s.default)(r.wireframeVertexArray)){if(r.wireframeVertexArray.mesh===i)return;r.wireframeVertexArray.destroy(),r.wireframeVertexArray=void 0}r.wireframeVertexArray=function(e,t,a){var i={indices:a.indices,primitiveType:ae.a.TRIANGLES};q.a.toWireframe(i);var n=i.indices,r=oe.a.createIndexBuffer({context:e,typedArray:n,usage:se.a.STATIC_DRAW,indexDatatype:Z.a.fromSizeInBytes(n.BYTES_PER_ELEMENT)});return new fe.a({context:e,attributes:t._attributes,indexBuffer:r})}(e,n,i),r.wireframeVertexArray.mesh=i}}!function(){var e,t,a=new Q.a({geometry:H.a.fromDimensions({dimensions:new n.default(2,2,2)})}),i=new Q.a({geometry:new ie.a({radius:1})}),r=new $.default;function o(e){return new Ve.a({geometryInstances:e,appearance:new je.a({translucent:!1,flat:!0}),asynchronous:!1})}ea=function(i,n){return i===e?t:(aa(),e=i,r=$.default.fromRotationTranslation(i.halfAxes,i.center,r),a.modelMatrix=r,a.attributes.color=Y.a.fromColor(n),t=o(a))},ta=function(a,n){return a===e?t:(aa(),e=a,r=$.default.fromTranslation(a.center,r),r=$.default.multiplyByUniformScale(r,a.radius,r),i.modelMatrix=r,i.attributes.color=Y.a.fromColor(n),t=o(i))},aa=function(){Object(s.default)(t)&&(t.destroy(),t=void 0,e=void 0)}}();var oa=new G.a(0,0,0,0),sa={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applyDayNightAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0},la=b.default.TRANSPARENT,ua=new T.a;function da(e,t,a){var i=t.data;Object(s.default)(i.vertexArray)||(void 0===i.fill&&(i.fill=new Dt(t)),i.fill.update(e,a));var r=a.creditDisplay,l=i.terrainData;if(Object(s.default)(l)&&Object(s.default)(l.credits))for(var u=l.credits,d=0,c=u.length;d<c;++d)r.addCredit(u[d]);var f=le.a.maximumTextureImageUnits,h=i.waterMaskTexture,m=i.waterMaskTranslationAndScale;!Object(s.default)(h)&&Object(s.default)(i.fill)&&(h=i.fill.waterMaskTexture,m=i.fill.waterMaskTranslationAndScale);var p=a.cameraUnderground,_=a.globeTranslucencyState,g=_.translucent,y=_.frontFaceAlphaByDistance,w=_.backFaceAlphaByDistance,C=_.rectangle,x=Object(o.default)(e.undergroundColor,la),T=Object(o.default)(e.undergroundColorAlphaByDistance,ua),E=Bt(e,a)&&a.mode===V.a.SCENE3D&&x.alpha>0&&(T.nearValue>0||T.farValue>0),P=e.hasWaterMask&&Object(s.default)(h),S=e.oceanNormalMap,D=P&&Object(s.default)(S),F=e.terrainProvider.ready&&e.terrainProvider.hasVertexNormals,M=a.fog.enabled&&!p,I=e.showGroundAtmosphere&&a.mode===V.a.SCENE3D,R=Ue.default.castShadows(e.shadows)&&!g,L=Ue.default.receiveShadows(e.shadows)&&!g,j=e.hueShift,U=e.saturationShift,B=e.brightnessShift,z=!(J.default.equalsEpsilon(j,0,J.default.EPSILON7)&&J.default.equalsEpsilon(U,0,J.default.EPSILON7)&&J.default.equalsEpsilon(B,0,J.default.EPSILON7)),H=!1;I&&(H=n.default.magnitude(a.camera.positionWC)>e.nightFadeOutDistance);P&&--f,D&&--f,Object(s.default)(a.shadowState)&&a.shadowState.shadowsEnabled&&--f,Object(s.default)(e.clippingPlanes)&&e.clippingPlanes.enabled&&--f,f-=_.numberOfTextureUniforms;var k=i.renderedMesh,W=k.center,Y=k.encoding,X=Yt,Q=0,q=0,Z=0,K=0,te=!1;if(a.mode!==V.a.SCENE3D){var ie=a.mapProjection,ne=ie.project(A.default.southwest(t.rectangle),Kt),oe=ie.project(A.default.northeast(t.rectangle),Jt);if(X.x=ne.x,X.y=ne.y,X.z=oe.x,X.w=oe.y,a.mode!==V.a.MORPHING&&((W=qt).x=0,W.y=.5*(X.z+X.x),W.z=.5*(X.w+X.y),X.x-=W.y,X.y-=W.z,X.z-=W.y,X.w-=W.z),a.mode===V.a.SCENE2D&&Y.quantization===N.a.BITS12){var se=1/(Math.pow(2,12)-1)*.5,ce=(X.z-X.x)*se,fe=(X.w-X.y)*se;X.x-=ce,X.y-=fe,X.z+=ce,X.w+=fe}ie instanceof re.a&&(Q=t.rectangle.south,q=t.rectangle.north,Z=re.a.geodeticLatitudeToMercatorAngle(Q),K=1/(re.a.geodeticLatitudeToMercatorAngle(q)-Z),te=!0)}var he=sa;he.frameState=a,he.surfaceTile=i,he.showReflectiveOcean=P,he.showOceanWaves=D,he.enableLighting=e.enableLighting,he.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,he.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,he.showGroundAtmosphere=I,he.perFragmentGroundAtmosphere=H,he.hasVertexNormals=F,he.useWebMercatorProjection=te,he.clippedByBoundaries=i.clippedByBoundaries,he.splitTerrain=e.splitDirection!==O.default.NONE;var me=i.imagery,pe=0,_e=me.length,ge=e.showSkirts&&!p&&!g,ve=e.backFaceCulling&&!p&&!g,ye=ve?e._renderState:e._disableCullingRenderState,be=ve?e._blendRenderState:e._disableCullingBlendRenderState,we=ye,Ce=e._firstPassInitialColor,Oe=a.context;if(Object(s.default)(e._debug.boundingSphereTile)||aa(),e._materialUniformMap!==e.materialUniformMap){e._materialUniformMap=e.materialUniformMap;for(var xe=e._drawCommands.length,Te=0;Te<xe;++Te)e._uniformMaps[Te]=na(a,e)}do{var Ee,Ae,Pe=0;if(e._drawCommands.length<=e._usedDrawCommands?((Ee=new ue.a).owner=t,Ee.cull=!1,Ee.boundingVolume=new v.default,Ee.orientedBoundingBox=void 0,Ae=na(a,e),e._drawCommands.push(Ee),e._uniformMaps.push(Ae)):(Ee=e._drawCommands[e._usedDrawCommands],Ae=e._uniformMaps[e._usedDrawCommands]),Ee.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){var Se=i.orientedBoundingBox;Object(s.default)(Se)?ea(Se,b.default.RED).update(a):Object(s.default)(k)&&Object(s.default)(k.boundingSphere3D)&&ta(k.boundingSphere3D,b.default.RED).update(a)}var De=Ae.properties;G.a.clone(Ce,De.initialColor),De.oceanNormalMap=S,De.lightingFadeDistance.x=e.lightingFadeOutDistance,De.lightingFadeDistance.y=e.lightingFadeInDistance,De.nightFadeDistance.x=e.nightFadeOutDistance,De.nightFadeDistance.y=e.nightFadeInDistance,De.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;var Fe=p?w:y,Me=p?y:w;Object(s.default)(Fe)&&(G.a.fromElements(Fe.near,Fe.nearValue,Fe.far,Fe.farValue,De.frontFaceAlphaByDistance),G.a.fromElements(Me.near,Me.nearValue,Me.far,Me.farValue,De.backFaceAlphaByDistance)),G.a.fromElements(T.near,T.nearValue,T.far,T.farValue,De.undergroundColorAlphaByDistance),b.default.clone(x,De.undergroundColor);var Ie=!Object(s.default)(i.vertexArray)&&Object(s.default)(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;Ie&&b.default.clone(e.fillHighlightColor,De.fillHighlightColor),De.center3D=k.center,n.default.clone(W,De.rtc),G.a.clone(X,De.tileRectangle),De.southAndNorthLatitude.x=Q,De.southAndNorthLatitude.y=q,De.southMercatorYAndOneOverHeight.x=Z,De.southMercatorYAndOneOverHeight.y=K;var Re=Xt,Ne=Ut(t.rectangle,e.cartographicLimitRectangle),je=Qt,Ve=Ut(t.rectangle,C);n.default.fromElements(j,U,B,De.hsbShift);var Be=t.rectangle,ze=1/Be.width,He=1/Be.height;Re.x=(Ne.west-Be.west)*ze,Re.y=(Ne.south-Be.south)*He,Re.z=(Ne.east-Be.west)*ze,Re.w=(Ne.north-Be.south)*He,G.a.clone(Re,De.localizedCartographicLimitRectangle),je.x=(Ve.west-Be.west)*ze,je.y=(Ve.south-Be.south)*He,je.z=(Ve.east-Be.west)*ze,je.w=(Ve.north-Be.south)*He,G.a.clone(je,De.localizedTranslucencyRectangle);var ke=M&&J.default.fog(t._distance,a.fog.density)>J.default.EPSILON3;z=z&&(ke||I);for(var Ge=!1,We=!1,Ye=!1,Xe=!1,Qe=!1,qe=!1,Ze=!1,Ke=!1,Je=!1,$e=!1;Pe<f&&pe<_e;){var et=me[pe],tt=et.readyImagery;if(++pe,Object(s.default)(tt)&&0!==tt.imageryLayer.alpha){var at=et.useWebMercatorT?tt.textureWebMercator:tt.texture,it=tt.imageryLayer;Object(s.default)(et.textureTranslationAndScale)||(et.textureTranslationAndScale=it._calculateTextureTranslationAndScale(t,et)),De.dayTextures[Pe]=at,De.dayTextureTranslationAndScale[Pe]=et.textureTranslationAndScale,De.dayTextureTexCoordsRectangle[Pe]=et.textureCoordinateRectangle,De.dayTextureUseWebMercatorT[Pe]=et.useWebMercatorT,De.dayTextureAlpha[Pe]=it.alpha,qe=qe||1!==De.dayTextureAlpha[Pe],De.dayTextureNightAlpha[Pe]=it.nightAlpha,Ze=Ze||1!==De.dayTextureNightAlpha[Pe],De.dayTextureDayAlpha[Pe]=it.dayAlpha,Ze=Ze||1!==De.dayTextureDayAlpha[Pe],De.dayTextureBrightness[Pe]=it.brightness,Ge=Ge||De.dayTextureBrightness[Pe]!==Le.default.DEFAULT_BRIGHTNESS,De.dayTextureContrast[Pe]=it.contrast,We=We||De.dayTextureContrast[Pe]!==Le.default.DEFAULT_CONTRAST,De.dayTextureHue[Pe]=it.hue,Ye=Ye||De.dayTextureHue[Pe]!==Le.default.DEFAULT_HUE,De.dayTextureSaturation[Pe]=it.saturation,Xe=Xe||De.dayTextureSaturation[Pe]!==Le.default.DEFAULT_SATURATION,De.dayTextureOneOverGamma[Pe]=1/it.gamma,Qe=Qe||De.dayTextureOneOverGamma[Pe]!==1/Le.default.DEFAULT_GAMMA,De.dayTextureSplit[Pe]=it.splitDirection,Ke=Ke||0!==De.dayTextureSplit[Pe];var nt=De.dayTextureCutoutRectangles[Pe];if(Object(s.default)(nt)||(nt=De.dayTextureCutoutRectangles[Pe]=new G.a),G.a.clone(G.a.ZERO,nt),Object(s.default)(it.cutoutRectangle)){var rt=Ut(Be,it.cutoutRectangle),ot=A.default.simpleIntersection(rt,Be,Lt);Je=Object(s.default)(ot)||Je,nt.x=(rt.west-Be.west)*ze,nt.y=(rt.south-Be.south)*He,nt.z=(rt.east-Be.west)*ze,nt.w=(rt.north-Be.south)*He}var st=De.colorsToAlpha[Pe];Object(s.default)(st)||(st=De.colorsToAlpha[Pe]=new G.a);var lt=Object(s.default)(it.colorToAlpha)&&it.colorToAlphaThreshold>0;if($e=$e||lt,lt){var ut=it.colorToAlpha;st.x=ut.red,st.y=ut.green,st.z=ut.blue,st.w=it.colorToAlphaThreshold}else st.w=-1;if(Object(s.default)(tt.credits))for(var dt=tt.credits,ct=0,ft=dt.length;ct<ft;++ct)r.addCredit(dt[ct]);++Pe}}De.dayTextures.length=Pe,De.waterMask=h,G.a.clone(m,De.waterMaskTranslationAndScale),De.minMaxHeight.x=Y.minimumHeight,De.minMaxHeight.y=Y.maximumHeight,$.default.clone(Y.matrix,De.scaleAndBias);var ht=e._clippingPlanes,mt=Object(s.default)(ht)&&ht.enabled&&t.isClipped;mt&&(De.clippingPlanesEdgeColor=b.default.clone(ht.edgeColor,De.clippingPlanesEdgeColor),De.clippingPlanesEdgeWidth=ht.edgeWidth),he.numberOfDayTextures=Pe,he.applyBrightness=Ge,he.applyContrast=We,he.applyHue=Ye,he.applySaturation=Xe,he.applyGamma=Qe,he.applyAlpha=qe,he.applyDayNightAlpha=Ze,he.applySplit=Ke,he.enableFog=ke,he.enableClippingPlanes=mt,he.clippingPlanes=ht,he.hasImageryLayerCutout=Je,he.colorCorrect=z,he.highlightFillTile=Ie,he.colorToAlpha=$e,he.showUndergroundColor=E,he.translucent=g;var pt=i.renderedMesh.indices.length;ge||(pt=i.renderedMesh.indexCountWithoutSkirts),Ee.shaderProgram=e._surfaceShaderSet.getShaderProgram(he),Ee.castShadows=R,Ee.receiveShadows=L,Ee.renderState=we,Ee.primitiveType=ae.a.TRIANGLES,Ee.vertexArray=i.vertexArray||i.fill.vertexArray,Ee.count=pt,Ee.uniformMap=Ae,Ee.pass=de.a.GLOBE,e._debug.wireframe&&(ra(Oe,0,t),Object(s.default)(i.wireframeVertexArray)&&(Ee.vertexArray=i.wireframeVertexArray,Ee.primitiveType=ae.a.LINES,Ee.count=2*pt));var _t=Ee.boundingVolume,gt=Ee.orientedBoundingBox;if(a.mode!==V.a.SCENE3D){var vt=i.tileBoundingRegion;v.default.fromRectangleWithHeights2D(t.rectangle,a.mapProjection,vt.minimumHeight,vt.maximumHeight,_t),n.default.fromElements(_t.center.z,_t.center.x,_t.center.y,_t.center),a.mode===V.a.MORPHING&&(_t=v.default.union(k.boundingSphere3D,_t,_t))}else Ee.boundingVolume=v.default.clone(k.boundingSphere3D,_t),Ee.orientedBoundingBox=ee.a.clone(i.orientedBoundingBox,gt);Ee.dirty=!0,g&&_.updateDerivedCommands(Ee,a),Rt(Ee,a),we=be,Ce=oa}while(pe<_e)}var ca=Mt;a(15);function fa(){this._enabled=!1,this._frontFaceAlpha=1,this._frontFaceAlphaByDistance=void 0,this._backFaceAlpha=1,this._backFaceAlphaByDistance=void 0,this._rectangle=A.default.clone(A.default.MAX_VALUE)}Object.defineProperties(fa.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e}},frontFaceAlpha:{get:function(){return this._frontFaceAlpha},set:function(e){this._frontFaceAlpha=e}},frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance},set:function(e){this._frontFaceAlphaByDistance=T.a.clone(e,this._frontFaceAlphaByDistance)}},backFaceAlpha:{get:function(){return this._backFaceAlpha},set:function(e){this._backFaceAlpha=e}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance},set:function(e){this._backFaceAlphaByDistance=T.a.clone(e,this._backFaceAlphaByDistance)}},rectangle:{get:function(){return this._rectangle},set:function(e){Object(s.default)(e)||(e=A.default.clone(A.default.MAX_VALUE)),A.default.clone(e,this._rectangle)}}});var ha=fa;function ma(){this._layers=[],this.layerAdded=new C.default,this.layerRemoved=new C.default,this.layerMoved=new C.default,this.layerShownOrHidden=new C.default}function pa(e,t){return e.indexOf(t)}function _a(e,t,a){var i=e._layers;if((t=J.default.clamp(t,0,i.length-1))!==(a=J.default.clamp(a,0,i.length-1))){var n=i[t];i[t]=i[a],i[a]=n,e._update(),e.layerMoved.raiseEvent(n,a,t)}}Object.defineProperties(ma.prototype,{length:{get:function(){return this._layers.length}}}),ma.prototype.add=function(e,t){Object(s.default)(t)?this._layers.splice(t,0,e):(t=this._layers.length,this._layers.push(e)),this._update(),this.layerAdded.raiseEvent(e,t)},ma.prototype.addImageryProvider=function(e,t){var a=new Le.default(e);return this.add(a,t),a},ma.prototype.remove=function(e,t){t=Object(o.default)(t,!0);var a=this._layers.indexOf(e);return-1!==a&&(this._layers.splice(a,1),this._update(),this.layerRemoved.raiseEvent(e,a),t&&e.destroy(),!0)},ma.prototype.removeAll=function(e){e=Object(o.default)(e,!0);for(var t=this._layers,a=0,i=t.length;a<i;a++){var n=t[a];this.layerRemoved.raiseEvent(n,a),e&&n.destroy()}this._layers=[]},ma.prototype.contains=function(e){return-1!==this.indexOf(e)},ma.prototype.indexOf=function(e){return this._layers.indexOf(e)},ma.prototype.get=function(e){return this._layers[e]},ma.prototype.raise=function(e){var t=pa(this._layers,e);_a(this,t,t+1)},ma.prototype.lower=function(e){var t=pa(this._layers,e);_a(this,t,t-1)},ma.prototype.raiseToTop=function(e){var t=pa(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))},ma.prototype.lowerToBottom=function(e){var t=pa(this._layers,e);0!==t&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))};var ga=new A.default;ma.prototype.pickImageryLayerFeatures=function(e,t){var a=t.globe.pick(e,t);if(Object(s.default)(a)){for(var i,n=t.globe.ellipsoid.cartesianToCartographic(a),r=t.globe._surface._tilesToRender,o=0;!Object(s.default)(i)&&o<r.length;++o){var l=r[o];A.default.contains(l.rectangle,n)&&(i=l)}if(Object(s.default)(i)){for(var u=i.data.imagery,d=[],c=[],f=u.length-1;f>=0;--f){var h=u[f],m=h.readyImagery;if(Object(s.default)(m)){var p=m.imageryLayer.imageryProvider;if(Object(s.default)(p.pickFeatures)&&A.default.contains(m.rectangle,n)){var _=ga;if(_.west=J.default.lerp(i.rectangle.west,i.rectangle.east,h.textureCoordinateRectangle.x-1/1024),_.east=J.default.lerp(i.rectangle.west,i.rectangle.east,h.textureCoordinateRectangle.z+1/1024),_.south=J.default.lerp(i.rectangle.south,i.rectangle.north,h.textureCoordinateRectangle.y-1/1024),_.north=J.default.lerp(i.rectangle.south,i.rectangle.north,h.textureCoordinateRectangle.w+1/1024),A.default.contains(_,n)){var g=p.pickFeatures(m.x,m.y,m.level,n.longitude,n.latitude);Object(s.default)(g)&&(d.push(g),c.push(m.imageryLayer))}}}}if(0!==d.length)return R.default.all(d,(function(e){for(var t=[],a=0;a<e.length;++a){var i=e[a],r=c[a];if(Object(s.default)(i)&&i.length>0)for(var o=0;o<i.length;++o){var l=i[o];l.imageryLayer=r,Object(s.default)(l.position)||(l.position=n),t.push(l)}}return t}))}}},ma.prototype.queueReprojectionCommands=function(e){for(var t=this._layers,a=0,i=t.length;a<i;++a)t[a].queueReprojectionCommands(e)},ma.prototype.cancelReprojections=function(){for(var e=this._layers,t=0,a=e.length;t<a;++t)e[t].cancelReprojections()},ma.prototype.isDestroyed=function(){return!1},ma.prototype.destroy=function(){return this.removeAll(!0),Object(l.default)(this)},ma.prototype._update=function(){var e,t,a,i,n=!0,r=this._layers;for(a=0,i=r.length;a<i;++a)(t=r[a])._layerIndex=a,t.show?(t._isBaseLayer=n,n=!1):t._isBaseLayer=!1,t.show!==t._show&&(Object(s.default)(t._show)&&(Object(s.default)(e)||(e=[]),e.push(t)),t._show=t.show);if(Object(s.default)(e))for(a=0,i=e.length;a<i;++a)t=e[a],this.layerShownOrHidden.raiseEvent(t,t._layerIndex,t.show)};var va=ma,ya=a(96),ba=a(169),wa=a(430);function Ca(e){this._ellipsoid=new wa.a(e.ellipsoid,n.default.ZERO)}Object.defineProperties(Ca.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var Oa=Ca;function xa(e){this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=Qe.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=Ae.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}function Ta(e){Object(s.default)(e)&&e.freeResources()}xa.createLevelZeroTiles=function(e){for(var t=e.getNumberOfXTilesAtLevel(0),a=e.getNumberOfYTilesAtLevel(0),i=new Array(t*a),n=0,r=0;r<a;++r)for(var o=0;o<t;++o)i[n++]=new xa({tilingScheme:e,x:o,y:r,level:0});return i},xa.prototype._updateCustomData=function(e,t,a){var i,n,r,o=this.customData;if(Object(s.default)(t)&&Object(s.default)(a)){for(o=o.filter((function(e){return-1===a.indexOf(e)})),this._customData=o,r=this._rectangle,i=0;i<t.length;++i)n=t[i],A.default.contains(r,n.positionCartographic)&&o.push(n);this._frameUpdated=e}else{var l=this._parent;if(Object(s.default)(l)&&this._frameUpdated!==l._frameUpdated){o.length=0,r=this._rectangle;var u=l.customData;for(i=0;i<u.length;++i)n=u[i],A.default.contains(r,n.positionCartographic)&&o.push(n);this._frameUpdated=l._frameUpdated}}},Object.defineProperties(xa.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return Object(s.default)(this._southwestChild)||(this._southwestChild=new xa({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return Object(s.default)(this._southeastChild)||(this._southeastChild=new xa({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return Object(s.default)(this._northwestChild)||(this._northwestChild=new xa({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return Object(s.default)(this._northeastChild)||(this._northeastChild=new xa({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<Ae.DONE}},eligibleForUnloading:{get:function(){var e=!0;return Object(s.default)(this.data)&&(e=this.data.eligibleForUnloading,Object(s.default)(e)||(e=!0)),e}}}),xa.prototype.findLevelZeroTile=function(e,t,a){var i=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=i:t>=i&&(t-=i),!(a<0||a>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((function(e){return e.x===t&&e.y===a}))[0]},xa.prototype.findTileToWest=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;var a=t.findTileToWest(e);return void 0!==a?t.southwestChild===this?a.southeastChild:a.northeastChild:void 0},xa.prototype.findTileToEast=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;var a=t.findTileToEast(e);return void 0!==a?t.southeastChild===this?a.southwestChild:a.northwestChild:void 0},xa.prototype.findTileToSouth=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;var a=t.findTileToSouth(e);return void 0!==a?t.southwestChild===this?a.northwestChild:a.northeastChild:void 0},xa.prototype.findTileToNorth=function(e){var t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;var a=t.findTileToNorth(e);return void 0!==a?t.northwestChild===this?a.southwestChild:a.southeastChild:void 0},xa.prototype.freeResources=function(){this.state=Ae.START,this.renderable=!1,this.upsampledFromParent=!1,Object(s.default)(this.data)&&Object(s.default)(this.data.freeResources)&&this.data.freeResources(),Ta(this._southwestChild),this._southwestChild=void 0,Ta(this._southeastChild),this._southeastChild=void 0,Ta(this._northwestChild),this._northwestChild=void 0,Ta(this._northeastChild),this._northeastChild=void 0};var Ea=xa;function Aa(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0}function Pa(e,t){var a=t.replacementPrevious,i=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=i),t===e.head?e.head=i:a.replacementNext=i,t===e.tail?e.tail=a:i.replacementPrevious=a,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count}Aa.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head},Aa.prototype.trimTiles=function(e){for(var t=this.tail,a=!0;a&&Object(s.default)(this._lastBeforeStartOfFrame)&&this.count>e&&Object(s.default)(t);){a=t!==this._lastBeforeStartOfFrame;var i=t.replacementPrevious;t.eligibleForUnloading&&(t.freeResources(),Pa(this,t)),t=i}},Aa.prototype.markTileRendered=function(e){var t=this.head;if(t!==e){if(++this.count,!Object(s.default)(t))return e.replacementPrevious=void 0,e.replacementNext=void 0,this.head=e,void(this.tail=e);(Object(s.default)(e.replacementPrevious)||Object(s.default)(e.replacementNext))&&Pa(this,e),e.replacementPrevious=void 0,e.replacementNext=t,t.replacementPrevious=e,this.head=e}else e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=e.replacementNext)};var Sa,Da=Aa;function Fa(e){this._tileProvider=e.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};var t=this._tileProvider.tilingScheme.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new Da,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=Object(o.default)(e.maximumScreenSpaceError,2),this.tileCacheSize=Object(o.default)(e.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new Oa({ellipsoid:t}),this._tileLoadProgressEvent=new C.default,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}function Ma(e){var t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}Object.defineProperties(Fa.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},occluders:{get:function(){return this._occluders}}}),Fa.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0},Fa.prototype.forEachLoadedTile=function(e){for(var t=this._tileReplacementQueue.head;Object(s.default)(t);)t.state!==Ae.START&&e(t),t=t.replacementNext},Fa.prototype.forEachRenderedTile=function(e){for(var t=this._tilesToRender,a=0,i=t.length;a<i;++a)e(t[a])},Fa.prototype.updateHeight=function(e,t){var a=this,i={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t,removeFunc:function(){for(var e=a._addHeightCallbacks,t=e.length,n=0;n<t;++n)if(e[n]===i){e.splice(n,1);break}a._removeHeightCallbacks.push(i)}};return a._addHeightCallbacks.push(i),i.removeFunc},Fa.prototype.update=function(e){Object(s.default)(this._tileProvider.update)&&this._tileProvider.update(e)},Fa.prototype.beginFrame=function(e){e.passes.render&&(this._tilesInvalidated&&(!function(e){var t=e._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0,Ma(e);var a=e._levelZeroTiles;if(Object(s.default)(a))for(var i=0;i<a.length;++i){for(var n=a[i].customData,r=n.length,o=0;o<r;++o){var l=n[o];l.level=0,e._addHeightCallbacks.push(l)}a[i].freeResources()}e._levelZeroTiles=void 0,e._tileProvider.cancelReprojections()}(this),this._tilesInvalidated=!1),this._tileProvider.initialize(e),Ma(this),this._debug.suspendLodUpdate||this._tileReplacementQueue.markStartOfRenderFrame())},Fa.prototype.render=function(e){var t=e.passes,a=this._tileProvider;t.render&&(a.beginUpdate(e),function(e,t){var a,i=e._debug;if(i.suspendLodUpdate)return;e._tilesToRender.length=0;var n,r=e._tileProvider;if(!Object(s.default)(e._levelZeroTiles)){if(!r.ready)return;var o=r.tilingScheme;e._levelZeroTiles=Ea.createLevelZeroTiles(o);var l=e._levelZeroTiles.length;if(La.length<l)for(La=new Array(l),a=0;a<l;++a)void 0===La[a]&&(La[a]=new Va)}e._occluders.ellipsoid.cameraPosition=t.camera.positionWC;var u=e._levelZeroTiles,d=u.length>1?e._occluders:void 0;Sa=t.camera.positionCartographic,u.sort(Ra);var c,f=e._addHeightCallbacks,h=e._removeHeightCallbacks,m=t.frameNumber;if(f.length>0||h.length>0){for(a=0,c=u.length;a<c;++a)(n=u[a])._updateCustomData(m,f,h);f.length=0,h.length=0}var p=t.camera;e._cameraPositionCartographic=p.positionCartographic;var _=$.default.getTranslation(p.transform,Na);for(e._cameraReferenceFrameOriginCartographic=e.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(_,e._cameraReferenceFrameOriginCartographic),a=0,c=u.length;a<c;++a)n=u[a],e._tileReplacementQueue.markTileRendered(n),n.renderable?ka(e,n,r,t,d,!1,La[a]):(ja(e,e._tileLoadQueueHigh,n,t),++i.tilesWaitingForChildren);e._lastSelectionFrameNumber=m}(this,e),function(e,t){for(var a=e._tileProvider,i=e._tilesToRender,n=0,r=i.length;n<r;++n){var o=i[n];a.showTileThisFrame(o,t)}}(this,e),a.endUpdate(e)),t.pick&&this._tilesToRender.length>0&&a.updateForPick(e)},Fa.prototype.endFrame=function(e){e.passes.render&&e.mode!==V.a.MORPHING&&(function(e,t){var a=e._tileLoadQueueHigh,i=e._tileLoadQueueMedium,n=e._tileLoadQueueLow;if(0===a.length&&0===i.length&&0===n.length)return;e._tileReplacementQueue.trimTiles(e.tileCacheSize);var r=Object(ya.default)()+e._loadQueueTimeSlice,o=e._tileProvider,s=Ya(e,t,o,r,a,!1);s=Ya(e,t,o,r,i,s),Ya(e,t,o,r,n,s)}(this,e),function(e,t){if(!e.tileProvider.ready)return;var a=Za;a.length=0;var i,r=e._tileToUpdateHeights,l=e._tileProvider.terrainProvider,u=Object(ya.default)(),d=e._updateHeightsTimeSlice,c=u+d,f=t.mode,h=t.mapProjection,m=e.tileProvider.tilingScheme.ellipsoid;for(;r.length>0;){var p=r[0];if(Object(s.default)(p.data)&&Object(s.default)(p.data.mesh)){var _=p.customData,g=_.length,v=!1;for(i=e._lastTileIndex;i<g;++i){var b=_[i];if(p.level>b.level){if(Object(s.default)(b.positionOnEllipsoidSurface)||(b.positionOnEllipsoidSurface=n.default.fromRadians(b.positionCartographic.longitude,b.positionCartographic.latitude,0,m)),f===V.a.SCENE3D){var w=m.geodeticSurfaceNormal(b.positionOnEllipsoidSurface,Xa.direction),C=m.getSurfaceNormalIntersectionWithZAxis(b.positionOnEllipsoidSurface,11500,Xa.origin);if(!Object(s.default)(C)){var O;Object(s.default)(p.data.tileBoundingRegion)&&(O=p.data.tileBoundingRegion.minimumHeight);var x=Math.min(Object(o.default)(O,0),-11500),T=n.default.multiplyByScalar(w,Math.abs(x)+1,qa);n.default.subtract(b.positionOnEllipsoidSurface,T,Xa.origin)}}else y.default.clone(b.positionCartographic,Qa),Qa.height=-11500,h.project(Qa,qa),n.default.fromElements(qa.z,qa.x,qa.y,qa),n.default.clone(qa,Xa.origin),n.default.clone(n.default.UNIT_X,Xa.direction);var E=p.data.pick(Xa,f,h,!1,qa);Object(s.default)(E)&&(b.callback(E),b.level=p.level)}else if(p.level===b.level){for(var P,S=p.children,D=S.length,F=0;F<D&&(P=S[F],!A.default.contains(P.rectangle,b.positionCartographic));++F);var M=l.getTileDataAvailable(P.x,P.y,P.level),I=p.parent;(Object(s.default)(M)&&!M||Object(s.default)(I)&&Object(s.default)(I.data)&&Object(s.default)(I.data.terrainData)&&!I.data.terrainData.isChildAvailable(I.x,I.y,P.x,P.y))&&b.removeFunc()}if(Object(ya.default)()>=c){v=!0;break}}if(v){e._lastTileIndex=i;break}e._lastTileIndex=0,r.shift()}else{var R=p._lastSelectionResultFrame===e._lastSelectionFrameNumber?p._lastSelectionResult:Qe.NONE;R!==Qe.RENDERED&&R!==Qe.CULLED_BUT_NEEDED||a.push(p),r.shift(),e._lastTileIndex=0}}for(i=0;i<a.length;i++)r.push(a[i])}(this,e),function(e,t){var a=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;(a!==e._lastTileLoadQueueLength||e._tilesInvalidated)&&(t.afterRender.push(C.default.prototype.raiseEvent.bind(e._tileLoadProgressEvent,a)),e._lastTileLoadQueueLength=a);var i=e._debug;i.enableDebugOutput&&!i.suspendLodUpdate&&(i.maxDepth=e._tilesToRender.reduce((function(e,t){return Math.max(e,t.level)}),-1),i.tilesRendered=e._tilesToRender.length,i.tilesVisited===i.lastTilesVisited&&i.tilesRendered===i.lastTilesRendered&&i.tilesCulled===i.lastTilesCulled&&i.maxDepth===i.lastMaxDepth&&i.tilesWaitingForChildren===i.lastTilesWaitingForChildren&&i.maxDepthVisited===i.lastMaxDepthVisited||(console.log("Visited "+i.tilesVisited+", Rendered: "+i.tilesRendered+", Culled: "+i.tilesCulled+", Max Depth Rendered: "+i.maxDepth+", Max Depth Visited: "+i.maxDepthVisited+", Waiting for children: "+i.tilesWaitingForChildren),i.lastTilesVisited=i.tilesVisited,i.lastTilesRendered=i.tilesRendered,i.lastTilesCulled=i.tilesCulled,i.lastMaxDepth=i.maxDepth,i.lastTilesWaitingForChildren=i.tilesWaitingForChildren,i.lastMaxDepthVisited=i.maxDepthVisited))}(this,e))},Fa.prototype.isDestroyed=function(){return!1},Fa.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};var Ia=new y.default;function Ra(e,t){var a=A.default.center(e.rectangle,Ia),i=a.longitude-Sa.longitude,n=a.latitude-Sa.latitude,r=(a=A.default.center(t.rectangle,Ia)).longitude-Sa.longitude,o=a.latitude-Sa.latitude;return i*i+n*n-(r*r+o*o)}var Na=new n.default,La=[];function ja(e,t,a,i){a.needsLoading&&(void 0!==e.tileProvider.computeTileLoadPriority&&(a._loadPriority=e.tileProvider.computeTileLoadPriority(a,i)),t.push(a))}function Va(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0}function Ua(){this.southwest=new Va,this.southeast=new Va,this.northwest=new Va,this.northeast=new Va}Ua.prototype.combine=function(e){var t=this.southwest,a=this.southeast,i=this.northwest,n=this.northeast;e.allAreRenderable=t.allAreRenderable&&a.allAreRenderable&&i.allAreRenderable&&n.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||a.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||n.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+a.notYetRenderableCount+i.notYetRenderableCount+n.notYetRenderableCount};for(var Ba=new Array(31),za=0;za<Ba.length;++za)Ba[za]=new Ua;function Ha(e,t,a,i,n){var r=e._debug;++r.tilesVisited,e._tileReplacementQueue.markTileRendered(a),a._updateCustomData(t.frameNumber),a.level>r.maxDepthVisited&&(r.maxDepthVisited=a.level);var o=function(e,t,a){if(t.mode===V.a.SCENE2D||t.camera.frustum instanceof te.a||t.camera.frustum instanceof ba.a)return function(e,t,a){var i=t.camera.frustum;Object(s.default)(i._offCenterFrustum)&&(i=i._offCenterFrustum);var n=t.context,r=n.drawingBufferWidth,o=n.drawingBufferHeight,l=e._tileProvider.getLevelMaximumGeometricError(a.level),u=Math.max(i.top-i.bottom,i.right-i.left)/Math.max(r,o),d=l/u;t.fog.enabled&&t.mode!==V.a.SCENE2D&&(d-=J.default.fog(a._distance,t.fog.density)*t.fog.sse);return d/=t.pixelRatio}(e,t,a);var i=e._tileProvider.getLevelMaximumGeometricError(a.level),n=a._distance,r=t.context.drawingBufferHeight,o=t.camera.frustum.sseDenominator,l=i*r/(n*o);t.fog.enabled&&(l-=J.default.fog(n,t.fog.density)*t.fog.sse);return l/=t.pixelRatio}(e,t,a)<e.maximumScreenSpaceError,l=a.southwestChild,u=a.southeastChild,d=a.northwestChild,c=a.northeastChild,f=e._lastSelectionFrameNumber,h=a._lastSelectionResultFrame===f?a._lastSelectionResult:Qe.NONE,m=e.tileProvider;if(o||i){var p=Qe.originalResult(h)===Qe.RENDERED,_=Qe.originalResult(h)===Qe.CULLED||h===Qe.NONE,g=a.state===Ae.DONE,v=p||_||g;if(v||Object(s.default)(m.canRenderWithoutLosingDetail)&&(v=m.canRenderWithoutLosingDetail(a)),v)return o&&ja(e,e._tileLoadQueueMedium,a,t),Ga(e,a),n.allAreRenderable=a.renderable,n.anyWereRenderedLastFrame=h===Qe.RENDERED,n.notYetRenderableCount=a.renderable?0:1,a._lastSelectionResultFrame=t.frameNumber,a._lastSelectionResult=Qe.RENDERED,void(n.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(a));i=!0,o&&ja(e,e._tileLoadQueueHigh,a,t)}if(m.canRefine(a)){if(l.upsampledFromParent&&u.upsampledFromParent&&d.upsampledFromParent&&c.upsampledFromParent)return Ga(e,a),ja(e,e._tileLoadQueueMedium,a,t),e._tileReplacementQueue.markTileRendered(l),e._tileReplacementQueue.markTileRendered(u),e._tileReplacementQueue.markTileRendered(d),e._tileReplacementQueue.markTileRendered(c),n.allAreRenderable=a.renderable,n.anyWereRenderedLastFrame=h===Qe.RENDERED,n.notYetRenderableCount=a.renderable?0:1,a._lastSelectionResultFrame=t.frameNumber,a._lastSelectionResult=Qe.RENDERED,void(n.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(a));a._lastSelectionResultFrame=t.frameNumber,a._lastSelectionResult=Qe.REFINED;var y=e._tilesToRender.length,b=e._tileLoadQueueLow.length,w=e._tileLoadQueueMedium.length,C=e._tileLoadQueueHigh.length,O=e._tileToUpdateHeights.length;if(function(e,t,a,i,n,r,o,s){var l=r.camera.positionCartographic,u=e._tileProvider,d=e._occluders,c=Ba[t.level],f=c.southwest,h=c.southeast,m=c.northwest,p=c.northeast;l.longitude<t.rectangle.east?l.latitude<t.rectangle.north?(ka(e,t,u,r,d,o,f),ka(e,a,u,r,d,o,h),ka(e,i,u,r,d,o,m),ka(e,n,u,r,d,o,p)):(ka(e,i,u,r,d,o,m),ka(e,t,u,r,d,o,f),ka(e,n,u,r,d,o,p),ka(e,a,u,r,d,o,h)):l.latitude<t.rectangle.north?(ka(e,a,u,r,d,o,h),ka(e,t,u,r,d,o,f),ka(e,n,u,r,d,o,p),ka(e,i,u,r,d,o,m)):(ka(e,n,u,r,d,o,p),ka(e,i,u,r,d,o,m),ka(e,a,u,r,d,o,h),ka(e,t,u,r,d,o,f));c.combine(s)}(e,l,u,d,c,t,i,n),y!==e._tilesToRender.length){var x=n.allAreRenderable,T=n.anyWereRenderedLastFrame,E=n.notYetRenderableCount,A=!1;if(!x&&!T){for(var P=e._tilesToRender,S=y;S<P.length;++S)for(var D=P[S];void 0!==D&&D._lastSelectionResult!==Qe.KICKED&&D!==a;)D._lastSelectionResult=Qe.kick(D._lastSelectionResult),D=D.parent;e._tilesToRender.length=y,e._tileToUpdateHeights.length=O,Ga(e,a),a._lastSelectionResult=Qe.RENDERED;var F=h===Qe.RENDERED;!F&&E>e.loadingDescendantLimit&&(e._tileLoadQueueLow.length=b,e._tileLoadQueueMedium.length=w,e._tileLoadQueueHigh.length=C,ja(e,e._tileLoadQueueMedium,a,t),n.notYetRenderableCount=a.renderable?0:1,A=!0),n.allAreRenderable=a.renderable,n.anyWereRenderedLastFrame=F,F||e._tileToUpdateHeights.push(a),++r.tilesWaitingForChildren}e.preloadAncestors&&!A&&ja(e,e._tileLoadQueueLow,a,t)}}else a._lastSelectionResultFrame=t.frameNumber,a._lastSelectionResult=Qe.RENDERED,Ga(e,a),ja(e,e._tileLoadQueueHigh,a,t),n.allAreRenderable=a.renderable,n.anyWereRenderedLastFrame=h===Qe.RENDERED,n.notYetRenderableCount=a.renderable?0:1}function ka(e,t,a,i,n,r,o){if(a.computeTileVisibility(t,i,n)!==ne.NONE)return Ha(e,i,t,r,o);if(++e._debug.tilesCulled,e._tileReplacementQueue.markTileRendered(t),o.allAreRenderable=!0,o.anyWereRenderedLastFrame=!1,o.notYetRenderableCount=0,function(e,t){var a=t.rectangle;return Object(s.default)(e._cameraPositionCartographic)&&A.default.contains(a,e._cameraPositionCartographic)||Object(s.default)(e._cameraReferenceFrameOriginCartographic)&&A.default.contains(a,e._cameraReferenceFrameOriginCartographic)}(e,t)){Object(s.default)(t.data)&&Object(s.default)(t.data.vertexArray)||ja(e,e._tileLoadQueueMedium,t,i);var l=e._lastSelectionFrameNumber,u=t._lastSelectionResultFrame===l?t._lastSelectionResult:Qe.NONE;u!==Qe.CULLED_BUT_NEEDED&&u!==Qe.RENDERED&&e._tileToUpdateHeights.push(t),t._lastSelectionResult=Qe.CULLED_BUT_NEEDED}else e.preloadSiblings||0===t.level?(ja(e,e._tileLoadQueueLow,t,i),t._lastSelectionResult=Qe.CULLED):t._lastSelectionResult=Qe.CULLED;t._lastSelectionResultFrame=i.frameNumber}function Ga(e,t){e._tilesToRender.push(t)}function Wa(e,t){return e._loadPriority-t._loadPriority}function Ya(e,t,a,i,n,r){void 0!==a.computeTileLoadPriority&&n.sort(Wa);for(var o=0,s=n.length;o<s&&(Object(ya.default)()<i||!r);++o){var l=n[o];e._tileReplacementQueue.markTileRendered(l),a.loadTile(t,l),r=!0}return r}var Xa=new E.default,Qa=new y.default,qa=new n.default,Za=[];var Ka=Fa;function Ja(e){e=Object(o.default)(e,d.default.WGS84);var t=new w.default({ellipsoid:e}),i=new va;this._ellipsoid=e,this._imageryLayerCollection=i,this._surfaceShaderSet=new z,this._material=void 0,this._surface=new Ka({tileProvider:new ca({terrainProvider:t,imageryLayers:i,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new C.default,this._undergroundColor=b.default.clone(b.default.BLACK),this._undergroundColorAlphaByDistance=new T.a(e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new ha,$a(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new P.default({url:a(1623)}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=Ue.default.RECEIVE_ONLY,this.splitDirection=O.default.NONE,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0}function $a(e){var t=[],a=Object(s.default)(e._material)&&(e._material.shaderSource.match(/slope/)||e._material.shaderSource.match("normalEC")),i=[I];!Object(s.default)(e._material)||a&&!e._terrainProvider.requestVertexNormals?e._surface._tileProvider.materialUniformMap=void 0:(i.push(e._material.shaderSource),t.push("APPLY_MATERIAL"),e._surface._tileProvider.materialUniformMap=e._material._uniforms),i.push(F),e._surfaceShaderSet.baseVertexShaderSource=new S.a({sources:[I,M],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new S.a({sources:i,defines:t}),e._surfaceShaderSet.material=e._material}function ei(e){return function(t,a){return v.default.distanceSquaredTo(t.data.pickBoundingSphere,e)-v.default.distanceSquaredTo(a.data.pickBoundingSphere,e)}}Object.defineProperties(Ja.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return!Object(s.default)(this._surface)||this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){Object(s.default)(e)||(e=A.default.clone(A.default.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),Object(s.default)(this._material)&&$a(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,$a(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=b.default.clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){this._undergroundColorAlphaByDistance=T.a.clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});var ti=[],ai={start:0,stop:0};Ja.prototype.pickWorldCoordinates=function(e,t,a,i){a=Object(o.default)(a,!0);var r=t.mode,l=t.mapProjection,u=ti;u.length=0;var d,c,f,h=this._surface._tilesToRender,m=h.length;for(c=0;c<m;++c){var p=(d=h[c]).data;if(Object(s.default)(p)){var _=p.pickBoundingSphere;if(r!==V.a.SCENE3D)p.pickBoundingSphere=_=v.default.fromRectangleWithHeights2D(d.rectangle,l,p.tileBoundingRegion.minimumHeight,p.tileBoundingRegion.maximumHeight,_),n.default.fromElements(_.center.z,_.center.x,_.center.y,_.center);else{if(!Object(s.default)(p.renderedMesh))continue;v.default.clone(p.renderedMesh.boundingSphere3D,_)}var g=x.default.raySphere(e,_,ai);Object(s.default)(g)&&u.push(d)}}for(u.sort(ei(e.origin)),m=u.length,c=0;c<m&&(f=u[c].data.pick(e,t.mode,t.mapProjection,!0,i),!Object(s.default)(f));++c);return f},Ja.prototype.pickTriangle=function(e,t,a,i){a=Object(o.default)(a,!0);var r=t.mode,l=t.mapProjection,u=ti;u.length=0;var d,c,f,h=this._surface._tilesToRender,m=h.length;for(c=0;c<m;++c){var p=(d=h[c]).data;if(Object(s.default)(p)){var _=p.pickBoundingSphere;r!==V.a.SCENE3D?(v.default.fromRectangleWithHeights2D(d.rectangle,l,p.minimumHeight,p.maximumHeight,_),n.default.fromElements(_.center.z,_.center.x,_.center.y,_.center)):v.default.clone(p.boundingSphere3D,_);var g=x.default.raySphere(e,_,ai);Object(s.default)(g)&&u.push(d)}}for(u.sort(ei(e.origin)),m=u.length,c=0;c<m;++c)if(f=u[c].data.pickTriangle(e,t.mode,t.mapProjection,a,i),Object(s.default)(f)){f.tile=u[c];break}return f};var ii=new y.default;Ja.prototype.pick=function(e,t,a){if(a=this.pickWorldCoordinates(e,t,!0,a),Object(s.default)(a)&&t.mode!==V.a.SCENE3D){a=n.default.fromElements(a.y,a.z,a.x,a);var i=t.mapProjection.unproject(a,ii);a=t.globe.ellipsoid.cartographicToCartesian(i,a)}return a};var ni=new n.default,ri=new n.default,oi=new y.default,si=new E.default;function li(e,t){return Object(s.default)(e)&&A.default.contains(e.rectangle,t)?e:void 0}Ja.prototype.getHeight=function(e){var t=this._surface._levelZeroTiles;if(Object(s.default)(t)){var a,i,r=t.length;for(i=0;i<r&&(a=t[i],!A.default.contains(a.rectangle,e));++i);if(!(i>=r)){for(var l=a;Object(s.default)(a);)a=li(a._southwestChild,e)||li(a._southeastChild,e)||li(a._northwestChild,e)||a._northeastChild,Object(s.default)(a)&&Object(s.default)(a.data)&&Object(s.default)(a.data.renderedMesh)&&(l=a);if(a=l,Object(s.default)(a)&&Object(s.default)(a.data)&&Object(s.default)(a.data.renderedMesh)){var u=this._surface._tileProvider.tilingScheme.ellipsoid,d=n.default.fromRadians(e.longitude,e.latitude,0,u,ni),c=si,f=u.geodeticSurfaceNormal(d,c.direction),h=u.getSurfaceNormalIntersectionWithZAxis(d,11500,c.origin);if(!Object(s.default)(h)){var m;Object(s.default)(a.data.tileBoundingRegion)&&(m=a.data.tileBoundingRegion.minimumHeight);var p=Math.min(Object(o.default)(m,0),-11500),_=n.default.multiplyByScalar(f,Math.abs(p)+1,ri);n.default.subtract(d,_,c.origin)}var g=a.data.pick(c,void 0,void 0,!1,ri);if(Object(s.default)(g))return u.cartesianToCartographic(g,oi).height}}}},Ja.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)},Ja.prototype.beginFrame=function(e){var t=this._surface,a=t.tileProvider,i=this.terrainProvider,n=this.showWaterEffect&&i.ready&&i.hasWaterMask;if(n&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;var r=this._oceanNormalMapResource,o=r.url;if(Object(s.default)(o)){var l=this;Object(R.default)(r.fetchImage(),(function(t){o===l._oceanNormalMapResource.url&&(l._oceanNormalMap=l._oceanNormalMap&&l._oceanNormalMap.destroy(),l._oceanNormalMap=new D.a({context:e.context,source:t}))}))}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}var u=e.passes,d=e.mode;u.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,a.terrainProvider=this.terrainProvider,a.lightingFadeOutDistance=this.lightingFadeOutDistance,a.lightingFadeInDistance=this.lightingFadeInDistance,a.nightFadeOutDistance=this.nightFadeOutDistance,a.nightFadeInDistance=this.nightFadeInDistance,a.zoomedOutOceanSpecularIntensity=d===V.a.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,a.hasWaterMask=n,a.oceanNormalMap=this._oceanNormalMap,a.enableLighting=this.enableLighting,a.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,a.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,a.showGroundAtmosphere=this.showGroundAtmosphere,a.shadows=this.shadows,a.splitDirection=this.splitDirection,a.hueShift=this.atmosphereHueShift,a.saturationShift=this.atmosphereSaturationShift,a.brightnessShift=this.atmosphereBrightnessShift,a.fillHighlightColor=this.fillHighlightColor,a.showSkirts=this.showSkirts,a.backFaceCulling=this.backFaceCulling,a.undergroundColor=this._undergroundColor,a.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,t.beginFrame(e))},Ja.prototype.render=function(e){this.show&&(Object(s.default)(this._material)&&this._material.update(e.context),this._surface.render(e))},Ja.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)},Ja.prototype.isDestroyed=function(){return!1},Ja.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),Object(l.default)(this)};var ui=Ja;var di=function(e,t,a,i){this.rightAscension=e,this.declination=t,this.rotation=a,this.rotationRate=i},ci=a(42),fi=a(198),hi={},mi=-.0529921,pi=-.1059842,_i=13.0120009,gi=13.3407154,vi=26.4057084,yi=13.064993,bi=1.7484877,wi=new ci.default;hi.ComputeMoon=function(e,t){Object(s.default)(e)||(e=ci.default.now()),wi=ci.default.addSeconds(e,32.184,wi);var a=ci.default.totalDays(wi)-2451545,i=a/fi.a.DAYS_PER_JULIAN_CENTURY,n=(125.045+mi*a)*J.default.RADIANS_PER_DEGREE,r=(250.089+pi*a)*J.default.RADIANS_PER_DEGREE,o=(260.008+_i*a)*J.default.RADIANS_PER_DEGREE,l=(176.625+gi*a)*J.default.RADIANS_PER_DEGREE,u=(357.529+.9856003*a)*J.default.RADIANS_PER_DEGREE,d=(311.589+vi*a)*J.default.RADIANS_PER_DEGREE,c=(134.963+yi*a)*J.default.RADIANS_PER_DEGREE,f=(276.617+.3287146*a)*J.default.RADIANS_PER_DEGREE,h=(34.226+bi*a)*J.default.RADIANS_PER_DEGREE,m=(15.134+-.1589763*a)*J.default.RADIANS_PER_DEGREE,p=(119.743+.0036096*a)*J.default.RADIANS_PER_DEGREE,_=(239.961+.1643573*a)*J.default.RADIANS_PER_DEGREE,g=(25.053+12.9590088*a)*J.default.RADIANS_PER_DEGREE,v=Math.sin(n),y=Math.sin(r),b=Math.sin(o),w=Math.sin(l),C=Math.sin(u),O=Math.sin(d),x=Math.sin(c),T=Math.sin(f),E=Math.sin(h),A=Math.sin(m),P=Math.sin(p),S=Math.sin(_),D=Math.sin(g),F=Math.cos(n),M=Math.cos(r),I=Math.cos(o),R=Math.cos(l),N=Math.cos(u),L=Math.cos(d),j=Math.cos(c),V=Math.cos(f),U=Math.cos(h),B=Math.cos(m),z=Math.cos(p),H=Math.cos(_),k=Math.cos(g),G=(269.9949+.0031*i-3.8787*v-.1204*y+.07*b-.0172*w+.0072*O-.0052*A+.0043*D)*J.default.RADIANS_PER_DEGREE,W=(66.5392+.013*i+1.5419*F+.0239*M-.0278*I+.0068*R-.0029*L+9e-4*j+8e-4*B-9e-4*k)*J.default.RADIANS_PER_DEGREE,Y=(38.3213+13.17635815*a-14e-13*a*a+3.561*v+.1208*y-.0642*b+.0158*w+.0252*C-.0066*O-.0047*x-.0046*T+.0028*E+.0052*A+.004*P+.0019*S-.0044*D)*J.default.RADIANS_PER_DEGREE,X=(13.17635815-2*a*14e-13+3.561*F*mi+.1208*M*pi-.0642*I*_i+.0158*R*gi+.0252*N*.9856003-.0066*L*vi-.0047*j*yi-.0046*V*.3287146+.0028*U*bi+.0052*B*-.1589763+.004*z*.0036096+.0019*H*.1643573-.0044*k*12.9590088)/86400*J.default.RADIANS_PER_DEGREE;return Object(s.default)(t)||(t=new di),t.rightAscension=G,t.declination=W,t.rotation=Y,t.rotationRate=X,t};var Ci=hi,Oi=a(43),xi=a(56);function Ti(e){Object(s.default)(e)&&"function"==typeof e||(e=Ci.ComputeMoon),this._computeFunction=e}var Ei=new n.default,Ai=new n.default,Pi=new n.default;var Si=new Oi.default,Di=new xi.default;Ti.prototype.evaluate=function(e,t){Object(s.default)(e)||(e=ci.default.now());var a=this._computeFunction(e),i=function(e,t,a){var i=Ei;i.x=Math.cos(e+J.default.PI_OVER_TWO),i.y=Math.sin(e+J.default.PI_OVER_TWO),i.z=0;var r=Math.cos(t),o=Pi;o.x=r*Math.cos(e),o.y=r*Math.sin(e),o.z=Math.sin(t);var l=n.default.cross(o,i,Ai);return Object(s.default)(a)||(a=new Oi.default),a[0]=i.x,a[1]=l.x,a[2]=o.x,a[3]=i.y,a[4]=l.y,a[5]=o.y,a[6]=i.z,a[7]=l.z,a[8]=o.z,a}(a.rightAscension,a.declination,t),r=J.default.zeroToTwoPi(a.rotation),o=xi.default.fromAxisAngle(n.default.UNIT_Z,r,Di),l=Oi.default.fromQuaternion(xi.default.conjugate(o,o),Si);return Oi.default.multiply(l,i,i)};var Fi=Ti,Mi=a(299),Ii={};var Ri=32.184,Ni=2451545;function Li(e,t){t=ci.default.addSeconds(e,Ri,t);var a,i=ci.default.totalDays(t)-Ni;return t=ci.default.addSeconds(t,(a=6.239996+.0172019696544*i,.001657*Math.sin(a+.01671*Math.sin(a))),t)}var ji=new ci.default(2451545,0,Mi.a.TAI),Vi=1e3,Ui=J.default.RADIANS_PER_DEGREE,Bi=J.default.RADIANS_PER_ARCSECOND,zi=new Oi.default;function Hi(e,t,a,i,r,o,l){a<0&&(a=-a,r+=J.default.PI);var u=e*(1-t),d=i-r,c=r,f=function(e,t){return function(e,t){var a=Math.floor(e/J.default.TWO_PI);e-=a*J.default.TWO_PI;var i=Math.cos(e)-t,n=Math.sin(e)*Math.sqrt(1-t*t),r=Math.atan2(n,i);r=J.default.zeroToTwoPi(r),e<0&&(r-=J.default.TWO_PI);return r+=a*J.default.TWO_PI}(function(e,t){var a,i=Math.floor(e/J.default.TWO_PI),n=(e-=i*J.default.TWO_PI)+t*Math.sin(e)/(1-Math.sin(e+t)+Math.sin(e)),r=Number.MAX_VALUE;for(a=0;a<ki&&Math.abs(r-n)>Gi;++a){var o=(r=n)-t*Math.sin(r)-e,s=1-t*Math.cos(r);n=r-o/s}return r=n+i*J.default.TWO_PI}(e,t),t)}(o-i,t);!function(e,t){if(e<=t)return"Circular";if(e<1-t)return"Elliptical";if(e<=1+t)return"Parabolic"}(t,0);!function(e,t,a,i){var n=Math.cos(e),r=Math.sin(e),o=Math.cos(t),l=Math.sin(t),u=Math.cos(a),d=Math.sin(a);Object(s.default)(i)?(i[0]=u*n-d*r*o,i[1]=d*n+u*r*o,i[2]=r*l,i[3]=-u*r-d*n*o,i[4]=-d*r+u*n*o,i[5]=n*l,i[6]=d*l,i[7]=-u*l,i[8]=o):i=new Oi.default(u*n-d*r*o,-u*r-d*n*o,d*l,d*n+u*r*o,-d*r+u*n*o,-u*l,r*l,n*l,o)}(d,a,c,zi);var h=u*(1+t),m=Math.cos(f),p=Math.sin(f),_=h/(1+t*m);return Object(s.default)(l)?(l.x=_*m,l.y=_*p,l.z=0):l=new n.default(_*m,_*p,0),Oi.default.multiplyByVector(zi,l,l)}var ki=50,Gi=J.default.EPSILON8;var Wi=149598022260.7121,Yi=100.46645683*Ui,Xi=1295977422.83429*Bi,Qi=16002,qi=21863,Zi=32004,Ki=10931,Ji=14529,$i=16368,en=15318,tn=32794,an=64e-7*14959787e4,nn=-2273887.624,rn=927506.794,on=14959787e4*-8e-7,sn=32e-7*14959787e4,ln=-613351.267,un=284235.953,dn=-164557.657,cn=-2243968.05,fn=-688150.202,hn=1017265.516,mn=807828.498,pn=14e-7*14959787e4,_n=359034.888,gn=14959787e4*-28e-7,vn=329115.314,yn=10,bn=16002,wn=21863,Cn=10931,On=1473,xn=32004,Tn=4387,En=73,An=-325e-7,Pn=-322e-7,Sn=1e-7*-79,Dn=232*1e-7,Fn=1e-7*-52,Mn=97e-7,In=55e-7,Rn=-41e-7,Nn=-105e-7,Ln=-137e-7,jn=258e-7,Vn=35e-7,Un=1e-7*-116,Bn=-88e-7,zn=-112e-7,Hn=-8e-6,kn=new ci.default(0,0,Mi.a.TAI);function Gn(e,t){Li(e,kn);var a=(kn.dayNumber-ji.dayNumber+(kn.secondsOfDay-ji.secondsOfDay)/fi.a.SECONDS_PER_DAY)/fi.a.DAYS_PER_JULIAN_CENTURY,i=a*a,n=i*a,r=n*a,o=383397.7725+.004*a,s=.055545526-16e-9*a,l=5.15668983*Ui,u=-8e-5*a+.02966*i-42e-6*n-13e-8*r,d=83.35324312*Ui,c=14643420.2669*a-38.2702*i-.045047*n+21301e-8*r,f=125.04455501*Ui,h=-6967919.3631*a+6.3602*i+.007625*n-3586e-8*r,m=218.31664563*Ui,p=1732559343.4847*a-6.391*i+.006588*n-3169e-8*r,_=297.85019547*Ui+Bi*(1602961601.209*a-6.3706*i+.006593*n-3169e-8*r),g=134.96340251*Ui+Bi*(1717915923.2178*a+31.8792*i+.051635*n-2447e-7*r),v=357.52910918*Ui+Bi*(129596581.0481*a-.5532*i+136e-6*n-1149e-8*r),y=310.17137918*Ui-Bi*(6967051.436*a+6.2068*i+.007618*n-3219e-8*r),b=2*_,w=4*_,C=6*_,O=2*g,x=3*g,T=4*g,E=2*(93.27209062*Ui+Bi*(1739527262.8478*a-12.7512*i-.001037*n+417e-8*r));o+=3400.4*Math.cos(b)-635.6*Math.cos(b-g)-235.6*Math.cos(g)+218.1*Math.cos(b-v)+181*Math.cos(b+g),s+=.014216*Math.cos(b-g)+.008551*Math.cos(b-O)-.001383*Math.cos(g)+.001356*Math.cos(b+g)-.001147*Math.cos(w-x)-914e-6*Math.cos(w-O)+869e-6*Math.cos(b-v-g)-627e-6*Math.cos(b)-394e-6*Math.cos(w-T)+282e-6*Math.cos(b-v-O)-279e-6*Math.cos(_-g)-236e-6*Math.cos(O)+231e-6*Math.cos(w)+229e-6*Math.cos(C-T)-201e-6*Math.cos(O-E),u+=486.26*Math.cos(b-E)-40.13*Math.cos(b)+37.51*Math.cos(E)+25.73*Math.cos(O-E)+19.97*Math.cos(b-v-E),c+=-55609*Math.sin(b-g)-34711*Math.sin(b-O)-9792*Math.sin(g)+9385*Math.sin(w-x)+7505*Math.sin(w-O)+5318*Math.sin(b+g)+3484*Math.sin(w-T)-3417*Math.sin(b-v-g)-2530*Math.sin(C-T)-2376*Math.sin(b)-2075*Math.sin(b-x)-1883*Math.sin(O)-1736*Math.sin(C-5*g)+1626*Math.sin(v)-1370*Math.sin(C-x),h+=-5392*Math.sin(b-E)-540*Math.sin(v)-441*Math.sin(b)+423*Math.sin(E)-288*Math.sin(O-E),p+=-3332.9*Math.sin(b)+1197.4*Math.sin(b-g)-662.5*Math.sin(v)+396.3*Math.sin(g)-218*Math.sin(b-v);var A=2*y,P=3*y;u+=46.997*Math.cos(y)*a-.614*Math.cos(b-E+y)*a+.614*Math.cos(b-E-y)*a-.0297*Math.cos(A)*i-.0335*Math.cos(y)*i+.0012*Math.cos(b-E+A)*i-16e-5*Math.cos(y)*n+4e-5*Math.cos(P)*n+4e-5*Math.cos(A)*n;var S=2.116*Math.sin(y)*a-.111*Math.sin(b-E-y)*a-.0015*Math.sin(y)*i;return c+=S,p+=S,h+=-520.77*Math.sin(y)*a+13.66*Math.sin(b-E+y)*a+1.12*Math.sin(b-y)*a-1.06*Math.sin(E-y)*a+.66*Math.sin(A)*i+.371*Math.sin(y)*i-.035*Math.sin(b-E+A)*i-.015*Math.sin(b-E+y)*i+.0014*Math.sin(y)*n-.0011*Math.sin(P)*n-9e-4*Math.sin(A)*n,Hi(o*=Vi,s,l+u*Bi,d+c*Bi,f+h*Bi,m+p*Bi,t)}var Wn=-.01215058143522694;var Yn=new Oi.default(1.0000000000000002,5619723173785822e-31,4690511510146299e-34,-5154129427414611e-31,.9174820620691819,-.39777715593191376,-223970096136568e-30,.39777715593191376,.9174820620691819),Xn=new n.default;Ii.computeSunPositionInEarthInertialFrame=function(e,t){return Object(s.default)(e)||(e=ci.default.now()),Object(s.default)(t)||(t=new n.default),Xn=function(e,t){Li(e,kn);var a=(kn.dayNumber-ji.dayNumber+(kn.secondsOfDay-ji.secondsOfDay)/fi.a.SECONDS_PER_DAY)/(10*fi.a.DAYS_PER_JULIAN_CENTURY),i=.3595362*a,n=Wi+an*Math.cos(Qi*i)+cn*Math.sin(Qi*i)+nn*Math.cos(qi*i)+fn*Math.sin(qi*i)+rn*Math.cos(Zi*i)+hn*Math.sin(Zi*i)+on*Math.cos(Ki*i)+mn*Math.sin(Ki*i)+sn*Math.cos(Ji*i)+pn*Math.sin(Ji*i)+ln*Math.cos($i*i)+_n*Math.sin($i*i)+un*Math.cos(en*i)+gn*Math.sin(en*i)+dn*Math.cos(tn*i)+vn*Math.sin(tn*i),r=Yi+Xi*a+An*Math.cos(yn*i)+Nn*Math.sin(yn*i)+Pn*Math.cos(bn*i)+Ln*Math.sin(bn*i)+Sn*Math.cos(wn*i)+jn*Math.sin(wn*i)+Dn*Math.cos(Cn*i)+Vn*Math.sin(Cn*i)+Fn*Math.cos(On*i)+Un*Math.sin(On*i)+Mn*Math.cos(xn*i)+Bn*Math.sin(xn*i)+In*Math.cos(Tn*i)+zn*Math.sin(Tn*i)+Rn*Math.cos(En*i)+Hn*Math.sin(En*i);return Hi(n,.0167086342-.0004203654*a,469.97289*Bi*a,102.93734808*Ui+11612.3529*Bi*a,174.87317577*Ui-8679.27034*Bi*a,r,t)}(e,Xn),t=n.default.negate(Xn,t),function(e,t){t=Gn(e,t),n.default.multiplyByScalar(t,Wn,t)}(e,Xn),n.default.subtract(t,Xn,t),Oi.default.multiplyByVector(Yn,t,t),t},Ii.computeMoonPositionInEarthInertialFrame=function(e,t){return Object(s.default)(e)||(e=ci.default.now()),t=Gn(e,t),Oi.default.multiplyByVector(Yn,t,t),t};var Qn=Ii,qn=a(62),Zn=a(368),Kn=a(78),Jn="#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#endif\n\nuniform vec3 u_radii;\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\n\nvarying vec3 v_positionEC;\n\nvec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)\n{\n    vec3 positionEC = czm_pointAlongRay(ray, intersection);\n    vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\n    vec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\n    vec3 sphericalNormal = normalize(positionMC / u_radii);\n    vec3 normalMC = geodeticNormal * side;              // normalized surface normal (always facing the viewer) in model coordinates\n    vec3 normalEC = normalize(czm_normal * normalMC);   // normalized surface normal in eye coordiantes\n\n    vec2 st = czm_ellipsoidWgs84TextureCoordinates(sphericalNormal);\n    vec3 positionToEyeEC = -positionEC;\n\n    czm_materialInput materialInput;\n    materialInput.s = st.s;\n    materialInput.st = st;\n    materialInput.str = (positionMC + u_radii) / u_radii;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef ONLY_SUN_LIGHTING\n    return czm_private_phong(normalize(positionToEyeEC), material, czm_sunDirectionEC);\n#else\n    return czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n\nvoid main()\n{\n    // PERFORMANCE_TODO: When dynamic branching is available, compute ratio of maximum and minimum radii\n    // in the vertex shader. Only when it is larger than some constant, march along the ray.\n    // Otherwise perform one intersection test which will be the common case.\n\n    // Test if the ray intersects a sphere with the ellipsoid's maximum radius.\n    // For very oblate ellipsoids, using the ellipsoid's radii for an intersection test\n    // may cause false negatives. This will discard fragments before marching the ray forward.\n    float maxRadius = max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5;\n    vec3 direction = normalize(v_positionEC);\n    vec3 ellipsoidCenter = czm_modelView[3].xyz;\n\n    float t1 = -1.0;\n    float t2 = -1.0;\n\n    float b = -2.0 * dot(direction, ellipsoidCenter);\n    float c = dot(ellipsoidCenter, ellipsoidCenter) - maxRadius * maxRadius;\n\n    float discriminant = b * b - 4.0 * c;\n    if (discriminant >= 0.0) {\n        t1 = (-b - sqrt(discriminant)) * 0.5;\n        t2 = (-b + sqrt(discriminant)) * 0.5;\n    }\n\n    if (t1 < 0.0 && t2 < 0.0) {\n        discard;\n    }\n\n    float t = min(t1, t2);\n    if (t < 0.0) {\n        t = 0.0;\n    }\n\n    // March ray forward to intersection with larger sphere and find\n    czm_ray ray = czm_ray(t * direction, direction);\n\n    vec3 ellipsoid_inverseRadii = vec3(1.0 / u_radii.x, 1.0 / u_radii.y, 1.0 / u_radii.z);\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoidCenter, ellipsoid_inverseRadii);\n\n    if (czm_isEmpty(intersection))\n    {\n        discard;\n    }\n\n    // If the viewer is outside, compute outsideFaceColor, with normals facing outward.\n    vec4 outsideFaceColor = (intersection.start != 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);\n\n    // If the viewer either is inside or can see inside, compute insideFaceColor, with normals facing inward.\n    vec4 insideFaceColor = (outsideFaceColor.a < 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);\n\n    gl_FragColor = mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);\n    gl_FragColor.a = 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);\n\n#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n    t = (intersection.start != 0.0) ? intersection.start : intersection.stop;\n    vec3 positionEC = czm_pointAlongRay(ray, t);\n    vec4 positionCC = czm_projection * vec4(positionEC, 1.0);\n#ifdef LOG_DEPTH\n    czm_writeLogDepth(1.0 + positionCC.w);\n#else\n    float z = positionCC.z / positionCC.w;\n\n    float n = czm_depthRange.near;\n    float f = czm_depthRange.far;\n\n    gl_FragDepthEXT = (z * (f - n) + f + n) * 0.5;\n#endif\n#endif\n#endif\n}\n",$n="attribute vec3 position;\n\nuniform vec3 u_radii;\n\nvarying vec3 v_positionEC;\n\nvoid main()\n{\n    // In the vertex data, the cube goes from (-1.0, -1.0, -1.0) to (1.0, 1.0, 1.0) in model coordinates.\n    // Scale to consider the radii.  We could also do this once on the CPU when using the BoxGeometry,\n    // but doing it here allows us to change the radii without rewriting the vertex data, and\n    // allows all ellipsoids to reuse the same vertex data.\n    vec4 p = vec4(u_radii * position, 1.0);\n\n    v_positionEC = (czm_modelView * p).xyz;     // position in eye coordinates\n    gl_Position = czm_modelViewProjection * p;  // position in clip coordinates\n\n    // With multi-frustum, when the ellipsoid primitive is positioned on the intersection of two frustums\n    // and close to terrain, the terrain (writes depth) in the closest frustum can overwrite part of the\n    // ellipsoid (does not write depth) that was rendered in the farther frustum.\n    //\n    // Here, we clamp the depth in the vertex shader to avoid being overwritten; however, this creates\n    // artifacts since some fragments can be alpha blended twice.  This is solved by only rendering\n    // the ellipsoid in the closest frustum to the viewer.\n    gl_Position.z = clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far);\n\n    czm_vertexLogDepth();\n}\n",er=a(184),tr=a(215),ar={position:0};function ir(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this.center=n.default.clone(Object(o.default)(e.center,n.default.ZERO)),this._center=new n.default,this.radii=n.default.clone(e.radii),this._radii=new n.default,this._oneOverEllipsoidRadiiSquared=new n.default,this._boundingSphere=new v.default,this.modelMatrix=$.default.clone(Object(o.default)(e.modelMatrix,$.default.IDENTITY)),this._modelMatrix=new $.default,this._computedModelMatrix=new $.default,this.show=Object(o.default)(e.show,!0),this.material=Object(o.default)(e.material,tr.a.fromType(tr.a.ColorType)),this._material=void 0,this._translucent=void 0,this.id=e.id,this._id=void 0,this.debugShowBoundingVolume=Object(o.default)(e.debugShowBoundingVolume,!1),this.onlySunLighting=Object(o.default)(e.onlySunLighting,!1),this._onlySunLighting=!1,this._depthTestEnabled=Object(o.default)(e.depthTestEnabled,!0),this._useLogDepth=!1,this._sp=void 0,this._rs=void 0,this._va=void 0,this._pickSP=void 0,this._pickId=void 0,this._colorCommand=new ue.a({owner:Object(o.default)(e._owner,this)}),this._pickCommand=new ue.a({owner:Object(o.default)(e._owner,this),pickOnly:!0});var t=this;this._uniforms={u_radii:function(){return t.radii},u_oneOverEllipsoidRadiiSquared:function(){return t._oneOverEllipsoidRadiiSquared}},this._pickUniforms={czm_pickColor:function(){return t._pickId.color}}}var nr="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n";ir.prototype.update=function(e){if(this.show&&e.mode===V.a.SCENE3D&&Object(s.default)(this.center)&&Object(s.default)(this.radii)){var t=e.context,a=this.material.isTranslucent(),i=this._translucent!==a;Object(s.default)(this._rs)&&!i||(this._translucent=a,this._rs=ce.a.fromCache({cull:{enabled:!0,face:er.a.FRONT},depthTest:{enabled:this._depthTestEnabled},depthMask:!a&&t.fragmentDepth,blending:a?he.a.ALPHA_BLEND:void 0})),Object(s.default)(this._va)||(this._va=function(e){var t=e.cache.ellipsoidPrimitive_vertexArray;if(Object(s.default)(t))return t;var a=Zn.a.createGeometry(Zn.a.fromDimensions({dimensions:new n.default(2,2,2),vertexFormat:Kn.default.POSITION_ONLY}));return t=fe.a.fromGeometry({context:e,geometry:a,attributeLocations:ar,bufferUsage:se.a.STATIC_DRAW,interleave:!0}),e.cache.ellipsoidPrimitive_vertexArray=t,t}(t));var r=!1,o=this.radii;if(!n.default.equals(this._radii,o)){n.default.clone(o,this._radii);var l=this._oneOverEllipsoidRadiiSquared;l.x=1/(o.x*o.x),l.y=1/(o.y*o.y),l.z=1/(o.z*o.z),r=!0}$.default.equals(this.modelMatrix,this._modelMatrix)&&n.default.equals(this.center,this._center)||($.default.clone(this.modelMatrix,this._modelMatrix),n.default.clone(this.center,this._center),$.default.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix),r=!0),r&&(n.default.clone(n.default.ZERO,this._boundingSphere.center),this._boundingSphere.radius=n.default.maximumComponent(o),v.default.transform(this._boundingSphere,this._computedModelMatrix,this._boundingSphere));var u=this._material!==this.material;this._material=this.material,this._material.update(t);var d=this.onlySunLighting!==this._onlySunLighting;this._onlySunLighting=this.onlySunLighting;var c=e.useLogDepth,f=this._useLogDepth!==c;this._useLogDepth=c;var h,m,p=this._colorCommand;(u||d||i||f)&&(h=new S.a({sources:[$n]}),m=new S.a({sources:[this.material.shaderSource,Jn]}),this.onlySunLighting&&m.defines.push("ONLY_SUN_LIGHTING"),!a&&t.fragmentDepth&&m.defines.push("WRITE_DEPTH"),this._useLogDepth&&(h.defines.push("LOG_DEPTH"),m.defines.push("LOG_DEPTH"),m.sources.push(nr)),this._sp=L.a.replaceCache({context:t,shaderProgram:this._sp,vertexShaderSource:h,fragmentShaderSource:m,attributeLocations:ar}),p.vertexArray=this._va,p.renderState=this._rs,p.shaderProgram=this._sp,p.uniformMap=Object(X.default)(this._uniforms,this.material._uniforms),p.executeInClosestFrustum=a);var _=e.commandList,g=e.passes;if(g.render&&(p.boundingVolume=this._boundingSphere,p.debugShowBoundingVolume=this.debugShowBoundingVolume,p.modelMatrix=this._computedModelMatrix,p.pass=a?de.a.TRANSLUCENT:de.a.OPAQUE,_.push(p)),g.pick){var y=this._pickCommand;Object(s.default)(this._pickId)&&this._id===this.id||(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=t.createPickId({primitive:this,id:this.id})),(u||d||!Object(s.default)(this._pickSP)||f)&&(h=new S.a({sources:[$n]}),m=new S.a({sources:[this.material.shaderSource,Jn],pickColorQualifier:"uniform"}),this.onlySunLighting&&m.defines.push("ONLY_SUN_LIGHTING"),!a&&t.fragmentDepth&&m.defines.push("WRITE_DEPTH"),this._useLogDepth&&(h.defines.push("LOG_DEPTH"),m.defines.push("LOG_DEPTH"),m.sources.push(nr)),this._pickSP=L.a.replaceCache({context:t,shaderProgram:this._pickSP,vertexShaderSource:h,fragmentShaderSource:m,attributeLocations:ar}),y.vertexArray=this._va,y.renderState=this._rs,y.shaderProgram=this._pickSP,y.uniformMap=Object(X.default)(Object(X.default)(this._uniforms,this._pickUniforms),this.material._uniforms),y.executeInClosestFrustum=a),y.boundingVolume=this._boundingSphere,y.modelMatrix=this._computedModelMatrix,y.pass=a?de.a.TRANSLUCENT:de.a.OPAQUE,_.push(y)}}},ir.prototype.isDestroyed=function(){return!1},ir.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._pickSP=this._pickSP&&this._pickSP.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),Object(l.default)(this)};var rr=ir;function or(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).textureUrl;Object(s.default)(t)||(t=a(1624)),this.show=Object(o.default)(e.show,!0),this.textureUrl=t,this._ellipsoid=Object(o.default)(e.ellipsoid,d.default.MOON),this.onlySunLighting=Object(o.default)(e.onlySunLighting,!0),this._ellipsoidPrimitive=new rr({radii:this.ellipsoid.radii,material:tr.a.fromType(tr.a.ImageType),depthTestEnabled:!1,_owner:this}),this._ellipsoidPrimitive.material.translucent=!1,this._axes=new Fi}Object.defineProperties(or.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var sr=new Oi.default,lr=new Oi.default,ur=new n.default,dr=[];or.prototype.update=function(e){if(this.show){var t=this._ellipsoidPrimitive;t.material.uniforms.image=this.textureUrl,t.onlySunLighting=this.onlySunLighting;var a=e.time;Object(s.default)(qn.default.computeIcrfToFixedMatrix(a,sr))||qn.default.computeTemeToPseudoFixedMatrix(a,sr);var i=this._axes.evaluate(a,lr);Oi.default.transpose(i,i),Oi.default.multiply(sr,i,i);var n=Qn.computeMoonPositionInEarthInertialFrame(a,ur);Oi.default.multiplyByVector(sr,n,n),$.default.fromRotationTranslation(i,n,t.modelMatrix);var r=e.commandList;return e.commandList=dr,dr.length=0,t.update(e),e.commandList=r,1===dr.length?dr[0]:void 0}},or.prototype.isDestroyed=function(){return!1},or.prototype.destroy=function(){return this._ellipsoidPrimitive=this._ellipsoidPrimitive&&this._ellipsoidPrimitive.destroy(),Object(l.default)(this)};var cr=or,fr=a(58),hr=a(74),mr=a(231),pr=a(512),_r=a(105),gr=[],vr=[];function yr(e,t,a,i,n){if(!(i>=n)){var r=Math.floor(.5*(i+n));yr(e,t,a,i,r),yr(e,t,a,r+1,n),function(e,t,a,i,n,r){var o,s,l=n-i+1,u=r-n,d=gr,c=vr;for(o=0;o<l;++o)d[o]=e[i+o];for(s=0;s<u;++s)c[s]=e[n+s+1];o=0,s=0;for(var f=i;f<=r;++f){var h=d[o],m=c[s];o<l&&(s>=u||t(h,m,a)<=0)?(e[f]=h,++o):s<u&&(e[f]=m,++s)}}(e,t,a,i,r,n)}}var br=function(e,t,a){var i=e.length,n=Math.ceil(.5*i);gr.length=n,vr.length=n,yr(e,t,a,0,i-1),gr.length=0,vr.length=0};function wr(e,t){this._occluderPosition=n.default.clone(e.center),this._occluderRadius=e.radius,this._horizonDistance=0,this._horizonPlaneNormal=void 0,this._horizonPlanePosition=void 0,this._cameraPosition=void 0,this.cameraPosition=t}var Cr=new n.default;Object.defineProperties(wr.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(e){e=n.default.clone(e,this._cameraPosition);var t,a,i,r=n.default.subtract(this._occluderPosition,e,Cr),o=n.default.magnitudeSquared(r),s=this._occluderRadius*this._occluderRadius;if(o>s){t=Math.sqrt(o-s),o=1/Math.sqrt(o),a=n.default.multiplyByScalar(r,o,Cr);var l=t*t*o;i=n.default.add(e,n.default.multiplyByScalar(a,l,Cr),Cr)}else t=Number.MAX_VALUE;this._horizonDistance=t,this._horizonPlaneNormal=a,this._horizonPlanePosition=i,this._cameraPosition=e}}}),wr.fromBoundingSphere=function(e,t,a){return Object(s.default)(a)?(n.default.clone(e.center,a._occluderPosition),a._occluderRadius=e.radius,a.cameraPosition=t,a):new wr(e,t)};var Or=new n.default;wr.prototype.isPointVisible=function(e){if(this._horizonDistance!==Number.MAX_VALUE){var t=n.default.subtract(e,this._occluderPosition,Or),a=this._occluderRadius;if((a=n.default.magnitudeSquared(t)-a*a)>0)return a=Math.sqrt(a)+this._horizonDistance,t=n.default.subtract(e,this._cameraPosition,t),a*a>n.default.magnitudeSquared(t)}return!1};var xr=new n.default;wr.prototype.isBoundingSphereVisible=function(e){var t=n.default.clone(e.center,xr),a=e.radius;if(this._horizonDistance!==Number.MAX_VALUE){var i=n.default.subtract(t,this._occluderPosition,Or),r=this._occluderRadius-a;if(r=n.default.magnitudeSquared(i)-r*r,a<this._occluderRadius)return r>0&&(r=Math.sqrt(r)+this._horizonDistance,i=n.default.subtract(t,this._cameraPosition,i),r*r+a*a>n.default.magnitudeSquared(i));if(r>0){i=n.default.subtract(t,this._cameraPosition,i);var o=n.default.magnitudeSquared(i),s=this._occluderRadius*this._occluderRadius,l=a*a;return(this._horizonDistance*this._horizonDistance+s)*l>o*s||(r=Math.sqrt(r)+this._horizonDistance)*r+l>o}return!0}return!1};var Tr=new n.default;wr.prototype.computeVisibility=function(e){var t=n.default.clone(e.center),a=e.radius;if(a>this._occluderRadius)return ne.FULL;if(this._horizonDistance!==Number.MAX_VALUE){var i=n.default.subtract(t,this._occluderPosition,Tr),r=this._occluderRadius-a,o=n.default.magnitudeSquared(i);if((r=o-r*r)>0){r=Math.sqrt(r)+this._horizonDistance,i=n.default.subtract(t,this._cameraPosition,i);var s=n.default.magnitudeSquared(i);return r*r+a*a<s?ne.NONE:(r=o-(r=this._occluderRadius+a)*r)>0?s<(r=Math.sqrt(r)+this._horizonDistance)*r+a*a?ne.FULL:ne.PARTIAL:(i=n.default.subtract(t,this._horizonPlanePosition,i),n.default.dot(i,this._horizonPlaneNormal)>-a?ne.PARTIAL:ne.FULL)}}return ne.NONE};var Er=new n.default;wr.computeOccludeePoint=function(e,t,a){var i=n.default.clone(t),r=n.default.clone(e.center),o=e.radius,s=a.length,l=n.default.normalize(n.default.subtract(i,r,Er),Er),u=-n.default.dot(l,r),d=wr._anyRotationVector(r,l,u),c=wr._horizonToPlaneNormalDotProduct(e,l,u,d,a[0]);if(c){for(var f,h=1;h<s;++h){if(!(f=wr._horizonToPlaneNormalDotProduct(e,l,u,d,a[h])))return;f<c&&(c=f)}if(!(c<.0017453283658983088)){var m=o/c;return n.default.add(r,n.default.multiplyByScalar(l,m,Er),Er)}}};var Ar=[];wr.computeOccludeePointFromRectangle=function(e,t){t=Object(o.default)(t,d.default.WGS84);var a=A.default.subsample(e,t,0,Ar),i=v.default.fromPoints(a),r=n.default.ZERO;if(!n.default.equals(r,i.center))return wr.computeOccludeePoint(new v.default(r,t.minimumRadius),i.center,a)};var Pr=new n.default;wr._anyRotationVector=function(e,t,a){var i=n.default.abs(t,Pr),r=i.x>i.y?0:1;(0===r&&i.z>i.x||1===r&&i.z>i.y)&&(r=2);var o,s=new n.default;0===r?(i.x=e.x,i.y=e.y+1,i.z=e.z+1,o=n.default.UNIT_X):1===r?(i.x=e.x+1,i.y=e.y,i.z=e.z+1,o=n.default.UNIT_Y):(i.x=e.x+1,i.y=e.y+1,i.z=e.z,o=n.default.UNIT_Z);var l=(n.default.dot(t,i)+a)/-n.default.dot(t,o);return n.default.normalize(n.default.subtract(n.default.add(i,n.default.multiplyByScalar(o,l,s),i),e,i),i)};var Sr=new n.default;wr._rotationVector=function(e,t,a,i,r){var o=n.default.subtract(i,e,Sr);if(o=n.default.normalize(o,o),n.default.dot(t,o)<.9999999847691291){var s=n.default.cross(t,o,o);if(n.default.magnitude(s)>J.default.EPSILON13)return n.default.normalize(s,new n.default)}return r};var Dr=new n.default,Fr=new n.default,Mr=new n.default,Ir=new n.default;wr._horizonToPlaneNormalDotProduct=function(e,t,a,i,r){var o=n.default.clone(r,Dr),s=n.default.clone(e.center,Fr),l=e.radius,u=n.default.subtract(s,o,Mr),d=n.default.magnitudeSquared(u),c=l*l;if(d<c)return!1;var f=d-c,h=Math.sqrt(f),m=h*(1/Math.sqrt(d))*h;u=n.default.normalize(u,u);var p=n.default.add(o,n.default.multiplyByScalar(u,m,Ir),Ir),_=Math.sqrt(f-m*m),g=this._rotationVector(s,t,a,o,i),v=n.default.fromElements(g.x*g.x*u.x+(g.x*g.y-g.z)*u.y+(g.x*g.z+g.y)*u.z,(g.x*g.y+g.z)*u.x+g.y*g.y*u.y+(g.y*g.z-g.x)*u.z,(g.x*g.z-g.y)*u.x+(g.y*g.z+g.x)*u.y+g.z*g.z*u.z,Dr);v=n.default.normalize(v,v);var y=n.default.multiplyByScalar(v,_,Dr);g=n.default.normalize(n.default.subtract(n.default.add(p,y,Mr),s,Mr),Mr);var b=n.default.dot(t,g);g=n.default.normalize(n.default.subtract(n.default.subtract(p,y,g),s,g),g);var w=n.default.dot(t,g);return b<w?b:w};var Rr,Nr=wr,Lr=a(174),jr=a(282),Vr=a(524),Ur=a(133),Br=a(109),zr="attribute vec4 position;\nattribute vec2 textureCoordinates;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    gl_Position = position;\n    v_textureCoordinates = textureCoordinates;\n}\n",Hr=a(99);function kr(e){this._context=e}var Gr=new ue.a({primitiveType:ae.a.TRIANGLES}),Wr=new Br.a({color:new b.default(0,0,0,0)});kr.prototype.execute=function(e){Object(s.default)(e.preExecute)&&e.preExecute(e);var t=e.outputTexture,a=t.width,i=t.height,n=this._context,r=Object(s.default)(e.vertexArray)?e.vertexArray:n.getViewportQuadVertexArray(),o=Object(s.default)(e.shaderProgram)?e.shaderProgram:function(e,t){return L.a.fromCache({context:e,vertexShaderSource:zr,fragmentShaderSource:t,attributeLocations:{position:0,textureCoordinates:1}})}(n,e.fragmentShaderSource),l=function(e,t){return new Hr.a({context:e,colorTextures:[t],destroyAttachments:!1})}(n,t),u=function(e,t){return Object(s.default)(Rr)&&Rr.viewport.width===e&&Rr.viewport.height===t||(Rr=ce.a.fromCache({viewport:new fr.default(0,0,e,t)})),Rr}(a,i),d=e.uniformMap,c=Wr;c.framebuffer=l,c.renderState=u,c.execute(n);var f=Gr;f.vertexArray=r,f.renderState=u,f.shaderProgram=o,f.uniformMap=d,f.framebuffer=l,f.execute(n),l.destroy(),e.persists||(o.destroy(),Object(s.default)(e.vertexArray)&&r.destroy()),Object(s.default)(e.postExecute)&&e.postExecute(t)},kr.prototype.isDestroyed=function(){return!1},kr.prototype.destroy=function(){return Object(l.default)(this)};var Yr=kr,Xr=a(35),Qr=a(51),qr=a(52),Zr=a(41),Kr=a(48),Jr=a(247);var $r=function(e){this.context=e,this.framebuffer=void 0,this.blendingEnabled=void 0,this.scissorTest=void 0,this.viewport=void 0};function eo(e){this._context=e,this._shaders={},this._numberOfShaders=0,this._shadersToRelease={}}function to(e,t){for(var a=t.derivedKeywords,i=a.length,n=0;n<i;++n){var r=a[n]+t.keyword;to(e,e._shaders[r])}delete e._shaders[t.keyword],t.shaderProgram.finalDestroy()}Object.defineProperties(eo.prototype,{numberOfShaders:{get:function(){return this._numberOfShaders}}}),eo.prototype.replaceShaderProgram=function(e){return Object(s.default)(e.shaderProgram)&&e.shaderProgram.destroy(),this.getShaderProgram(e)},eo.prototype.getShaderProgram=function(e){var t=e.vertexShaderSource,a=e.fragmentShaderSource,i=e.attributeLocations;"string"==typeof t&&(t=new S.a({sources:[t]})),"string"==typeof a&&(a=new S.a({sources:[a]}));var n,r=t.createCombinedVertexShader(this._context),o=a.createCombinedFragmentShader(this._context),l=r+o+JSON.stringify(i);if(Object(s.default)(this._shaders[l]))n=this._shaders[l],delete this._shadersToRelease[l];else{var u=this._context,d=new L.a({gl:u._gl,logShaderCompilation:u.logShaderCompilation,debugShaders:u.debugShaders,vertexShaderSource:t,vertexShaderText:r,fragmentShaderSource:a,fragmentShaderText:o,attributeLocations:i});n={cache:this,shaderProgram:d,keyword:l,derivedKeywords:[],count:0},d._cachedShader=n,this._shaders[l]=n,++this._numberOfShaders}return++n.count,n.shaderProgram},eo.prototype.replaceDerivedShaderProgram=function(e,t,a){var i=e._cachedShader,n=t+i.keyword,r=this._shaders[n];if(Object(s.default)(r)){to(this,r);var o=i.derivedKeywords.indexOf(t);o>-1&&i.derivedKeywords.splice(o,1)}return this.createDerivedShaderProgram(e,t,a)},eo.prototype.getDerivedShaderProgram=function(e,t){var a=t+e._cachedShader.keyword,i=this._shaders[a];if(Object(s.default)(i))return i.shaderProgram},eo.prototype.createDerivedShaderProgram=function(e,t,a){var i=e._cachedShader,n=t+i.keyword,r=a.vertexShaderSource,o=a.fragmentShaderSource,s=a.attributeLocations;"string"==typeof r&&(r=new S.a({sources:[r]})),"string"==typeof o&&(o=new S.a({sources:[o]}));var l=this._context,u=r.createCombinedVertexShader(l),d=o.createCombinedFragmentShader(l),c=new L.a({gl:l._gl,logShaderCompilation:l.logShaderCompilation,debugShaders:l.debugShaders,vertexShaderSource:r,vertexShaderText:u,fragmentShaderSource:o,fragmentShaderText:d,attributeLocations:s}),f={cache:this,shaderProgram:c,keyword:n,derivedKeywords:[],count:0};return i.derivedKeywords.push(t),c._cachedShader=f,this._shaders[n]=f,c},eo.prototype.destroyReleasedShaderPrograms=function(){var e=this._shadersToRelease;for(var t in e){if(e.hasOwnProperty(t))to(this,e[t]),--this._numberOfShaders}this._shadersToRelease={}},eo.prototype.releaseShaderProgram=function(e){if(Object(s.default)(e)){var t=e._cachedShader;t&&0==--t.count&&(this._shadersToRelease[t.keyword]=t)}},eo.prototype.isDestroyed=function(){return!1},eo.prototype.destroy=function(){var e=this._shaders;for(var t in e)e.hasOwnProperty(t)&&e[t].shaderProgram.finalDestroy();return Object(l.default)(this)};var ao=eo;function io(){this._textures={},this._numberOfTextures=0,this._texturesToRelease={}}Object.defineProperties(io.prototype,{numberOfTextures:{get:function(){return this._numberOfTextures}}}),io.prototype.getTexture=function(e){var t=this._textures[e];if(Object(s.default)(t))return delete this._texturesToRelease[e],++t.count,t.texture},io.prototype.addTexture=function(e,t){var a={texture:t,count:1};t.finalDestroy=t.destroy;var i=this;t.destroy=function(){0==--a.count&&(i._texturesToRelease[e]=a)},this._textures[e]=a,++this._numberOfTextures},io.prototype.destroyReleasedTextures=function(){var e=this._texturesToRelease;for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];delete this._textures[t],a.texture.finalDestroy(),--this._numberOfTextures}this._texturesToRelease={}},io.prototype.isDestroyed=function(){return!1},io.prototype.destroy=function(){var e=this._textures;for(var t in e)e.hasOwnProperty(t)&&e[t].texture.finalDestroy();return Object(l.default)(this)};var no=io,ro=a(182);var oo=function(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this.color=b.default.clone(Object(o.default)(e.color,b.default.WHITE)),this.intensity=Object(o.default)(e.intensity,2)};function so(){this.globeDepthTexture=void 0,this.gamma=void 0,this._viewport=new fr.default,this._viewportCartesian4=new G.a,this._viewportDirty=!1,this._viewportOrthographicMatrix=$.default.clone($.default.IDENTITY),this._viewportTransformation=$.default.clone($.default.IDENTITY),this._model=$.default.clone($.default.IDENTITY),this._view=$.default.clone($.default.IDENTITY),this._inverseView=$.default.clone($.default.IDENTITY),this._projection=$.default.clone($.default.IDENTITY),this._infiniteProjection=$.default.clone($.default.IDENTITY),this._entireFrustum=new k.default,this._currentFrustum=new k.default,this._frustumPlanes=new G.a,this._farDepthFromNearPlusOne=void 0,this._log2FarDepthFromNearPlusOne=void 0,this._oneOverLog2FarDepthFromNearPlusOne=void 0,this._frameState=void 0,this._temeToPseudoFixed=Oi.default.clone($.default.IDENTITY),this._view3DDirty=!0,this._view3D=new $.default,this._inverseView3DDirty=!0,this._inverseView3D=new $.default,this._inverseModelDirty=!0,this._inverseModel=new $.default,this._inverseTransposeModelDirty=!0,this._inverseTransposeModel=new Oi.default,this._viewRotation=new Oi.default,this._inverseViewRotation=new Oi.default,this._viewRotation3D=new Oi.default,this._inverseViewRotation3D=new Oi.default,this._inverseProjectionDirty=!0,this._inverseProjection=new $.default,this._modelViewDirty=!0,this._modelView=new $.default,this._modelView3DDirty=!0,this._modelView3D=new $.default,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new $.default,this._inverseModelViewDirty=!0,this._inverseModelView=new $.default,this._inverseModelView3DDirty=!0,this._inverseModelView3D=new $.default,this._viewProjectionDirty=!0,this._viewProjection=new $.default,this._inverseViewProjectionDirty=!0,this._inverseViewProjection=new $.default,this._modelViewProjectionDirty=!0,this._modelViewProjection=new $.default,this._inverseModelViewProjectionDirty=!0,this._inverseModelViewProjection=new $.default,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new $.default,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new $.default,this._normalDirty=!0,this._normal=new Oi.default,this._normal3DDirty=!0,this._normal3D=new Oi.default,this._inverseNormalDirty=!0,this._inverseNormal=new Oi.default,this._inverseNormal3DDirty=!0,this._inverseNormal3D=new Oi.default,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new ro.a,this._cameraPosition=new n.default,this._sunPositionWC=new n.default,this._sunPositionColumbusView=new n.default,this._sunDirectionWC=new n.default,this._sunDirectionEC=new n.default,this._moonDirectionEC=new n.default,this._lightDirectionWC=new n.default,this._lightDirectionEC=new n.default,this._lightColor=new n.default,this._lightColorHdr=new n.default,this._pass=void 0,this._mode=void 0,this._mapProjection=void 0,this._ellipsoid=void 0,this._cameraDirection=new n.default,this._cameraRight=new n.default,this._cameraUp=new n.default,this._frustum2DWidth=0,this._eyeHeight=0,this._eyeHeight2D=new k.default,this._pixelRatio=1,this._orthographicIn3D=!1,this._backgroundColor=new b.default,this._brdfLut=void 0,this._environmentMap=void 0,this._sphericalHarmonicCoefficients=void 0,this._specularEnvironmentMaps=void 0,this._specularEnvironmentMapsDimensions=new k.default,this._specularEnvironmentMapsMaximumLOD=void 0,this._fogDensity=void 0,this._invertClassificationColor=void 0,this._imagerySplitPosition=0,this._pixelSizePerMeter=void 0,this._geometricToleranceOverMeter=void 0,this._minimumDisableDepthTestDistance=void 0}Object.defineProperties(so.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(e){if(!fr.default.equals(e,this._viewport)){fr.default.clone(e,this._viewport);var t=this._viewport,a=this._viewportCartesian4;a.x=t.x,a.y=t.y,a.z=t.width,a.w=t.height,this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){return ho(this),this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){return ho(this),this._viewportTransformation}},model:{get:function(){return this._model},set:function(e){$.default.clone(e,this._model),this._modelView3DDirty=!0,this._inverseModelView3DDirty=!0,this._inverseModelDirty=!0,this._inverseTransposeModelDirty=!0,this._modelViewDirty=!0,this._inverseModelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._inverseModelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._normal3DDirty=!0,this._inverseNormal3DDirty=!0,this._encodedCameraPositionMCDirty=!0}},inverseModel:{get:function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,$.default.inverse(this._model,this._inverseModel)),this._inverseModel}},inverseTransposeModel:{get:function(){var e=this._inverseTransposeModel;return this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,$.default.getMatrix3(this.inverseModel,e),Oi.default.transpose(e,e)),e}},view:{get:function(){return this._view}},view3D:{get:function(){return Oo(this),this._view3D}},viewRotation:{get:function(){return Oo(this),this._viewRotation}},viewRotation3D:{get:function(){return Oo(this),this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){return xo(this),this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){return xo(this),this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){var e;return(e=this)._inverseProjectionDirty&&(e._inverseProjectionDirty=!1,e._mode===V.a.SCENE2D||e._mode===V.a.MORPHING||e._orthographicIn3D?$.default.clone($.default.ZERO,e._inverseProjection):$.default.inverse(e._projection,e._inverseProjection)),this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){var e;return(e=this)._modelViewDirty&&(e._modelViewDirty=!1,$.default.multiplyTransformation(e._view,e._model,e._modelView)),this._modelView}},modelView3D:{get:function(){var e;return(e=this)._modelView3DDirty&&(e._modelView3DDirty=!1,$.default.multiplyTransformation(e.view3D,e._model,e._modelView3D)),this._modelView3D}},modelViewRelativeToEye:{get:function(){return function(e){if(e._modelViewRelativeToEyeDirty){e._modelViewRelativeToEyeDirty=!1;var t=e.modelView,a=e._modelViewRelativeToEye;a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=0,a[13]=0,a[14]=0,a[15]=t[15]}}(this),this._modelViewRelativeToEye}},inverseModelView:{get:function(){var e;return(e=this)._inverseModelViewDirty&&(e._inverseModelViewDirty=!1,$.default.inverse(e.modelView,e._inverseModelView)),this._inverseModelView}},inverseModelView3D:{get:function(){var e;return(e=this)._inverseModelView3DDirty&&(e._inverseModelView3DDirty=!1,$.default.inverse(e.modelView3D,e._inverseModelView3D)),this._inverseModelView3D}},viewProjection:{get:function(){var e;return(e=this)._viewProjectionDirty&&(e._viewProjectionDirty=!1,$.default.multiply(e._projection,e._view,e._viewProjection)),this._viewProjection}},inverseViewProjection:{get:function(){var e;return(e=this)._inverseViewProjectionDirty&&(e._inverseViewProjectionDirty=!1,$.default.inverse(e.viewProjection,e._inverseViewProjection)),this._inverseViewProjection}},modelViewProjection:{get:function(){var e;return(e=this)._modelViewProjectionDirty&&(e._modelViewProjectionDirty=!1,$.default.multiply(e._projection,e.modelView,e._modelViewProjection)),this._modelViewProjection}},inverseModelViewProjection:{get:function(){var e;return(e=this)._inverseModelViewProjectionDirty&&(e._inverseModelViewProjectionDirty=!1,$.default.inverse(e.modelViewProjection,e._inverseModelViewProjection)),this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){var e;return(e=this)._modelViewProjectionRelativeToEyeDirty&&(e._modelViewProjectionRelativeToEyeDirty=!1,$.default.multiply(e._projection,e.modelViewRelativeToEye,e._modelViewProjectionRelativeToEye)),this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){var e;return(e=this)._modelViewInfiniteProjectionDirty&&(e._modelViewInfiniteProjectionDirty=!1,$.default.multiply(e._infiniteProjection,e.modelView,e._modelViewInfiniteProjection)),this._modelViewInfiniteProjection}},normal:{get:function(){return function(e){if(e._normalDirty){e._normalDirty=!1;var t=e._normal;$.default.getMatrix3(e.inverseModelView,t),Oi.default.getRotation(t,t),Oi.default.transpose(t,t)}}(this),this._normal}},normal3D:{get:function(){return function(e){if(e._normal3DDirty){e._normal3DDirty=!1;var t=e._normal3D;$.default.getMatrix3(e.inverseModelView3D,t),Oi.default.getRotation(t,t),Oi.default.transpose(t,t)}}(this),this._normal3D}},inverseNormal:{get:function(){var e;return(e=this)._inverseNormalDirty&&(e._inverseNormalDirty=!1,$.default.getMatrix3(e.inverseModelView,e._inverseNormal),Oi.default.getRotation(e._inverseNormal,e._inverseNormal)),this._inverseNormal}},inverseNormal3D:{get:function(){var e;return(e=this)._inverseNormal3DDirty&&(e._inverseNormal3DDirty=!1,$.default.getMatrix3(e.inverseModelView3D,e._inverseNormal3D),Oi.default.getRotation(e._inverseNormal3D,e._inverseNormal3D)),this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},farDepthFromNearPlusOne:{get:function(){return this._farDepthFromNearPlusOne}},log2FarDepthFromNearPlusOne:{get:function(){return this._log2FarDepthFromNearPlusOne}},oneOverLog2FarDepthFromNearPlusOne:{get:function(){return this._oneOverLog2FarDepthFromNearPlusOne}},eyeHeight:{get:function(){return this._eyeHeight}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},lightDirectionWC:{get:function(){return this._lightDirectionWC}},lightDirectionEC:{get:function(){return this._lightDirectionEC}},lightColor:{get:function(){return this._lightColor}},lightColorHdr:{get:function(){return this._lightColorHdr}},encodedCameraPositionMCHigh:{get:function(){return po(this),this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){return po(this),this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},pixelRatio:{get:function(){return this._pixelRatio}},fogDensity:{get:function(){return this._fogDensity}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps}},specularEnvironmentMapsDimensions:{get:function(){return this._specularEnvironmentMapsDimensions}},specularEnvironmentMapsMaximumLOD:{get:function(){return this._specularEnvironmentMapsMaximumLOD}},imagerySplitPosition:{get:function(){return this._imagerySplitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},orthographicIn3D:{get:function(){return this._orthographicIn3D}},ellipsoid:{get:function(){return Object(o.default)(this._ellipsoid,d.default.WGS84)}}});var lo=new Oi.default,uo=new y.default;so.prototype.updateCamera=function(e){var t,a;t=this,a=e.viewMatrix,$.default.clone(a,t._view),$.default.getMatrix3(a,t._viewRotation),t._view3DDirty=!0,t._inverseView3DDirty=!0,t._modelViewDirty=!0,t._modelView3DDirty=!0,t._modelViewRelativeToEyeDirty=!0,t._inverseModelViewDirty=!0,t._inverseModelView3DDirty=!0,t._viewProjectionDirty=!0,t._inverseViewProjectionDirty=!0,t._modelViewProjectionDirty=!0,t._modelViewProjectionRelativeToEyeDirty=!0,t._modelViewInfiniteProjectionDirty=!0,t._normalDirty=!0,t._inverseNormalDirty=!0,t._normal3DDirty=!0,t._inverseNormal3DDirty=!0,function(e,t){$.default.clone(t,e._inverseView),$.default.getMatrix3(t,e._inverseViewRotation)}(this,e.inverseViewMatrix),function(e,t){n.default.clone(t.positionWC,e._cameraPosition),n.default.clone(t.directionWC,e._cameraDirection),n.default.clone(t.rightWC,e._cameraRight),n.default.clone(t.upWC,e._cameraUp);var a=t.positionCartographic;Object(s.default)(a)?e._eyeHeight=a.height:e._eyeHeight=-e._ellipsoid.maximumRadius,e._encodedCameraPositionMCDirty=!0}(this,e),this._entireFrustum.x=e.frustum.near,this._entireFrustum.y=e.frustum.far,this.updateFrustum(e.frustum),this._orthographicIn3D=this._mode!==V.a.SCENE2D&&e.frustum instanceof te.a},so.prototype.updateFrustum=function(e){var t,a;t=this,a=e.projectionMatrix,$.default.clone(a,t._projection),t._inverseProjectionDirty=!0,t._viewProjectionDirty=!0,t._inverseViewProjectionDirty=!0,t._modelViewProjectionDirty=!0,t._modelViewProjectionRelativeToEyeDirty=!0,Object(s.default)(e.infiniteProjectionMatrix)&&function(e,t){$.default.clone(t,e._infiniteProjection),e._modelViewInfiniteProjectionDirty=!0}(this,e.infiniteProjectionMatrix),this._currentFrustum.x=e.near,this._currentFrustum.y=e.far,this._farDepthFromNearPlusOne=e.far-e.near+1,this._log2FarDepthFromNearPlusOne=J.default.log2(this._farDepthFromNearPlusOne),this._oneOverLog2FarDepthFromNearPlusOne=1/this._log2FarDepthFromNearPlusOne,Object(s.default)(e._offCenterFrustum)&&(e=e._offCenterFrustum),this._frustumPlanes.x=e.top,this._frustumPlanes.y=e.bottom,this._frustumPlanes.z=e.left,this._frustumPlanes.w=e.right},so.prototype.updatePass=function(e){this._pass=e};var co=[],fo=new oo;function ho(e){if(e._viewportDirty){var t=e._viewport;$.default.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,e._viewportOrthographicMatrix),$.default.computeViewportTransformation(t,0,1,e._viewportTransformation),e._viewportDirty=!1}}so.prototype.update=function(e){this._mode=e.mode,this._mapProjection=e.mapProjection,this._ellipsoid=e.mapProjection.ellipsoid,this._pixelRatio=e.pixelRatio;var t=e.camera;this.updateCamera(t),e.mode===V.a.SCENE2D?(this._frustum2DWidth=t.frustum.right-t.frustum.left,this._eyeHeight2D.x=.5*this._frustum2DWidth,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0),function(e,t){Object(s.default)(qn.default.computeIcrfToFixedMatrix(t.time,lo))||(lo=qn.default.computeTemeToPseudoFixedMatrix(t.time,lo));var a=Qn.computeSunPositionInEarthInertialFrame(t.time,e._sunPositionWC);Oi.default.multiplyByVector(lo,a,a),n.default.normalize(a,e._sunDirectionWC),a=Oi.default.multiplyByVector(e.viewRotation3D,a,e._sunDirectionEC),n.default.normalize(a,a),a=Qn.computeMoonPositionInEarthInertialFrame(t.time,e._moonDirectionEC),Oi.default.multiplyByVector(lo,a,a),Oi.default.multiplyByVector(e.viewRotation3D,a,a),n.default.normalize(a,a);var i=t.mapProjection,r=i.ellipsoid.cartesianToCartographic(e._sunPositionWC,uo);i.project(r,e._sunPositionColumbusView)}(this,e);var a=Object(o.default)(e.light,fo);a instanceof oo?(this._lightDirectionWC=n.default.clone(this._sunDirectionWC,this._lightDirectionWC),this._lightDirectionEC=n.default.clone(this._sunDirectionEC,this._lightDirectionEC)):(this._lightDirectionWC=n.default.normalize(n.default.negate(a.direction,this._lightDirectionWC),this._lightDirectionWC),this._lightDirectionEC=Oi.default.multiplyByVector(this.viewRotation3D,this._lightDirectionWC,this._lightDirectionEC));var i=a.color,r=n.default.fromElements(i.red,i.green,i.blue,this._lightColorHdr);r=n.default.multiplyByScalar(r,a.intensity,r);var l=n.default.maximumComponent(r);l>1?n.default.divideByScalar(r,l,this._lightColor):n.default.clone(r,this._lightColor);var u=e.brdfLutGenerator,d=Object(s.default)(u)?u.colorTexture:void 0;this._brdfLut=d,this._environmentMap=Object(o.default)(e.environmentMap,e.context.defaultCubeMap),this._sphericalHarmonicCoefficients=Object(o.default)(e.sphericalHarmonicCoefficients,co),this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentMapsMaximumLOD=e.specularEnvironmentMapsMaximumLOD,Object(s.default)(this._specularEnvironmentMaps)&&k.default.clone(this._specularEnvironmentMaps.dimensions,this._specularEnvironmentMapsDimensions),this._fogDensity=e.fog.density,this._invertClassificationColor=e.invertClassificationColor,this._frameState=e,this._temeToPseudoFixed=qn.default.computeTemeToPseudoFixedMatrix(e.time,this._temeToPseudoFixed),this._imagerySplitPosition=e.imagerySplitPosition*e.context.drawingBufferWidth;var c,f=t.frustum.fov,h=this._viewport;c=Object(s.default)(f)?h.height>h.width?2*Math.tan(.5*f)/h.height:2*Math.tan(.5*f)/h.width:1/Math.max(h.width,h.height),this._geometricToleranceOverMeter=c*e.maximumScreenSpaceError,b.default.clone(e.backgroundColor,this._backgroundColor),this._minimumDisableDepthTestDistance=e.minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};var mo=new n.default;function po(e){e._encodedCameraPositionMCDirty&&(e._encodedCameraPositionMCDirty=!1,$.default.multiplyByPoint(e.inverseModel,e._cameraPosition,mo),ro.a.fromCartesian(mo,e._encodedCameraPositionMC))}var _o=new n.default,go=new n.default,vo=new n.default,yo=new n.default,bo=new y.default,wo=new n.default,Co=new $.default;function Oo(e){e._view3DDirty&&(e._mode===V.a.SCENE3D?$.default.clone(e._view,e._view3D):function(e,t,a,i,r,o,l,u){var d=_o;d.x=e.y,d.y=e.z,d.z=e.x;var c=go;c.x=a.y,c.y=a.z,c.z=a.x;var f=vo;f.x=i.y,f.y=i.z,f.z=i.x;var h=yo;h.x=t.y,h.y=t.z,h.z=t.x,o===V.a.SCENE2D&&(d.z=.5*r);var m=l.unproject(d,bo);m.longitude=J.default.clamp(m.longitude,-Math.PI,Math.PI),m.latitude=J.default.clamp(m.latitude,-J.default.PI_OVER_TWO,J.default.PI_OVER_TWO);var p=l.ellipsoid,_=p.cartographicToCartesian(m,wo),g=qn.default.eastNorthUpToFixedFrame(_,p,Co);$.default.multiplyByPointAsVector(g,c,c),$.default.multiplyByPointAsVector(g,f,f),$.default.multiplyByPointAsVector(g,h,h),Object(s.default)(u)||(u=new $.default),u[0]=c.x,u[1]=f.x,u[2]=-h.x,u[3]=0,u[4]=c.y,u[5]=f.y,u[6]=-h.y,u[7]=0,u[8]=c.z,u[9]=f.z,u[10]=-h.z,u[11]=0,u[12]=-n.default.dot(c,_),u[13]=-n.default.dot(f,_),u[14]=n.default.dot(h,_),u[15]=1}(e._cameraPosition,e._cameraDirection,e._cameraRight,e._cameraUp,e._frustum2DWidth,e._mode,e._mapProjection,e._view3D),$.default.getMatrix3(e._view3D,e._viewRotation3D),e._view3DDirty=!1)}function xo(e){e._inverseView3DDirty&&($.default.inverseTransformation(e.view3D,e._inverseView3D),$.default.getMatrix3(e._inverseView3D,e._inverseViewRotation3D),e._inverseView3DDirty=!1)}var To=so;function Eo(e,t,a){var i=e.getError();if(i!==e.NO_ERROR)throw new Zr.default(function(e,t,a,i){for(var n=function(e,t){var a="WebGL Error:  ";switch(t){case e.INVALID_ENUM:a+="INVALID_ENUM";break;case e.INVALID_VALUE:a+="INVALID_VALUE";break;case e.INVALID_OPERATION:a+="INVALID_OPERATION";break;case e.OUT_OF_MEMORY:a+="OUT_OF_MEMORY";break;case e.CONTEXT_LOST_WEBGL:a+="CONTEXT_LOST_WEBGL lost";break;default:a+="Unknown ("+t+")"}return a}(e,i)+": "+t.name+"(",r=0;r<a.length;++r)0!==r&&(n+=", "),n+=a[r];return n+=");"}(e,t,a,i))}function Ao(e,t,a){return{get:function(){var i=e[t];return a(e,"get: "+t,i),e[t]},set:function(i){e[t]=i,a(e,"set: "+t,i)}}}function Po(e,t){for(var a=t.length,i=0;i<a;++i){var n=e.getExtension(t[i]);if(n)return n}}function So(e,t){if("undefined"==typeof WebGLRenderingContext)throw new Zr.default("The browser does not support WebGL.  Visit http://get.webgl.org.");this._canvas=e,t=Object(W.default)(t,!0),(t=Object(o.default)(t,{})).allowTextureFilterAnisotropic=Object(o.default)(t.allowTextureFilterAnisotropic,!0);var a=Object(o.default)(t.webgl,{});a.alpha=Object(o.default)(a.alpha,!1),a.stencil=Object(o.default)(a.stencil,!0);var i,n=Object(o.default)(t.requestWebgl2,!1)&&"undefined"!=typeof WebGL2RenderingContext,r=!1,l=t.getWebGLStub;if(Object(s.default)(l))i=l(e,a);else if(n&&(i=e.getContext("webgl2",a)||e.getContext("experimental-webgl2",a)||void 0,Object(s.default)(i)&&(r=!0)),Object(s.default)(i)||(i=e.getContext("webgl",a)||e.getContext("experimental-webgl",a)||void 0),!Object(s.default)(i))throw new Zr.default("The browser supports WebGL, but initialization failed.");this._originalGLContext=i,this._gl=i,this._webgl2=r,this._id=Object(hr.default)(),this.validateFramebuffer=!1,this.validateShaderProgram=!1,this.logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new ao(this),this._textureCache=new no;var u=i;this._stencilBits=u.getParameter(u.STENCIL_BITS),le.a._maximumCombinedTextureImageUnits=u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS),le.a._maximumCubeMapSize=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),le.a._maximumFragmentUniformVectors=u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS),le.a._maximumTextureImageUnits=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),le.a._maximumRenderbufferSize=u.getParameter(u.MAX_RENDERBUFFER_SIZE),le.a._maximumTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),le.a._maximumVaryingVectors=u.getParameter(u.MAX_VARYING_VECTORS),le.a._maximumVertexAttributes=u.getParameter(u.MAX_VERTEX_ATTRIBS),le.a._maximumVertexTextureImageUnits=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),le.a._maximumVertexUniformVectors=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS);var d=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);le.a._minimumAliasedLineWidth=d[0],le.a._maximumAliasedLineWidth=d[1];var c=u.getParameter(u.ALIASED_POINT_SIZE_RANGE);le.a._minimumAliasedPointSize=c[0],le.a._maximumAliasedPointSize=c[1];var f=u.getParameter(u.MAX_VIEWPORT_DIMS);le.a._maximumViewportWidth=f[0],le.a._maximumViewportHeight=f[1];var h=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT);le.a._highpFloatSupported=0!==h.precision;var m=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT);le.a._highpIntSupported=0!==m.rangeMax,this._antialias=u.getContextAttributes().antialias,this._standardDerivatives=!!Po(u,["OES_standard_derivatives"]),this._blendMinmax=!!Po(u,["EXT_blend_minmax"]),this._elementIndexUint=!!Po(u,["OES_element_index_uint"]),this._depthTexture=!!Po(u,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),this._fragDepth=!!Po(u,["EXT_frag_depth"]),this._debugShaders=Po(u,["WEBGL_debug_shaders"]),this._textureFloat=!!Po(u,["OES_texture_float"]),this._textureHalfFloat=!!Po(u,["OES_texture_half_float"]),this._textureFloatLinear=!!Po(u,["OES_texture_float_linear"]),this._textureHalfFloatLinear=!!Po(u,["OES_texture_half_float_linear"]),this._colorBufferFloat=!!Po(u,["EXT_color_buffer_float","WEBGL_color_buffer_float"]),this._floatBlend=!!Po(u,["EXT_float_blend"]),this._colorBufferHalfFloat=!!Po(u,["EXT_color_buffer_half_float"]),this._s3tc=!!Po(u,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!Po(u,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._etc1=!!Po(u,["WEBGL_compressed_texture_etc1"]);var p,_,g,v,y,w,C,O,x,T,E=t.allowTextureFilterAnisotropic?Po(u,["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"]):void 0;if(this._textureFilterAnisotropic=E,le.a._maximumTextureFilterAnisotropy=Object(s.default)(E)?u.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,r){var A=this;p=function(){return A._gl.createVertexArray()},_=function(e){A._gl.bindVertexArray(e)},g=function(e){A._gl.deleteVertexArray(e)},v=function(e,t,a,i,n){u.drawElementsInstanced(e,t,a,i,n)},y=function(e,t,a,i){u.drawArraysInstanced(e,t,a,i)},w=function(e,t){u.vertexAttribDivisor(e,t)},C=function(e){u.drawBuffers(e)}}else O=Po(u,["OES_vertex_array_object"]),Object(s.default)(O)&&(p=function(){return O.createVertexArrayOES()},_=function(e){O.bindVertexArrayOES(e)},g=function(e){O.deleteVertexArrayOES(e)}),x=Po(u,["ANGLE_instanced_arrays"]),Object(s.default)(x)&&(v=function(e,t,a,i,n){x.drawElementsInstancedANGLE(e,t,a,i,n)},y=function(e,t,a,i){x.drawArraysInstancedANGLE(e,t,a,i)},w=function(e,t){x.vertexAttribDivisorANGLE(e,t)}),T=Po(u,["WEBGL_draw_buffers"]),Object(s.default)(T)&&(C=function(e){T.drawBuffersWEBGL(e)});this.glCreateVertexArray=p,this.glBindVertexArray=_,this.glDeleteVertexArray=g,this.glDrawElementsInstanced=v,this.glDrawArraysInstanced=y,this.glVertexAttribDivisor=w,this.glDrawBuffers=C,this._vertexArrayObject=!!O,this._instancedArrays=!!x,this._drawBuffers=!!T,le.a._maximumDrawBuffers=this.drawBuffers?u.getParameter(Kr.a.MAX_DRAW_BUFFERS):1,le.a._maximumColorAttachments=this.drawBuffers?u.getParameter(Kr.a.MAX_COLOR_ATTACHMENTS):1,this._clearColor=new b.default(0,0,0,0),this._clearDepth=1,this._clearStencil=0;var P=new To,S=new $r(this),D=ce.a.fromCache();this._defaultPassState=S,this._defaultRenderState=D,this._defaultTexture=void 0,this._defaultCubeMap=void 0,this._us=P,this._currentRenderState=D,this._currentPassState=S,this._currentFramebuffer=void 0,this._maxFrameTextureUnitIndex=0,this._vertexAttribDivisors=[],this._previousDrawInstanced=!1;for(var F=0;F<le.a._maximumVertexAttributes;F++)this._vertexAttribDivisors.push(0);this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.options=t,this.cache={},ce.a.apply(u,D,S)}var Do,Fo={};function Mo(e,t,a,i){var n=e._currentRenderState,r=e._currentPassState;e._currentRenderState=t,e._currentPassState=a,ce.a.partialApply(e._gl,n,t,r,a,i)}function Io(e,t){if(t!==e._currentFramebuffer){e._currentFramebuffer=t;var a=Do;if(Object(s.default)(t))t._bind(),a=t._getActiveColorAttachments();else{var i=e._gl;i.bindFramebuffer(i.FRAMEBUFFER,null)}e.drawBuffers&&e.glDrawBuffers(a)}}Object.defineProperties(So.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},textureCache:{get:function(){return this._textureCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return this._stencilBits>=8}},antialias:{get:function(){return this._antialias}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},floatBlend:{get:function(){return this._floatBlend}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},etc1:{get:function(){return this._etc1}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(e){this._throwOnWebGLError=e,this._gl=function(e,t){if(!Object(s.default)(t))return e;function a(a){return function(){var i=a.apply(e,arguments);return t(e,a,arguments),i}}var i={};for(var n in e){var r=e[n];r instanceof Function?i[n]=a(r):Object.defineProperty(i,n,Ao(e,n,t))}return i}(this._originalGLContext,e?Eo:void 0)}},defaultTexture:{get:function(){return void 0===this._defaultTexture&&(this._defaultTexture=new D.a({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}},defaultCubeMap:{get:function(){if(void 0===this._defaultCubeMap){var e={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new Jr.a({context:this,source:{positiveX:e,negativeX:e,positiveY:e,negativeY:e,positiveZ:e,negativeZ:e},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return Fo}}}),"undefined"!=typeof WebGLRenderingContext&&(Do=[Kr.a.BACK]);var Ro=new Br.a;So.prototype.clear=function(e,t){e=Object(o.default)(e,Ro),t=Object(o.default)(t,this._defaultPassState);var a=this._gl,i=0,n=e.color,r=e.depth,l=e.stencil;Object(s.default)(n)&&(b.default.equals(this._clearColor,n)||(b.default.clone(n,this._clearColor),a.clearColor(n.red,n.green,n.blue,n.alpha)),i|=a.COLOR_BUFFER_BIT),Object(s.default)(r)&&(r!==this._clearDepth&&(this._clearDepth=r,a.clearDepth(r)),i|=a.DEPTH_BUFFER_BIT),Object(s.default)(l)&&(l!==this._clearStencil&&(this._clearStencil=l,a.clearStencil(l)),i|=a.STENCIL_BUFFER_BIT),Mo(this,Object(o.default)(e.renderState,this._defaultRenderState),t,!0),Io(this,Object(o.default)(e.framebuffer,t.framebuffer)),a.clear(i)},So.prototype.draw=function(e,t,a,i){t=Object(o.default)(t,this._defaultPassState);var n=Object(o.default)(e._framebuffer,t.framebuffer),r=Object(o.default)(e._renderState,this._defaultRenderState);a=Object(o.default)(a,e._shaderProgram),i=Object(o.default)(i,e._uniformMap),function(e,t,a,i,n){Io(e,t),Mo(e,n,a,!1),i._bind(),e._maxFrameTextureUnitIndex=Math.max(e._maxFrameTextureUnitIndex,i.maximumTextureUnitIndex)}(this,n,t,a,r),function(e,t,a,i){var n=t._primitiveType,r=t._vertexArray,l=t._offset,u=t._count,d=t.instanceCount;e._us.model=Object(o.default)(t._modelMatrix,$.default.IDENTITY),a._setUniforms(i,e._us,e.validateShaderProgram),r._bind();var c=r.indexBuffer;Object(s.default)(c)?(l*=c.bytesPerIndex,u=Object(o.default)(u,c.numberOfIndices),0===d?e._gl.drawElements(n,u,c.indexDatatype,l):e.glDrawElementsInstanced(n,u,c.indexDatatype,l,d)):(u=Object(o.default)(u,r.numberOfVertices),0===d?e._gl.drawArrays(n,l,u):e.glDrawArraysInstanced(n,l,u,d)),r._unBind()}(this,e,a,i)},So.prototype.endFrame=function(){var e=this._gl;e.useProgram(null),this._currentFramebuffer=void 0,e.bindFramebuffer(e.FRAMEBUFFER,null);var t=Do;this.drawBuffers&&this.glDrawBuffers(t);var a=this._maxFrameTextureUnitIndex;this._maxFrameTextureUnitIndex=0;for(var i=0;i<a;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},So.prototype.readPixels=function(e){var t=this._gl;e=Object(o.default)(e,o.default.EMPTY_OBJECT);var a=Math.max(Object(o.default)(e.x,0),0),i=Math.max(Object(o.default)(e.y,0),0),n=Object(o.default)(e.width,t.drawingBufferWidth),r=Object(o.default)(e.height,t.drawingBufferHeight),l=e.framebuffer,u=we.a.UNSIGNED_BYTE;Object(s.default)(l)&&l.numberOfColorAttachments>0&&(u=l.getColorTexture(0).pixelDatatype);var d=_e.a.createTypedArray(_e.a.RGBA,u,n,r);return Io(this,l),t.readPixels(a,i,n,r,_e.a.RGBA,we.a.toWebGLConstant(u,this),d),d};var No={position:0,textureCoordinates:1};function Lo(e,t,a){this._pickObjects=e,this.key=t,this.color=a}So.prototype.getViewportQuadVertexArray=function(){var e=this.cache.viewportQuad_vertexArray;if(!Object(s.default)(e)){var t=new Qr.a({attributes:{position:new qr.a({componentDatatype:Xr.a.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new qr.a({componentDatatype:Xr.a.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:ae.a.TRIANGLES});e=fe.a.fromGeometry({context:this,geometry:t,attributeLocations:No,bufferUsage:se.a.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=e}return e},So.prototype.createViewportQuadCommand=function(e,t){return t=Object(o.default)(t,o.default.EMPTY_OBJECT),new ue.a({vertexArray:this.getViewportQuadVertexArray(),primitiveType:ae.a.TRIANGLES,renderState:t.renderState,shaderProgram:L.a.fromCache({context:this,vertexShaderSource:zr,fragmentShaderSource:e,attributeLocations:No}),uniformMap:t.uniformMap,owner:t.owner,framebuffer:t.framebuffer,pass:t.pass})},So.prototype.getObjectByPickColor=function(e){return this._pickObjects[e.toRgba()]},Object.defineProperties(Lo.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(e){this._pickObjects[this.key]=e}}}),Lo.prototype.destroy=function(){delete this._pickObjects[this.key]},So.prototype.createPickId=function(e){++this._nextPickColor[0];var t=this._nextPickColor[0];if(0===t)throw new Zr.default("Out of unique Pick IDs.");return this._pickObjects[t]=e,new Lo(this._pickObjects,t,b.default.fromRgba(t))},So.prototype.isDestroyed=function(){return!1},So.prototype.destroy=function(){var e=this.cache;for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];Object(s.default)(a.destroy)&&a.destroy()}return this._shaderCache=this._shaderCache.destroy(),this._textureCache=this._textureCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),Object(l.default)(this)};var jo=So,Vo="varying vec2 v_textureCoordinates;\nconst float M_PI = 3.141592653589793;\n\nfloat vdcRadicalInverse(int i)\n{\n    float r;\n    float base = 2.0;\n    float value = 0.0;\n    float invBase = 1.0 / base;\n    float invBi = invBase;\n    for (int x = 0; x < 100; x++)\n    {\n        if (i <= 0)\n        {\n            break;\n        }\n        r = mod(float(i), base);\n        value += r * invBi;\n        invBi *= invBase;\n        i = int(float(i) * invBase);\n    }\n    return value;\n}\n\nvec2 hammersley2D(int i, int N)\n{\n    return vec2(float(i) / float(N), vdcRadicalInverse(i));\n}\n\nvec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N)\n{\n    float a = roughness * roughness;\n    float phi = 2.0 * M_PI * xi.x;\n    float cosTheta = sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y));\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n    vec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n    vec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\n    vec3 tangentX = normalize(cross(upVector, N));\n    vec3 tangentY = cross(N, tangentX);\n    return tangentX * H.x + tangentY * H.y + N * H.z;\n}\n\nfloat G1_Smith(float NdotV, float k)\n{\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\nfloat G_Smith(float roughness, float NdotV, float NdotL)\n{\n    float k = roughness * roughness / 2.0;\n    return G1_Smith(NdotV, k) * G1_Smith(NdotL, k);\n}\n\nvec2 integrateBrdf(float roughness, float NdotV)\n{\n    vec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\n    float A = 0.0;\n    float B = 0.0;\n    const int NumSamples = 1024;\n    for (int i = 0; i < NumSamples; i++)\n    {\n        vec2 xi = hammersley2D(i, NumSamples);\n        vec3 H = importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0));\n        vec3 L = 2.0 * dot(V, H) * H - V;\n        float NdotL = clamp(L.z, 0.0, 1.0);\n        float NdotH = clamp(H.z, 0.0, 1.0);\n        float VdotH = clamp(dot(V, H), 0.0, 1.0);\n        if (NdotL > 0.0)\n        {\n            float G = G_Smith(roughness, NdotV, NdotL);\n            float G_Vis = G * VdotH / (NdotH * NdotV);\n            float Fc = pow(1.0 - VdotH, 5.0);\n            A += (1.0 - Fc) * G_Vis;\n            B += Fc * G_Vis;\n        }\n    }\n    return vec2(A, B) / float(NumSamples);\n}\n\nvoid main()\n{\n    gl_FragColor = vec4(integrateBrdf(v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);\n}\n";function Uo(){this._framebuffer=void 0,this._colorTexture=void 0,this._drawCommand=void 0}Object.defineProperties(Uo.prototype,{colorTexture:{get:function(){return this._colorTexture}}}),Uo.prototype.update=function(e){if(!Object(s.default)(this._colorTexture)){var t=e.context;!function(e,t){var a=new D.a({context:t,width:256,height:256,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Ce.a.NEAREST});e._colorTexture=a;var i=new Hr.a({context:t,colorTextures:[a],destroyAttachments:!1});e._framebuffer=i}(this,t),function(e,t){var a=e._framebuffer,i=t.createViewportQuadCommand(Vo,{framebuffer:a,renderState:ce.a.fromCache({viewport:new fr.default(0,0,256,256)})});e._drawCommand=i}(this,t),this._drawCommand.execute(t),this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}},Uo.prototype.isDestroyed=function(){return!1},Uo.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),Object(l.default)(this)};var Bo=Uo,zo=a(202),Ho=a(227),ko=a(351),Go=a(265),Wo=a(734),Yo=Object.freeze({ROTATE:0,INFINITE_SCROLL:1});function Xo(e){this._scene=e,this._transform=$.default.clone($.default.IDENTITY),this._invTransform=$.default.clone($.default.IDENTITY),this._actualTransform=$.default.clone($.default.IDENTITY),this._actualInvTransform=$.default.clone($.default.IDENTITY),this._transformChanged=!1,this.position=new n.default,this._position=new n.default,this._positionWC=new n.default,this._positionCartographic=new y.default,this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new n.default,this._direction=new n.default,this._directionWC=new n.default,this.up=new n.default,this._up=new n.default,this._upWC=new n.default,this.right=new n.default,this._right=new n.default,this._rightWC=new n.default,this.frustum=new Lr.a,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=J.default.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new C.default,this._moveEnd=new C.default,this._changed=new C.default,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new $.default,this._invViewMatrix=new $.default,Qo(this),this._mode=V.a.SCENE3D,this._modeChanged=!0;var t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new y.default(Math.PI,J.default.PI_OVER_TWO)),this._max2Dfrustum=void 0,dl(this,Xo.DEFAULT_VIEW_RECTANGLE,this.position,!0);var a=n.default.magnitude(this.position);a+=a*Xo.DEFAULT_VIEW_FACTOR,n.default.normalize(this.position,this.position),n.default.multiplyByScalar(this.position,a,this.position)}function Qo(e){$.default.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),$.default.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),$.default.inverseTransformation(e._viewMatrix,e._invViewMatrix)}Xo.TRANSFORM_2D=new $.default(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),Xo.TRANSFORM_2D_INVERSE=$.default.inverseTransformation(Xo.TRANSFORM_2D,new $.default),Xo.DEFAULT_VIEW_RECTANGLE=A.default.fromDegrees(-95,-20,-70,90),Xo.DEFAULT_VIEW_FACTOR=.5,Xo.DEFAULT_OFFSET=new ko.default(0,-J.default.PI_OVER_FOUR,0),Xo.prototype.canPreloadFlight=function(){return Object(s.default)(this._currentFlight)&&this._mode!==V.a.SCENE2D},Xo.prototype._updateCameraChanged=function(){if(function(e){if(Object(s.default)(e._oldPositionWC)){e.positionWCDeltaMagnitudeLastFrame=e.positionWCDeltaMagnitude;var t=n.default.subtract(e.positionWC,e._oldPositionWC,e._oldPositionWC);e.positionWCDeltaMagnitude=n.default.magnitude(t),e._oldPositionWC=n.default.clone(e.positionWC,e._oldPositionWC),e.positionWCDeltaMagnitude>0?(e.timeSinceMoved=0,e._lastMovedTimestamp=Object(ya.default)()):e.timeSinceMoved=Math.max(Object(ya.default)()-e._lastMovedTimestamp,0)/1e3}else e._oldPositionWC=n.default.clone(e.positionWC,e._oldPositionWC)}(this),0!==this._changed.numberOfListeners){var e=this.percentageChanged;if(this._mode!==V.a.SCENE2D){if(!Object(s.default)(this._changedDirection))return this._changedPosition=n.default.clone(this.positionWC,this._changedPosition),void(this._changedDirection=n.default.clone(this.directionWC,this._changedDirection));var t,a=J.default.acosClamped(n.default.dot(this.directionWC,this._changedDirection));t=Object(s.default)(this.frustum.fovy)?a/(.5*this.frustum.fovy):a;var i=n.default.distance(this.positionWC,this._changedPosition)/this.positionCartographic.height;(t>e||i>e)&&(this._changed.raiseEvent(Math.max(t,i)),this._changedPosition=n.default.clone(this.positionWC,this._changedPosition),this._changedDirection=n.default.clone(this.directionWC,this._changedDirection))}else{if(!Object(s.default)(this._changedFrustum))return this._changedPosition=n.default.clone(this.position,this._changedPosition),void(this._changedFrustum=this.frustum.clone());var r,o=this.position,l=this._changedPosition,u=this.frustum,d=this._changedFrustum,c=o.x+u.left,f=o.x+u.right,h=l.x+d.left,m=l.x+d.right,p=o.y+u.bottom,_=o.y+u.top,g=l.y+d.bottom,v=l.y+d.top,y=Math.max(c,h),b=Math.min(f,m),w=Math.max(p,g),C=Math.min(_,v);if(y>=b||w>=_)r=1;else{var O=d;c<h&&f>m&&p<g&&_>v&&(O=u),r=1-(b-y)*(C-w)/((O.right-O.left)*(O.top-O.bottom))}r>e&&(this._changed.raiseEvent(r),this._changedPosition=n.default.clone(this.position,this._changedPosition),this._changedFrustum=this.frustum.clone(this._changedFrustum))}}};var qo=new y.default,Zo=new n.default,Ko=new n.default,Jo=new G.a,$o=new G.a,es=new G.a,ts=new G.a,as=new G.a;var is=new n.default;function ns(e){var t=e._mode,a=!1,i=0;t===V.a.SCENE2D&&(a=(i=e.frustum.right-e.frustum.left)!==e._positionCartographic.height);var r=e._position,o=!n.default.equals(r,e.position)||a;o&&(r=n.default.clone(e.position,e._position));var s=e._direction,l=!n.default.equals(s,e.direction);l&&(n.default.normalize(e.direction,e.direction),s=n.default.clone(e.direction,e._direction));var u=e._up,d=!n.default.equals(u,e.up);d&&(n.default.normalize(e.up,e.up),u=n.default.clone(e.up,e._up));var c=e._right,f=!n.default.equals(c,e.right);f&&(n.default.normalize(e.right,e.right),c=n.default.clone(e.right,e._right));var h=e._transformChanged||e._modeChanged;e._transformChanged=!1,h&&($.default.inverseTransformation(e._transform,e._invTransform),e._mode===V.a.COLUMBUS_VIEW||e._mode===V.a.SCENE2D?$.default.equals($.default.IDENTITY,e._transform)?$.default.clone(Xo.TRANSFORM_2D,e._actualTransform):e._mode===V.a.COLUMBUS_VIEW?function(e){qn.default.basisTo2D(e._projection,e._transform,e._actualTransform)}(e):function(e){var t=e._projection,a=t.ellipsoid,i=$.default.getColumn(e._transform,3,Jo),r=a.cartesianToCartographic(i,qo),o=t.project(r,Zo),s=$o;s.x=o.z,s.y=o.x,s.z=o.y,s.w=1;var l=G.a.clone(G.a.UNIT_X,as),u=G.a.add($.default.getColumn(e._transform,0,Ko),i,Ko);a.cartesianToCartographic(u,r),t.project(r,o);var d=es;d.x=o.z,d.y=o.x,d.z=o.y,d.w=0,n.default.subtract(d,s,d),d.x=0;var c=ts;if(n.default.magnitudeSquared(d)>J.default.EPSILON10)n.default.cross(l,d,c);else{var f=G.a.add($.default.getColumn(e._transform,1,Ko),i,Ko);a.cartesianToCartographic(f,r),t.project(r,o),c.x=o.z,c.y=o.x,c.z=o.y,c.w=0,n.default.subtract(c,s,c),c.x=0,n.default.magnitudeSquared(c)<J.default.EPSILON10&&(G.a.clone(G.a.UNIT_Y,d),G.a.clone(G.a.UNIT_Z,c))}n.default.cross(c,l,d),n.default.normalize(d,d),n.default.cross(l,d,c),n.default.normalize(c,c),$.default.setColumn(e._actualTransform,0,d,e._actualTransform),$.default.setColumn(e._actualTransform,1,c,e._actualTransform),$.default.setColumn(e._actualTransform,2,l,e._actualTransform),$.default.setColumn(e._actualTransform,3,s,e._actualTransform)}(e):$.default.clone(e._transform,e._actualTransform),$.default.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);var m=e._actualTransform;if(o||h)if(e._positionWC=$.default.multiplyByPoint(m,r,e._positionWC),t===V.a.SCENE3D||t===V.a.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{var p=is;p.x=e._positionWC.y,p.y=e._positionWC.z,p.z=e._positionWC.x,t===V.a.SCENE2D&&(p.z=i),e._projection.unproject(p,e._positionCartographic)}if(l||d||f){var _=n.default.dot(s,n.default.cross(u,c,is));if(Math.abs(1-_)>J.default.EPSILON2){var g=1/n.default.magnitudeSquared(u),v=n.default.dot(u,s)*g,y=n.default.multiplyByScalar(s,v,is);u=n.default.normalize(n.default.subtract(u,y,e._up),e._up),n.default.clone(u,e.up),c=n.default.cross(s,u,e._right),n.default.clone(c,e.right)}}(l||h)&&(e._directionWC=$.default.multiplyByPointAsVector(m,s,e._directionWC),n.default.normalize(e._directionWC,e._directionWC)),(d||h)&&(e._upWC=$.default.multiplyByPointAsVector(m,u,e._upWC),n.default.normalize(e._upWC,e._upWC)),(f||h)&&(e._rightWC=$.default.multiplyByPointAsVector(m,c,e._rightWC),n.default.normalize(e._rightWC,e._rightWC)),(o||l||d||f||h)&&Qo(e)}function rs(e,t){var a;return a=J.default.equalsEpsilon(Math.abs(e.z),1,J.default.EPSILON3)?Math.atan2(t.y,t.x)-J.default.PI_OVER_TWO:Math.atan2(e.y,e.x)-J.default.PI_OVER_TWO,J.default.TWO_PI-J.default.zeroToTwoPi(a)}function os(e){return J.default.PI_OVER_TWO-J.default.acosClamped(e.z)}function ss(e,t,a){var i=0;return J.default.equalsEpsilon(Math.abs(e.z),1,J.default.EPSILON3)||(i=Math.atan2(-a.z,t.z),i=J.default.zeroToTwoPi(i+J.default.TWO_PI)),i}var ls=new $.default,us=new $.default;Object.defineProperties(Xo.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return ns(this),this._invTransform}},viewMatrix:{get:function(){return ns(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return ns(this),this._invViewMatrix}},positionCartographic:{get:function(){return ns(this),this._positionCartographic}},positionWC:{get:function(){return ns(this),this._positionWC}},directionWC:{get:function(){return ns(this),this._directionWC}},upWC:{get:function(){return ns(this),this._upWC}},rightWC:{get:function(){return ns(this),this._rightWC}},heading:{get:function(){if(this._mode!==V.a.MORPHING){var e=this._projection.ellipsoid,t=$.default.clone(this._transform,ls),a=qn.default.eastNorthUpToFixedFrame(this.positionWC,e,us);this._setTransform(a);var i=rs(this.direction,this.up);return this._setTransform(t),i}}},pitch:{get:function(){if(this._mode!==V.a.MORPHING){var e=this._projection.ellipsoid,t=$.default.clone(this._transform,ls),a=qn.default.eastNorthUpToFixedFrame(this.positionWC,e,us);this._setTransform(a);var i=os(this.direction);return this._setTransform(t),i}}},roll:{get:function(){if(this._mode!==V.a.MORPHING){var e=this._projection.ellipsoid,t=$.default.clone(this._transform,ls),a=qn.default.eastNorthUpToFixedFrame(this.positionWC,e,us);this._setTransform(a);var i=ss(this.direction,this.up,this.right);return this._setTransform(t),i}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),Xo.prototype.update=function(e){var t=!1;if(e!==this._mode&&(this._mode=e,this._modeChanged=e!==V.a.MORPHING,t=this._mode===V.a.SCENE2D),t){var a=this._max2Dfrustum=this.frustum.clone(),i=a.top/a.right;a.right=2*this._maxCoord.x,a.left=-a.right,a.top=i*a.right,a.bottom=-a.top}this._mode===V.a.SCENE2D&&Fs(this,this.position)};var ds=new n.default,cs=new n.default,fs=new n.default;Xo.prototype._setTransform=function(e){var t=n.default.clone(this.positionWC,ds),a=n.default.clone(this.upWC,cs),i=n.default.clone(this.directionWC,fs);$.default.clone(e,this._transform),this._transformChanged=!0,ns(this);var r=this._actualInvTransform;$.default.multiplyByPoint(r,t,this.position),$.default.multiplyByPointAsVector(r,i,this.direction),$.default.multiplyByPointAsVector(r,a,this.up),n.default.cross(this.direction,this.up,this.right),ns(this)};var hs=new k.default,ms=new E.default,ps=new n.default,_s=new n.default;function gs(e){if(!$.default.equals($.default.IDENTITY,e.transform))return n.default.magnitude(e.position);var t,a,i,r=e._scene,o=r.globe,l=hs;if(l.x=r.drawingBufferWidth/2,l.y=r.drawingBufferHeight/2,Object(s.default)(o)){var u=e.getPickRay(l,ms);t=o.pickWorldCoordinates(u,r,!0,ps)}if(r.pickPositionSupported&&(a=r.pickPositionWorldCoordinates(l,_s)),Object(s.default)(t)||Object(s.default)(a)){var d=Object(s.default)(a)?n.default.distance(a,e.positionWC):Number.POSITIVE_INFINITY,c=Object(s.default)(t)?n.default.distance(t,e.positionWC):Number.POSITIVE_INFINITY;i=Math.min(d,c)}else i=Math.max(e.positionCartographic.height,0);return i}Xo.prototype._adjustOrthographicFrustum=function(e){this.frustum instanceof te.a&&(!e&&this._positionCartographic.height<15e4||(this.frustum.width=gs(this)))};var vs=new n.default,ys=new $.default,bs=new $.default,ws=new xi.default,Cs=new Oi.default,Os=new y.default;var xs=new n.default,Ts=new n.default,Es=new n.default;function As(e,t,a,i){var r=n.default.clone(a.direction,xs),o=n.default.clone(a.up,Ts);if(e._scene.mode===V.a.SCENE3D){var s=e._projection.ellipsoid,l=qn.default.eastNorthUpToFixedFrame(t,s,ls),u=$.default.inverseTransformation(l,us);$.default.multiplyByPointAsVector(u,r,r),$.default.multiplyByPointAsVector(u,o,o)}var d=n.default.cross(r,o,Es);return i.heading=rs(r,o),i.pitch=os(r),i.roll=ss(r,o,d),i}var Ps={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},Ss=new Go.default;Xo.prototype.setView=function(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.orientation,o.default.EMPTY_OBJECT),a=this._mode;if(a!==V.a.MORPHING){Object(s.default)(e.endTransform)&&this._setTransform(e.endTransform);var i=Object(o.default)(e.convert,!0),r=Object(o.default)(e.destination,n.default.clone(this.positionWC,vs));Object(s.default)(r)&&Object(s.default)(r.west)&&(r=this.getRectangleCameraCoordinates(r,vs),i=!1),Object(s.default)(t.direction)&&(t=As(this,r,t,Ps.orientation)),Ss.heading=Object(o.default)(t.heading,0),Ss.pitch=Object(o.default)(t.pitch,-J.default.PI_OVER_TWO),Ss.roll=Object(o.default)(t.roll,0),a===V.a.SCENE3D?function(e,t,a){var i=$.default.clone(e.transform,ys),r=qn.default.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,bs);e._setTransform(r),n.default.clone(n.default.ZERO,e.position),a.heading=a.heading-J.default.PI_OVER_TWO;var o=xi.default.fromHeadingPitchRoll(a,ws),s=Oi.default.fromQuaternion(o,Cs);Oi.default.getColumn(s,0,e.direction),Oi.default.getColumn(s,2,e.up),n.default.cross(e.direction,e.up,e.right),e._setTransform(i),e._adjustOrthographicFrustum(!0)}(this,r,Ss):a===V.a.SCENE2D?function(e,t,a,i){var r=$.default.clone(e.transform,ys);if(e._setTransform($.default.IDENTITY),!n.default.equals(t,e.positionWC)){if(i){var o=e._projection,s=o.ellipsoid.cartesianToCartographic(t,Os);t=o.project(s,vs)}k.default.clone(t,e.position);var l=.5*-t.z,u=-l,d=e.frustum;if(u>l){var c=d.top/d.right;d.right=u,d.left=l,d.top=d.right*c,d.bottom=-d.top}}if(e._scene.mapMode2D===Yo.ROTATE){a.heading=a.heading-J.default.PI_OVER_TWO,a.pitch=-J.default.PI_OVER_TWO,a.roll=0;var f=xi.default.fromHeadingPitchRoll(a,ws),h=Oi.default.fromQuaternion(f,Cs);Oi.default.getColumn(h,2,e.up),n.default.cross(e.direction,e.up,e.right)}e._setTransform(r)}(this,r,Ss,i):function(e,t,a,i){var r=$.default.clone(e.transform,ys);if(e._setTransform($.default.IDENTITY),!n.default.equals(t,e.positionWC)){if(i){var o=e._projection,s=o.ellipsoid.cartesianToCartographic(t,Os);t=o.project(s,vs)}n.default.clone(t,e.position)}a.heading=a.heading-J.default.PI_OVER_TWO;var l=xi.default.fromHeadingPitchRoll(a,ws),u=Oi.default.fromQuaternion(l,Cs);Oi.default.getColumn(u,0,e.direction),Oi.default.getColumn(u,2,e.up),n.default.cross(e.direction,e.up,e.right),e._setTransform(r),e._adjustOrthographicFrustum(!0)}(this,r,Ss,i)}};var Ds=new n.default;function Fs(e,t){var a,i,n=e._scene.mapMode2D===Yo.ROTATE,r=e._maxCoord.x,o=e._maxCoord.y;n?a=-(i=r):(i=t.x-2*r,a=t.x+2*r),t.x>r&&(t.x=i),t.x<-r&&(t.x=a),t.y>o&&(t.y=o),t.y<-o&&(t.y=-o)}Xo.prototype.flyHome=function(e){var t=this._mode;if(t===V.a.MORPHING&&this._scene.completeMorph(),t===V.a.SCENE2D)this.flyTo({destination:Xo.DEFAULT_VIEW_RECTANGLE,duration:e,endTransform:$.default.IDENTITY});else if(t===V.a.SCENE3D){var a=this.getRectangleCameraCoordinates(Xo.DEFAULT_VIEW_RECTANGLE),i=n.default.magnitude(a);i+=i*Xo.DEFAULT_VIEW_FACTOR,n.default.normalize(a,a),n.default.multiplyByScalar(a,i,a),this.flyTo({destination:a,duration:e,endTransform:$.default.IDENTITY})}else if(t===V.a.COLUMBUS_VIEW){var r=this._projection.ellipsoid.maximumRadius,o=new n.default(0,-1,1);o=n.default.multiplyByScalar(n.default.normalize(o,o),5*r,o),this.flyTo({destination:o,duration:e,orientation:{heading:0,pitch:-Math.acos(n.default.normalize(o,Ds).z),roll:0},endTransform:$.default.IDENTITY,convert:!1})}},Xo.prototype.worldToCameraCoordinates=function(e,t){return Object(s.default)(t)||(t=new G.a),ns(this),$.default.multiplyByVector(this._actualInvTransform,e,t)},Xo.prototype.worldToCameraCoordinatesPoint=function(e,t){return Object(s.default)(t)||(t=new n.default),ns(this),$.default.multiplyByPoint(this._actualInvTransform,e,t)},Xo.prototype.worldToCameraCoordinatesVector=function(e,t){return Object(s.default)(t)||(t=new n.default),ns(this),$.default.multiplyByPointAsVector(this._actualInvTransform,e,t)},Xo.prototype.cameraToWorldCoordinates=function(e,t){return Object(s.default)(t)||(t=new G.a),ns(this),$.default.multiplyByVector(this._actualTransform,e,t)},Xo.prototype.cameraToWorldCoordinatesPoint=function(e,t){return Object(s.default)(t)||(t=new n.default),ns(this),$.default.multiplyByPoint(this._actualTransform,e,t)},Xo.prototype.cameraToWorldCoordinatesVector=function(e,t){return Object(s.default)(t)||(t=new n.default),ns(this),$.default.multiplyByPointAsVector(this._actualTransform,e,t)};var Ms=new n.default;Xo.prototype.move=function(e,t){var a=this.position;n.default.multiplyByScalar(e,t,Ms),n.default.add(a,Ms,a),this._mode===V.a.SCENE2D&&Fs(this,a),this._adjustOrthographicFrustum(!0)},Xo.prototype.moveForward=function(e){e=Object(o.default)(e,this.defaultMoveAmount),this._mode===V.a.SCENE2D?ks(this,e):this.move(this.direction,e)},Xo.prototype.moveBackward=function(e){e=Object(o.default)(e,this.defaultMoveAmount),this._mode===V.a.SCENE2D?ks(this,-e):this.move(this.direction,-e)},Xo.prototype.moveUp=function(e){e=Object(o.default)(e,this.defaultMoveAmount),this.move(this.up,e)},Xo.prototype.moveDown=function(e){e=Object(o.default)(e,this.defaultMoveAmount),this.move(this.up,-e)},Xo.prototype.moveRight=function(e){e=Object(o.default)(e,this.defaultMoveAmount),this.move(this.right,e)},Xo.prototype.moveLeft=function(e){e=Object(o.default)(e,this.defaultMoveAmount),this.move(this.right,-e)},Xo.prototype.lookLeft=function(e){e=Object(o.default)(e,this.defaultLookAmount),this._mode!==V.a.SCENE2D&&this.look(this.up,-e)},Xo.prototype.lookRight=function(e){e=Object(o.default)(e,this.defaultLookAmount),this._mode!==V.a.SCENE2D&&this.look(this.up,e)},Xo.prototype.lookUp=function(e){e=Object(o.default)(e,this.defaultLookAmount),this._mode!==V.a.SCENE2D&&this.look(this.right,-e)},Xo.prototype.lookDown=function(e){e=Object(o.default)(e,this.defaultLookAmount),this._mode!==V.a.SCENE2D&&this.look(this.right,e)};var Is=new xi.default,Rs=new Oi.default;Xo.prototype.look=function(e,t){var a=Object(o.default)(t,this.defaultLookAmount),i=xi.default.fromAxisAngle(e,-a,Is),n=Oi.default.fromQuaternion(i,Rs),r=this.direction,s=this.up,l=this.right;Oi.default.multiplyByVector(n,r,r),Oi.default.multiplyByVector(n,s,s),Oi.default.multiplyByVector(n,l,l)},Xo.prototype.twistLeft=function(e){e=Object(o.default)(e,this.defaultLookAmount),this.look(this.direction,e)},Xo.prototype.twistRight=function(e){e=Object(o.default)(e,this.defaultLookAmount),this.look(this.direction,-e)};var Ns=new xi.default,Ls=new Oi.default;Xo.prototype.rotate=function(e,t){var a=Object(o.default)(t,this.defaultRotateAmount),i=xi.default.fromAxisAngle(e,-a,Ns),r=Oi.default.fromQuaternion(i,Ls);Oi.default.multiplyByVector(r,this.position,this.position),Oi.default.multiplyByVector(r,this.direction,this.direction),Oi.default.multiplyByVector(r,this.up,this.up),n.default.cross(this.direction,this.up,this.right),n.default.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},Xo.prototype.rotateDown=function(e){zs(this,e=Object(o.default)(e,this.defaultRotateAmount))},Xo.prototype.rotateUp=function(e){zs(this,-(e=Object(o.default)(e,this.defaultRotateAmount)))};var js=new n.default,Vs=new n.default,Us=new n.default,Bs=new n.default;function zs(e,t){var a=e.position;if(Object(s.default)(e.constrainedAxis)&&!n.default.equalsEpsilon(e.position,n.default.ZERO,J.default.EPSILON2)){var i=n.default.normalize(a,js),r=n.default.equalsEpsilon(i,e.constrainedAxis,J.default.EPSILON2),o=n.default.equalsEpsilon(i,n.default.negate(e.constrainedAxis,Bs),J.default.EPSILON2);if(r||o)(r&&t<0||o&&t>0)&&e.rotate(e.right,t);else{var l=n.default.normalize(e.constrainedAxis,Vs),u=n.default.dot(i,l),d=J.default.acosClamped(u);t>0&&t>d&&(t=d-J.default.EPSILON4),u=n.default.dot(i,n.default.negate(l,Bs)),d=J.default.acosClamped(u),t<0&&-t>d&&(t=-d+J.default.EPSILON4);var c=n.default.cross(l,i,Us);e.rotate(c,t)}}else e.rotate(e.right,t)}function Hs(e,t){Object(s.default)(e.constrainedAxis)?e.rotate(e.constrainedAxis,t):e.rotate(e.up,t)}function ks(e,t){var a,i=e.frustum;if(t*=.5,Math.abs(i.top)+Math.abs(i.bottom)>Math.abs(i.left)+Math.abs(i.right)){var n=i.top-t,r=i.bottom+t,o=e._maxCoord.y;e._scene.mapMode2D===Yo.ROTATE&&(o*=e.maximumZoomFactor),r>o&&(r=o,n=-o),n<=r&&(n=1,r=-1),a=i.right/i.top,i.top=n,i.bottom=r,i.right=i.top*a,i.left=-i.right}else{var s=i.right-t,l=i.left+t,u=e._maxCoord.x;e._scene.mapMode2D===Yo.ROTATE&&(u*=e.maximumZoomFactor),s>u&&(s=u,l=-u),s<=l&&(s=1,l=-1),a=i.top/i.right,i.right=s,i.left=l,i.top=i.right*a,i.bottom=-i.top}}function Gs(e,t){e.move(e.direction,t)}Xo.prototype.rotateRight=function(e){Hs(this,-(e=Object(o.default)(e,this.defaultRotateAmount)))},Xo.prototype.rotateLeft=function(e){Hs(this,e=Object(o.default)(e,this.defaultRotateAmount))},Xo.prototype.zoomIn=function(e){e=Object(o.default)(e,this.defaultZoomAmount),this._mode===V.a.SCENE2D?ks(this,e):Gs(this,e)},Xo.prototype.zoomOut=function(e){e=Object(o.default)(e,this.defaultZoomAmount),this._mode===V.a.SCENE2D?ks(this,-e):Gs(this,-e)},Xo.prototype.getMagnitude=function(){return this._mode===V.a.SCENE3D?n.default.magnitude(this.position):this._mode===V.a.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===V.a.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var Ws=new $.default;Xo.prototype.lookAt=function(e,t){var a=qn.default.eastNorthUpToFixedFrame(e,d.default.WGS84,Ws);this.lookAtTransform(a,t)};var Ys=new n.default,Xs=new xi.default,Qs=new xi.default,qs=new Oi.default;function Zs(e,t,a){t=J.default.clamp(t,-J.default.PI_OVER_TWO,J.default.PI_OVER_TWO),e=J.default.zeroToTwoPi(e)-J.default.PI_OVER_TWO;var i=xi.default.fromAxisAngle(n.default.UNIT_Y,-t,Xs),r=xi.default.fromAxisAngle(n.default.UNIT_Z,-e,Qs),o=xi.default.multiply(r,i,r),s=Oi.default.fromQuaternion(o,qs),l=n.default.clone(n.default.UNIT_X,Ys);return Oi.default.multiplyByVector(s,l,l),n.default.negate(l,l),n.default.multiplyByScalar(l,a,l),l}Xo.prototype.lookAtTransform=function(e,t){if(this._setTransform(e),Object(s.default)(t)){var a;if(a=Object(s.default)(t.heading)?Zs(t.heading,t.pitch,t.range):t,this._mode===V.a.SCENE2D){k.default.clone(k.default.ZERO,this.position),n.default.negate(a,this.up),this.up.z=0,n.default.magnitudeSquared(this.up)<J.default.EPSILON10&&n.default.clone(n.default.UNIT_Y,this.up),n.default.normalize(this.up,this.up),this._setTransform($.default.IDENTITY),n.default.negate(n.default.UNIT_Z,this.direction),n.default.cross(this.direction,this.up,this.right),n.default.normalize(this.right,this.right);var i=this.frustum,r=i.top/i.right;return i.right=.5*n.default.magnitude(a),i.left=-i.right,i.top=r*i.right,i.bottom=-i.top,void this._setTransform(e)}n.default.clone(a,this.position),n.default.negate(this.position,this.direction),n.default.normalize(this.direction,this.direction),n.default.cross(this.direction,n.default.UNIT_Z,this.right),n.default.magnitudeSquared(this.right)<J.default.EPSILON10&&n.default.clone(n.default.UNIT_X,this.right),n.default.normalize(this.right,this.right),n.default.cross(this.right,this.direction,this.up),n.default.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var Ks,Js=new y.default,$s=new y.default,el=new n.default,tl=new n.default,al=new n.default,il=new n.default,nl=new n.default,rl=new n.default,ol=new n.default,sl=new n.default,ll={direction:new n.default,right:new n.default,up:new n.default};function ul(e,t,a,i){return Math.abs(n.default.dot(t,a))/i-n.default.dot(e,a)}function dl(e,t,a,i){var r=e._projection.ellipsoid,o=i?e:ll,l=t.north,u=t.south,d=t.east,c=t.west;c>d&&(d+=J.default.TWO_PI);var f,h=.5*(c+d);if(u<-J.default.PI_OVER_TWO+J.default.RADIANS_PER_DEGREE&&l>J.default.PI_OVER_TWO-J.default.RADIANS_PER_DEGREE)f=0;else{var m=Js;m.longitude=h,m.latitude=l,m.height=0;var p=$s;p.longitude=h,p.latitude=u,p.height=0;var _=Ks;Object(s.default)(_)&&_.ellipsoid===r||(Ks=_=new Ho.default(void 0,void 0,r)),_.setEndPoints(m,p),f=_.interpolateUsingFraction(.5,Js).latitude}var g=Js;g.longitude=h,g.latitude=f,g.height=0;var v=r.cartographicToCartesian(g,ol),y=Js;y.longitude=d,y.latitude=l;var b=r.cartographicToCartesian(y,el);y.longitude=c;var w=r.cartographicToCartesian(y,al);y.longitude=h;var C=r.cartographicToCartesian(y,nl);y.latitude=u;var O=r.cartographicToCartesian(y,rl);y.longitude=d;var x=r.cartographicToCartesian(y,il);y.longitude=c;var T=r.cartographicToCartesian(y,tl);n.default.subtract(w,v,w),n.default.subtract(x,v,x),n.default.subtract(b,v,b),n.default.subtract(T,v,T),n.default.subtract(C,v,C),n.default.subtract(O,v,O);var E=r.geodeticSurfaceNormal(v,o.direction);n.default.negate(E,E);var A=n.default.cross(E,n.default.UNIT_Z,o.right);n.default.normalize(A,A);var P,S=n.default.cross(A,E,o.up);if(e.frustum instanceof te.a){var D,F,M=Math.max(n.default.distance(b,w),n.default.distance(x,T)),I=Math.max(n.default.distance(b,x),n.default.distance(w,T)),R=e.frustum._offCenterFrustum.right/e.frustum._offCenterFrustum.top,N=I*R;M>N?F=(D=M)/R:(F=I,D=N),P=Math.max(D,F)}else{var L=Math.tan(.5*e.frustum.fovy),j=e.frustum.aspectRatio*L;if(P=Math.max(ul(E,S,w,L),ul(E,S,x,L),ul(E,S,b,L),ul(E,S,T,L),ul(E,S,C,L),ul(E,S,O,L),ul(E,A,w,j),ul(E,A,x,j),ul(E,A,b,j),ul(E,A,T,j),ul(E,A,C,j),ul(E,A,O,j)),u<0&&l>0){var V=Js;V.longitude=c,V.latitude=0,V.height=0;var U=r.cartographicToCartesian(V,sl);n.default.subtract(U,v,U),P=Math.max(P,ul(E,S,U,L),ul(E,A,U,j)),V.longitude=d,U=r.cartographicToCartesian(V,sl),n.default.subtract(U,v,U),P=Math.max(P,ul(E,S,U,L),ul(E,A,U,j))}}return n.default.add(v,n.default.multiplyByScalar(E,-P,sl),a)}var cl=new y.default,fl=new n.default,hl=new n.default;var ml=new y.default,pl=new n.default,_l=new n.default;Xo.prototype.getRectangleCameraCoordinates=function(e,t){var a=this._mode;return Object(s.default)(t)||(t=new n.default),a===V.a.SCENE3D?dl(this,e,t):a===V.a.COLUMBUS_VIEW?function(e,t,a){var i=e._projection;t.west>t.east&&(t=A.default.MAX_VALUE);var n=e._actualTransform,r=e._actualInvTransform,o=cl;o.longitude=t.east,o.latitude=t.north;var l=i.project(o,fl);$.default.multiplyByPoint(n,l,l),$.default.multiplyByPoint(r,l,l),o.longitude=t.west,o.latitude=t.south;var u=i.project(o,hl);if($.default.multiplyByPoint(n,u,u),$.default.multiplyByPoint(r,u,u),a.x=.5*(l.x-u.x)+u.x,a.y=.5*(l.y-u.y)+u.y,Object(s.default)(e.frustum.fovy)){var d=Math.tan(.5*e.frustum.fovy),c=e.frustum.aspectRatio*d;a.z=.5*Math.max((l.x-u.x)/c,(l.y-u.y)/d)}else{var f=l.x-u.x,h=l.y-u.y;a.z=Math.max(f,h)}return a}(this,e,t):a===V.a.SCENE2D?function(e,t,a){var i=e._projection,n=t.east;t.west>t.east&&(e._scene.mapMode2D===Yo.INFINITE_SCROLL?n+=J.default.TWO_PI:n=(t=A.default.MAX_VALUE).east);var r=ml;r.longitude=n,r.latitude=t.north;var o=i.project(r,pl);r.longitude=t.west,r.latitude=t.south;var s,l,u=i.project(r,_l),d=.5*Math.abs(o.x-u.x),c=.5*Math.abs(o.y-u.y),f=e.frustum.right/e.frustum.top,h=c*f;return d>h?l=(s=d)/f:(l=c,s=h),c=Math.max(2*s,2*l),a.x=.5*(o.x-u.x)+u.x,a.y=.5*(o.y-u.y)+u.y,(r=i.unproject(a,r)).height=c,a=i.project(r,a)}(this,e,t):void 0};var gl=new E.default;var vl=new E.default;var yl=new E.default;Xo.prototype.pickEllipsoid=function(e,t,a){var i=this._scene.canvas;if(0!==i.clientWidth&&0!==i.clientHeight){if(Object(s.default)(a)||(a=new n.default),t=Object(o.default)(t,d.default.WGS84),this._mode===V.a.SCENE3D)a=function(e,t,a,i){a=Object(o.default)(a,d.default.WGS84);var n=e.getPickRay(t,gl),r=x.default.rayEllipsoid(n,a);if(r){var s=r.start>0?r.start:r.stop;return E.default.getPoint(n,s,i)}}(this,e,t,a);else if(this._mode===V.a.SCENE2D)a=function(e,t,a,i){var r=e.getPickRay(t,vl).origin;r=n.default.fromElements(r.y,r.z,0,r);var o=a.unproject(r);if(!(o.latitude<-J.default.PI_OVER_TWO||o.latitude>J.default.PI_OVER_TWO))return a.ellipsoid.cartographicToCartesian(o,i)}(this,e,this._projection,a);else{if(this._mode!==V.a.COLUMBUS_VIEW)return;a=function(e,t,a,i){var r=e.getPickRay(t,yl),o=-r.origin.x/r.direction.x;E.default.getPoint(r,o,i);var s=a.unproject(new n.default(i.y,i.z,0));if(!(s.latitude<-J.default.PI_OVER_TWO||s.latitude>J.default.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return a.ellipsoid.cartographicToCartesian(s,i)}(this,e,this._projection,a)}return a}};var bl=new n.default,wl=new n.default,Cl=new n.default;var Ol=new n.default;Xo.prototype.getPickRay=function(e,t){Object(s.default)(t)||(t=new E.default);var a=this.frustum;return Object(s.default)(a.aspectRatio)&&Object(s.default)(a.fov)&&Object(s.default)(a.near)?function(e,t,a){var i=e._scene.canvas,r=i.clientWidth,o=i.clientHeight,s=Math.tan(.5*e.frustum.fovy),l=e.frustum.aspectRatio*s,u=e.frustum.near,d=2/r*t.x-1,c=2/o*(o-t.y)-1,f=e.positionWC;n.default.clone(f,a.origin);var h=n.default.multiplyByScalar(e.directionWC,u,bl);n.default.add(f,h,h);var m=n.default.multiplyByScalar(e.rightWC,d*u*l,wl),p=n.default.multiplyByScalar(e.upWC,c*u*s,Cl),_=n.default.add(h,m,a.direction);return n.default.add(_,p,_),n.default.subtract(_,f,_),n.default.normalize(_,_),a}(this,e,t):function(e,t,a){var i=e._scene.canvas,r=i.clientWidth,o=i.clientHeight,l=e.frustum;Object(s.default)(l._offCenterFrustum)&&(l=l._offCenterFrustum);var u=2/r*t.x-1;u*=.5*(l.right-l.left);var d=2/o*(o-t.y)-1;d*=.5*(l.top-l.bottom);var c=a.origin;return n.default.clone(e.position,c),n.default.multiplyByScalar(e.right,u,Ol),n.default.add(Ol,c,c),n.default.multiplyByScalar(e.up,d,Ol),n.default.add(Ol,c,c),n.default.clone(e.directionWC,a.direction),e._mode!==V.a.COLUMBUS_VIEW&&e._mode!==V.a.SCENE2D||n.default.fromElements(a.origin.z,a.origin.x,a.origin.y,a.origin),a}(this,e,t)};var xl=new n.default,Tl=new n.default;Xo.prototype.distanceToBoundingSphere=function(e){var t=n.default.subtract(this.positionWC,e.center,xl),a=n.default.multiplyByScalar(this.directionWC,n.default.dot(t,this.directionWC),Tl);return Math.max(0,n.default.magnitude(a)-e.radius)};var El=new k.default;Xo.prototype.getPixelSize=function(e,t,a){var i=this.distanceToBoundingSphere(e),n=this.frustum.getPixelDimensions(t,a,i,this._scene.pixelRatio,El);return Math.max(n.x,n.y)};var Al=new n.default,Pl=new n.default,Sl=new n.default,Dl=new n.default;function Fl(e,t){var a=e.position,i=e.direction,r=e.worldToCameraCoordinatesVector(n.default.UNIT_X,Al),o=-n.default.dot(r,a)/n.default.dot(r,i),s=n.default.add(a,n.default.multiplyByScalar(i,o,Pl),Pl);e.cameraToWorldCoordinatesPoint(s,s),a=e.cameraToWorldCoordinatesPoint(e.position,Sl);var l=Math.tan(.5*e.frustum.fovy),u=e.frustum.aspectRatio*l,d=n.default.magnitude(n.default.subtract(a,s,Dl)),c=u*d,f=l*d,h=e._maxCoord.x,m=e._maxCoord.y,p=Math.max(c-h,h),_=Math.max(f-m,m);if(a.z<-p||a.z>p||a.y<-_||a.y>_){var g=s.y<-p||s.y>p,v=s.z<-_||s.z>_;if(g||v)return function(e,t,a,i,r,o){var s=n.default.clone(t);return a.y>i?s.y-=a.y-i:a.y<-i&&(s.y+=-i-a.y),a.z>r?s.z-=a.z-r:a.z<-r&&(s.z+=-r-a.z),{easingFunction:zo.default.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:o,update:function(a){var i=n.default.lerp(t,s,a.time,new n.default);e.worldToCameraCoordinatesPoint(i,e.position)}}}(e,a,s,p,_,t)}}Xo.prototype.createCorrectPositionTween=function(e){if(this._mode===V.a.COLUMBUS_VIEW)return Fl(this,e)};var Ml=new n.default,Il={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};Xo.prototype.cancelFlight=function(){Object(s.default)(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},Xo.prototype.completeFlight=function(){if(Object(s.default)(this._currentFlight)){this._currentFlight.cancelTween();var e={destination:void 0,orientation:{heading:void 0,pitch:void 0,roll:void 0}};e.destination=Il.destination,e.orientation.heading=Il.heading,e.orientation.pitch=Il.pitch,e.orientation.roll=Il.roll,this.setView(e),Object(s.default)(this._currentFlight.complete)&&this._currentFlight.complete(),this._currentFlight=void 0}},Xo.prototype.flyTo=function(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).destination;if(this._mode!==V.a.MORPHING){this.cancelFlight();var a=Object(o.default)(e.orientation,o.default.EMPTY_OBJECT);if(Object(s.default)(a.direction)&&(a=As(this,t,a,Ps.orientation)),Object(s.default)(e.duration)&&e.duration<=0){var i=Ps;return i.destination=e.destination,i.orientation.heading=a.heading,i.orientation.pitch=a.pitch,i.orientation.roll=a.roll,i.convert=e.convert,i.endTransform=e.endTransform,this.setView(i),void("function"==typeof e.complete&&e.complete())}var n=Object(s.default)(t.west);n&&(t=this.getRectangleCameraCoordinates(t,Ml));var r,l=this;Il.destination=t,Il.heading=a.heading,Il.pitch=a.pitch,Il.roll=a.roll,Il.duration=e.duration,Il.complete=function(){r===l._currentFlight&&(l._currentFlight=void 0),Object(s.default)(e.complete)&&e.complete()},Il.cancel=e.cancel,Il.endTransform=e.endTransform,Il.convert=!n&&e.convert,Il.maximumHeight=e.maximumHeight,Il.pitchAdjustHeight=e.pitchAdjustHeight,Il.flyOverLongitude=e.flyOverLongitude,Il.flyOverLongitudeWeight=e.flyOverLongitudeWeight,Il.easingFunction=e.easingFunction;var u=this._scene,d=Wo.default.createTween(u,Il);if(0!==d.duration){r=u.tweens.add(d),this._currentFlight=r;var c=this._scene.preloadFlightCamera;this._mode!==V.a.SCENE2D&&(Object(s.default)(c)||(c=Xo.clone(this)),c.setView({destination:t,orientation:a}),this._scene.preloadFlightCullingVolume=c.frustum.computeCullingVolume(c.positionWC,c.directionWC,c.upWC))}else"function"==typeof d.complete&&d.complete()}};var Rl=100;function Nl(e,t,a){a=ko.default.clone(Object(s.default)(a)?a:Xo.DEFAULT_OFFSET);var i=e._scene.screenSpaceCameraController.minimumZoomDistance,n=e._scene.screenSpaceCameraController.maximumZoomDistance,r=a.range;if(!Object(s.default)(r)||0===r){var o=t.radius;0===o?a.range=Rl:e.frustum instanceof te.a||e._mode===V.a.SCENE2D?a.range=function(e,t){var a,i,n=e.frustum;Object(s.default)(n._offCenterFrustum)&&(n=n._offCenterFrustum);var r=n.right/n.top,o=t*r;return t>o?i=(a=t)/r:(i=t,a=o),1.5*Math.max(a,i)}(e,o):a.range=function(e,t){var a=e.frustum,i=Math.tan(.5*a.fovy),n=a.aspectRatio*i;return Math.max(t/n,t/i)}(e,o),a.range=J.default.clamp(a.range,i,n)}return a}Xo.prototype.viewBoundingSphere=function(e,t){t=Nl(this,e,t),this.lookAt(e.center,t)};var Ll=new $.default,jl=new n.default,Vl=new n.default,Ul=new n.default,Bl=new n.default,zl=new G.a,Hl=new xi.default,kl=new Oi.default;Xo.prototype.flyToBoundingSphere=function(e,t){t=Object(o.default)(t,o.default.EMPTY_OBJECT);var a=this._mode===V.a.SCENE2D||this._mode===V.a.COLUMBUS_VIEW;this._setTransform($.default.IDENTITY);var i,r=Nl(this,e,t.offset);i=a?n.default.multiplyByScalar(n.default.UNIT_Z,r.range,jl):Zs(r.heading,r.pitch,r.range);var s,l,u=qn.default.eastNorthUpToFixedFrame(e.center,d.default.WGS84,Ll);if($.default.multiplyByPoint(u,i,i),!a){if(s=n.default.subtract(e.center,i,Vl),n.default.normalize(s,s),l=$.default.multiplyByPointAsVector(u,n.default.UNIT_Z,Ul),1-Math.abs(n.default.dot(s,l))<J.default.EPSILON6){var c=xi.default.fromAxisAngle(s,r.heading,Hl),f=Oi.default.fromQuaternion(c,kl);n.default.fromCartesian4($.default.getColumn(u,1,zl),l),Oi.default.multiplyByVector(f,l,l)}var h=n.default.cross(s,l,Bl);n.default.cross(h,s,l),n.default.normalize(l,l)}this.flyTo({destination:i,orientation:{direction:s,up:l},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};var Gl=new n.default,Wl=new n.default,Yl=new n.default,Xl=new n.default,Ql=[new n.default,new n.default,new n.default,new n.default];var ql=new k.default,Zl=new n.default,Kl=[new y.default,new y.default,new y.default,new y.default];function Jl(e,t,a,i,n,r){ql.x=e,ql.y=t;var o=i.pickEllipsoid(ql,n,Zl);return Object(s.default)(o)?(Kl[a]=n.cartesianToCartographic(o,Kl[a]),1):(Kl[a]=n.cartesianToCartographic(r[a],Kl[a]),0)}Xo.prototype.computeViewRectangle=function(e,t){e=Object(o.default)(e,d.default.WGS84);var a=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),i=new v.default(n.default.ZERO,e.maximumRadius);if(a.computeVisibility(i)!==K.default.OUTSIDE){var r=this._scene.canvas,s=r.clientWidth,l=r.clientHeight,u=0,c=function(e,t){var a,i,r=t.radii,o=e.positionWC,s=n.default.multiplyComponents(t.oneOverRadii,o,Gl),l=n.default.magnitude(s),u=n.default.normalize(s,Wl);n.default.equalsEpsilon(u,n.default.UNIT_Z,J.default.EPSILON10)?(a=new n.default(0,1,0),i=new n.default(0,0,1)):(a=n.default.normalize(n.default.cross(n.default.UNIT_Z,u,Yl),Yl),i=n.default.normalize(n.default.cross(u,a,Xl),Xl));var d=Math.sqrt(n.default.magnitudeSquared(s)-1),c=n.default.multiplyByScalar(u,1/l,Gl),f=d/l,h=n.default.multiplyByScalar(a,f,Wl),m=n.default.multiplyByScalar(i,f,Yl),p=n.default.add(c,m,Ql[0]);n.default.subtract(p,h,p),n.default.multiplyComponents(r,p,p);var _=n.default.subtract(c,m,Ql[1]);n.default.subtract(_,h,_),n.default.multiplyComponents(r,_,_);var g=n.default.subtract(c,m,Ql[2]);n.default.add(g,h,g),n.default.multiplyComponents(r,g,g);var v=n.default.add(c,m,Ql[3]);return n.default.add(v,h,v),n.default.multiplyComponents(r,v,v),Ql}(this,e);if(u+=Jl(0,0,0,this,e,c),u+=Jl(0,l,1,this,e,c),u+=Jl(s,l,2,this,e,c),(u+=Jl(s,0,3,this,e,c))<2)return A.default.MAX_VALUE;t=A.default.fromCartographicArray(Kl,t);for(var f=0,h=Kl[3].longitude,m=0;m<4;++m){var p=Kl[m].longitude,_=Math.abs(p-h);_>J.default.PI?f+=J.default.TWO_PI-_:f+=_,h=p}return J.default.equalsEpsilon(Math.abs(f),J.default.TWO_PI,J.default.EPSILON9)&&(t.west=-J.default.PI,t.east=J.default.PI,Kl[0].latitude>=0?t.north=J.default.PI_OVER_TWO:t.south=-J.default.PI_OVER_TWO),t}},Xo.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===V.a.SCENE2D||this.frustum instanceof Lr.a)){var e=this._scene;this.frustum=new Lr.a,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=J.default.toRadians(60)}},Xo.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===V.a.SCENE2D||this.frustum instanceof te.a)){var e=gs(this),t=this._scene;this.frustum=new te.a,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=e}},Xo.clone=function(e,t){return Object(s.default)(t)||(t=new Xo(e._scene)),n.default.clone(e.position,t.position),n.default.clone(e.direction,t.direction),n.default.clone(e.up,t.up),n.default.clone(e.right,t.right),$.default.clone(e._transform,t.transform),t._transformChanged=!0,t.frustum=e.frustum.clone(),t};var $l=Xo,eu=a(373);var tu=function(e){this.pass=e.pass,this.commandList=e.commandList,this.camera=e.camera,this.cullingVolume=e.cullingVolume,this.ready=!1},au=a(730),iu=a(64),nu=0,ru=1;function ou(e){var t,a,i=e.frustum,r=e.orientation,s=e.origin,l=Object(o.default)(e.vertexFormat,Kn.default.DEFAULT),u=Object(o.default)(e._drawNearPlane,!0);i instanceof Lr.a?(t=nu,a=Lr.a.packedLength):i instanceof te.a&&(t=ru,a=te.a.packedLength),this._frustumType=t,this._frustum=i.clone(),this._origin=n.default.clone(s),this._orientation=xi.default.clone(r),this._drawNearPlane=u,this._vertexFormat=l,this._workerName="createFrustumGeometry",this.packedLength=2+a+n.default.packedLength+xi.default.packedLength+Kn.default.packedLength}ou.pack=function(e,t,a){a=Object(o.default)(a,0);var i=e._frustumType,r=e._frustum;return t[a++]=i,i===nu?(Lr.a.pack(r,t,a),a+=Lr.a.packedLength):(te.a.pack(r,t,a),a+=te.a.packedLength),n.default.pack(e._origin,t,a),a+=n.default.packedLength,xi.default.pack(e._orientation,t,a),a+=xi.default.packedLength,Kn.default.pack(e._vertexFormat,t,a),t[a+=Kn.default.packedLength]=e._drawNearPlane?1:0,t};var su=new Lr.a,lu=new te.a,uu=new xi.default,du=new n.default,cu=new Kn.default;function fu(e,t,a,i,n,r,o,l){for(var u=e/3*2,d=0;d<4;++d)Object(s.default)(t)&&(t[e]=r.x,t[e+1]=r.y,t[e+2]=r.z),Object(s.default)(a)&&(a[e]=o.x,a[e+1]=o.y,a[e+2]=o.z),Object(s.default)(i)&&(i[e]=l.x,i[e+1]=l.y,i[e+2]=l.z),e+=3;n[u]=0,n[u+1]=0,n[u+2]=1,n[u+3]=0,n[u+4]=1,n[u+5]=1,n[u+6]=0,n[u+7]=1}ou.unpack=function(e,t,a){t=Object(o.default)(t,0);var i,r=e[t++];r===nu?(i=Lr.a.unpack(e,t,su),t+=Lr.a.packedLength):(i=te.a.unpack(e,t,lu),t+=te.a.packedLength);var l=n.default.unpack(e,t,du);t+=n.default.packedLength;var u=xi.default.unpack(e,t,uu);t+=xi.default.packedLength;var d=Kn.default.unpack(e,t,cu),c=1===e[t+=Kn.default.packedLength];if(!Object(s.default)(a))return new ou({frustum:i,origin:l,orientation:u,vertexFormat:d,_drawNearPlane:c});var f=r===a._frustumType?a._frustum:void 0;return a._frustum=i.clone(f),a._frustumType=r,a._origin=n.default.clone(l,a._origin),a._orientation=xi.default.clone(u,a._orientation),a._vertexFormat=Kn.default.clone(d,a._vertexFormat),a._drawNearPlane=c,a};var hu=new Oi.default,mu=new $.default,pu=new $.default,_u=new n.default,gu=new n.default,vu=new n.default,yu=new n.default,bu=new n.default,wu=new n.default,Cu=new Array(3),Ou=new Array(4);Ou[0]=new G.a(-1,-1,1,1),Ou[1]=new G.a(1,-1,1,1),Ou[2]=new G.a(1,1,1,1),Ou[3]=new G.a(-1,1,1,1);for(var xu=new Array(4),Tu=0;Tu<4;++Tu)xu[Tu]=new G.a;ou._computeNearFarPlanes=function(e,t,a,i,r,l,u,d){var c=Oi.default.fromQuaternion(t,hu),f=Object(o.default)(l,_u),h=Object(o.default)(u,gu),m=Object(o.default)(d,vu);f=Oi.default.getColumn(c,0,f),h=Oi.default.getColumn(c,1,h),m=Oi.default.getColumn(c,2,m),n.default.normalize(f,f),n.default.normalize(h,h),n.default.normalize(m,m),n.default.negate(f,f);var p,_,g=$.default.computeView(e,m,h,f,mu);if(a===nu){var v=i.projectionMatrix,y=$.default.multiply(v,g,pu);_=$.default.inverse(y,pu)}else p=$.default.inverseTransformation(g,pu);Object(s.default)(_)?(Cu[0]=i.near,Cu[1]=i.far):(Cu[0]=0,Cu[1]=i.near,Cu[2]=i.far);for(var b=0;b<2;++b)for(var w=0;w<4;++w){var C=G.a.clone(Ou[w],xu[w]);if(Object(s.default)(_)){var O=1/(C=$.default.multiplyByVector(_,C,C)).w;n.default.multiplyByScalar(C,O,C),n.default.subtract(C,e,C),n.default.normalize(C,C);var x=n.default.dot(m,C);n.default.multiplyByScalar(C,Cu[b]/x,C),n.default.add(C,e,C)}else{Object(s.default)(i._offCenterFrustum)&&(i=i._offCenterFrustum);var T=Cu[b],E=Cu[b+1];C.x=.5*(C.x*(i.right-i.left)+i.left+i.right),C.y=.5*(C.y*(i.top-i.bottom)+i.bottom+i.top),C.z=.5*(C.z*(T-E)-T-E),C.w=1,$.default.multiplyByVector(p,C,C)}r[12*b+3*w]=C.x,r[12*b+3*w+1]=C.y,r[12*b+3*w+2]=C.z}},ou.createGeometry=function(e){var t=e._frustumType,a=e._frustum,i=e._origin,r=e._orientation,o=e._drawNearPlane,l=e._vertexFormat,u=o?6:5,d=new Float64Array(72);ou._computeNearFarPlanes(i,r,t,a,d);var c=24;d[c]=d[12],d[c+1]=d[13],d[c+2]=d[14],d[c+3]=d[0],d[c+4]=d[1],d[c+5]=d[2],d[c+6]=d[9],d[c+7]=d[10],d[c+8]=d[11],d[c+9]=d[21],d[c+10]=d[22],d[c+11]=d[23],d[c+=12]=d[15],d[c+1]=d[16],d[c+2]=d[17],d[c+3]=d[3],d[c+4]=d[4],d[c+5]=d[5],d[c+6]=d[0],d[c+7]=d[1],d[c+8]=d[2],d[c+9]=d[12],d[c+10]=d[13],d[c+11]=d[14],d[c+=12]=d[3],d[c+1]=d[4],d[c+2]=d[5],d[c+3]=d[15],d[c+4]=d[16],d[c+5]=d[17],d[c+6]=d[18],d[c+7]=d[19],d[c+8]=d[20],d[c+9]=d[6],d[c+10]=d[7],d[c+11]=d[8],d[c+=12]=d[6],d[c+1]=d[7],d[c+2]=d[8],d[c+3]=d[18],d[c+4]=d[19],d[c+5]=d[20],d[c+6]=d[21],d[c+7]=d[22],d[c+8]=d[23],d[c+9]=d[9],d[c+10]=d[10],d[c+11]=d[11],o||(d=d.subarray(12));var f=new iu.a({position:new qr.a({componentDatatype:Xr.a.DOUBLE,componentsPerAttribute:3,values:d})});if(Object(s.default)(l.normal)||Object(s.default)(l.tangent)||Object(s.default)(l.bitangent)||Object(s.default)(l.st)){var h=Object(s.default)(l.normal)?new Float32Array(12*u):void 0,m=Object(s.default)(l.tangent)?new Float32Array(12*u):void 0,p=Object(s.default)(l.bitangent)?new Float32Array(12*u):void 0,_=Object(s.default)(l.st)?new Float32Array(8*u):void 0,g=_u,y=gu,b=vu,w=n.default.negate(g,yu),C=n.default.negate(y,bu),O=n.default.negate(b,wu);c=0,o&&(fu(c,h,m,p,_,O,g,y),c+=12),fu(c,h,m,p,_,b,w,y),fu(c+=12,h,m,p,_,w,O,y),fu(c+=12,h,m,p,_,C,O,w),fu(c+=12,h,m,p,_,g,b,y),fu(c+=12,h,m,p,_,y,b,w),Object(s.default)(h)&&(f.normal=new qr.a({componentDatatype:Xr.a.FLOAT,componentsPerAttribute:3,values:h})),Object(s.default)(m)&&(f.tangent=new qr.a({componentDatatype:Xr.a.FLOAT,componentsPerAttribute:3,values:m})),Object(s.default)(p)&&(f.bitangent=new qr.a({componentDatatype:Xr.a.FLOAT,componentsPerAttribute:3,values:p})),Object(s.default)(_)&&(f.st=new qr.a({componentDatatype:Xr.a.FLOAT,componentsPerAttribute:2,values:_}))}for(var x=new Uint16Array(6*u),T=0;T<u;++T){var E=6*T,A=4*T;x[E]=A,x[E+1]=A+1,x[E+2]=A+2,x[E+3]=A,x[E+4]=A+2,x[E+5]=A+3}return new Qr.a({attributes:f,indices:x,primitiveType:ae.a.TRIANGLES,boundingSphere:v.default.fromVertices(d)})};var Eu=ou,Au=0,Pu=1;function Su(e){var t,a,i=e.frustum,r=e.orientation,s=e.origin,l=Object(o.default)(e._drawNearPlane,!0);i instanceof Lr.a?(t=Au,a=Lr.a.packedLength):i instanceof te.a&&(t=Pu,a=te.a.packedLength),this._frustumType=t,this._frustum=i.clone(),this._origin=n.default.clone(s),this._orientation=xi.default.clone(r),this._drawNearPlane=l,this._workerName="createFrustumOutlineGeometry",this.packedLength=2+a+n.default.packedLength+xi.default.packedLength}Su.pack=function(e,t,a){a=Object(o.default)(a,0);var i=e._frustumType,r=e._frustum;return t[a++]=i,i===Au?(Lr.a.pack(r,t,a),a+=Lr.a.packedLength):(te.a.pack(r,t,a),a+=te.a.packedLength),n.default.pack(e._origin,t,a),a+=n.default.packedLength,xi.default.pack(e._orientation,t,a),t[a+=xi.default.packedLength]=e._drawNearPlane?1:0,t};var Du=new Lr.a,Fu=new te.a,Mu=new xi.default,Iu=new n.default;Su.unpack=function(e,t,a){t=Object(o.default)(t,0);var i,r=e[t++];r===Au?(i=Lr.a.unpack(e,t,Du),t+=Lr.a.packedLength):(i=te.a.unpack(e,t,Fu),t+=te.a.packedLength);var l=n.default.unpack(e,t,Iu);t+=n.default.packedLength;var u=xi.default.unpack(e,t,Mu),d=1===e[t+=xi.default.packedLength];if(!Object(s.default)(a))return new Su({frustum:i,origin:l,orientation:u,_drawNearPlane:d});var c=r===a._frustumType?a._frustum:void 0;return a._frustum=i.clone(c),a._frustumType=r,a._origin=n.default.clone(l,a._origin),a._orientation=xi.default.clone(u,a._orientation),a._drawNearPlane=d,a},Su.createGeometry=function(e){var t=e._frustumType,a=e._frustum,i=e._origin,n=e._orientation,r=e._drawNearPlane,o=new Float64Array(24);Eu._computeNearFarPlanes(i,n,t,a,o);for(var s,l,u=new iu.a({position:new qr.a({componentDatatype:Xr.a.DOUBLE,componentsPerAttribute:3,values:o})}),d=r?2:1,c=new Uint16Array(8*(d+1)),f=r?0:1;f<2;++f)l=4*f,c[s=r?8*f:0]=l,c[s+1]=l+1,c[s+2]=l+1,c[s+3]=l+2,c[s+4]=l+2,c[s+5]=l+3,c[s+6]=l+3,c[s+7]=l;for(f=0;f<2;++f)l=4*f,c[s=8*(d+f)]=l,c[s+1]=l+4,c[s+2]=l+1,c[s+3]=l+5,c[s+4]=l+2,c[s+5]=l+6,c[s+6]=l+3,c[s+7]=l+7;return new Qr.a({attributes:u,indices:c,primitiveType:ae.a.LINES,boundingSphere:v.default.fromVertices(o)})};var Ru=Su;function Nu(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this._camera=e.camera,this._frustumSplits=e.frustumSplits,this._color=Object(o.default)(e.color,b.default.CYAN),this._updateOnChange=Object(o.default)(e.updateOnChange,!0),this.show=Object(o.default)(e.show,!0),this.id=e.id,this._id=void 0,this._outlinePrimitives=[],this._planesPrimitives=[]}var Lu=new n.default,ju=new Oi.default,Vu=new xi.default,Uu=new Lr.a,Bu=new jr.a,zu=new te.a,Hu=new ba.a,ku=new b.default,Gu=[1,1e5];Nu.prototype.update=function(e){if(this.show){var t,a,i=this._planesPrimitives,r=this._outlinePrimitives;if(this._updateOnChange){for(a=i.length,t=0;t<a;++t)r[t]=r[t]&&r[t].destroy(),i[t]=i[t]&&i[t].destroy();i.length=0,r.length=0}if(0===i.length){var o,l,u=this._camera,d=u.frustum;o=d instanceof Lr.a?Uu:d instanceof jr.a?Bu:d instanceof te.a?zu:Hu,o=d.clone(o);var c=this._frustumSplits;!Object(s.default)(c)||c.length<=1?((c=Gu)[0]=this._camera.frustum.near,c[1]=this._camera.frustum.far,l=1):l=c.length-1;var f=u.positionWC,h=u.directionWC,m=u.upWC,p=u.rightWC;p=n.default.negate(p,Lu);var _=ju;Oi.default.setColumn(_,0,p,_),Oi.default.setColumn(_,1,m,_),Oi.default.setColumn(_,2,h,_);var g=xi.default.fromRotationMatrix(_,Vu);for(i.length=r.length=l,t=0;t<l;++t)o.near=c[t],o.far=c[t+1],i[t]=new Ve.a({geometryInstances:new Q.a({geometry:new Eu({origin:f,orientation:g,frustum:o,_drawNearPlane:0===t}),attributes:{color:Y.a.fromColor(b.default.fromAlpha(this._color,.1,ku))},id:this.id,pickPrimitive:this}),appearance:new je.a({translucent:!0,flat:!0}),asynchronous:!1}),r[t]=new Ve.a({geometryInstances:new Q.a({geometry:new Ru({origin:f,orientation:g,frustum:o,_drawNearPlane:0===t}),attributes:{color:Y.a.fromColor(this._color)},id:this.id,pickPrimitive:this}),appearance:new je.a({translucent:!1,flat:!0}),asynchronous:!1})}for(a=i.length,t=0;t<a;++t)r[t].update(e),i[t].update(e)}},Nu.prototype.isDestroyed=function(){return!1},Nu.prototype.destroy=function(){for(var e=this._planesPrimitives.length,t=0;t<e;++t)this._outlinePrimitives[t]=this._outlinePrimitives[t]&&this._outlinePrimitives[t].destroy(),this._planesPrimitives[t]=this._planesPrimitives[t]&&this._planesPrimitives[t].destroy();return Object(l.default)(this)};var Wu=Nu;function Yu(){this._rs=void 0,this._sp=void 0,this._va=void 0,this._command=void 0,this._mode=void 0,this._useLogDepth=!1}var Xu=c.default.supportsTypedArrays()?new Float32Array(12):[],Qu=new n.default,qu=new n.default,Zu=new n.default,Ku=new n.default,Ju=new n.default;Yu.prototype.update=function(e){if(this._mode=e.mode,e.mode===V.a.SCENE3D){var t=e.context,a=e.mapProjection.ellipsoid,i=e.useLogDepth;if(Object(s.default)(this._command)||(this._rs=ce.a.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._command=new ue.a({renderState:this._rs,boundingVolume:new v.default(n.default.ZERO,a.maximumRadius),pass:de.a.OPAQUE,owner:this})),!Object(s.default)(this._sp)||this._useLogDepth!==i){this._useLogDepth=i;var r=new S.a({sources:["attribute vec4 position;\n\nvarying vec4 positionEC;\n\nvoid main()\n{\n    positionEC = czm_modelView * position;\n    gl_Position = czm_projection * positionEC;\n\n    czm_vertexLogDepth();\n}\n"]}),o=new S.a({sources:["varying vec4 positionEC;\n\nvoid main()\n{\n    vec3 position;\n    vec3 direction;\n    if (czm_orthographicIn3D == 1.0)\n    {\n        vec2 uv = (gl_FragCoord.xy -  czm_viewport.xy) / czm_viewport.zw;\n        vec2 minPlane = vec2(czm_frustumPlanes.z, czm_frustumPlanes.y); // left, bottom\n        vec2 maxPlane = vec2(czm_frustumPlanes.w, czm_frustumPlanes.x); // right, top\n        position = vec3(mix(minPlane, maxPlane, uv), 0.0);\n        direction = vec3(0.0, 0.0, -1.0);\n    } \n    else \n    {\n        position = vec3(0.0);\n        direction = normalize(positionEC.xyz);\n    }\n\n    czm_ray ray = czm_ray(position, direction);\n\n    vec3 ellipsoid_center = czm_view[3].xyz;\n\n    czm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\n    if (!czm_isEmpty(intersection))\n    {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n    }\n    else\n    {\n        discard;\n    }\n\n    czm_writeLogDepth();\n}\n"]});if(i){o.sources.push("#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),o.defines.push("LOG_DEPTH"),r.defines.push("LOG_DEPTH")}this._sp=L.a.replaceCache({shaderProgram:this._sp,context:t,vertexShaderSource:r,fragmentShaderSource:o,attributeLocations:{position:0}}),this._command.shaderProgram=this._sp}var l=function(e,t){var a,i,r,o=e.radii,s=t.camera;if(s.frustum instanceof te.a)a=n.default.ZERO,i=s.rightWC,r=s.upWC;else{var l=s.positionWC,u=n.default.multiplyComponents(e.oneOverRadii,l,Qu),d=n.default.normalize(u,qu),c=n.default.normalize(n.default.cross(n.default.UNIT_Z,u,Zu),Zu),f=n.default.normalize(n.default.cross(d,c,Ku),Ku),h=n.default.magnitude(u),m=Math.sqrt(h*h-1);a=n.default.multiplyByScalar(d,1/h,Qu);var p=m/h;i=n.default.multiplyByScalar(c,p,qu),r=n.default.multiplyByScalar(f,p,Zu)}var _=n.default.add(a,r,Ju);n.default.subtract(_,i,_),n.default.multiplyComponents(o,_,_),n.default.pack(_,Xu,0);var g=n.default.subtract(a,r,Ju);n.default.subtract(g,i,g),n.default.multiplyComponents(o,g,g),n.default.pack(g,Xu,3);var v=n.default.add(a,r,Ju);n.default.add(v,i,v),n.default.multiplyComponents(o,v,v),n.default.pack(v,Xu,6);var y=n.default.subtract(a,r,Ju);return n.default.add(y,i,y),n.default.multiplyComponents(o,y,y),n.default.pack(y,Xu,9),Xu}(a,e);if(Object(s.default)(this._va))this._va.getAttribute(0).vertexBuffer.copyFromArrayView(l);else{var u=new Qr.a({attributes:{position:new qr.a({componentDatatype:Xr.a.FLOAT,componentsPerAttribute:3,values:l})},indices:[0,1,2,2,1,3],primitiveType:ae.a.TRIANGLES});this._va=fe.a.fromGeometry({context:t,geometry:u,attributeLocations:{position:0},bufferUsage:se.a.DYNAMIC_DRAW}),this._command.vertexArray=this._va}}},Yu.prototype.execute=function(e,t){this._mode===V.a.SCENE3D&&this._command.execute(e,t)},Yu.prototype.isDestroyed=function(){return!1},Yu.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy(),this._va=this._va&&this._va.destroy()};var $u=Yu;function ed(){}var td=/\bgl_FragDepthEXT\b/,ad=/\bdiscard\b/;ed.createDepthOnlyDerivedCommand=function(e,t,a,i){var n,r;return Object(s.default)(i)||(i={}),Object(s.default)(i.depthOnlyCommand)&&(n=i.depthOnlyCommand.shaderProgram,r=i.depthOnlyCommand.renderState),i.depthOnlyCommand=ue.a.shallowClone(t,i.depthOnlyCommand),Object(s.default)(n)&&i.shaderProgramId===t.shaderProgram.id?(i.depthOnlyCommand.shaderProgram=n,i.depthOnlyCommand.renderState=r):(i.depthOnlyCommand.shaderProgram=function(e,t){var a=e.shaderCache.getDerivedShaderProgram(t,"depthOnly");if(!Object(s.default)(a)){var i,n=t._attributeLocations,r=t.fragmentShaderSource,o=!1,l=r.sources,u=l.length;for(i=0;i<u;++i)if(td.test(l[i])||ad.test(l[i])){o=!0;break}var d,c=!1,f=r.defines;for(u=f.length,i=0;i<u;++i)if("LOG_DEPTH"===f[i]){c=!0;break}o||c?!o&&c&&(d="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeLogDepth(); \n} \n",r=new S.a({defines:["LOG_DEPTH"],sources:[d]})):(d="void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n",r=new S.a({sources:[d]})),a=e.shaderCache.createDerivedShaderProgram(t,"depthOnly",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:r,attributeLocations:n})}return a}(a,t.shaderProgram),i.depthOnlyCommand.renderState=function(e,t){var a=e._depthOnlyRenderStateCache,i=a[t.id];if(!Object(s.default)(i)){var n=ce.a.getState(t);n.depthMask=!0,n.colorMask={red:!1,green:!1,blue:!1,alpha:!1},i=ce.a.fromCache(n),a[t.id]=i}return i}(e,t.renderState),i.shaderProgramId=t.shaderProgram.id),i};var id=/\s+czm_writeLogDepth\(/,nd=/\s+czm_vertexLogDepth\(/,rd=/\s*#extension\s+GL_EXT_frag_depth\s*:\s*enable/;ed.createLogDepthCommand=function(e,t,a){var i;return Object(s.default)(a)||(a={}),Object(s.default)(a.command)&&(i=a.command.shaderProgram),a.command=ue.a.shallowClone(e,a.command),Object(s.default)(i)&&a.shaderProgramId===e.shaderProgram.id?a.command.shaderProgram=i:(a.command.shaderProgram=function(e,t){var a=e.shaderCache.getDerivedShaderProgram(t,"logDepth");if(!Object(s.default)(a)){var i,n=t._attributeLocations,r=t.vertexShaderSource.clone(),o=t.fragmentShaderSource.clone();r.defines=Object(s.default)(r.defines)?r.defines.slice(0):[],r.defines.push("LOG_DEPTH"),o.defines=Object(s.default)(o.defines)?o.defines.slice(0):[],o.defines.push("LOG_DEPTH");var l=!1,u=r.sources,d=u.length;for(i=0;i<d;++i)if(nd.test(u[i])){l=!0;break}if(!l){for(i=0;i<d;++i)u[i]=S.a.replaceMain(u[i],"czm_log_depth_main");"\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n",u.push("\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n")}for(d=(u=o.sources).length,l=!1,i=0;i<d;++i)id.test(u[i])&&(l=!0);-1!==o.defines.indexOf("LOG_DEPTH_WRITE")&&(l=!0);var c=!0;for(i=0;i<d;++i)rd.test(u[i])&&(c=!1);var f="";if(c&&(f+="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),!l){for(i=0;i<d;i++)u[i]=S.a.replaceMain(u[i],"czm_log_depth_main");f+="\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_writeLogDepth(); \n} \n"}u.push(f),a=e.shaderCache.createDerivedShaderProgram(t,"logDepth",{vertexShaderSource:r,fragmentShaderSource:o,attributeLocations:n})}return a}(t,e.shaderProgram),a.shaderProgramId=e.shaderProgram.id),a},ed.createPickDerivedCommand=function(e,t,a,i){var n,r;return Object(s.default)(i)||(i={}),Object(s.default)(i.pickCommand)&&(n=i.pickCommand.shaderProgram,r=i.pickCommand.renderState),i.pickCommand=ue.a.shallowClone(t,i.pickCommand),Object(s.default)(n)&&i.shaderProgramId===t.shaderProgram.id?(i.pickCommand.shaderProgram=n,i.pickCommand.renderState=r):(i.pickCommand.shaderProgram=function(e,t,a){var i=e.shaderCache.getDerivedShaderProgram(t,"pick");if(!Object(s.default)(i)){for(var n=t._attributeLocations,r=t.fragmentShaderSource,o=r.sources,l=o.length,u="void main() \n{ \n    czm_non_pick_main(); \n    if (gl_FragColor.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = "+a+"; \n} \n",d=new Array(l+1),c=0;c<l;++c)d[c]=S.a.replaceMain(o[c],"czm_non_pick_main");d[l]=u,r=new S.a({sources:d,defines:r.defines}),i=e.shaderCache.createDerivedShaderProgram(t,"pick",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:r,attributeLocations:n})}return i}(a,t.shaderProgram,t.pickId),i.pickCommand.renderState=function(e,t){var a=e.picking.pickRenderStateCache,i=a[t.id];if(!Object(s.default)(i)){var n=ce.a.getState(t);n.blending.enabled=!1,n.depthMask=!0,i=ce.a.fromCache(n),a[t.id]=i}return i}(e,t.renderState),i.shaderProgramId=t.shaderProgram.id),i},ed.createHdrCommand=function(e,t,a){var i;return Object(s.default)(a)||(a={}),Object(s.default)(a.command)&&(i=a.command.shaderProgram),a.command=ue.a.shallowClone(e,a.command),Object(s.default)(i)&&a.shaderProgramId===e.shaderProgram.id?a.command.shaderProgram=i:(a.command.shaderProgram=function(e,t){var a=e.shaderCache.getDerivedShaderProgram(t,"HDR");if(!Object(s.default)(a)){var i=t._attributeLocations,n=t.vertexShaderSource.clone(),r=t.fragmentShaderSource.clone();n.defines=Object(s.default)(n.defines)?n.defines.slice(0):[],n.defines.push("HDR"),r.defines=Object(s.default)(r.defines)?r.defines.slice(0):[],r.defines.push("HDR"),a=e.shaderCache.createDerivedShaderProgram(t,"HDR",{vertexShaderSource:n,fragmentShaderSource:r,attributeLocations:i})}return a}(t,e.shaderProgram),a.shaderProgramId=e.shaderProgram.id),a};var od=ed;function sd(e){this._scene=e,this._lastAlpha=void 0,this._lastBeta=void 0,this._lastGamma=void 0,this._alpha=void 0,this._beta=void 0,this._gamma=void 0;var t=this;function a(e){var a=e.alpha;if(!Object(s.default)(a))return t._alpha=void 0,t._beta=void 0,void(t._gamma=void 0);t._alpha=J.default.toRadians(a),t._beta=J.default.toRadians(e.beta),t._gamma=J.default.toRadians(e.gamma)}window.addEventListener("deviceorientation",a,!1),this._removeListener=function(){window.removeEventListener("deviceorientation",a,!1)}}var ld=new xi.default,ud=new xi.default,dd=new Oi.default;sd.prototype.update=function(){if(Object(s.default)(this._alpha)){Object(s.default)(this._lastAlpha)||(this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma);var e=this._lastAlpha-this._alpha,t=this._lastBeta-this._beta,a=this._lastGamma-this._gamma;!function(e,t,a,i){var n=e.direction,r=e.right,o=e.up,s=xi.default.fromAxisAngle(n,a,ud),l=xi.default.fromAxisAngle(r,i,ld),u=xi.default.multiply(l,s,l),d=xi.default.fromAxisAngle(o,t,ud);xi.default.multiply(d,u,u);var c=Oi.default.fromQuaternion(u,dd);Oi.default.multiplyByVector(c,r,r),Oi.default.multiplyByVector(c,o,o),Oi.default.multiplyByVector(c,n,n)}(this._scene.camera,-e,t,a),this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma}},sd.prototype.isDestroyed=function(){return!1},sd.prototype.destroy=function(){return this._removeListener(),Object(l.default)(this)};var cd=sd;function fd(){this.enabled=!0,this.density=2e-4,this.screenSpaceErrorFactor=2,this.minimumBrightness=.03}for(var hd=[359.393,800.749,1275.6501,2151.1192,3141.7763,4777.5198,6281.2493,12364.307,15900.765,49889.0549,78026.8259,99260.7344,120036.3873,151011.0158,156091.1953,203849.3112,274866.9803,319916.3149,493552.0528,628733.5874],md=[2e-5,2e-4,1e-4,7e-5,5e-5,4e-5,3e-5,19e-6,1e-5,85e-7,62e-7,58e-7,53e-7,52e-7,51e-7,42e-7,4e-6,34e-7,26e-7,22e-7],pd=0;pd<md.length;++pd)md[pd]*=1e6;for(var _d=md[1],gd=md[md.length-1],vd=0;vd<md.length;++vd)md[vd]=(md[vd]-gd)/(_d-gd);var yd=0;var bd=new n.default;fd.prototype.update=function(e){if(e.fog.enabled=this.enabled){var t=e.camera,a=t.positionCartographic;if(!Object(s.default)(a)||a.height>8e5||e.mode!==V.a.SCENE3D)e.fog.enabled=!1;else{var i=a.height,r=function(e){var t,a=hd,i=a.length;if(e<a[0])return yd=0;if(e>a[i-1])return yd=i-2;if(e>=a[yd]){if(yd+1<i&&e<a[yd+1])return yd;if(yd+2<i&&e<a[yd+2])return++yd}else if(yd-1>=0&&e>=a[yd-1])return--yd;for(t=0;t<i-2&&!(e>=a[t]&&e<a[t+1]);++t);return yd=t}(i),o=J.default.clamp((i-hd[r])/(hd[r+1]-hd[r]),0,1),l=J.default.lerp(md[r],md[r+1],o),u=1e6*this.density;l=l*(u-u/_d*gd)*1e-6;var d=n.default.normalize(t.positionWC,bd);l*=1-Math.abs(n.default.dot(t.directionWC,d)),e.fog.density=l,e.fog.sse=this.screenSpaceErrorFactor,e.fog.minimumBrightness=this.minimumBrightness}}};var wd=fd;var Cd=function(e,t,a){this.context=e,this.commandList=[],this.shadowMaps=[],this.brdfLutGenerator=void 0,this.environmentMap=void 0,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this.specularEnvironmentMapsMaximumLOD=void 0,this.mode=V.a.SCENE3D,this.morphTime=V.a.getMorphTime(V.a.SCENE3D),this.frameNumber=0,this.newFrame=!1,this.time=void 0,this.jobScheduler=a,this.mapProjection=void 0,this.camera=void 0,this.cameraUnderground=!1,this.globeTranslucencyState=void 0,this.cullingVolume=void 0,this.occluder=void 0,this.maximumScreenSpaceError=void 0,this.pixelRatio=1,this.passes={render:!1,pick:!1,depth:!1,postProcess:!1,offscreen:!1},this.creditDisplay=t,this.afterRender=[],this.scene3DOnly=!1,this.fog={enabled:!1,density:void 0,sse:void 0,minimumBrightness:void 0},this.terrainExaggeration=1,this.shadowState={shadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5e3,closestObjectSize:1e3,lastDirtyTime:0,outOfView:!0},this.imagerySplitPosition=0,this.frustumSplits=[],this.backgroundColor=void 0,this.light=void 0,this.minimumDisableDepthTestDistance=void 0,this.invertClassification=!1,this.invertClassificationColor=void 0,this.useLogDepth=!1,this.tilesetPassState=void 0,this.minimumTerrainHeight=0},Od="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n}\n",xd="uniform highp sampler2D u_depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_depthTexture, v_textureCoordinates).r);\n}\n",Td=a(153),Ed=a(204),Ad=a(205);function Pd(){this._globeColorTexture=void 0,this._primitiveColorTexture=void 0,this._depthStencilTexture=void 0,this._globeDepthTexture=void 0,this._tempGlobeDepthTexture=void 0,this._tempCopyDepthTexture=void 0,this._globeColorFramebuffer=void 0,this._primitiveColorFramebuffer=void 0,this._copyDepthFramebuffer=void 0,this._tempCopyDepthFramebuffer=void 0,this._updateDepthFramebuffer=void 0,this._clearGlobeColorCommand=void 0,this._clearPrimitiveColorCommand=void 0,this._copyColorCommand=void 0,this._copyDepthCommand=void 0,this._tempCopyDepthCommand=void 0,this._updateDepthCommand=void 0,this._mergeColorCommand=void 0,this._viewport=new fr.default,this._rs=void 0,this._rsBlend=void 0,this._rsUpdate=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useLogDepth=void 0,this._useHdr=void 0,this._clearGlobeDepth=void 0,this._debugGlobeDepthViewportCommand=void 0}function Sd(e){e._globeColorTexture=e._globeColorTexture&&!e._globeColorTexture.isDestroyed()&&e._globeColorTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&!e._depthStencilTexture.isDestroyed()&&e._depthStencilTexture.destroy(),e._globeDepthTexture=e._globeDepthTexture&&!e._globeDepthTexture.isDestroyed()&&e._globeDepthTexture.destroy()}function Dd(e){e._globeColorFramebuffer=e._globeColorFramebuffer&&!e._globeColorFramebuffer.isDestroyed()&&e._globeColorFramebuffer.destroy(),e._copyDepthFramebuffer=e._copyDepthFramebuffer&&!e._copyDepthFramebuffer.isDestroyed()&&e._copyDepthFramebuffer.destroy()}function Fd(e){e._tempCopyDepthFramebuffer=e._tempCopyDepthFramebuffer&&!e._tempCopyDepthFramebuffer.isDestroyed()&&e._tempCopyDepthFramebuffer.destroy(),e._updateDepthFramebuffer=e._updateDepthFramebuffer&&!e._updateDepthFramebuffer.isDestroyed()&&e._updateDepthFramebuffer.destroy(),e._tempGlobeDepthTexture=e._tempGlobeDepthTexture&&!e._tempGlobeDepthTexture.isDestroyed()&&e._tempGlobeDepthTexture.destroy()}function Md(e){e._primitiveColorTexture=e._primitiveColorTexture&&!e._primitiveColorTexture.isDestroyed()&&e._primitiveColorTexture.destroy(),e._primitiveColorFramebuffer=e._primitiveColorFramebuffer&&!e._primitiveColorFramebuffer.isDestroyed()&&e._primitiveColorFramebuffer.destroy()}function Id(e,t,a,i,n,r){var o=e._globeColorTexture,l=!Object(s.default)(o)||o.width!==a||o.height!==i||n!==e._useHdr;l&&(Sd(e),Dd(e),function(e,t,a,i,n){var r=n?t.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;e._globeColorTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:r,sampler:Ce.a.NEAREST}),e._depthStencilTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8}),e._globeDepthTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Ce.a.NEAREST})}(e,t,a,i,n),function(e,t){e._globeColorFramebuffer=new Hr.a({context:t,colorTextures:[e._globeColorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._copyDepthFramebuffer=new Hr.a({context:t,colorTextures:[e._globeDepthTexture],destroyAttachments:!1})}(e,t)),(l||r!==e._clearGlobeDepth)&&(Md(e),r&&function(e,t,a,i,n){var r=n?t.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;e._primitiveColorTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:r,sampler:Ce.a.NEAREST}),e._primitiveColorFramebuffer=new Hr.a({context:t,colorTextures:[e._primitiveColorTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1})}(e,t,a,i,n))}function Rd(e,t,a,i,n){e._viewport.width=a,e._viewport.height=i;var r=!fr.default.equals(e._viewport,n.viewport),o=r!==e._useScissorTest;e._useScissorTest=r,fr.default.equals(e._scissorRectangle,n.viewport)||(e._scissorRectangle=fr.default.clone(n.viewport,e._scissorRectangle),o=!0),Object(s.default)(e._rs)&&fr.default.equals(e._viewport,e._rs.viewport)&&!o||(e._rs=ce.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}}),e._rsBlend=ce.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},blending:he.a.ALPHA_BLEND}),e._rsUpdate=ce.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle},stencilTest:{enabled:!0,frontFunction:Ed.a.EQUAL,frontOperation:{fail:Ad.a.KEEP,zFail:Ad.a.KEEP,zPass:Ad.a.KEEP},backFunction:Ed.a.NEVER,reference:Td.a.CESIUM_3D_TILE_MASK,mask:Td.a.CESIUM_3D_TILE_MASK}})),Object(s.default)(e._copyDepthCommand)||(e._copyDepthCommand=t.createViewportQuadCommand(xd,{uniformMap:{u_depthTexture:function(){return e._depthStencilTexture}},owner:e})),e._copyDepthCommand.framebuffer=e._copyDepthFramebuffer,e._copyDepthCommand.renderState=e._rs,Object(s.default)(e._copyColorCommand)||(e._copyColorCommand=t.createViewportQuadCommand(Od,{uniformMap:{colorTexture:function(){return e._globeColorTexture}},owner:e})),e._copyColorCommand.renderState=e._rs,Object(s.default)(e._tempCopyDepthCommand)||(e._tempCopyDepthCommand=t.createViewportQuadCommand(xd,{uniformMap:{u_depthTexture:function(){return e._tempCopyDepthTexture}},owner:e})),e._tempCopyDepthCommand.framebuffer=e._tempCopyDepthFramebuffer,e._tempCopyDepthCommand.renderState=e._rs,Object(s.default)(e._updateDepthCommand)||(e._updateDepthCommand=t.createViewportQuadCommand(Od,{uniformMap:{colorTexture:function(){return e._tempGlobeDepthTexture}},owner:e})),e._updateDepthCommand.framebuffer=e._updateDepthFramebuffer,e._updateDepthCommand.renderState=e._rsUpdate,Object(s.default)(e._clearGlobeColorCommand)||(e._clearGlobeColorCommand=new Br.a({color:new b.default(0,0,0,0),stencil:0,owner:e})),e._clearGlobeColorCommand.framebuffer=e._globeColorFramebuffer,Object(s.default)(e._clearPrimitiveColorCommand)||(e._clearPrimitiveColorCommand=new Br.a({color:new b.default(0,0,0,0),stencil:0,owner:e})),e._clearPrimitiveColorCommand.framebuffer=e._primitiveColorFramebuffer,Object(s.default)(e._mergeColorCommand)||(e._mergeColorCommand=t.createViewportQuadCommand(Od,{uniformMap:{colorTexture:function(){return e._primitiveColorTexture}},owner:e})),e._mergeColorCommand.framebuffer=e._globeColorFramebuffer,e._mergeColorCommand.renderState=e._rsBlend}Object.defineProperties(Pd.prototype,{framebuffer:{get:function(){return this._globeColorFramebuffer}},primitiveFramebuffer:{get:function(){return this._primitiveColorFramebuffer}}}),Pd.prototype.executeDebugGlobeDepth=function(e,t,a){!function(e,t,a,i){if(!Object(s.default)(e._debugGlobeDepthViewportCommand)||i!==e._useLogDepth){var n=new S.a({defines:[i?"LOG_DEPTH":""],sources:["uniform highp sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});e._debugGlobeDepthViewportCommand=t.createViewportQuadCommand(n,{uniformMap:{u_depthTexture:function(){return e._globeDepthTexture}},owner:e}),e._useLogDepth=i}e._debugGlobeDepthViewportCommand.execute(t,a)}(this,e,t,a)},Pd.prototype.update=function(e,t,a,i,n){var r=a.width,o=a.height;Id(this,e,r,o,i,n),Rd(this,e,r,o,t),e.uniformState.globeDepthTexture=void 0,this._useHdr=i,this._clearGlobeDepth=n},Pd.prototype.executeCopyDepth=function(e,t){Object(s.default)(this._copyDepthCommand)&&(this._copyDepthCommand.execute(e,t),e.uniformState.globeDepthTexture=this._globeDepthTexture)},Pd.prototype.executeUpdateDepth=function(e,t,a){var i=t.framebuffer.depthStencilTexture;if(a||i!==this._depthStencilTexture){if(Object(s.default)(this._updateDepthCommand)){if(!Object(s.default)(this._updateDepthFramebuffer)||this._updateDepthFramebuffer.depthStencilTexture!==i||this._updateDepthFramebuffer.getColorTexture(0)!==this._globeDepthTexture){var n=this._globeDepthTexture.width,r=this._globeDepthTexture.height;Fd(this),function(e,t,a,i,n){e._tempGlobeDepthTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Ce.a.NEAREST}),e._tempCopyDepthFramebuffer=new Hr.a({context:t,colorTextures:[e._tempGlobeDepthTexture],destroyAttachments:!1}),e._updateDepthFramebuffer=new Hr.a({context:t,colorTextures:[e._globeDepthTexture],depthStencilTexture:n.framebuffer.depthStencilTexture,destroyAttachments:!1})}(this,e,n,r,t),Rd(this,e,n,r,t)}this._tempCopyDepthTexture=i,this._tempCopyDepthCommand.execute(e,t),this._updateDepthCommand.execute(e,t)}}else Object(s.default)(this._copyDepthCommand)&&this._copyDepthCommand.execute(e,t)},Pd.prototype.executeCopyColor=function(e,t){Object(s.default)(this._copyColorCommand)&&this._copyColorCommand.execute(e,t)},Pd.prototype.executeMergeColor=function(e,t){Object(s.default)(this._mergeColorCommand)&&this._mergeColorCommand.execute(e,t)},Pd.prototype.clear=function(e,t,a){var i=this._clearGlobeColorCommand;Object(s.default)(i)&&(b.default.clone(a,i.color),i.execute(e,t)),i=this._clearPrimitiveColorCommand,Object(s.default)(i)&&Object(s.default)(this._primitiveColorFramebuffer)&&i.execute(e,t)},Pd.prototype.isDestroyed=function(){return!1},Pd.prototype.destroy=function(){return Sd(this),Dd(this),Md(this),Fd(this),Object(s.default)(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy()),Object(s.default)(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy()),Object(s.default)(this._tempCopyDepthCommand)&&(this._tempCopyDepthCommand.shaderProgram=this._tempCopyDepthCommand.shaderProgram.destroy()),Object(s.default)(this._updateDepthCommand)&&(this._updateDepthCommand.shaderProgram=this._updateDepthCommand.shaderProgram.destroy()),Object(s.default)(this._mergeColorCommand)&&(this._mergeColorCommand.shaderProgram=this._mergeColorCommand.shaderProgram.destroy()),Object(s.default)(this._debugGlobeDepthViewportCommand)&&(this._debugGlobeDepthViewportCommand.shaderProgram=this._debugGlobeDepthViewportCommand.shaderProgram.destroy()),Object(l.default)(this)};var Nd=Pd,Ld={OPAQUE_FRONT_FACE:0,OPAQUE_BACK_FACE:1,DEPTH_ONLY_FRONT_FACE:2,DEPTH_ONLY_BACK_FACE:3,DEPTH_ONLY_FRONT_AND_BACK_FACE:4,TRANSLUCENT_FRONT_FACE:5,TRANSLUCENT_BACK_FACE:6,TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:7,TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:8,PICK_FRONT_FACE:9,PICK_BACK_FACE:10,DERIVED_COMMANDS_MAXIMUM_LENGTH:11},jd=Ld.DERIVED_COMMANDS_MAXIMUM_LENGTH,Vd=["opaqueFrontFaceCommand","opaqueBackFaceCommand","depthOnlyFrontFaceCommand","depthOnlyBackFaceCommand","depthOnlyFrontAndBackFaceCommand","translucentFrontFaceCommand","translucentBackFaceCommand","translucentFrontFaceManualDepthTestCommand","translucentBackFaceManualDepthTestCommand","pickFrontFaceCommand","pickBackFaceCommand"];function Ud(){this._frontFaceAlphaByDistance=new T.a(0,1,0,1),this._backFaceAlphaByDistance=new T.a(0,1,0,1),this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._requiresManualDepthTest=!1,this._sunVisibleThroughGlobe=!1,this._environmentVisible=!1,this._useDepthPlane=!1,this._numberOfTextureUniforms=0,this._globeTranslucencyFramebuffer=void 0,this._rectangle=A.default.clone(A.default.MAX_VALUE),this._derivedCommandKey=0,this._derivedCommandsDirty=!1,this._derivedCommandPacks=void 0,this._derivedCommandTypes=new Array(jd),this._derivedBlendCommandTypes=new Array(jd),this._derivedPickCommandTypes=new Array(jd),this._derivedCommandTypesToUpdate=new Array(jd),this._derivedCommandsLength=0,this._derivedBlendCommandsLength=0,this._derivedPickCommandsLength=0,this._derivedCommandsToUpdateLength=0}function Bd(e,t,a,i){return e?Object(s.default)(a)?(T.a.clone(a,i),i.nearValue*=t,i.farValue*=t,i):(i.nearValue=t,i.farValue=t,i):(i.nearValue=1,i.farValue=1,i)}function zd(e,t,a){return e&&(a.baseColor.alpha<1||t.nearValue<1||t.farValue<1)}function Hd(e,t,a,i,n){var r=0,o=e._frontFaceTranslucent,s=e._backFaceTranslucent;if(!o)return r;var l=t.cameraUnderground,u=e._requiresManualDepthTest,d=i?Ld.PICK_FRONT_FACE:u?Ld.TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:Ld.TRANSLUCENT_FRONT_FACE,c=i?Ld.PICK_BACK_FACE:u?Ld.TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:Ld.TRANSLUCENT_BACK_FACE;return t.mode===V.a.SCENE2D?(n[r++]=Ld.DEPTH_ONLY_FRONT_FACE,n[r++]=d,r):(s?(a||(n[r++]=Ld.DEPTH_ONLY_FRONT_AND_BACK_FACE),l?(n[r++]=d,n[r++]=c):(n[r++]=c,n[r++]=d)):l?(a||(n[r++]=Ld.DEPTH_ONLY_BACK_FACE),n[r++]=Ld.OPAQUE_FRONT_FACE,n[r++]=c):(a||(n[r++]=Ld.DEPTH_ONLY_FRONT_FACE),n[r++]=Ld.OPAQUE_BACK_FACE,n[r++]=d),r)}function kd(e,t){var a=e.indexOf(t);a>-1&&e.splice(a,1)}function Gd(e,t){return e.indexOf(t)>-1}function Wd(e,t){kd(e.defines,"TRANSLUCENT"),kd(t.defines,"TRANSLUCENT")}function Yd(e,t){kd(e.defines,"GROUND_ATMOSPHERE"),kd(t.defines,"GROUND_ATMOSPHERE"),kd(e.defines,"FOG"),kd(t.defines,"FOG"),kd(e.defines,"TRANSLUCENT"),kd(t.defines,"TRANSLUCENT")}function Xd(e,t){if(!Gd(t.defines,"TILE_LIMIT_RECTANGLE")&&!Gd(t.defines,"ENABLE_CLIPPING_PLANES")){t.sources=["void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n"]}}function Qd(e,t){for(var a=t.sources,i=a.length,n=0;n<i;++n)a[n]=S.a.replaceMain(a[n],"czm_globe_translucency_main");a.push("\n\nuniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n#ifdef MANUAL_DEPTH_TEST \n    float logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st)); \n    if (logDepthOrDepth != 0.0) \n    { \n        vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth); \n        float depthEC = eyeCoordinate.z / eyeCoordinate.w; \n        if (v_positionEC.z < depthEC) \n        { \n            discard; \n        } \n    } \n#endif \n    czm_globe_translucency_main(); \n    vec4 classificationColor = texture2D(u_classificationTexture, st); \n    if (classificationColor.a > 0.0) \n    { \n        // Reverse premultiplication process to get the correct composited result of the classification primitives \n        classificationColor.rgb /= classificationColor.a; \n    } \n    gl_FragColor = classificationColor * vec4(classificationColor.aaa, 1.0) + gl_FragColor * (1.0 - classificationColor.a); \n} \n")}function qd(e,t){Qd(0,t),kd(e.defines,"GROUND_ATMOSPHERE"),kd(t.defines,"GROUND_ATMOSPHERE"),kd(e.defines,"FOG"),kd(t.defines,"FOG")}function Zd(e,t){Qd(0,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function Kd(e,t){qd(e,t),e.defines.push("GENERATE_POSITION"),t.defines.push("MANUAL_DEPTH_TEST")}function Jd(e,t){t.sources=["uniform sampler2D u_classificationTexture; \nvoid main() \n{ \n    vec2 st = gl_FragCoord.xy / czm_viewport.zw; \n    vec4 pickColor = texture2D(u_classificationTexture, st); \n    if (pickColor == vec4(0.0)) \n    { \n        discard; \n    } \n    gl_FragColor = pickColor; \n} \n"]}function $d(e,t,a,i,n,r){if(!Object(s.default)(n))return t;if(!i&&Object(s.default)(a))return a;var o=e.shaderCache.getDerivedShaderProgram(t,r);if(!Object(s.default)(o)){var l=t._attributeLocations,u=t.vertexShaderSource.clone(),d=t.fragmentShaderSource.clone();u.defines=Object(s.default)(u.defines)?u.defines.slice(0):[],d.defines=Object(s.default)(d.defines)?d.defines.slice(0):[],n(u,d),o=e.shaderCache.createDerivedShaderProgram(t,r,{vertexShaderSource:u,fragmentShaderSource:d,attributeLocations:l})}return o}function ec(e){e.cull.face=er.a.BACK,e.cull.enabled=!0}function tc(e){e.cull.face=er.a.FRONT,e.cull.enabled=!0}function ac(e){e.cull.face=er.a.BACK,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function ic(e){e.cull.face=er.a.FRONT,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function nc(e){e.cull.enabled=!1,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function rc(e){e.cull.face=er.a.BACK,e.cull.enabled=!0,e.depthMask=!1,e.blending=he.a.ALPHA_BLEND}function oc(e){e.cull.face=er.a.FRONT,e.cull.enabled=!0,e.depthMask=!1,e.blending=he.a.ALPHA_BLEND}function sc(e){e.cull.face=er.a.BACK,e.cull.enabled=!0,e.blending.enabled=!1}function lc(e){e.cull.face=er.a.FRONT,e.cull.enabled=!0,e.blending.enabled=!1}function uc(e,t,a,i,n){if(!Object(s.default)(i))return e;if(!a&&Object(s.default)(t))return t;var r=n[e.id];if(!Object(s.default)(r)){var o=ce.a.getState(e);i(o),r=ce.a.fromCache(o),n[e.id]=r}return r}function dc(e){return{u_classificationTexture:function(){return e._globeTranslucencyFramebuffer.classificationTexture}}}function cc(e,t,a,i,n){return Object(s.default)(n)?!i&&Object(s.default)(a)?a:Object(X.default)(t,n(e),!1):t}function fc(e){this.pass=e.pass,this.pickOnly=e.pickOnly,this.getShaderProgramFunction=e.getShaderProgramFunction,this.getRenderStateFunction=e.getRenderStateFunction,this.getUniformMapFunction=e.getUniformMapFunction,this.renderStateCache={}}Object.defineProperties(Ud.prototype,{frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance}},translucent:{get:function(){return this._frontFaceTranslucent}},sunVisibleThroughGlobe:{get:function(){return this._sunVisibleThroughGlobe}},environmentVisible:{get:function(){return this._environmentVisible}},useDepthPlane:{get:function(){return this._useDepthPlane}},numberOfTextureUniforms:{get:function(){return this._numberOfTextureUniforms}},rectangle:{get:function(){return this._rectangle}}}),Ud.prototype.update=function(e){var t=e.globe;if(!Object(s.default)(t)||!t.show)return this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._sunVisibleThroughGlobe=!0,this._environmentVisible=!0,void(this._useDepthPlane=!1);this._frontFaceAlphaByDistance=Bd(t.translucency.enabled,t.translucency.frontFaceAlpha,t.translucency.frontFaceAlphaByDistance,this._frontFaceAlphaByDistance),this._backFaceAlphaByDistance=Bd(t.translucency.enabled,t.translucency.backFaceAlpha,t.translucency.backFaceAlphaByDistance,this._backFaceAlphaByDistance),this._frontFaceTranslucent=zd(t.translucency.enabled,this._frontFaceAlphaByDistance,t),this._backFaceTranslucent=zd(t.translucency.enabled,this._backFaceAlphaByDistance,t),this._requiresManualDepthTest=function(e,t,a){return e._frontFaceTranslucent&&!e._backFaceTranslucent&&!a.depthTestAgainstTerrain&&t.mode!==V.a.SCENE2D&&t.context.depthTexture}(this,e,t),this._sunVisibleThroughGlobe=function(e,t){var a=e._frontFaceTranslucent,i=e._backFaceTranslucent;return a&&(t.cameraUnderground||i)}(this,e),this._environmentVisible=function(e,t){return!t.cameraUnderground||e._frontFaceTranslucent}(this,e),this._useDepthPlane=function(e,t){return!t.cameraUnderground&&!e._frontFaceTranslucent}(this,e),this._numberOfTextureUniforms=function(e){var t=0;e._frontFaceTranslucent&&++t;e._requiresManualDepthTest&&++t;return t}(this),this._rectangle=A.default.clone(t.translucency.rectangle,this._rectangle),function(e,t){var a;e._derivedCommandsLength=Hd(e,t,!1,!1,e._derivedCommandTypes),e._derivedBlendCommandsLength=Hd(e,t,!0,!1,e._derivedBlendCommandTypes),e._derivedPickCommandsLength=Hd(e,t,!1,!0,e._derivedPickCommandTypes);var i=0;for(a=0;a<e._derivedCommandsLength;++a)i|=1<<e._derivedCommandTypes[a];for(a=0;a<e._derivedBlendCommandsLength;++a)i|=1<<e._derivedBlendCommandTypes[a];for(a=0;a<e._derivedPickCommandsLength;++a)i|=1<<e._derivedPickCommandTypes[a];var n=0;for(a=0;a<jd;++a)(i&1<<a)>0&&(e._derivedCommandTypesToUpdate[n++]=a);e._derivedCommandsToUpdateLength=n;var r=i!==e._derivedCommandKey;e._derivedCommandKey=i,e._derivedCommandsDirty=r,!Object(s.default)(e._derivedCommandPacks)&&e._frontFaceTranslucent&&(e._derivedCommandPacks=[new fc({pass:de.a.GLOBE,pickOnly:!1,getShaderProgramFunction:Wd,getRenderStateFunction:ec,getUniformMapFunction:void 0}),new fc({pass:de.a.GLOBE,pickOnly:!1,getShaderProgramFunction:Yd,getRenderStateFunction:tc,getUniformMapFunction:void 0}),new fc({pass:de.a.GLOBE,pickOnly:!1,getShaderProgramFunction:Xd,getRenderStateFunction:ac,getUniformMapFunction:void 0}),new fc({pass:de.a.GLOBE,pickOnly:!1,getShaderProgramFunction:Xd,getRenderStateFunction:ic,getUniformMapFunction:void 0}),new fc({pass:de.a.GLOBE,pickOnly:!1,getShaderProgramFunction:Xd,getRenderStateFunction:nc,getUniformMapFunction:void 0}),new fc({pass:de.a.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Qd,getRenderStateFunction:rc,getUniformMapFunction:dc}),new fc({pass:de.a.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:qd,getRenderStateFunction:oc,getUniformMapFunction:dc}),new fc({pass:de.a.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Zd,getRenderStateFunction:rc,getUniformMapFunction:dc}),new fc({pass:de.a.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Kd,getRenderStateFunction:oc,getUniformMapFunction:dc}),new fc({pass:de.a.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:Jd,getRenderStateFunction:sc,getUniformMapFunction:dc}),new fc({pass:de.a.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:Jd,getRenderStateFunction:lc,getUniformMapFunction:dc})])}(this,e)};var hc=new Array(jd),mc=new Array(jd);function pc(e,t,a,i,n,r,o){for(var l=0;l<t;++l){var u=e[l],d=u.derivedCommands.type;(!Object(s.default)(o)||o.indexOf(d)>-1)&&a(u,i,n,r)}}function _c(e,t,a,i,n,r){for(var o=0;o<t;++o)a(e[o],i,n,r)}Ud.prototype.updateDerivedCommands=function(e,t){var a=this._derivedCommandTypesToUpdate,i=this._derivedCommandsToUpdateLength;if(0!==i){for(var n=0;n<i;++n)mc[n]=this._derivedCommandPacks[a[n]],hc[n]=Vd[a[n]];!function(e,t,a,i,n,r,l){var u=t.derivedCommands.globeTranslucency,d=e._derivedCommandsDirty;if(t.dirty||!Object(s.default)(u)||d){t.dirty=!1,Object(s.default)(u)||(u={},t.derivedCommands.globeTranslucency=u);var c=l.frameNumber,f=Object(o.default)(u.uniformMapDirtyFrame,0),h=Object(o.default)(u.shaderProgramDirtyFrame,0),m=Object(o.default)(u.renderStateDirtyFrame,0),p=u.uniformMap!==t.uniformMap,_=u.shaderProgramId!==t.shaderProgram.id,g=u.renderStateId!==t.renderState.id;p&&(u.uniformMapDirtyFrame=c),_&&(u.shaderProgramDirtyFrame=c),g&&(u.renderStateDirtyFrame=c),u.uniformMap=t.uniformMap,u.shaderProgramId=t.shaderProgram.id,u.renderStateId=t.renderState.id;for(var v=0;v<a;++v){var y,b,w,C=r[v],O=i[v],x=n[v],T=u[x];Object(s.default)(T)?(y=T.uniformMap,b=T.shaderProgram,w=T.renderState):(y=void 0,b=void 0,w=void 0),T=ue.a.shallowClone(t,T),u[x]=T;var E=Object(o.default)(T.derivedCommands.uniformMapDirtyFrame,0),A=Object(o.default)(T.derivedCommands.shaderProgramDirtyFrame,0),P=Object(o.default)(T.derivedCommands.renderStateDirtyFrame,0),S=p||E<f,D=_||A<h,F=g||P<m;S&&(T.derivedCommands.uniformMapDirtyFrame=c),D&&(T.derivedCommands.shaderProgramDirtyFrame=c),F&&(T.derivedCommands.renderStateDirtyFrame=c),T.derivedCommands.type=O,T.pass=C.pass,T.pickOnly=C.pickOnly,T.uniformMap=cc(e,t.uniformMap,y,S,C.getUniformMapFunction),T.shaderProgram=$d(l.context,t.shaderProgram,b,D,C.getShaderProgramFunction,x),T.renderState=uc(t.renderState,w,F,C.getRenderStateFunction,C.renderStateCache)}}}(this,e,i,a,hc,mc,t)}},Ud.prototype.pushDerivedCommands=function(e,t,a){var i=a.passes.pick;if(!i||!t){var n=this._derivedCommandTypes,r=this._derivedCommandsLength;if(i?(n=this._derivedPickCommandTypes,r=this._derivedPickCommandsLength):t&&(n=this._derivedBlendCommandTypes,r=this._derivedBlendCommandsLength),0!==r)for(var o=e.derivedCommands.globeTranslucency,s=0;s<r;++s){var l=Vd[n[s]];a.commandList.push(o[l])}else a.commandList.push(e)}};var gc=[Ld.OPAQUE_FRONT_FACE,Ld.OPAQUE_BACK_FACE],vc=[Ld.DEPTH_ONLY_FRONT_FACE,Ld.DEPTH_ONLY_BACK_FACE,Ld.DEPTH_ONLY_FRONT_AND_BACK_FACE];Ud.prototype.executeGlobeCommands=function(e,t,a,i,n){var r=i.context,o=e.commands[de.a.GLOBE],s=e.indices[de.a.GLOBE];0!==s&&(this._globeTranslucencyFramebuffer=a,a.clearClassification(r,n),pc(o,s,t,i,r,n,gc))},Ud.prototype.executeGlobeClassificationCommands=function(e,t,a,i,n){var r=i.context,o=e.commands[de.a.GLOBE],s=e.indices[de.a.GLOBE],l=e.commands[de.a.TERRAIN_CLASSIFICATION],u=e.indices[de.a.TERRAIN_CLASSIFICATION];if(0!==s&&0!==u){var d=this._frontFaceTranslucent,c=this._backFaceTranslucent;if(d&&c||_c(l,u,t,i,r,n),d||c){this._globeTranslucencyFramebuffer=a;var f=r.uniformState.globeDepthTexture,h=n.framebuffer;if(n.framebuffer=a.classificationFramebuffer,pc(o,s,t,i,r,n,vc),r.depthTexture){var m=a.packDepth(r,n);r.uniformState.globeDepthTexture=m}_c(l,u,t,i,r,n),r.uniformState.globeDepthTexture=f,n.framebuffer=h}}};var yc=Ud;function bc(){this.previousFramebuffer=void 0,this._previousFramebuffer=void 0,this._texture=void 0,this._classifiedTexture=void 0,this._depthStencilTexture=void 0,this._fbo=void 0,this._fboClassified=void 0,this._rsUnclassified=void 0,this._rsClassified=void 0,this._unclassifiedCommand=void 0,this._classifiedCommand=void 0,this._translucentCommand=void 0,this._clearColorCommand=new Br.a({color:new b.default(0,0,0,0),owner:this}),this._clearCommand=new Br.a({color:new b.default(0,0,0,0),depth:1,stencil:0});var e=this;this._uniformMap={colorTexture:function(){return e._texture},depthTexture:function(){return e._depthStencilTexture},classifiedTexture:function(){return e._classifiedTexture}}}Object.defineProperties(bc.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}}),bc.isTranslucencySupported=function(e){return e.depthTexture&&e.fragmentDepth};var wc={depthMask:!1,stencilTest:{enabled:!0,frontFunction:Ed.a.EQUAL,frontOperation:{fail:Ad.a.KEEP,zFail:Ad.a.KEEP,zPass:Ad.a.KEEP},backFunction:Ed.a.NEVER,reference:0,mask:Td.a.CLASSIFICATION_MASK},blending:he.a.ALPHA_BLEND},Cc={depthMask:!1,stencilTest:{enabled:!0,frontFunction:Ed.a.NOT_EQUAL,frontOperation:{fail:Ad.a.KEEP,zFail:Ad.a.KEEP,zPass:Ad.a.KEEP},backFunction:Ed.a.NEVER,reference:0,mask:Td.a.CLASSIFICATION_MASK},blending:he.a.ALPHA_BLEND},Oc={depthMask:!0,depthTest:{enabled:!0},stencilTest:Td.a.setCesium3DTileBit(),stencilMask:Td.a.CESIUM_3D_TILE_MASK,blending:he.a.ALPHA_BLEND};bc.prototype.update=function(e){var t=this._texture,a=!Object(s.default)(t)||this.previousFramebuffer!==this._previousFramebuffer;this._previousFramebuffer=this.previousFramebuffer;var i,n,r=e.drawingBufferWidth,o=e.drawingBufferHeight,l=!Object(s.default)(t)||t.width!==r||t.height!==o;((l||a)&&(this._texture=this._texture&&this._texture.destroy(),this._classifiedTexture=this._classifiedTexture&&this._classifiedTexture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._texture=new D.a({context:e,width:r,height:o,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:new Ce.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:xe.a.LINEAR,magnificationFilter:Oe.a.LINEAR})}),Object(s.default)(this._previousFramebuffer)||(this._classifiedTexture=new D.a({context:e,width:r,height:o,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:new Ce.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:xe.a.LINEAR,magnificationFilter:Oe.a.LINEAR})}),this._depthStencilTexture=new D.a({context:e,width:r,height:o,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8}))),!Object(s.default)(this._fbo)||l||a)&&(this._fbo=this._fbo&&this._fbo.destroy(),this._fboClassified=this._fboClassified&&this._fboClassified.destroy(),Object(s.default)(this._previousFramebuffer)?(i=this._previousFramebuffer.depthStencilTexture,n=this._previousFramebuffer.depthStencilRenderbuffer):i=this._depthStencilTexture,this._fbo=new Hr.a({context:e,colorTextures:[this._texture],depthStencilTexture:i,depthStencilRenderbuffer:n,destroyAttachments:!1}),Object(s.default)(this._previousFramebuffer)||(this._fboClassified=new Hr.a({context:e,colorTextures:[this._classifiedTexture],depthStencilTexture:i,destroyAttachments:!1})));if(Object(s.default)(this._rsUnclassified)||(this._rsUnclassified=ce.a.fromCache(wc),this._rsClassified=ce.a.fromCache(Cc),this._rsDefault=ce.a.fromCache(Oc)),!Object(s.default)(this._unclassifiedCommand)||a){Object(s.default)(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());var u=Object(s.default)(this._previousFramebuffer)?"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n#ifdef UNCLASSIFIED\n    gl_FragColor = color * czm_invertClassificationColor;\n#else\n    gl_FragColor = color;\n#endif\n}\n":"#extension GL_EXT_frag_depth : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D classifiedTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n    bool isClassified = all(equal(texture2D(classifiedTexture, v_textureCoordinates), vec4(0.0)));\n#ifdef UNCLASSIFIED\n    vec4 highlightColor = czm_invertClassificationColor;\n    if (isClassified)\n    {\n        discard;\n    }\n#else\n    vec4 highlightColor = vec4(1.0);\n    if (!isClassified)\n    {\n        discard;\n    }\n#endif\n    gl_FragColor = color * highlightColor;\n    gl_FragDepthEXT = texture2D(depthTexture, v_textureCoordinates).r;\n}\n",d=new S.a({defines:["UNCLASSIFIED"],sources:[u]}),c=new S.a({sources:[u]});this._unclassifiedCommand=e.createViewportQuadCommand(d,{renderState:Object(s.default)(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),this._classifiedCommand=e.createViewportQuadCommand(c,{renderState:Object(s.default)(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),Object(s.default)(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy()),Object(s.default)(this._previousFramebuffer)||(this._translucentCommand=e.createViewportQuadCommand(Od,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))}},bc.prototype.clear=function(e,t){var a=t.framebuffer;Object(s.default)(this._previousFramebuffer)?(t.framebuffer=this._fbo,this._clearColorCommand.execute(e,t)):(t.framebuffer=this._fbo,this._clearCommand.execute(e,t),t.framebuffer=this._fboClassified,this._clearCommand.execute(e,t)),t.framebuffer=a},bc.prototype.executeClassified=function(e,t){if(!Object(s.default)(this._previousFramebuffer)){var a=t.framebuffer;t.framebuffer=this._fboClassified,this._translucentCommand.execute(e,t),t.framebuffer=a}this._classifiedCommand.execute(e,t)},bc.prototype.executeUnclassified=function(e,t){this._unclassifiedCommand.execute(e,t)},bc.prototype.isDestroyed=function(){return!1},bc.prototype.destroy=function(){return this._fbo=this._fbo&&this._fbo.destroy(),this._texture=this._texture&&this._texture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),Object(s.default)(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),Object(l.default)(this)};var xc=bc,Tc=a(653);function Ec(e){this._total=e,this.usedThisFrame=0,this.stolenFromMeThisFrame=0,this.starvedThisFrame=!1,this.starvedLastFrame=!1}function Ac(e){var t=new Array(Tc.a.NUMBER_OF_JOB_TYPES);t[Tc.a.TEXTURE]=new Ec(Object(s.default)(e)?e[Tc.a.TEXTURE]:10),t[Tc.a.PROGRAM]=new Ec(Object(s.default)(e)?e[Tc.a.PROGRAM]:10),t[Tc.a.BUFFER]=new Ec(Object(s.default)(e)?e[Tc.a.BUFFER]:30);var a,i=t.length,n=0;for(a=0;a<i;++a)n+=t[a].total;var r=new Array(i);for(a=0;a<i;++a)r[a]=!1;this._totalBudget=n,this._totalUsedThisFrame=0,this._budgets=t,this._executedThisFrame=r}Object.defineProperties(Ec.prototype,{total:{get:function(){return this._total}}}),Ac.getTimestamp=ya.default,Object.defineProperties(Ac.prototype,{totalBudget:{get:function(){return this._totalBudget}}}),Ac.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget},Ac.prototype.resetBudgets=function(){for(var e=this._budgets,t=e.length,a=0;a<t;++a){var i=e[a];i.starvedLastFrame=i.starvedThisFrame,i.starvedThisFrame=!1,i.usedThisFrame=0,i.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0},Ac.prototype.execute=function(e,t){var a,i=this._budgets,n=i[t],r=this._executedThisFrame[t];if(this._totalUsedThisFrame>=this._totalBudget&&r)return n.starvedThisFrame=!0,!1;if(n.usedThisFrame+n.stolenFromMeThisFrame>=n.total){var o,s=i.length;for(o=0;o<s&&(!((a=i[o]).usedThisFrame+a.stolenFromMeThisFrame<a.total)||a.starvedLastFrame);++o);if(o===s&&r)return!1;r&&(n.starvedThisFrame=!0)}var l=Ac.getTimestamp();e.execute();var u=Ac.getTimestamp()-l;return this._totalUsedThisFrame+=u,a?a.stolenFromMeThisFrame+=u:n.usedThisFrame+=u,this._executedThisFrame[t]=!0,!0};var Pc=Ac,Sc=a(773),Dc=a(358);function Fc(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(Dc.default)(e.container);this._container=t;var a=document.createElement("div");a.className="cesium-performanceDisplay";var i=document.createElement("div");i.className="cesium-performanceDisplay-fps",this._fpsText=document.createTextNode(""),i.appendChild(this._fpsText);var n=document.createElement("div");n.className="cesium-performanceDisplay-ms",this._msText=document.createTextNode(""),n.appendChild(this._msText),a.appendChild(n),a.appendChild(i),this._container.appendChild(a),this._lastFpsSampleTime=Object(ya.default)(),this._lastMsSampleTime=Object(ya.default)(),this._fpsFrameCount=0,this._msFrameCount=0,this._throttled=!1;var r=document.createElement("div");r.className="cesium-performanceDisplay-throttled",this._throttledText=document.createTextNode(""),r.appendChild(this._throttledText),a.appendChild(r)}Object.defineProperties(Fc.prototype,{throttled:{get:function(){return this._throttled},set:function(e){this._throttled!==e&&(this._throttledText.nodeValue=e?"(throttled)":"",this._throttled=e)}}}),Fc.prototype.update=function(e){var t=Object(ya.default)(),a=Object(o.default)(e,!0);this._fpsFrameCount++;var i=t-this._lastFpsSampleTime;if(i>1e3){var n="N/A";a&&(n=1e3*this._fpsFrameCount/i|0),this._fpsText.nodeValue=n+" FPS",this._lastFpsSampleTime=t,this._fpsFrameCount=0}this._msFrameCount++;var r=t-this._lastMsSampleTime;if(r>200){var s="N/A";a&&(s=(r/this._msFrameCount).toFixed(2)),this._msText.nodeValue=s+" MS",this._lastMsSampleTime=t,this._msFrameCount=0}},Fc.prototype.destroy=function(){return Object(l.default)(this)};var Mc=Fc,Ic=a(150),Rc=a(90),Nc=a(236);function Lc(){this._framebuffer=void 0,this._depthTexture=void 0,this._textureToCopy=void 0,this._copyDepthCommand=void 0,this._useLogDepth=void 0,this._debugPickDepthViewportCommand=void 0}function jc(e){e._depthTexture=e._depthTexture&&!e._depthTexture.isDestroyed()&&e._depthTexture.destroy()}function Vc(e){e._framebuffer=e._framebuffer&&!e._framebuffer.isDestroyed()&&e._framebuffer.destroy()}function Uc(e,t,a,i){jc(e),Vc(e),function(e,t,a,i){e._depthTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE})}(e,t,a,i),e._framebuffer=new Hr.a({context:t,colorTextures:[e._depthTexture],destroyAttachments:!1})}Lc.prototype.executeDebugPickDepth=function(e,t,a){!function(e,t,a,i){if(!Object(s.default)(e._debugPickDepthViewportCommand)||i!==e._useLogDepth){var n=new S.a({defines:[i?"LOG_DEPTH":""],sources:["uniform highp sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_texture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});e._debugPickDepthViewportCommand=t.createViewportQuadCommand(n,{uniformMap:{u_texture:function(){return e._depthTexture}},owner:e}),e._useLogDepth=i}e._debugPickDepthViewportCommand.execute(t,a)}(this,e,t,a)},Lc.prototype.update=function(e,t){!function(e,t,a){var i=a.width,n=a.height,r=e._depthTexture,o=!Object(s.default)(r)||r.width!==i||r.height!==n;Object(s.default)(e._framebuffer)&&!o||Uc(e,t,i,n)}(this,e,t),function(e,t,a){if(!Object(s.default)(e._copyDepthCommand)){e._copyDepthCommand=t.createViewportQuadCommand("uniform highp sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_texture, v_textureCoordinates).r);\n}\n",{renderState:ce.a.fromCache(),uniformMap:{u_texture:function(){return e._textureToCopy}},owner:e})}e._textureToCopy=a,e._copyDepthCommand.framebuffer=e._framebuffer}(this,e,t)};var Bc=new G.a,zc=new G.a(1,1/255,1/65025,1/16581375);Lc.prototype.getDepth=function(e,t,a){if(Object(s.default)(this._framebuffer)){var i=e.readPixels({x:t,y:a,width:1,height:1,framebuffer:this._framebuffer}),n=G.a.unpack(i,0,Bc);return G.a.divideByScalar(n,255,n),G.a.dot(n,zc)}},Lc.prototype.executeCopyDepth=function(e,t){this._copyDepthCommand.execute(e,t)},Lc.prototype.isDestroyed=function(){return!1},Lc.prototype.destroy=function(){return jc(this),Vc(this),Object(s.default)(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=Object(s.default)(this._copyDepthCommand.shaderProgram)&&this._copyDepthCommand.shaderProgram.destroy()),Object(l.default)(this)};var Hc=Lc,kc=a(369),Gc=a(186),Wc=a(323);var Yc=function(e,t){this.near=Object(o.default)(e,0),this.far=Object(o.default)(t,0);for(var a=de.a.NUMBER_OF_PASSES,i=new Array(a),n=new Array(a),r=0;r<a;++r)i[r]=[],n[r]=0;this.commands=i,this.indices=n},Xc={RGBA4:Kr.a.RGBA4,RGB5_A1:Kr.a.RGB5_A1,RGB565:Kr.a.RGB565,DEPTH_COMPONENT16:Kr.a.DEPTH_COMPONENT16,STENCIL_INDEX8:Kr.a.STENCIL_INDEX8,DEPTH_STENCIL:Kr.a.DEPTH_STENCIL,validate:function(e){return e===Xc.RGBA4||e===Xc.RGB5_A1||e===Xc.RGB565||e===Xc.DEPTH_COMPONENT16||e===Xc.STENCIL_INDEX8||e===Xc.DEPTH_STENCIL}},Qc=Object.freeze(Xc);function qc(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).context._gl,a=(le.a.maximumRenderbufferSize,Object(o.default)(e.format,Qc.RGBA4)),i=Object(s.default)(e.width)?e.width:t.drawingBufferWidth,n=Object(s.default)(e.height)?e.height:t.drawingBufferHeight;this._gl=t,this._format=a,this._width=i,this._height=n,this._renderbuffer=this._gl.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderbuffer),t.renderbufferStorage(t.RENDERBUFFER,a,i,n),t.bindRenderbuffer(t.RENDERBUFFER,null)}Object.defineProperties(qc.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}}),qc.prototype._getRenderbuffer=function(){return this._renderbuffer},qc.prototype.isDestroyed=function(){return!1},qc.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),Object(l.default)(this)};var Zc=qc;function Kc(){this._colorTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._packedDepthTexture=void 0,this._packedDepthFramebuffer=void 0,this._renderState=void 0,this._packedDepthCommand=void 0,this._clearCommand=void 0,this._viewport=new fr.default,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHdr=void 0}function Jc(e){e._colorTexture=e._colorTexture&&!e._colorTexture.isDestroyed()&&e._colorTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&!e._depthStencilTexture.isDestroyed()&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&!e._depthStencilRenderbuffer.isDestroyed()&&e._depthStencilRenderbuffer.destroy(),e._framebuffer=e._framebuffer&&!e._framebuffer.isDestroyed()&&e._framebuffer.destroy(),e._packedDepthTexture=e._packedDepthTexture&&!e._packedDepthTexture.isDestroyed()&&e._packedDepthTexture.destroy(),e._packedDepthFramebuffer=e._packedDepthFramebuffer&&!e._packedDepthFramebuffer.isDestroyed()&&e._packedDepthFramebuffer.destroy()}function $c(e,t,a,i,n){var r=e._colorTexture;(!Object(s.default)(r)||r.width!==a||r.height!==i||n!==e._useHdr)&&(Jc(e),function(e,t,a,i,n){var r=n?t.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;e._colorTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:r,sampler:Ce.a.NEAREST}),t.depthTexture?e._depthStencilTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8}):e._depthStencilRenderbuffer=new Zc({context:t,width:a,height:i,format:Qc.DEPTH_STENCIL}),e._framebuffer=new Hr.a({context:t,colorTextures:[e._colorTexture],depthStencilTexture:e._depthStencilTexture,depthStencilRenderbuffer:e._depthStencilRenderbuffer,destroyAttachments:!1}),e._packedDepthTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Ce.a.NEAREST}),e._packedDepthFramebuffer=new Hr.a({context:t,colorTextures:[e._packedDepthTexture],destroyAttachments:!1})}(e,t,a,i,n))}Object.defineProperties(Kc.prototype,{classificationTexture:{get:function(){return this._colorTexture}},classificationFramebuffer:{get:function(){return this._framebuffer}}}),Kc.prototype.updateAndClear=function(e,t,a,i){var n=t.width,r=t.height;$c(this,a,n,r,e),function(e,t,a,i,n){e._viewport.width=a,e._viewport.height=i;var r=!fr.default.equals(e._viewport,n.viewport),o=r!==e._useScissorTest;e._useScissorTest=r,fr.default.equals(e._scissorRectangle,n.viewport)||(e._scissorRectangle=fr.default.clone(n.viewport,e._scissorRectangle),o=!0),Object(s.default)(e._renderState)&&fr.default.equals(e._viewport,e._renderState.viewport)&&!o||(e._renderState=ce.a.fromCache({viewport:e._viewport,scissorTest:{enabled:e._useScissorTest,rectangle:e._scissorRectangle}})),Object(s.default)(e._packedDepthCommand)||(e._packedDepthCommand=t.createViewportQuadCommand(xd,{uniformMap:{u_depthTexture:function(){return e._depthStencilTexture}},owner:e})),Object(s.default)(e._clearCommand)||(e._clearCommand=new Br.a({color:new b.default(0,0,0,0),depth:1,stencil:0,owner:e})),e._packedDepthCommand.framebuffer=e._packedDepthFramebuffer,e._packedDepthCommand.renderState=e._renderState,e._clearCommand.framebuffer=e._framebuffer,e._clearCommand.renderState=e._renderState}(this,a,n,r,i),this._useHdr=e},Kc.prototype.clearClassification=function(e,t){this._clearCommand.execute(e,t)},Kc.prototype.packDepth=function(e,t){return this._packedDepthCommand.execute(e,t),this._packedDepthTexture},Kc.prototype.isDestroyed=function(){return!1},Kc.prototype.destroy=function(){return Jc(this),Object(l.default)(this)};var ef=Kc,tf="#ifdef MRT\n#extension GL_EXT_draw_buffers : enable\n#endif\n\nuniform vec4 u_bgColor;\nuniform sampler2D u_depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    if (texture2D(u_depthTexture, v_textureCoordinates).r < 1.0)\n    {\n#ifdef MRT\n        gl_FragData[0] = u_bgColor;\n        gl_FragData[1] = vec4(u_bgColor.a);\n#else\n        gl_FragColor = u_bgColor;\n#endif\n        return;\n    }\n    \n    discard;\n}\n",af=a(590),nf=a(591);function rf(e){this._translucentMultipassSupport=!1,this._translucentMRTSupport=!1;var t=e.colorBufferFloat&&e.depthTexture;this._translucentMRTSupport=e.drawBuffers&&t,this._translucentMultipassSupport=!this._translucentMRTSupport&&t,this._opaqueFBO=void 0,this._opaqueTexture=void 0,this._depthStencilTexture=void 0,this._accumulationTexture=void 0,this._translucentFBO=void 0,this._alphaFBO=void 0,this._adjustTranslucentFBO=void 0,this._adjustAlphaFBO=void 0,this._opaqueClearCommand=new Br.a({color:new b.default(0,0,0,0),owner:this}),this._translucentMRTClearCommand=new Br.a({color:new b.default(0,0,0,1),owner:this}),this._translucentMultipassClearCommand=new Br.a({color:new b.default(0,0,0,0),owner:this}),this._alphaClearCommand=new Br.a({color:new b.default(1,1,1,1),owner:this}),this._translucentRenderStateCache={},this._alphaRenderStateCache={},this._compositeCommand=void 0,this._adjustTranslucentCommand=void 0,this._adjustAlphaCommand=void 0,this._viewport=new fr.default,this._rs=void 0,this._useScissorTest=!1,this._scissorRectangle=void 0,this._useHDR=!1}function of(e){e._accumulationTexture=e._accumulationTexture&&!e._accumulationTexture.isDestroyed()&&e._accumulationTexture.destroy(),e._revealageTexture=e._revealageTexture&&!e._revealageTexture.isDestroyed()&&e._revealageTexture.destroy()}function sf(e){e._translucentFBO=e._translucentFBO&&!e._translucentFBO.isDestroyed()&&e._translucentFBO.destroy(),e._alphaFBO=e._alphaFBO&&!e._alphaFBO.isDestroyed()&&e._alphaFBO.destroy(),e._adjustTranslucentFBO=e._adjustTranslucentFBO&&!e._adjustTranslucentFBO.isDestroyed()&&e._adjustTranslucentFBO.destroy(),e._adjustAlphaFBO=e._adjustAlphaFBO&&!e._adjustAlphaFBO.isDestroyed()&&e._adjustAlphaFBO.destroy()}function lf(e){of(e),sf(e)}rf.prototype.update=function(e,t,a,i){if(this.isSupported()){this._opaqueFBO=a,this._opaqueTexture=a.getColorTexture(0),this._depthStencilTexture=a.depthStencilTexture;var n=this._opaqueTexture.width,r=this._opaqueTexture.height,o=this._accumulationTexture,l=!Object(s.default)(o)||o.width!==n||o.height!==r||i!==this._useHDR;if(l&&function(e,t,a,i){of(e),e._accumulationTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.FLOAT});var n=new Float32Array(a*i*4);e._revealageTexture=new D.a({context:t,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.FLOAT,source:{arrayBufferView:n,width:a,height:i},flipY:!1})}(this,e,n,r),Object(s.default)(this._translucentFBO)&&!l||function(e,t){sf(e);var a=Kr.a.FRAMEBUFFER_COMPLETE,i=!0;if(e._translucentMRTSupport&&(e._translucentFBO=new Hr.a({context:t,colorTextures:[e._accumulationTexture,e._revealageTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._adjustTranslucentFBO=new Hr.a({context:t,colorTextures:[e._accumulationTexture,e._revealageTexture],destroyAttachments:!1}),e._translucentFBO.status===a&&e._adjustTranslucentFBO.status===a||(sf(e),e._translucentMRTSupport=!1)),!e._translucentMRTSupport){e._translucentFBO=new Hr.a({context:t,colorTextures:[e._accumulationTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._alphaFBO=new Hr.a({context:t,colorTextures:[e._revealageTexture],depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1}),e._adjustTranslucentFBO=new Hr.a({context:t,colorTextures:[e._accumulationTexture],destroyAttachments:!1}),e._adjustAlphaFBO=new Hr.a({context:t,colorTextures:[e._revealageTexture],destroyAttachments:!1});var n=e._translucentFBO.status===a,r=e._alphaFBO.status===a,o=e._adjustTranslucentFBO.status===a,s=e._adjustAlphaFBO.status===a;n&&r&&o&&s||(lf(e),e._translucentMultipassSupport=!1,i=!1)}return i}(this,e)){this._useHDR=i;var u,d,c=this;Object(s.default)(this._compositeCommand)||(u=new S.a({sources:["/**\n * Compositing for Weighted Blended Order-Independent Transparency. See:\n * - http://jcgt.org/published/0002/02/09/\n * - http://casual-effects.blogspot.com/2014/03/weighted-blended-order-independent.html\n */\n\nuniform sampler2D u_opaque;\nuniform sampler2D u_accumulation;\nuniform sampler2D u_revealage;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 opaque = texture2D(u_opaque, v_textureCoordinates);\n    vec4 accum = texture2D(u_accumulation, v_textureCoordinates);\n    float r = texture2D(u_revealage, v_textureCoordinates).r;\n\n#ifdef MRT\n    vec4 transparent = vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);\n#else\n    vec4 transparent = vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);\n#endif\n\n    gl_FragColor = (1.0 - transparent.a) * transparent + transparent.a * opaque;\n\n    if (opaque != czm_backgroundColor)\n    {\n        gl_FragColor.a = 1.0;\n    }\n}\n"]}),this._translucentMRTSupport&&u.defines.push("MRT"),d={u_opaque:function(){return c._opaqueTexture},u_accumulation:function(){return c._accumulationTexture},u_revealage:function(){return c._revealageTexture}},this._compositeCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this})),Object(s.default)(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(u=new S.a({defines:["MRT"],sources:[tf]}),d={u_bgColor:function(){return c._translucentMRTClearCommand.color},u_depthTexture:function(){return c._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this})):this._translucentMultipassSupport&&(u=new S.a({sources:[tf]}),d={u_bgColor:function(){return c._translucentMultipassClearCommand.color},u_depthTexture:function(){return c._depthStencilTexture}},this._adjustTranslucentCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this}),d={u_bgColor:function(){return c._alphaClearCommand.color},u_depthTexture:function(){return c._depthStencilTexture}},this._adjustAlphaCommand=e.createViewportQuadCommand(u,{uniformMap:d,owner:this}))),this._viewport.width=n,this._viewport.height=r;var f=!fr.default.equals(this._viewport,t.viewport),h=f!==this._useScissorTest;this._useScissorTest=f,fr.default.equals(this._scissorRectangle,t.viewport)||(this._scissorRectangle=fr.default.clone(t.viewport,this._scissorRectangle),h=!0),Object(s.default)(this._rs)&&fr.default.equals(this._viewport,this._rs.viewport)&&!h||(this._rs=ce.a.fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}})),Object(s.default)(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs),this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs),Object(s.default)(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs)}}};var uf={enabled:!0,color:new b.default(0,0,0,0),equationRgb:af.a.ADD,equationAlpha:af.a.ADD,functionSourceRgb:nf.a.ONE,functionDestinationRgb:nf.a.ONE,functionSourceAlpha:nf.a.ZERO,functionDestinationAlpha:nf.a.ONE_MINUS_SOURCE_ALPHA},df={enabled:!0,color:new b.default(0,0,0,0),equationRgb:af.a.ADD,equationAlpha:af.a.ADD,functionSourceRgb:nf.a.ONE,functionDestinationRgb:nf.a.ONE,functionSourceAlpha:nf.a.ONE,functionDestinationAlpha:nf.a.ONE},cf={enabled:!0,color:new b.default(0,0,0,0),equationRgb:af.a.ADD,equationAlpha:af.a.ADD,functionSourceRgb:nf.a.ZERO,functionDestinationRgb:nf.a.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:nf.a.ZERO,functionDestinationAlpha:nf.a.ONE_MINUS_SOURCE_ALPHA};function ff(e,t,a,i){var n=a[i.id];if(!Object(s.default)(n)){var r=ce.a.getState(i);r.depthMask=!1,r.blending=t,n=ce.a.fromCache(r),a[i.id]=n}return n}var hf="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragData[0] = vec4(Ci * wzi, ai);\n    gl_FragData[1] = vec4(ai * wzi);\n",mf="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragColor = vec4(Ci, ai) * wzi;\n",pf="    float ai = czm_gl_FragColor.a;\n    gl_FragColor = vec4(ai);\n";function _f(e,t,a,i){var n=e.shaderCache.getDerivedShaderProgram(t,a);if(!Object(s.default)(n)){var r=t._attributeLocations,o=t.fragmentShaderSource.clone();o.sources=o.sources.map((function(e){return e=(e=(e=(e=S.a.replaceMain(e,"czm_translucent_main")).replace(/gl_FragColor/g,"czm_gl_FragColor")).replace(/\bdiscard\b/g,"czm_discard = true")).replace(/czm_phong/g,"czm_translucentPhong")})),o.sources.splice(0,0,(-1!==i.indexOf("gl_FragData")?"#extension GL_EXT_draw_buffers : enable \n":"")+"vec4 czm_gl_FragColor;\nbool czm_discard = false;\n"),o.sources.push("void main()\n{\n    czm_translucent_main();\n    if (czm_discard)\n    {\n        discard;\n    }\n"+i+"}\n"),n=e.shaderCache.createDerivedShaderProgram(t,a,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:o,attributeLocations:r})}return n}rf.prototype.createDerivedCommands=function(e,t,a){var i,n,r,o,l,u,d,c;(Object(s.default)(a)||(a={}),this._translucentMRTSupport)?(Object(s.default)(a.translucentCommand)&&(i=a.translucentCommand.shaderProgram,n=a.translucentCommand.renderState),a.translucentCommand=ue.a.shallowClone(e,a.translucentCommand),Object(s.default)(i)&&a.shaderProgramId===e.shaderProgram.id?(a.translucentCommand.shaderProgram=i,a.translucentCommand.renderState=n):(a.translucentCommand.shaderProgram=function(e,t){return _f(e,t,"translucentMRT",hf)}(t,e.shaderProgram),a.translucentCommand.renderState=(d=this,c=e.renderState,ff(0,uf,d._translucentRenderStateCache,c)),a.shaderProgramId=e.shaderProgram.id)):(Object(s.default)(a.translucentCommand)&&(r=a.translucentCommand.shaderProgram,o=a.translucentCommand.renderState,l=a.alphaCommand.shaderProgram,u=a.alphaCommand.renderState),a.translucentCommand=ue.a.shallowClone(e,a.translucentCommand),a.alphaCommand=ue.a.shallowClone(e,a.alphaCommand),Object(s.default)(r)&&a.shaderProgramId===e.shaderProgram.id?(a.translucentCommand.shaderProgram=r,a.translucentCommand.renderState=o,a.alphaCommand.shaderProgram=l,a.alphaCommand.renderState=u):(a.translucentCommand.shaderProgram=function(e,t){return _f(e,t,"translucentMultipass",mf)}(t,e.shaderProgram),a.translucentCommand.renderState=function(e,t,a){return ff(0,df,e._translucentRenderStateCache,a)}(this,0,e.renderState),a.alphaCommand.shaderProgram=function(e,t){return _f(e,t,"alphaMultipass",pf)}(t,e.shaderProgram),a.alphaCommand.renderState=function(e,t,a){return ff(0,cf,e._alphaRenderStateCache,a)}(this,0,e.renderState),a.shaderProgramId=e.shaderProgram.id));return a},rf.prototype.executeCommands=function(e,t,a,i,n){this._translucentMRTSupport?function(e,t,a,i,n,r){var o=t.context,l=t.frameState.useLogDepth,u=t._hdr,d=i.framebuffer,c=n.length,f=t.frameState.shadowState.lightShadowsEnabled;i.framebuffer=e._adjustTranslucentFBO,e._adjustTranslucentCommand.execute(o,i);var h,m=e._opaqueFBO;i.framebuffer=e._translucentFBO;for(var p=0;p<c;++p)h=n[p],h=l?h.derivedCommands.logDepth.command:h,h=u?h.derivedCommands.hdr.command:h,a(f&&h.receiveShadows?h.derivedCommands.oit.shadows.translucentCommand:h.derivedCommands.oit.translucentCommand,t,o,i,m);Object(s.default)(r)&&(h=r.unclassifiedCommand,a(f&&h.receiveShadows?h.derivedCommands.oit.shadows.translucentCommand:h.derivedCommands.oit.translucentCommand,t,o,i,m)),i.framebuffer=d}(this,e,t,a,i,n):function(e,t,a,i,n,r){var o,l,u=t.context,d=t.frameState.useLogDepth,c=t._hdr,f=i.framebuffer,h=n.length,m=t.frameState.shadowState.lightShadowsEnabled;i.framebuffer=e._adjustTranslucentFBO,e._adjustTranslucentCommand.execute(u,i),i.framebuffer=e._adjustAlphaFBO,e._adjustAlphaCommand.execute(u,i);var p=e._opaqueFBO;for(i.framebuffer=e._translucentFBO,l=0;l<h;++l)o=n[l],o=d?o.derivedCommands.logDepth.command:o,o=c?o.derivedCommands.hdr.command:o,a(m&&o.receiveShadows?o.derivedCommands.oit.shadows.translucentCommand:o.derivedCommands.oit.translucentCommand,t,u,i,p);for(Object(s.default)(r)&&(o=r.unclassifiedCommand,a(m&&o.receiveShadows?o.derivedCommands.oit.shadows.translucentCommand:o.derivedCommands.oit.translucentCommand,t,u,i,p)),i.framebuffer=e._alphaFBO,l=0;l<h;++l)o=n[l],o=d?o.derivedCommands.logDepth.command:o,o=c?o.derivedCommands.hdr.command:o,a(m&&o.receiveShadows?o.derivedCommands.oit.shadows.alphaCommand:o.derivedCommands.oit.alphaCommand,t,u,i,p);Object(s.default)(r)&&(o=r.unclassifiedCommand,a(m&&o.receiveShadows?o.derivedCommands.oit.shadows.alphaCommand:o.derivedCommands.oit.alphaCommand,t,u,i,p)),i.framebuffer=f}(this,e,t,a,i,n)},rf.prototype.execute=function(e,t){this._compositeCommand.execute(e,t)},rf.prototype.clear=function(e,t,a){var i=t.framebuffer;t.framebuffer=this._opaqueFBO,b.default.clone(a,this._opaqueClearCommand.color),this._opaqueClearCommand.execute(e,t),t.framebuffer=this._translucentFBO,(this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand).execute(e,t),this._translucentMultipassSupport&&(t.framebuffer=this._alphaFBO,this._alphaClearCommand.execute(e,t)),t.framebuffer=i},rf.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport},rf.prototype.isDestroyed=function(){return!1},rf.prototype.destroy=function(){return lf(this),Object(s.default)(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),Object(s.default)(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy()),Object(s.default)(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy()),Object(l.default)(this)};var gf=rf;function vf(){this._depthStencilTexture=void 0,this._framebuffer=void 0,this._passState=void 0}function yf(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy()}vf.prototype.update=function(e,t,a){var i=a.width,n=a.height;Object(s.default)(this._framebuffer)&&i===this._depthStencilTexture.width&&n===this._depthStencilTexture.height||(yf(this),function(e,t){var a=t.drawingBufferWidth,i=t.drawingBufferHeight;e._depthStencilTexture=new D.a({context:t,width:a,height:i,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8}),e._framebuffer=new Hr.a({context:t,depthStencilTexture:e._depthStencilTexture,destroyAttachments:!1});var n=new $r(t);n.blendingEnabled=!1,n.scissorTest={enabled:!0,rectangle:new fr.default},n.viewport=new fr.default,e._passState=n}(this,e));var r=this._framebuffer,o=this._passState;return o.framebuffer=r,o.viewport.width=i,o.viewport.height=n,o.scissorTest.rectangle.x=t.x,o.scissorTest.rectangle.y=n-t.y,o.scissorTest.rectangle.width=1,o.scissorTest.rectangle.height=1,o},vf.prototype.isDestroyed=function(){return!1},vf.prototype.destroy=function(){return yf(this),Object(l.default)(this)};var bf=vf;function wf(e){var t=new $r(e);t.blendingEnabled=!1,t.scissorTest={enabled:!0,rectangle:new fr.default},t.viewport=new fr.default,this._context=e,this._fb=void 0,this._passState=t,this._width=0,this._height=0}wf.prototype.begin=function(e,t){var a=this._context,i=t.width,n=t.height;return fr.default.clone(e,this._passState.scissorTest.rectangle),Object(s.default)(this._fb)&&this._width===i&&this._height===n||(this._width=i,this._height=n,this._fb=this._fb&&this._fb.destroy(),this._fb=new Hr.a({context:a,colorTextures:[new D.a({context:a,width:i,height:n})],depthStencilRenderbuffer:new Zc({context:a,width:i,height:n,format:Qc.DEPTH_STENCIL})}),this._passState.framebuffer=this._fb),this._passState.viewport.width=i,this._passState.viewport.height=n,this._passState};var Cf=new b.default;wf.prototype.end=function(e){for(var t=Object(o.default)(e.width,1),a=Object(o.default)(e.height,1),i=this._context,n=i.readPixels({x:e.x,y:e.y,width:t,height:a,framebuffer:this._fb}),r=Math.max(t,a),l=r*r,u=Math.floor(.5*t),d=Math.floor(.5*a),c=0,f=0,h=0,m=-1,p=0;p<l;++p){if(-u<=c&&c<=u&&-d<=f&&f<=d){var _=4*((d-f)*t+c+u);Cf.red=b.default.byteToFloat(n[_]),Cf.green=b.default.byteToFloat(n[_+1]),Cf.blue=b.default.byteToFloat(n[_+2]),Cf.alpha=b.default.byteToFloat(n[_+3]);var g=i.getObjectByPickColor(Cf);if(Object(s.default)(g))return g}if(c===f||c<0&&-c===f||c>0&&c===1-f){var v=h;h=-m,m=v}c+=h,f+=m}},wf.prototype.isDestroyed=function(){return!1},wf.prototype.destroy=function(){return this._fb=this._fb&&this._fb.destroy(),Object(l.default)(this)};var Of=wf;function xf(){this._colorTexture=void 0,this._idTexture=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._framebuffer=void 0,this._idFramebuffer=void 0,this._idClearColor=new b.default(0,0,0,0),this._useHdr=void 0,this._clearCommand=new Br.a({color:new b.default(0,0,0,0),depth:1,owner:this})}function Tf(e){e._framebuffer=e._framebuffer&&e._framebuffer.destroy(),e._idFramebuffer=e._idFramebuffer&&e._idFramebuffer.destroy(),e._colorTexture=e._colorTexture&&e._colorTexture.destroy(),e._idTexture=e._idTexture&&e._idTexture.destroy(),e._depthStencilTexture=e._depthStencilTexture&&e._depthStencilTexture.destroy(),e._depthStencilRenderbuffer=e._depthStencilRenderbuffer&&e._depthStencilRenderbuffer.destroy(),e._depthStencilIdTexture=e._depthStencilIdTexture&&e._depthStencilIdTexture.destroy(),e._depthStencilIdRenderbuffer=e._depthStencilIdRenderbuffer&&e._depthStencilIdRenderbuffer.destroy(),e._framebuffer=void 0,e._idFramebuffer=void 0,e._colorTexture=void 0,e._idTexture=void 0,e._depthStencilTexture=void 0,e._depthStencilRenderbuffer=void 0,e._depthStencilIdTexture=void 0,e._depthStencilIdRenderbuffer=void 0}xf.prototype.update=function(e,t,a){var i=t.width,n=t.height,r=this._colorTexture;if(!Object(s.default)(r)||r.width!==i||r.height!==n||a!==this._useHdr){Tf(this),this._useHdr=a;var o=a?e.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;this._colorTexture=new D.a({context:e,width:i,height:n,pixelFormat:_e.a.RGBA,pixelDatatype:o,sampler:Ce.a.NEAREST}),this._idTexture=new D.a({context:e,width:i,height:n,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Ce.a.NEAREST}),e.depthTexture?(this._depthStencilTexture=new D.a({context:e,width:i,height:n,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8,sampler:Ce.a.NEAREST}),this._depthStencilIdTexture=new D.a({context:e,width:i,height:n,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8,sampler:Ce.a.NEAREST})):(this._depthStencilRenderbuffer=new Zc({context:e,width:i,height:n,format:Qc.DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new Zc({context:e,width:i,height:n,format:Qc.DEPTH_STENCIL})),this._framebuffer=new Hr.a({context:e,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._idFramebuffer=new Hr.a({context:e,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1})}},xf.prototype.clear=function(e,t,a){var i=t.framebuffer;t.framebuffer=this._framebuffer,b.default.clone(a,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=this._idFramebuffer,b.default.clone(this._idClearColor,this._clearCommand.color),this._clearCommand.execute(e,t),t.framebuffer=i},xf.prototype.getFramebuffer=function(){return this._framebuffer},xf.prototype.getIdFramebuffer=function(){return this._idFramebuffer},xf.prototype.isDestroyed=function(){return!1},xf.prototype.destroy=function(){return Tf(this),Object(l.default)(this)};var Ef=xf;function Af(){}Af.getShadowCastShaderKeyword=function(e,t,a,i){return"castShadow "+e+" "+t+" "+a+" "+i},Af.createShadowCastVertexShader=function(e,t,a){var i=e.defines.slice(0),n=e.sources.slice(0);i.push("SHADOW_MAP"),a&&i.push("GENERATE_POSITION");var r=S.a.findPositionVarying(e),o=Object(s.default)(r);if(t&&!o){for(var l=n.length,u=0;u<l;++u)n[u]=S.a.replaceMain(n[u],"czm_shadow_cast_main");n.push("varying vec3 v_positionEC; \nvoid main() \n{ \n    czm_shadow_cast_main(); \n    v_positionEC = (czm_inverseProjection * gl_Position).xyz; \n}")}return new S.a({defines:i,sources:n})},Af.createShadowCastFragmentShader=function(e,t,a,i){var n=e.defines.slice(0),r=e.sources.slice(0),o=S.a.findPositionVarying(e),l=Object(s.default)(o);l||(o="v_positionEC");for(var u=r.length,d=0;d<u;++d)r[d]=S.a.replaceMain(r[d],"czm_shadow_cast_main");var c="";return t&&(l||(c+="varying vec3 v_positionEC; \n"),c+="uniform vec4 shadowMap_lightPositionEC; \n"),c+=i?"void main() \n{ \n":"void main() \n{ \n    czm_shadow_cast_main(); \n    if (gl_FragColor.a == 0.0) \n    { \n       discard; \n    } \n",c+=t?"    float distance = length("+o+"); \n    if (distance >= shadowMap_lightPositionEC.w) \n    { \n        discard; \n    } \n    distance /= shadowMap_lightPositionEC.w; // radius \n    gl_FragColor = czm_packDepth(distance); \n":a?"    gl_FragColor = vec4(1.0); \n":"    gl_FragColor = czm_packDepth(gl_FragCoord.z); \n",c+="} \n",r.push(c),new S.a({defines:n,sources:r})},Af.getShadowReceiveShaderKeyword=function(e,t,a,i){return"receiveShadow "+e._usesDepthTexture+e._polygonOffsetSupported+e._isPointLight+e._isSpotLight+(e._numberOfCascades>1)+e.debugCascadeColors+e.softShadows+t+a+i},Af.createShadowReceiveVertexShader=function(e,t,a){var i=e.defines.slice(0),n=e.sources.slice(0);return i.push("SHADOW_MAP"),t&&(a?i.push("GENERATE_POSITION_AND_NORMAL"):i.push("GENERATE_POSITION")),new S.a({defines:i,sources:n})},Af.createShadowReceiveFragmentShader=function(e,t,a,i,n){for(var r=S.a.findNormalVarying(e),o=!i&&Object(s.default)(r)||i&&n,l=S.a.findPositionVarying(e),u=Object(s.default)(l),d=t._usesDepthTexture,c=t._polygonOffsetSupported,f=t._isPointLight,h=t._isSpotLight,m=t._numberOfCascades>1,p=t.debugCascadeColors,_=t.softShadows,g=f?t._pointBias:i?t._terrainBias:t._primitiveBias,v=e.defines.slice(0),y=e.sources.slice(0),b=y.length,w=0;w<b;++w)y[w]=S.a.replaceMain(y[w],"czm_shadow_receive_main");f?v.push("USE_CUBE_MAP_SHADOW"):d&&v.push("USE_SHADOW_DEPTH_TEXTURE"),_&&!f&&v.push("USE_SOFT_SHADOWS"),m&&a&&i&&(o?v.push("ENABLE_VERTEX_LIGHTING"):v.push("ENABLE_DAYNIGHT_SHADING")),a&&g.normalShading&&o&&(v.push("USE_NORMAL_SHADING"),g.normalShadingSmooth>0&&v.push("USE_NORMAL_SHADING_SMOOTH"));var C="";return C+=f?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",C+="uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n"+(u?"    return vec4("+l+", 1.0); \n":"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n")+"} \nvec3 getNormalEC() \n{ \n"+(o?"    return normalize("+r+"); \n":"    return vec3(1.0); \n")+"} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n"+(g.normalOffset&&o?"    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale = 1.0 - nDotL; \n    vec3 offset = normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz += offset; \n":"")+"} \n",C+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC = getPositionEC(); \n    vec3 normalEC = getNormalEC(); \n    float depth = -positionEC.z; \n",C+="    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",i?C+="    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \n":c||(C+="    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \n"),C+=f?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords = directionWC; \n    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":h?"    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":m?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth > maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights = czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n"+(p?"    // Draw cascade colors for debugging \n    gl_FragColor *= czm_cascadeColor(weights); \n":""):"    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n",C+="    gl_FragColor.rgb *= visibility; \n} \n",y.push(C),new S.a({defines:v,sources:y})};var Pf=Af;function Sf(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).context;this._enabled=Object(o.default)(e.enabled,!0),this._softShadows=Object(o.default)(e.softShadows,!1),this._normalOffset=Object(o.default)(e.normalOffset,!0),this.dirty=!0,this.fromLightSource=Object(o.default)(e.fromLightSource,!0),this.darkness=Object(o.default)(e.darkness,.3),this._darkness=this.darkness,this.maximumDistance=Object(o.default)(e.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0;var a,i=!0;(c.default.isInternetExplorer()||c.default.isEdge()||(c.default.isChrome()||c.default.isFirefox())&&c.default.isWindows()&&!t.depthTexture)&&(i=!1),this._polygonOffsetSupported=i,this._terrainBias={polygonOffset:i,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1e-4},this._primitiveBias={polygonOffset:i,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5e-4},this._depthAttachment=void 0,this._colorAttachment=void 0,this._shadowMapMatrix=new $.default,this._shadowMapTexture=void 0,this._lightDirectionEC=new n.default,this._lightPositionEC=new G.a,this._distance=0,this._lightCamera=e.lightCamera,this._shadowMapCamera=new Yf,this._shadowMapCullingVolume=void 0,this._sceneCamera=void 0,this._boundingSphere=new v.default,this._isPointLight=Object(o.default)(e.isPointLight,!1),this._pointLightRadius=Object(o.default)(e.pointLightRadius,100),this._cascadesEnabled=!this._isPointLight&&Object(o.default)(e.cascadesEnabled,!0),this._numberOfCascades=this._cascadesEnabled?Object(o.default)(e.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new k.default,this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new ba.a:Object(s.default)(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new G.a,new G.a],this._cascadeMatrices=[new $.default,new $.default,new $.default,new $.default],this._cascadeDistances=new G.a,a=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1,this._passes=new Array(a);for(var r=0;r<a;++r)this._passes[r]=new Df(t);this.debugShow=!1,this.debugFreezeFrame=!1,this._debugFreezeFrame=!1,this._debugCascadeColors=!1,this._debugLightFrustum=void 0,this._debugCameraFrustum=void 0,this._debugCascadeFrustums=new Array(this._numberOfCascades),this._debugShadowViewCommand=void 0,this._usesDepthTexture=t.depthTexture,this._isPointLight&&(this._usesDepthTexture=!1),this._primitiveRenderState=void 0,this._terrainRenderState=void 0,this._pointRenderState=void 0,Mf(this),this._clearCommand=new Br.a({depth:1,color:new b.default}),this._clearPassState=new $r(t),this._size=Object(o.default)(e.size,2048),this.size=this._size}function Df(e){this.camera=new Yf,this.passState=new $r(e),this.framebuffer=void 0,this.textureOffsets=void 0,this.commandList=[],this.cullingVolume=void 0}function Ff(e,t){return ce.a.fromCache({cull:{enabled:!0,face:er.a.BACK},depthTest:{enabled:!0},colorMask:{red:e,green:e,blue:e,alpha:e},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function Mf(e){var t=!e._usesDepthTexture;e._primitiveRenderState=Ff(t,e._primitiveBias),e._terrainRenderState=Ff(t,e._terrainBias),e._pointRenderState=Ff(t,e._pointBias)}function If(e){for(var t=e._passes.length,a=0;a<t;++a){var i=e._passes[a],n=i.framebuffer;Object(s.default)(n)&&!n.isDestroyed()&&n.destroy(),i.framebuffer=void 0}e._depthAttachment=e._depthAttachment&&e._depthAttachment.destroy(),e._colorAttachment=e._colorAttachment&&e._colorAttachment.destroy()}function Rf(e,t){e._isPointLight?function(e,t){for(var a=new Zc({context:t,width:e._textureSize.x,height:e._textureSize.y,format:Qc.DEPTH_COMPONENT16}),i=new Jr.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Ce.a.NEAREST}),n=[i.negativeX,i.negativeY,i.negativeZ,i.positiveX,i.positiveY,i.positiveZ],r=0;r<6;++r){var o=new Hr.a({context:t,depthRenderbuffer:a,colorTextures:[n[r]],destroyAttachments:!1}),s=e._passes[r];s.framebuffer=o,s.passState.framebuffer=o}e._shadowMapTexture=i,e._depthAttachment=a,e._colorAttachment=i}(e,t):e._usesDepthTexture?function(e,t){for(var a=new D.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:_e.a.DEPTH_STENCIL,pixelDatatype:we.a.UNSIGNED_INT_24_8,sampler:Ce.a.NEAREST}),i=new Hr.a({context:t,depthStencilTexture:a,destroyAttachments:!1}),n=e._passes.length,r=0;r<n;++r){var o=e._passes[r];o.framebuffer=i,o.passState.framebuffer=i}e._shadowMapTexture=a,e._depthAttachment=a}(e,t):function(e,t){for(var a=new Zc({context:t,width:e._textureSize.x,height:e._textureSize.y,format:Qc.DEPTH_COMPONENT16}),i=new D.a({context:t,width:e._textureSize.x,height:e._textureSize.y,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,sampler:Ce.a.NEAREST}),n=new Hr.a({context:t,depthRenderbuffer:a,colorTextures:[i],destroyAttachments:!1}),r=e._passes.length,o=0;o<r;++o){var s=e._passes[o];s.framebuffer=n,s.passState.framebuffer=n}e._shadowMapTexture=i,e._depthAttachment=a,e._colorAttachment=i}(e,t)}function Nf(e,t){Object(s.default)(e._passes[0].framebuffer)&&e._shadowMapTexture.width===e._textureSize.x||(If(e),Rf(e,t),function(e,t){e._usesDepthTexture&&e._passes[0].framebuffer.status!==Kr.a.FRAMEBUFFER_COMPLETE&&(e._usesDepthTexture=!1,Mf(e),If(e),Rf(e,t))}(e,t),Lf(e,t))}function Lf(e,t,a){a=Object(o.default)(a,0),(e._isPointLight||0===a)&&(e._clearCommand.framebuffer=e._passes[a].framebuffer,e._clearCommand.execute(t,e._clearPassState))}Sf.MAXIMUM_DISTANCE=2e4,Sf.prototype.debugCreateRenderStates=function(){Mf(this)},Object.defineProperties(Sf.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this.dirty=this._enabled!==e,this._enabled=e}},normalOffset:{get:function(){return this._normalOffset},set:function(e){this.dirty=this._normalOffset!==e,this._normalOffset=e,this._terrainBias.normalOffset=e,this._primitiveBias.normalOffset=e,this._pointBias.normalOffset=e}},softShadows:{get:function(){return this._softShadows},set:function(e){this.dirty=this._softShadows!==e,this._softShadows=e}},size:{get:function(){return this._size},set:function(e){!function(e,t){e._size=t;var a=e._passes,i=a.length,n=e._textureSize;if(e._isPointLight){t=le.a.maximumCubeMapSize>=t?t:le.a.maximumCubeMapSize,n.x=t,n.y=t;var r=new fr.default(0,0,t,t);a[0].passState.viewport=r,a[1].passState.viewport=r,a[2].passState.viewport=r,a[3].passState.viewport=r,a[4].passState.viewport=r,a[5].passState.viewport=r}else 1===i?(t=le.a.maximumTextureSize>=t?t:le.a.maximumTextureSize,n.x=t,n.y=t,a[0].passState.viewport=new fr.default(0,0,t,t)):4===i&&(t=le.a.maximumTextureSize>=2*t?t:le.a.maximumTextureSize/2,n.x=2*t,n.y=2*t,a[0].passState.viewport=new fr.default(0,0,t,t),a[1].passState.viewport=new fr.default(t,0,t,t),a[2].passState.viewport=new fr.default(0,t,t,t),a[3].passState.viewport=new fr.default(t,t,t,t));e._clearPassState.viewport=new fr.default(0,0,n.x,n.y);for(var o=0;o<i;++o){var s=a[o],l=s.passState.viewport,u=l.x/n.x,d=l.y/n.y,c=l.width/n.x,f=l.height/n.y;s.textureOffsets=new $.default(c,0,0,u,0,f,0,d,0,0,1,0,0,0,0,1)}}(this,e)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(e){this.dirty=this._debugCascadeColors!==e,this._debugCascadeColors=e}}});var jf=new fr.default;function Vf(e,t){var a=t.context,i=t.context.drawingBufferWidth,n=t.context.drawingBufferHeight,r=.3*Math.min(i,n),o=jf;o.x=i-r,o.y=0,o.width=r,o.height=r;var l=e._debugShadowViewCommand;Object(s.default)(l)||(l=function(e,t){var a;a=e._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv = v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y < 0.5) \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = -1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = -1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z = -1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = 1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = 1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z = 1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n":"uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n"+(e._usesDepthTexture?"    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n")+"    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n";var i=t.createViewportQuadCommand(a,{uniformMap:{shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture}}});return i.pass=de.a.OVERLAY,i}(e,a),e._debugShadowViewCommand=l),Object(s.default)(l.renderState)&&fr.default.equals(l.renderState.viewport,o)||(l.renderState=ce.a.fromCache({viewport:fr.default.clone(o)})),t.commandList.push(e._debugShadowViewCommand)}var Uf=new Array(8);Uf[0]=new G.a(-1,-1,-1,1),Uf[1]=new G.a(1,-1,-1,1),Uf[2]=new G.a(1,1,-1,1),Uf[3]=new G.a(-1,1,-1,1),Uf[4]=new G.a(-1,-1,1,1),Uf[5]=new G.a(1,-1,1,1),Uf[6]=new G.a(1,1,1,1),Uf[7]=new G.a(-1,1,1,1);for(var Bf=new $.default,zf=new Array(8),Hf=0;Hf<8;++Hf)zf[Hf]=new G.a;var kf=[b.default.RED,b.default.GREEN,b.default.BLUE,b.default.MAGENTA],Gf=new n.default;function Wf(e,t){Vf(e,t);var a=e.debugFreezeFrame&&!e._debugFreezeFrame;if(e._debugFreezeFrame=e.debugFreezeFrame,e.debugFreezeFrame&&(a&&(e._debugCameraFrustum=e._debugCameraFrustum&&e._debugCameraFrustum.destroy(),e._debugCameraFrustum=new Wu({camera:e._sceneCamera,color:b.default.CYAN,updateOnChange:!1})),e._debugCameraFrustum.update(t)),e._cascadesEnabled){if(e.debugFreezeFrame){a&&(e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=new Wu({camera:e._shadowMapCamera,color:b.default.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t);for(var i=0;i<e._numberOfCascades;++i)a&&(e._debugCascadeFrustums[i]=e._debugCascadeFrustums[i]&&e._debugCascadeFrustums[i].destroy(),e._debugCascadeFrustums[i]=new Wu({camera:e._passes[i].camera,color:kf[i],updateOnChange:!1})),e._debugCascadeFrustums[i].update(t)}}else if(e._isPointLight){if(!Object(s.default)(e._debugLightFrustum)||e._needsUpdate){var r=e._shadowMapCamera.positionWC,o=xi.default.IDENTITY,l=2*e._pointLightRadius,u=n.default.fromElements(l,l,l,Gf),d=$.default.fromTranslationQuaternionRotationScale(r,o,u,Bf);e._debugLightFrustum=e._debugLightFrustum&&e._debugLightFrustum.destroy(),e._debugLightFrustum=function(e,t){var a=new Q.a({geometry:new H.a({minimum:new n.default(-.5,-.5,-.5),maximum:new n.default(.5,.5,.5)}),attributes:{color:Y.a.fromColor(t)}}),i=new Q.a({geometry:new ie.a({radius:.5}),attributes:{color:Y.a.fromColor(t)}});return new Ve.a({geometryInstances:[a,i],appearance:new je.a({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:e})}(d,b.default.YELLOW)}e._debugLightFrustum.update(t)}else Object(s.default)(e._debugLightFrustum)&&!e._needsUpdate||(e._debugLightFrustum=new Wu({camera:e._shadowMapCamera,color:b.default.YELLOW,updateOnChange:!1})),e._debugLightFrustum.update(t)}function Yf(){this.viewMatrix=new $.default,this.inverseViewMatrix=new $.default,this.frustum=void 0,this.positionCartographic=new y.default,this.positionWC=new n.default,this.directionWC=n.default.clone(n.default.UNIT_Z),this.upWC=n.default.clone(n.default.UNIT_Y),this.rightWC=n.default.clone(n.default.UNIT_X),this.viewProjectionMatrix=new $.default}Yf.prototype.clone=function(e){$.default.clone(e.viewMatrix,this.viewMatrix),$.default.clone(e.inverseViewMatrix,this.inverseViewMatrix),this.frustum=e.frustum.clone(this.frustum),y.default.clone(e.positionCartographic,this.positionCartographic),n.default.clone(e.positionWC,this.positionWC),n.default.clone(e.directionWC,this.directionWC),n.default.clone(e.upWC,this.upWC),n.default.clone(e.rightWC,this.rightWC)};var Xf=new $.default(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);Yf.prototype.getViewProjection=function(){var e=this.viewMatrix,t=this.frustum.projectionMatrix;return $.default.multiply(t,e,this.viewProjectionMatrix),$.default.multiply(Xf,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};var Qf=new Array(5),qf=new Lr.a,Zf=new Array(4),Kf=new n.default,Jf=new n.default;var $f=new $.default,eh=new n.default,th=new n.default,ah=new n.default;var ih=[new n.default(-1,0,0),new n.default(0,-1,0),new n.default(0,0,-1),new n.default(1,0,0),new n.default(0,1,0),new n.default(0,0,1)],nh=[new n.default(0,-1,0),new n.default(0,0,-1),new n.default(0,-1,0),new n.default(0,-1,0),new n.default(0,0,1),new n.default(0,-1,0)],rh=[new n.default(0,0,1),new n.default(1,0,0),new n.default(-1,0,0),new n.default(0,0,-1),new n.default(1,0,0),new n.default(1,0,0)];var oh=new n.default,sh=new n.default,lh=new v.default,uh=lh.center;function dh(e,t){var a=t.camera,i=e._lightCamera,r=e._sceneCamera,o=e._shadowMapCamera;e._cascadesEnabled?n.default.clone(i.directionWC,o.directionWC):e._isPointLight?n.default.clone(i.positionWC,o.positionWC):o.clone(i);var s,l,u=e._lightDirectionEC;$.default.multiplyByPointAsVector(a.viewMatrix,o.directionWC,u),n.default.normalize(u,u),n.default.negate(u,u),$.default.multiplyByPoint(a.viewMatrix,o.positionWC,e._lightPositionEC),e._lightPositionEC.w=e._pointLightRadius,e._fitNearFar?(s=Math.min(t.shadowState.nearPlane,e.maximumDistance),l=Math.min(t.shadowState.farPlane,e.maximumDistance+1)):(s=a.frustum.near,l=e.maximumDistance),e._sceneCamera=$l.clone(a,r),a.frustum.clone(e._sceneCamera.frustum),e._sceneCamera.frustum.near=s,e._sceneCamera.frustum.far=l,e._distance=l-s,function(e,t){var a=e._sceneCamera,i=e._shadowMapCamera,r=lh;if(e._cascadesEnabled){if(a.frustum.near>=e.maximumDistance)return e._outOfView=!0,void(e._needsUpdate=!1);var o=t.mapProjection.ellipsoid.geodeticSurfaceNormal(a.positionWC,oh),s=n.default.negate(i.directionWC,sh),l=n.default.dot(o,s),u=J.default.clamp(l/.1,0,1);if(e._darkness=J.default.lerp(1,e.darkness,u),l<0)return e._outOfView=!0,void(e._needsUpdate=!1);e._needsUpdate=!0,e._outOfView=!1}else if(e._isPointLight)r.center=i.positionWC,r.radius=e._pointLightRadius,e._outOfView=t.cullingVolume.computeVisibility(r)===K.default.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(r),v.default.clone(r,e._boundingSphere);else{var d=i.frustum.far/2,c=n.default.add(i.positionWC,n.default.multiplyByScalar(i.directionWC,d,uh),uh);r.center=c,r.radius=d,e._outOfView=t.cullingVolume.computeVisibility(r)===K.default.OUTSIDE,e._needsUpdate=!e._outOfView&&!e._boundingSphere.equals(r),v.default.clone(r,e._boundingSphere)}}(e,t),!e._outOfViewPrevious&&e._outOfView&&(e._needsUpdate=!0),e._outOfViewPrevious=e._outOfView}Sf.prototype.update=function(e){if(dh(this,e),this._needsUpdate)if(Nf(this,e.context),this._isPointLight&&function(e,t){var a=new Lr.a;a.fov=J.default.PI_OVER_TWO,a.near=1,a.far=e._pointLightRadius,a.aspectRatio=1;for(var i=0;i<6;++i){var n=e._passes[i].camera;n.positionWC=e._shadowMapCamera.positionWC,n.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(n.positionWC,n.positionCartographic),n.directionWC=ih[i],n.upWC=nh[i],n.rightWC=rh[i],$.default.computeView(n.positionWC,n.directionWC,n.upWC,n.rightWC,n.viewMatrix),$.default.inverse(n.viewMatrix,n.inverseViewMatrix),n.frustum=a}}(this,e),this._cascadesEnabled&&(function(e,t){var a=e._shadowMapCamera,i=e._sceneCamera,r=$.default.multiply(i.frustum.projectionMatrix,i.viewMatrix,Bf),o=$.default.inverse(r,Bf),s=a.directionWC,l=i.directionWC;n.default.equalsEpsilon(s,l,J.default.EPSILON10)&&(l=i.upWC);var u=n.default.cross(s,l,eh);l=n.default.cross(u,s,th),n.default.normalize(l,l),n.default.normalize(u,u);for(var d=n.default.fromElements(0,0,0,ah),c=$.default.computeView(d,s,l,u,$f),f=$.default.multiply(c,o,Bf),h=n.default.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Kf),m=n.default.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Jf),p=0;p<8;++p){var _=G.a.clone(Uf[p],zf[p]);$.default.multiplyByVector(f,_,_),n.default.divideByScalar(_,_.w,_),n.default.minimumByComponent(_,h,h),n.default.maximumByComponent(_,m,m)}m.z+=1e3,h.z-=10;var g=ah;g.x=-.5*(h.x+m.x),g.y=-.5*(h.y+m.y),g.z=-m.z;var v=$.default.fromTranslation(g,Bf);c=$.default.multiply(v,c,c);var y=.5*(m.x-h.x),b=.5*(m.y-h.y),w=m.z-h.z,C=a.frustum;C.left=-y,C.right=y,C.bottom=-b,C.top=b,C.near=.01,C.far=w,$.default.clone(c,a.viewMatrix),$.default.inverse(c,a.inverseViewMatrix),$.default.getTranslation(a.inverseViewMatrix,a.positionWC),t.mapProjection.ellipsoid.cartesianToCartographic(a.positionWC,a.positionCartographic),n.default.clone(s,a.directionWC),n.default.clone(l,a.upWC),n.default.clone(u,a.rightWC)}(this,e),this._numberOfCascades>1&&function(e,t){var a,i=e._shadowMapCamera,r=e._sceneCamera,o=r.frustum.near,s=r.frustum.far,l=e._numberOfCascades,u=s-o,d=s/o,c=.9,f=!1;t.shadowState.closestObjectSize<200&&(f=!0,c=.9);var h=Zf,m=Qf;for(m[0]=o,m[l]=s,a=0;a<l;++a){var p=(a+1)/l,_=o*Math.pow(d,p),g=o+u*p,v=J.default.lerp(g,_,c);m[a+1]=v,h[a]=v-m[a]}if(f){for(a=0;a<l;++a)h[a]=Math.min(h[a],e._maximumCascadeDistances[a]);var y=m[0];for(a=0;a<l-1;++a)y+=h[a],m[a+1]=y}G.a.unpack(m,0,e._cascadeSplits[0]),G.a.unpack(m,1,e._cascadeSplits[1]),G.a.unpack(h,0,e._cascadeDistances);var b=i.frustum,w=b.left,C=b.right,O=b.bottom,x=b.top,T=b.near,E=b.far,A=i.positionWC,P=i.directionWC,S=i.upWC,D=r.frustum.clone(qf),F=i.getViewProjection();for(a=0;a<l;++a){D.near=m[a],D.far=m[a+1];for(var M=$.default.multiply(D.projectionMatrix,r.viewMatrix,Bf),I=$.default.inverse(M,Bf),R=$.default.multiply(F,I,Bf),N=n.default.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Kf),L=n.default.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Jf),j=0;j<8;++j){var V=G.a.clone(Uf[j],zf[j]);$.default.multiplyByVector(R,V,V),n.default.divideByScalar(V,V.w,V),n.default.minimumByComponent(V,N,N),n.default.maximumByComponent(V,L,L)}N.x=Math.max(N.x,0),N.y=Math.max(N.y,0),N.z=0,L.x=Math.min(L.x,1),L.y=Math.min(L.y,1),L.z=Math.min(L.z,1);var U=e._passes[a],B=U.camera;B.clone(i);var z=B.frustum;z.left=w+N.x*(C-w),z.right=w+L.x*(C-w),z.bottom=O+N.y*(x-O),z.top=O+L.y*(x-O),z.near=T+N.z*(E-T),z.far=T+L.z*(E-T),U.cullingVolume=B.frustum.computeCullingVolume(A,P,S);var H=e._cascadeMatrices[a];$.default.multiply(B.getViewProjection(),r.inverseViewMatrix,H),$.default.multiply(U.textureOffsets,H,H)}}(this,e)),this._isPointLight)this._shadowMapCullingVolume=mr.a.fromBoundingSphere(this._boundingSphere);else{var t=this._shadowMapCamera,a=t.positionWC,i=t.directionWC,r=t.upWC;this._shadowMapCullingVolume=t.frustum.computeCullingVolume(a,i,r),1===this._passes.length&&this._passes[0].camera.clone(t)}if(1===this._passes.length){var o=this._sceneCamera.inverseViewMatrix;$.default.multiply(this._shadowMapCamera.getViewProjection(),o,this._shadowMapMatrix)}this.debugShow&&Wf(this,e)},Sf.prototype.updatePass=function(e,t){Lf(this,e,t)};var ch=new k.default;function fh(e,t,a){var i=e._isPointLight?e._pointBias:a?e._terrainBias:e._primitiveBias,n={shadowMap_texture:function(){return e._shadowMapTexture},shadowMap_textureCube:function(){return e._shadowMapTexture},shadowMap_matrix:function(){return e._shadowMapMatrix},shadowMap_cascadeSplits:function(){return e._cascadeSplits},shadowMap_cascadeMatrices:function(){return e._cascadeMatrices},shadowMap_lightDirectionEC:function(){return e._lightDirectionEC},shadowMap_lightPositionEC:function(){return e._lightPositionEC},shadowMap_cascadeDistances:function(){return e._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var t=ch;return t.x=1/e._textureSize.x,t.y=1/e._textureSize.y,G.a.fromElements(t.x,t.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return G.a.fromElements(i.normalOffsetScale,e._distance,e.maximumDistance,e._darkness,this.combinedUniforms2)},combinedUniforms1:new G.a,combinedUniforms2:new G.a};return Object(X.default)(t,n,!1)}function hh(e,t,a,i,n,r){var o,l,u;if(Object(s.default)(r)&&(o=r.shaderProgram,l=r.renderState,u=r.uniformMap),(r=ue.a.shallowClone(a,r)).castShadows=!0,r.receiveShadows=!1,!Object(s.default)(o)||n!==a.shaderProgram.id||t){var d=a.shaderProgram,c=a.pass===de.a.GLOBE,f=a.pass!==de.a.TRANSLUCENT,h=e._isPointLight,m=e._usesDepthTexture,p=Pf.getShadowCastShaderKeyword(h,c,m,f);if(o=i.shaderCache.getDerivedShaderProgram(d,p),!Object(s.default)(o)){var _=d.vertexShaderSource,g=d.fragmentShaderSource,v=Pf.createShadowCastVertexShader(_,h,c),y=Pf.createShadowCastFragmentShader(g,h,m,f);o=i.shaderCache.createDerivedShaderProgram(d,p,{vertexShaderSource:v,fragmentShaderSource:y,attributeLocations:d._attributeLocations})}l=e._primitiveRenderState,h?l=e._pointRenderState:c&&(l=e._terrainRenderState),a.renderState.cull.enabled||((l=Object(W.default)(l,!1)).cull=Object(W.default)(l.cull,!1),l.cull.enabled=!1,l=ce.a.fromCache(l)),u=fh(e,a.uniformMap,c)}return r.shaderProgram=o,r.renderState=l,r.uniformMap=u,r}Sf.createReceiveDerivedCommand=function(e,t,a,i,n){Object(s.default)(n)||(n={});var r=e.length>0,o=t.shaderProgram,l=o.vertexShaderSource,u=o.fragmentShaderSource,d=t.pass===de.a.GLOBE,c=!1;if(d&&(c=t.owner.data.renderedMesh.encoding.hasVertexNormals),t.receiveShadows&&r){var f,h;Object(s.default)(n.receiveCommand)&&(f=n.receiveCommand.shaderProgram,h=n.receiveCommand.uniformMap),n.receiveCommand=ue.a.shallowClone(t,n.receiveCommand),n.castShadows=!1,n.receiveShadows=!0;var m=n.receiveShaderCastShadows!==t.castShadows,p=n.receiveShaderProgramId!==t.shaderProgram.id;if(!Object(s.default)(f)||p||a||m){var _=Pf.getShadowReceiveShaderKeyword(e[0],t.castShadows,d,c);if(f=i.shaderCache.getDerivedShaderProgram(o,_),!Object(s.default)(f)){var g=Pf.createShadowReceiveVertexShader(l,d,c),v=Pf.createShadowReceiveFragmentShader(u,e[0],t.castShadows,d,c);f=i.shaderCache.createDerivedShaderProgram(o,_,{vertexShaderSource:g,fragmentShaderSource:v,attributeLocations:o._attributeLocations})}h=fh(e[0],t.uniformMap,d)}n.receiveCommand.shaderProgram=f,n.receiveCommand.uniformMap=h,n.receiveShaderProgramId=t.shaderProgram.id,n.receiveShaderCastShadows=t.castShadows}return n},Sf.createCastDerivedCommand=function(e,t,a,i,n){if(Object(s.default)(n)||(n={}),t.castShadows){var r=n.castCommands;Object(s.default)(r)||(r=n.castCommands=[]);var o=n.castShaderProgramId,l=e.length;r.length=l;for(var u=0;u<l;++u)r[u]=hh(e[u],a,t,i,o,r[u]);n.castShaderProgramId=t.shaderProgram.id}return n},Sf.prototype.isDestroyed=function(){return!1},Sf.prototype.destroy=function(){If(this),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(var e=0;e<this._numberOfCascades;++e)this._debugCascadeFrustums[e]=this._debugCascadeFrustums[e]&&this._debugCascadeFrustums[e].destroy();return Object(l.default)(this)};var mh=Sf;function ph(){this.command=void 0,this.near=void 0,this.far=void 0}function _h(e,t,a){var i,n,r=e.context;r.depthTexture&&(i=new Nd),e._useOIT&&r.depthTexture&&(n=new gf(r));var o=new $r(r);o.viewport=fr.default.clone(a),this.camera=t,this._cameraClone=$l.clone(t),this._cameraStartFired=!1,this._cameraMovedTime=void 0,this.viewport=a,this.passState=o,this.pickFramebuffer=new Of(r),this.pickDepthFramebuffer=new bf,this.sceneFramebuffer=new Ef,this.globeDepth=i,this.globeTranslucencyFramebuffer=new ef,this.oit=n,this.pickDepths=[],this.debugGlobeDepths=[],this.frustumCommandsList=[],this.debugFrustumStatistics=void 0,this._commandExtents=[]}var gh=new n.default,vh=new n.default;function yh(e,t,a){var i,r,o,s,l,u=1/Math.max(1,(i=e.position,r=t.position,o=Math.max(Math.abs(i.x),Math.abs(r.x)),s=Math.max(Math.abs(i.y),Math.abs(r.y)),l=Math.max(Math.abs(i.z),Math.abs(r.z)),Math.max(Math.max(o,s),l)));return n.default.multiplyByScalar(e.position,u,gh),n.default.multiplyByScalar(t.position,u,vh),n.default.equalsEpsilon(gh,vh,a)&&n.default.equalsEpsilon(e.direction,t.direction,a)&&n.default.equalsEpsilon(e.up,t.up,a)&&n.default.equalsEpsilon(e.right,t.right,a)&&$.default.equalsEpsilon(e.transform,t.transform,a)&&e.frustum.equalsEpsilon(t.frustum,a)}function bh(e,t,a,i,n){t.debugShowFrustums&&(a.debugOverlappingFrustums=0);for(var r=e.frustumCommandsList,o=r.length,l=0;l<o;++l){var u=r[l],d=u.near;if(!(i>u.far)){if(n<d)break;var c=a.pass,f=u.indices[c]++;if(u.commands[c][f]=a,t.debugShowFrustums&&(a.debugOverlappingFrustums|=1<<l),a.executeInClosestFrustum)break}}if(t.debugShowFrustums){var h=e.debugFrustumStatistics.commandsInFrustums;h[a.debugOverlappingFrustums]=Object(s.default)(h[a.debugOverlappingFrustums])?h[a.debugOverlappingFrustums]+1:1,++e.debugFrustumStatistics.totalCommands}t.updateDerivedCommands(a)}_h.prototype.checkForCameraUpdates=function(e){var t=this.camera,a=this._cameraClone;return yh(t,a,J.default.EPSILON15)?(this._cameraStartFired&&Object(ya.default)()-this._cameraMovedTime>e.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=Object(ya.default)(),$l.clone(t,a),!0)};var wh=new mr.a,Ch=new Wc.a;_h.prototype.createPotentiallyVisibleSet=function(e){var t=e.frameState,a=t.camera,i=a.directionWC,n=a.positionWC,r=e._computeCommandList,o=e._overlayCommandList,l=t.commandList;e.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});for(var u=this.frustumCommandsList,d=u.length,c=de.a.NUMBER_OF_PASSES,f=0;f<d;++f)for(var h=0;h<c;++h)u[f].indices[h]=0;r.length=0,o.length=0;for(var m=this._commandExtents,p=m.length,_=0,g=+Number.MAX_VALUE,v=-Number.MAX_VALUE,y=t.shadowState.shadowsEnabled,b=+Number.MAX_VALUE,w=-Number.MAX_VALUE,C=Number.MAX_VALUE,O=t.mode===V.a.SCENE3D?t.occluder:void 0,x=t.cullingVolume,T=wh.planes,E=0;E<5;++E)T[E]=x.planes[E];x=wh;for(var A,P,S=l.length,D=0;D<S;++D){var F=l[D],M=F.pass;if(M===de.a.COMPUTE)r.push(F);else if(M===de.a.OVERLAY)o.push(F);else{var I,R,N=F.boundingVolume;if(Object(s.default)(N)){if(!e.isVisible(F,x,O))continue;var L=N.computePlaneDistances(n,i,Ch);if(I=L.start,R=L.stop,g=Math.min(g,I),v=Math.max(v,R),y&&F.receiveShadows&&I<mh.MAXIMUM_DISTANCE&&!(M===de.a.GLOBE&&I<-100&&R>100)){var j=R-I;M!==de.a.GLOBE&&I<100&&(C=Math.min(C,j)),b=Math.min(b,I),w=Math.max(w,R)}}else F instanceof Br.a?(I=a.frustum.near,R=a.frustum.far):(I=a.frustum.near,R=a.frustum.far,g=Math.min(g,I),v=Math.max(v,R));var U=m[_];Object(s.default)(U)||(U=m[_]=new ph),U.command=F,U.near=I,U.far=R,_++}}for(y&&(b=Math.min(Math.max(b,a.frustum.near),a.frustum.far),w=Math.max(Math.min(w,a.frustum.far),b)),y&&(t.shadowState.nearPlane=b,t.shadowState.farPlane=w,t.shadowState.closestObjectSize=C),function(e,t,a,i){var n,r=t.frameState,o=r.camera,l=r.useLogDepth?t.logarithmicDepthFarToNearRatio:t.farToNearRatio,u=t.mode===V.a.SCENE2D,d=t.nearToFarDistance2D;a=Math.min(Math.max(a,o.frustum.near),o.frustum.far),i=Math.max(Math.min(i,o.frustum.far),a),u?(i=Math.min(i,o.position.z+t.nearToFarDistance2D),a=Math.min(a,i),n=Math.ceil(Math.max(1,i-a)/t.nearToFarDistance2D)):n=Math.ceil(Math.log(i/a)/Math.log(l));var c=e.frustumCommandsList;c.length=n;for(var f=0;f<n;++f){var h,m;u?(h=Math.min(i-d,a+f*d),m=Math.min(i,h+d)):(h=Math.max(a,Math.pow(l,f)*a),m=Math.min(i,l*h));var p=c[f];Object(s.default)(p)?(p.near=h,p.far=m):p=c[f]=new Yc(h,m)}}(this,e,g,v),A=0;A<_;A++)bh(this,e,(P=m[A]).command,P.near,P.far);if(_<p)for(A=_;A<p&&(P=m[A],Object(s.default)(P.command));A++)P.command=void 0;var B=u.length,z=t.frustumSplits;z.length=B+1;for(var H=0;H<B;++H)z[H]=u[H].near,H===B-1&&(z[H+1]=u[H].far)},_h.prototype.destroy=function(){var e,t;this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy(),this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy(),this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy(),this.globeDepth=this.globeDepth&&this.globeDepth.destroy(),this.oit=this.oit&&this.oit.destroy(),this.globeTranslucencyFramebuffer=this.globeTranslucencyFramebuffer&&this.globeTranslucencyFramebuffer.destroy();var a=this.pickDepths,i=this.debugGlobeDepths;for(t=a.length,e=0;e<t;++e)a[e].destroy();for(t=i.length,e=0;e<t;++e)i[e].destroy()};var Oh=_h,xh=.1,Th=new tu({pass:eu.a.MOST_DETAILED_PRELOAD}),Eh=new tu({pass:eu.a.MOST_DETAILED_PICK}),Ah=new tu({pass:eu.a.PICK});function Ph(e){this._mostDetailedRayPicks=[],this.pickRenderStateCache={},this._pickPositionCache={},this._pickPositionCacheDirty=!1;var t=new fr.default(0,0,1,1),a=new $l(e);a.frustum=new te.a({width:xh,aspectRatio:1,near:.1}),this._pickOffscreenView=new Oh(e,a,t)}Ph.prototype.update=function(){this._pickPositionCacheDirty=!0},Ph.prototype.getPickDepth=function(e,t){var a=e.view.pickDepths,i=a[t];return Object(s.default)(i)||(i=new Hc,a[t]=i),i};var Sh=new ba.a,Dh=new n.default,Fh=new n.default,Mh=new k.default,Ih=new $.default;var Rh=new jr.a,Nh=new k.default;function Lh(e,t,a,i,r){var o=e.camera.frustum;return o instanceof te.a||o instanceof ba.a?function(e,t,a,i,r){var o=e.camera,l=o.frustum;Object(s.default)(l._offCenterFrustum)&&(l=l._offCenterFrustum);var u=2*(t.x-r.x)/r.width-1;u*=.5*(l.right-l.left);var d=2*(r.height-t.y-r.y)/r.height-1;d*=.5*(l.top-l.bottom);var c=$.default.clone(o.transform,Ih);o._setTransform($.default.IDENTITY);var f=n.default.clone(o.position,Dh);n.default.multiplyByScalar(o.right,u,Fh),n.default.add(Fh,f,f),n.default.multiplyByScalar(o.up,d,Fh),n.default.add(Fh,f,f),o._setTransform(c),e.mode===V.a.SCENE2D&&n.default.fromElements(f.z,f.x,f.y,f);var h=l.getPixelDimensions(r.width,r.height,1,1,Mh),m=Sh;return m.right=.5*h.x,m.left=-m.right,m.top=.5*h.y,m.bottom=-m.top,m.near=l.near,m.far=l.far,m.computeCullingVolume(f,o.directionWC,o.upWC)}(e,t,0,0,r):function(e,t,a,i,n){var r=e.camera,o=r.frustum,s=o.near,l=Math.tan(.5*o.fovy),u=o.aspectRatio*l,d=(2*(t.x-n.x)/n.width-1)*s*u,c=(2*(n.height-t.y-n.y)/n.height-1)*s*l,f=o.getPixelDimensions(n.width,n.height,1,1,Nh),h=f.x*a*.5,m=f.y*i*.5,p=Rh;return p.top=c+m,p.bottom=c-m,p.right=d+h,p.left=d-h,p.near=s,p.far=o.far,p.computeCullingVolume(r.positionWC,r.directionWC,r.upWC)}(e,t,a,i,r)}var jh=3,Vh=3,Uh=new fr.default(0,0,jh,Vh),Bh=new k.default,zh=new b.default(0,0,0,0);Ph.prototype.pick=function(e,t,a,i){jh=Object(o.default)(a,3),Vh=Object(o.default)(i,jh);var n=e.context,r=n.uniformState,s=e.frameState,l=e.defaultView;e.view=l;var u=l.viewport;u.x=0,u.y=0,u.width=n.drawingBufferWidth,u.height=n.drawingBufferHeight;var d=l.passState;d.viewport=fr.default.clone(u,d.viewport);var c=Gc.default.transformWindowToDrawingBuffer(e,t,Bh);e.jobScheduler.disableThisFrame(),e.updateFrameState(),s.cullingVolume=Lh(e,c,jh,Vh,u),s.invertClassification=!1,s.passes.pick=!0,s.tilesetPassState=Ah,r.update(s),e.updateEnvironment(),Uh.x=c.x-.5*(jh-1),Uh.y=e.drawingBufferHeight-c.y-.5*(Vh-1),Uh.width=jh,Uh.height=Vh,d=l.pickFramebuffer.begin(Uh,l.viewport),e.updateAndExecuteCommands(d,zh),e.resolveFramebuffers(d);var f=l.pickFramebuffer.end(Uh);return n.endFrame(),f};var Hh=new Lr.a,kh=new jr.a,Gh=new te.a,Wh=new ba.a;Ph.prototype.pickPositionWorldCoordinates=function(e,t,a){if(e.useDepthPicking){var i=t.toString();if(this._pickPositionCacheDirty)this._pickPositionCache={},this._pickPositionCacheDirty=!1;else if(this._pickPositionCache.hasOwnProperty(i))return n.default.clone(this._pickPositionCache[i],a);var r=e.frameState,o=e.context,l=o.uniformState,u=e.defaultView;e.view=u;var d=Gc.default.transformWindowToDrawingBuffer(e,t,Bh);e.pickTranslucentDepth?function(e,t){var a=e.context,i=e.frameState,n=e.environmentState,r=e.defaultView;e.view=r;var o=r.viewport;o.x=0,o.y=0,o.width=a.drawingBufferWidth,o.height=a.drawingBufferHeight;var s=r.passState;s.viewport=fr.default.clone(o,s.viewport),e.clearPasses(i.passes),i.passes.pick=!0,i.passes.depth=!0,i.cullingVolume=Lh(e,t,1,1,o),i.tilesetPassState=Ah,e.updateEnvironment(),n.renderTranslucentDepthForPick=!0,s=r.pickDepthFramebuffer.update(a,t,o),e.updateAndExecuteCommands(s,zh),e.resolveFramebuffers(s),a.endFrame()}(e,d):(e.updateFrameState(),l.update(r),e.updateEnvironment()),d.y=e.drawingBufferHeight-d.y;var c,f=e.camera;c=Object(s.default)(f.frustum.fov)?f.frustum.clone(Hh):Object(s.default)(f.frustum.infiniteProjectionMatrix)?f.frustum.clone(kh):Object(s.default)(f.frustum.width)?f.frustum.clone(Gh):f.frustum.clone(Wh);for(var h=u.frustumCommandsList,m=h.length,p=0;p<m;++p){var _=this.getPickDepth(e,p).getDepth(o,d.x,d.y);if(Object(s.default)(_)&&(_>0&&_<1)){var g,v=h[p];return e.mode===V.a.SCENE2D?(g=f.position.z,f.position.z=g-v.near+1,c.far=Math.max(1,v.far-v.near),c.near=1,l.update(r),l.updateFrustum(c)):(c.near=v.near*(0!==p?e.opaqueFrustumNearOffset:1),c.far=v.far,l.updateFrustum(c)),a=Gc.default.drawingBufferToWgs84Coordinates(e,d,_,a),e.mode===V.a.SCENE2D&&(f.position.z=g,l.update(r)),this._pickPositionCache[i]=n.default.clone(a),a}}this._pickPositionCache[i]=void 0}};var Yh=new y.default;function Xh(e,t){var a,i,n=[],r=[],o=[],l=[];Object(s.default)(e)||(e=Number.MAX_VALUE);for(var u=t();Object(s.default)(u);){var d=u.object,c=u.position,f=u.exclude;if(Object(s.default)(c)&&!Object(s.default)(d)){n.push(u);break}if(!Object(s.default)(d)||!Object(s.default)(d.primitive))break;if(!f&&(n.push(u),0>=--e))break;var h=d.primitive,m=!1;"function"==typeof h.getGeometryInstanceAttributes&&Object(s.default)(d.id)&&(i=h.getGeometryInstanceAttributes(d.id),Object(s.default)(i)&&Object(s.default)(i.show)&&(m=!0,i.show=Rc.a.toValue(!1,i.show),o.push(i))),d instanceof Nc.a&&(m=!0,d.show=!1,l.push(d)),m||(h.show=!1,r.push(h)),u=t()}for(a=0;a<r.length;++a)r[a].show=!0;for(a=0;a<o.length;++a)(i=o[a]).show=Rc.a.toValue(!0,i.show);for(a=0;a<l.length;++a)l[a].show=!0;return n}Ph.prototype.pickPosition=function(e,t,a){if(a=this.pickPositionWorldCoordinates(e,t,a),Object(s.default)(a)&&e.mode!==V.a.SCENE3D){n.default.fromElements(a.y,a.z,a.x,a);var i=e.mapProjection,r=i.ellipsoid,o=i.unproject(a,Yh);r.cartographicToCartesian(o,a)}return a},Ph.prototype.drillPick=function(e,t,a,i,n){var r=this;return Xh(a,(function(){var a=r.pick(e,t,i,n);if(Object(s.default)(a))return{object:a,position:void 0,exclude:!1}})).map((function(e){return e.object}))};var Qh=new n.default,qh=new n.default;function Zh(e,t,a){this.ray=e,this.width=t,this.tilesets=a,this.ready=!1,this.deferred=R.default.defer(),this.promise=this.deferred.promise}function Kh(e,t,a,i){var r=t.direction,s=n.default.mostOrthogonalAxis(r,Qh),l=n.default.cross(r,s,Qh),u=n.default.cross(r,l,qh);return i.position=t.origin,i.direction=r,i.up=u,i.right=l,i.frustum.width=Object(o.default)(a,xh),i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC)}function Jh(e,t,a){var i=t.frameState,n=a.ray,r=a.width,o=a.tilesets,s=e._pickOffscreenView.camera,l=Kh(0,n,r,s),u=Th;u.camera=s,u.cullingVolume=l;for(var d=!0,c=o.length,f=0;f<c;++f){var h=o[f];h.show&&t.primitives.contains(h)&&(h.updateForPass(i,u),d=d&&u.ready)}return d&&a.deferred.resolve(),d}function $h(e,t,a,i,n,r){var o=[];if(function e(t,a,i){for(var n=t.length,r=0;r<n;++r){var o=t.get(r);o.show&&(Object(s.default)(o.isCesium3DTileset)?Object(s.default)(a)&&-1!==a.indexOf(o)||i.push(o):o instanceof kc.a&&e(o,a,i))}}(t.primitives,i,o),0===o.length)return R.default.resolve(r());var l=new Zh(a,n,o);return e._mostDetailedRayPicks.push(l),l.promise.then((function(){return r()}))}function em(e,t){return!(!Object(s.default)(e)||!Object(s.default)(t)||0===t.length)&&(t.indexOf(e)>-1||t.indexOf(e.primitive)>-1||t.indexOf(e.id)>-1)}function tm(e,t,a,i,n,r,o,l){return Xh(i,(function(){return function(e,t,a,i,n,r,o){var l=t.context,u=l.uniformState,d=t.frameState,c=e._pickOffscreenView;t.view=c,Kh(0,a,n,c.camera),Uh=fr.default.clone(c.viewport,Uh);var f,h=c.pickFramebuffer.begin(Uh,c.viewport);t.jobScheduler.disableThisFrame(),t.updateFrameState(),d.invertClassification=!1,d.passes.pick=!0,d.passes.offscreen=!0,d.tilesetPassState=o?Eh:Ah,u.update(d),t.updateEnvironment(),t.updateAndExecuteCommands(h,zh),t.resolveFramebuffers(h);var m=c.pickFramebuffer.end(l);if(t.context.depthTexture)for(var p=c.frustumCommandsList.length,_=0;_<p;++_){var g=e.getPickDepth(t,_).getDepth(l,0,0);if(Object(s.default)(g)&&(g>0&&g<1)){var v=c.frustumCommandsList[_],y=v.near*(0!==_?t.opaqueFrustumNearOffset:1),b=y+g*(v.far-y);f=E.default.getPoint(a,b);break}}if(t.view=t.defaultView,l.endFrame(),Object(s.default)(m)||Object(s.default)(f))return{object:m,position:f,exclude:!Object(s.default)(f)&&r||em(m,i)}}(e,t,a,n,r,o,l)}))}function am(e,t,a,i,n,r,o){var s=tm(e,t,a,1,i,n,r,o);if(s.length>0)return s[0]}function im(e,t,a,i,n,r,o,s){return tm(e,t,a,i,n,r,o,s)}function nm(e,t){var a=R.default.defer();return t.then((function(t){var i=e.postRender.addEventListener((function(){a.resolve(t),i()}));e.requestRender()})).otherwise((function(e){a.reject(e)})),a.promise}Ph.prototype.updateMostDetailedRayPicks=function(e){for(var t=this._mostDetailedRayPicks,a=0;a<t.length;++a)Jh(this,e,t[a])&&t.splice(a--,1)},Ph.prototype.pickFromRay=function(e,t,a,i){return am(this,e,t,a,i,!1,!1)},Ph.prototype.drillPickFromRay=function(e,t,a,i,n){return im(this,e,t,a,i,n,!1,!1)},Ph.prototype.pickFromRayMostDetailed=function(e,t,a,i){var n=this;return t=E.default.clone(t),a=Object(s.default)(a)?a.slice():a,nm(e,$h(n,e,t,a,i,(function(){return am(n,e,t,a,i,!1,!0)})))},Ph.prototype.drillPickFromRayMostDetailed=function(e,t,a,i,n){var r=this;return t=E.default.clone(t),i=Object(s.default)(i)?i.slice():i,nm(e,$h(r,e,t,i,n,(function(){return im(r,e,t,a,i,n,!1,!0)})))};var rm=new n.default,om=new n.default,sm=new E.default,lm=new y.default;function um(e,t){var a=e.globe,i=Object(s.default)(a)?a.ellipsoid:e.mapProjection.ellipsoid,r=Ic.a._defaultMaxTerrainHeight,o=i.geodeticSurfaceNormalCartographic(t,om),l=y.default.toCartesian(t,i,rm),u=sm;u.origin=l,u.direction=o;var d=new E.default;return E.default.getPoint(u,r,d.origin),n.default.negate(o,d.direction),d}function dm(e,t){var a=e.globe,i=Object(s.default)(a)?a.ellipsoid:e.mapProjection.ellipsoid;return um(e,y.default.fromCartesian(t,i,lm))}function cm(e,t){var a=e.globe,i=Object(s.default)(a)?a.ellipsoid:e.mapProjection.ellipsoid;return y.default.fromCartesian(t,i,lm).height}function fm(e,t,a,i,n){var r=um(t,a);return $h(e,t,r,i,n,(function(){var a=am(e,t,r,i,n,!0,!0);if(Object(s.default)(a))return cm(t,a.position)}))}function hm(e,t,a,i,r,o){var l=dm(t,a);return $h(e,t,l,i,r,(function(){var a=am(e,t,l,i,r,!0,!0);if(Object(s.default)(a))return n.default.clone(a.position,o)}))}Ph.prototype.sampleHeight=function(e,t,a,i){var n=am(this,e,um(e,t),a,i,!0,!1);if(Object(s.default)(n))return cm(e,n.position)},Ph.prototype.clampToHeight=function(e,t,a,i,r){var o=am(this,e,dm(e,t),a,i,!0,!1);if(Object(s.default)(o))return n.default.clone(o.position,r)},Ph.prototype.sampleHeightMostDetailed=function(e,t,a,i){a=Object(s.default)(a)?a.slice():a;for(var n=t.length,r=new Array(n),o=0;o<n;++o)r[o]=fm(this,e,t[o],a,i);return nm(e,R.default.all(r).then((function(e){for(var a=e.length,i=0;i<a;++i)t[i].height=e[i];return t})))},Ph.prototype.clampToHeightMostDetailed=function(e,t,a,i){a=Object(s.default)(a)?a.slice():a;for(var n=t.length,r=new Array(n),o=0;o<n;++o)r[o]=hm(this,e,t[o],a,i,t[o]);return nm(e,R.default.all(r).then((function(e){for(var a=e.length,i=0;i<a;++i)t[i]=e[i];return t})))},Ph.prototype.destroy=function(){this._pickOffscreenView=this._pickOffscreenView&&this._pickOffscreenView.destroy()};var mm=Ph,pm=a(188),_m="#define SAMPLES 8\n\nuniform float delta;\nuniform float sigma;\nuniform float direction; // 0.0 for x direction, 1.0 for y direction\n\nuniform sampler2D colorTexture;\n\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\n\nvarying vec2 v_textureCoordinates;\n\n//  Incremental Computation of the Gaussian:\n//  https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch40.html\n\nvoid main()\n{\n    vec2 st = v_textureCoordinates;\n    vec2 dir = vec2(1.0 - direction, direction);\n\n#ifdef USE_STEP_SIZE\n    vec2 step = vec2(stepSize * (czm_pixelRatio / czm_viewport.zw));\n#else\n    vec2 step = step;\n#endif\n\n    vec3 g;\n    g.x = 1.0 / (sqrt(czm_twoPi) * sigma);\n    g.y = exp((-0.5 * delta * delta) / (sigma * sigma));\n    g.z = g.y * g.y;\n\n    vec4 result = texture2D(colorTexture, st) * g.x;\n    for (int i = 1; i < SAMPLES; ++i)\n    {\n        g.xy *= g.yz;\n\n        vec2 offset = float(i) * dir * step;\n        result += texture2D(colorTexture, st - offset) * g.x;\n        result += texture2D(colorTexture, st + offset) * g.x;\n    }\n\n    gl_FragColor = result;\n}\n";function gm(){this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._ready=!1,this._name="czm_autoexposure",this._logDepthChanged=void 0,this._useLogDepth=void 0,this._framebuffers=void 0,this._previousLuminance=void 0,this._commands=void 0,this._clearCommand=void 0,this._minMaxLuminance=new k.default,this.enabled=!0,this._enabled=!0,this.minimumLuminance=.1,this.maximumLuminance=10}function vm(e){var t=e._framebuffers;if(Object(s.default)(t)){for(var a=t.length,i=0;i<a;++i)t[i].destroy();e._framebuffers=void 0,e._previousLuminance.destroy(),e._previousLuminance=void 0}}function ym(e){var t=e._commands;if(Object(s.default)(t)){for(var a=t.length,i=0;i<a;++i)t[i].shaderProgram.destroy();e._commands=void 0}}function bm(e,t){var a;if(0===t)a={colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions}};else{var i=e._framebuffers[t-1].getColorTexture(0);a={colorTexture:function(){return i},colorTextureDimensions:function(){return i.dimensions}}}return a.minMaxLuminance=function(){return e._minMaxLuminance},a.previousLuminance=function(){return e._previousLuminance.getColorTexture(0)},a}function wm(e,t){var a="uniform sampler2D colorTexture; \nvarying vec2 v_textureCoordinates; \nfloat sampleTexture(vec2 offset) { \n";return a+=0===e?"    vec4 color = texture2D(colorTexture, v_textureCoordinates + offset); \n    return czm_luminance(color.rgb); \n":"    return texture2D(colorTexture, v_textureCoordinates + offset).r; \n",a+="}\n\n",a+="uniform vec2 colorTextureDimensions; \nuniform vec2 minMaxLuminance; \nuniform sampler2D previousLuminance; \nvoid main() { \n    float color = 0.0; \n    float xStep = 1.0 / colorTextureDimensions.x; \n    float yStep = 1.0 / colorTextureDimensions.y; \n    int count = 0; \n    for (int i = 0; i < 3; ++i) { \n        for (int j = 0; j < 3; ++j) { \n            vec2 offset; \n            offset.x = -xStep + float(i) * xStep; \n            offset.y = -yStep + float(j) * yStep; \n            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { \n                continue; \n            } \n            color += sampleTexture(offset); \n            ++count; \n        } \n    } \n    if (count > 0) { \n        color /= float(count); \n    } \n",e===t-1&&(a+="    float previous = texture2D(previousLuminance, vec2(0.5)).r; \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n    color = previous + (color - previous) / (60.0 * 1.5); \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n"),a+="    gl_FragColor = vec4(color); \n} \n"}Object.defineProperties(gm.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},outputTexture:{get:function(){var e=this._framebuffers;if(Object(s.default)(e))return e[e.length-1].getColorTexture(0)}}}),gm.prototype.clear=function(e){var t=this._framebuffers;if(Object(s.default)(t)){var a=this._clearCommand;Object(s.default)(a)||(a=this._clearCommand=new Br.a({color:new b.default(0,0,0,0),framebuffer:void 0}));for(var i=t.length,n=0;n<i;++n)a.framebuffer=t[n],a.execute(e)}},gm.prototype.update=function(e){var t=e.drawingBufferWidth,a=e.drawingBufferHeight;t===this._width&&a===this._height||(this._width=t,this._height=a,function(e,t){vm(e);for(var a=e._width,i=e._height,n=_e.a.RGBA,r=t.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT,o=Math.ceil(Math.log(Math.max(a,i))/Math.log(3)),s=new Array(o),l=0;l<o;++l)a=Math.max(Math.ceil(a/3),1),i=Math.max(Math.ceil(i/3),1),s[l]=new Hr.a({context:t,colorTextures:[new D.a({context:t,width:a,height:i,pixelFormat:n,pixelDatatype:r,sampler:Ce.a.NEAREST})]});var u=s[o-1].getColorTexture(0);e._previousLuminance=new Hr.a({context:t,colorTextures:[new D.a({context:t,width:u.width,height:u.height,pixelFormat:n,pixelDatatype:r,sampler:Ce.a.NEAREST})]}),e._framebuffers=s}(this,e),function(e,t){ym(e);for(var a=e._framebuffers,i=a.length,n=new Array(i),r=0;r<i;++r)n[r]=t.createViewportQuadCommand(wm(r,i),{framebuffer:a[r],uniformMap:bm(e,r)});e._commands=n}(this,e),this._ready||(this._ready=!0)),this._minMaxLuminance.x=this.minimumLuminance,this._minMaxLuminance.y=this.maximumLuminance;var i=this._framebuffers,n=i[i.length-1];i[i.length-1]=this._previousLuminance,this._commands[this._commands.length-1].framebuffer=this._previousLuminance,this._previousLuminance=n},gm.prototype.execute=function(e,t){this._colorTexture=t;var a=this._commands;if(Object(s.default)(a))for(var i=a.length,n=0;n<i;++n)a[n].execute(e)},gm.prototype.isDestroyed=function(){return!1},gm.prototype.destroy=function(){return vm(this),ym(this),Object(l.default)(this)};var Cm=gm,Om={NEAREST:0,LINEAR:1};function xm(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).fragmentShader,a=Object(o.default)(e.textureScale,1),i=Object(o.default)(e.pixelFormat,_e.a.RGBA);this._fragmentShader=t,this._uniforms=e.uniforms,this._textureScale=a,this._forcePowerOfTwo=Object(o.default)(e.forcePowerOfTwo,!1),this._sampleMode=Object(o.default)(e.sampleMode,Om.NEAREST),this._pixelFormat=i,this._pixelDatatype=Object(o.default)(e.pixelDatatype,we.a.UNSIGNED_BYTE),this._clearColor=Object(o.default)(e.clearColor,b.default.BLACK),this._uniformMap=void 0,this._command=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;var n=new $r;n.scissorTest={enabled:!0,rectangle:Object(s.default)(e.scissorRectangle)?fr.default.clone(e.scissorRectangle):new fr.default},this._passState=n,this._ready=!1;var r=e.name;Object(s.default)(r)||(r=Object(hr.default)()),this._name=r,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0}Object.defineProperties(xm.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(Object(s.default)(this._textureCache)){var e=this._textureCache.getFramebuffer(this._name);if(Object(s.default)(e))return e.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});var Tm=/uniform\s+sampler2D\s+depthTexture/g;function Em(e,t,a){var i=t[a];return("string"==typeof i||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData)&&e._dirtyUniforms.push(a),{get:function(){return t[a]},set:function(i){var n=t[a];t[a]=i;var r=e._actualUniforms,o=r[a];Object(s.default)(o)&&o!==n&&o instanceof D.a&&!Object(s.default)(e._textureCache.getStageByName(a))&&(e._texturesToRelease.push(o),delete r[a],delete r[a+"Dimensions"]),n instanceof D.a&&e._texturesToRelease.push(n),"string"==typeof i||i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof ImageData?e._dirtyUniforms.push(a):r[a]=i}}}function Am(e,t){return function(){var a=e._actualUniforms[t];return"function"==typeof a?a():a}}function Pm(e,t){return function(){var a=e[t]();if(Object(s.default)(a))return a.dimensions}}function Sm(e,t){return function(a){e._texturesToCreate.push({name:t,source:a})}}function Dm(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function Fm(e){Object(s.default)(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();var t=e._textureCache;if(Object(s.default)(t)){var a=e._uniforms,i=e._actualUniforms;for(var n in i)i.hasOwnProperty(n)&&i[n]instanceof D.a&&(Object(s.default)(t.getStageByName(a[n]))||i[n].destroy(),e._dirtyUniforms.push(n))}}xm.prototype._isSupported=function(e){return!Tm.test(this._fragmentShader)||e.depthTexture},xm.prototype.update=function(e,t){if(this.enabled===this._enabled||this.enabled||Fm(this),this._enabled=this.enabled,this._enabled&&(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=function(e){var t=Object(s.default)(e._selected)?e._selected.length:0,a=Object(s.default)(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||a!==e._parentSelectedLength,Object(s.default)(e._selected)&&Object(s.default)(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Object(s.default)(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&Object(s.default)(e._combinedSelected)){if(!Object(s.default)(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var n=0;n<t;++n)if(e._combinedSelected[n]!==e._combinedSelectedShadow[n])return!0}return i}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Object(s.default)(this._selected)?this._selected.length:0,this._parentSelectedLength=Object(s.default)(this._parentSelected)?this._parentSelected.length:0,function(e,t){if(e._selectedDirty){e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;var a=e._combinedSelected;if(Object(s.default)(a)){var i,n,r,o=0,l=a.length;for(i=0;i<l;++i)n=a[i],Object(s.default)(n.pickIds)?o+=n.pickIds.length:Object(s.default)(n.pickId)&&++o;if(0===l||0===o){var u=new Uint8Array(4);return u[0]=255,u[1]=255,u[2]=255,u[3]=255,void(e._selectedIdTexture=new D.a({context:t,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,source:{arrayBufferView:u,width:1,height:1},sampler:Ce.a.NEAREST}))}var d=0,c=new Uint8Array(4*o);for(i=0;i<l;++i)if(n=a[i],Object(s.default)(n.pickIds))for(var f=n.pickIds,h=f.length,m=0;m<h;++m)r=f[m].color,c[d]=b.default.floatToByte(r.red),c[d+1]=b.default.floatToByte(r.green),c[d+2]=b.default.floatToByte(r.blue),c[d+3]=b.default.floatToByte(r.alpha),d+=4;else Object(s.default)(n.pickId)&&(r=n.pickId.color,c[d]=b.default.floatToByte(r.red),c[d+1]=b.default.floatToByte(r.green),c[d+2]=b.default.floatToByte(r.blue),c[d+3]=b.default.floatToByte(r.alpha),d+=4);e._selectedIdTexture=new D.a({context:t,pixelFormat:_e.a.RGBA,pixelDatatype:we.a.UNSIGNED_BYTE,source:{arrayBufferView:c,width:o,height:1},sampler:Ce.a.NEAREST})}}}(this,e),function(e){if(!Object(s.default)(e._uniformMap)){var t={},a={},i=e._uniforms,n=e._actualUniforms;for(var r in i)if(i.hasOwnProperty(r)){"function"!=typeof i[r]?(t[r]=Am(e,r),a[r]=Em(e,i,r)):(t[r]=i[r],a[r]=i[r]),n[r]=i[r];var o=t[r]();("string"==typeof o||o instanceof D.a||o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement)&&(t[r+"Dimensions"]=Pm(t,r))}e._uniforms={},Object.defineProperties(e._uniforms,a),e._uniformMap=Object(X.default)(t,{colorTexture:function(){return e._colorTexture},colorTextureDimensions:function(){return e._colorTexture.dimensions},depthTexture:function(){return e._depthTexture},depthTextureDimensions:function(){return e._depthTexture.dimensions},czm_idTexture:function(){return e._idTexture},czm_selectedIdTexture:function(){return e._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/e._selectedIdTexture.width}})}}(this),function(e,t){var a,i,n,r=e._texturesToRelease,o=r.length;for(a=0;a<o;++a)i=(i=r[a])&&i.destroy();r.length=0;var l=e._texturesToCreate;for(o=l.length,a=0;a<o;++a){var u=l[a];n=u.name;var d=u.source;e._actualUniforms[n]=new D.a({context:t,source:d})}l.length=0;var c=e._dirtyUniforms;if(0!==c.length||Object(s.default)(e._texturePromise)){if(0!==c.length&&!Object(s.default)(e._texturePromise)){o=c.length;var f=e._uniforms,h=[];for(a=0;a<o;++a){var m=f[n=c[a]],p=e._textureCache.getStageByName(m);if(Object(s.default)(p))e._actualUniforms[n]=Dm(e,m);else if("string"==typeof m){var _=new P.default({url:m});h.push(_.fetchImage().then(Sm(e,n)))}else e._texturesToCreate.push({name:n,source:m})}c.length=0,h.length>0?(e._ready=!1,e._texturePromise=R.default.all(h).then((function(){e._ready=!0,e._texturePromise=void 0}))):e._ready=!0}}else e._ready=!0}(this,e),function(e,t){if(!Object(s.default)(e._command)||e._logDepthChanged||e._selectedDirty){var a=e._fragmentShader;if(Object(s.default)(e._selectedIdTexture))a="#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i = 0; i < "+e._selectedIdTexture.width+"; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n"+(a=a.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""));var i=new S.a({defines:[e._useLogDepth?"LOG_DEPTH":""],sources:[a]});e._command=t.createViewportQuadCommand(i,{uniformMap:e._uniformMap,owner:e})}}(this,e),function(e){var t,a;e._sampleMode===Om.LINEAR?(t=xe.a.LINEAR,a=Oe.a.LINEAR):(t=xe.a.NEAREST,a=Oe.a.NEAREST);var i=e._sampler;Object(s.default)(i)&&i.minificationFilter===t&&i.magnificationFilter===a||(e._sampler=new Ce.a({wrapS:Te.a.CLAMP_TO_EDGE,wrapT:Te.a.CLAMP_TO_EDGE,minificationFilter:t,magnificationFilter:a}))}(this),this._selectedDirty=!1,this._ready)){var a=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=a,Object(s.default)(a)){var i,n=a.getColorTexture(0);n.width===e.drawingBufferWidth&&n.height===e.drawingBufferHeight||(i=this._renderState,Object(s.default)(i)&&n.width===i.viewport.width&&n.height===i.viewport.height||(this._renderState=ce.a.fromCache({viewport:new fr.default(0,0,n.width,n.height)}))),this._command.renderState=i}}},xm.prototype.execute=function(e,t,a,i){if(Object(s.default)(this._command)&&Object(s.default)(this._command.framebuffer)&&this._ready&&this._enabled){this._colorTexture=t,this._depthTexture=a,this._idTexture=i,Ce.a.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);var n=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;Object(s.default)(n)&&(n.context=e),this._command.execute(e,n)}},xm.prototype.isDestroyed=function(){return!1},xm.prototype.destroy=function(){return Fm(this),Object(l.default)(this)};var Mm=xm;function Im(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT),this._stages=e.stages,this._inputPreviousStageTexture=Object(o.default)(e.inputPreviousStageTexture,!0);var t=e.name;Object(s.default)(t)||(t=Object(hr.default)()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}Object.defineProperties(Im.prototype,{ready:{get:function(){for(var e=this._stages,t=e.length,a=0;a<t;++a)if(!e[a].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){for(var t=this._stages,a=t.length,i=0;i<a;++i)t[i].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}}),Im.prototype._isSupported=function(e){for(var t=this._stages,a=t.length,i=0;i<a;++i)if(!t[i]._isSupported(e))return!1;return!0},Im.prototype.get=function(e){return this._stages[e]},Im.prototype.update=function(e,t){this._selectedDirty=function(e){var t=Object(s.default)(e._selected)?e._selected.length:0,a=Object(s.default)(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||a!==e._parentSelectedLength,Object(s.default)(e._selected)&&Object(s.default)(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):Object(s.default)(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&Object(s.default)(e._combinedSelected)){if(!Object(s.default)(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(var n=0;n<t;++n)if(e._combinedSelected[n]!==e._combinedSelectedShadow[n])return!0}return i}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=Object(s.default)(this._selected)?this._selected.length:0,this._parentSelectedLength=Object(s.default)(this._parentSelected)?this._parentSelected.length:0;for(var a=this._stages,i=a.length,n=0;n<i;++n){var r=a[n];this._selectedDirty&&(r.parentSelected=this._combinedSelected),r.update(e,t)}},Im.prototype.isDestroyed=function(){return!1},Im.prototype.destroy=function(){for(var e=this._stages,t=e.length,a=0;a<t;++a)e[a].destroy();return Object(l.default)(this)};var Rm=Im,Nm={};function Lm(e){var t="#define USE_STEP_SIZE\n"+_m,a=new Mm({name:e+"_x_direction",fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:Om.LINEAR}),i=new Mm({name:e+"_y_direction",fragmentShader:t,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:Om.LINEAR}),n={};return Object.defineProperties(n,{delta:{get:function(){return a.uniforms.delta},set:function(e){var t=a.uniforms,n=i.uniforms;t.delta=n.delta=e}},sigma:{get:function(){return a.uniforms.sigma},set:function(e){var t=a.uniforms,n=i.uniforms;t.sigma=n.sigma=e}},stepSize:{get:function(){return a.uniforms.stepSize},set:function(e){var t=a.uniforms,n=i.uniforms;t.stepSize=n.stepSize=e}}}),new Rm({name:e,stages:[a,i],uniforms:n})}Nm.createBlurStage=function(){return Lm("czm_blur")},Nm.createDepthOfFieldStage=function(){var e=Lm("czm_depth_of_field_blur"),t=new Mm({name:"czm_depth_of_field_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D blurTexture;\nuniform sampler2D depthTexture;\nuniform float focalDistance;\n\nvarying vec2 v_textureCoordinates;\n\nvec4 toEye(vec2 uv, float depth)\n{\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n   vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\n   posInCamera = posInCamera / posInCamera.w;\n   return posInCamera;\n}\n\nfloat computeDepthBlur(float depth)\n{\n    float f;\n    if (depth < focalDistance)\n    {\n        f = (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);\n    }\n    else\n    {\n        f = (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);\n        f = pow(f, 0.1);\n    }\n    f *= f;\n    f = clamp(f, 0.0, 1.0);\n    return pow(f, 0.5);\n}\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = toEye(v_textureCoordinates, depth);\n    float d = computeDepthBlur(-posInCamera.z);\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), texture2D(blurTexture, v_textureCoordinates), d);\n}\n",uniforms:{focalDistance:5,blurTexture:e.name}}),a={};return Object.defineProperties(a,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(e){t.uniforms.focalDistance=e}},delta:{get:function(){return e.uniforms.delta},set:function(t){e.uniforms.delta=t}},sigma:{get:function(){return e.uniforms.sigma},set:function(t){e.uniforms.sigma=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}}}),new Rm({name:"czm_depth_of_field",stages:[e,t],inputPreviousStageTexture:!1,uniforms:a})},Nm.isDepthOfFieldSupported=function(e){return e.context.depthTexture},Nm.createEdgeDetectionStage=function(){var e=Object(hr.default)();return new Mm({name:"czm_edge_detection_"+e,fragmentShader:"uniform sampler2D depthTexture;\nuniform float length;\nuniform vec4 color;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    float directions[3];\n    directions[0] = -1.0;\n    directions[1] = 0.0;\n    directions[2] = 1.0;\n\n    float scalars[3];\n    scalars[0] = 3.0;\n    scalars[1] = 10.0;\n    scalars[2] = 3.0;\n\n    float padx = czm_pixelRatio / czm_viewport.z;\n    float pady = czm_pixelRatio / czm_viewport.w;\n\n#ifdef CZM_SELECTED_FEATURE\n    bool selected = false;\n    for (int i = 0; i < 3; ++i)\n    {\n        float dir = directions[i];\n        selected = selected || czm_selected(vec2(-padx, dir * pady));\n        selected = selected || czm_selected(vec2(padx, dir * pady));\n        selected = selected || czm_selected(vec2(dir * padx, -pady));\n        selected = selected || czm_selected(vec2(dir * padx, pady));\n        if (selected)\n        {\n            break;\n        }\n    }\n    if (!selected)\n    {\n        gl_FragColor = vec4(color.rgb, 0.0);\n        return;\n    }\n#endif\n\n    float horizEdge = 0.0;\n    float vertEdge = 0.0;\n\n    for (int i = 0; i < 3; ++i)\n    {\n        float dir = directions[i];\n        float scale = scalars[i];\n\n        horizEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;\n        horizEdge += texture2D(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;\n\n        vertEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;\n        vertEdge += texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;\n    }\n\n    float len = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\n    gl_FragColor = vec4(color.rgb, len > length ? color.a : 0.0);\n}\n",uniforms:{length:.25,color:b.default.clone(b.default.BLACK)}})},Nm.isEdgeDetectionSupported=function(e){return e.context.depthTexture},Nm.createSilhouetteStage=function(e){var t=function(e){if(!Object(s.default)(e))return Nm.createEdgeDetectionStage();for(var t=new Rm({name:"czm_edge_detection_multiple",stages:e,inputPreviousStageTexture:!1}),a={},i="",n="",r=0;r<e.length;++r)i+="uniform sampler2D edgeTexture"+r+"; \n",n+="        vec4 edge"+r+" = texture2D(edgeTexture"+r+", v_textureCoordinates); \n        if (edge"+r+".a > 0.0) \n        { \n            color = edge"+r+"; \n            break; \n        } \n",a["edgeTexture"+r]=e[r].name;var o=i+"varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < "+e.length+"; i++) \n    { \n"+n+"    } \n    gl_FragColor = color; \n} \n",l=new Mm({name:"czm_edge_detection_combine",fragmentShader:o,uniforms:a});return new Rm({name:"czm_edge_detection_composite",stages:[t,l]})}(e),a=new Mm({name:"czm_silhouette_color_edges",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D silhouetteTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec4 silhouetteColor = texture2D(silhouetteTexture, v_textureCoordinates);\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    gl_FragColor = mix(color, silhouetteColor, silhouetteColor.a);\n}\n",uniforms:{silhouetteTexture:t.name}});return new Rm({name:"czm_silhouette",stages:[t,a],inputPreviousStageTexture:!1,uniforms:t.uniforms})},Nm.isSilhouetteSupported=function(e){return e.context.depthTexture},Nm.createBloomStage=function(){var e=new Mm({name:"czm_bloom_contrast_bias",fragmentShader:"uniform sampler2D colorTexture;\nuniform float contrast;\nuniform float brightness;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 sceneColor = texture2D(colorTexture, v_textureCoordinates).xyz;\n    sceneColor = czm_RGBToHSB(sceneColor);\n    sceneColor.z += brightness;\n    sceneColor = czm_HSBToRGB(sceneColor);\n\n    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\n    sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);\n    gl_FragColor = vec4(sceneColor, 1.0);\n}\n",uniforms:{contrast:128,brightness:-.3}}),t=Lm("czm_bloom_blur"),a=new Rm({name:"czm_bloom_contrast_bias_blur",stages:[e,t]}),i=new Mm({name:"czm_bloom_generate_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D bloomTexture;\nuniform bool glowOnly;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n\n#ifdef CZM_SELECTED_FEATURE\n    if (czm_selected()) {\n        gl_FragColor = color;\n        return;\n    }\n#endif\n\n    vec4 bloom = texture2D(bloomTexture, v_textureCoordinates);\n    gl_FragColor = glowOnly ? bloom : bloom + color;\n}\n",uniforms:{glowOnly:!1,bloomTexture:a.name}}),n={};return Object.defineProperties(n,{glowOnly:{get:function(){return i.uniforms.glowOnly},set:function(e){i.uniforms.glowOnly=e}},contrast:{get:function(){return e.uniforms.contrast},set:function(t){e.uniforms.contrast=t}},brightness:{get:function(){return e.uniforms.brightness},set:function(t){e.uniforms.brightness=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}}}),new Rm({name:"czm_bloom",stages:[a,i],inputPreviousStageTexture:!1,uniforms:n})},Nm.createAmbientOcclusionStage=function(){var e=new Mm({name:"czm_ambient_occlusion_generate",fragmentShader:"uniform sampler2D randomTexture;\nuniform sampler2D depthTexture;\nuniform float intensity;\nuniform float bias;\nuniform float lengthCap;\nuniform float stepSize;\nuniform float frustumLength;\n\nvarying vec2 v_textureCoordinates;\n\nvec4 clipToEye(vec2 uv, float depth)\n{\n    vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n    vec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\n    posEC = posEC / posEC.w;\n    return posEC;\n}\n\n//Reconstruct Normal Without Edge Removation\nvec3 getNormalXEdge(vec3 posInCamera, float depthU, float depthD, float depthL, float depthR, vec2 pixelSize)\n{\n    vec4 posInCameraUp = clipToEye(v_textureCoordinates - vec2(0.0, pixelSize.y), depthU);\n    vec4 posInCameraDown = clipToEye(v_textureCoordinates + vec2(0.0, pixelSize.y), depthD);\n    vec4 posInCameraLeft = clipToEye(v_textureCoordinates - vec2(pixelSize.x, 0.0), depthL);\n    vec4 posInCameraRight = clipToEye(v_textureCoordinates + vec2(pixelSize.x, 0.0), depthR);\n\n    vec3 up = posInCamera.xyz - posInCameraUp.xyz;\n    vec3 down = posInCameraDown.xyz - posInCamera.xyz;\n    vec3 left = posInCamera.xyz - posInCameraLeft.xyz;\n    vec3 right = posInCameraRight.xyz - posInCamera.xyz;\n\n    vec3 DX = length(left) < length(right) ? left : right;\n    vec3 DY = length(up) < length(down) ? up : down;\n\n    return normalize(cross(DY, DX));\n}\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = clipToEye(v_textureCoordinates, depth);\n\n    if (posInCamera.z > frustumLength)\n    {\n        gl_FragColor = vec4(1.0);\n        return;\n    }\n\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\n    float depthU = czm_readDepth(depthTexture, v_textureCoordinates - vec2(0.0, pixelSize.y));\n    float depthD = czm_readDepth(depthTexture, v_textureCoordinates + vec2(0.0, pixelSize.y));\n    float depthL = czm_readDepth(depthTexture, v_textureCoordinates - vec2(pixelSize.x, 0.0));\n    float depthR = czm_readDepth(depthTexture, v_textureCoordinates + vec2(pixelSize.x, 0.0));\n    vec3 normalInCamera = getNormalXEdge(posInCamera.xyz, depthU, depthD, depthL, depthR, pixelSize);\n\n    float ao = 0.0;\n    vec2 sampleDirection = vec2(1.0, 0.0);\n    float gapAngle = 90.0 * czm_radiansPerDegree;\n\n    // RandomNoise\n    float randomVal = texture2D(randomTexture, v_textureCoordinates).x;\n\n    //Loop for each direction\n    for (int i = 0; i < 4; i++)\n    {\n        float newGapAngle = gapAngle * (float(i) + randomVal);\n        float cosVal = cos(newGapAngle);\n        float sinVal = sin(newGapAngle);\n\n        //Rotate Sampling Direction\n        vec2 rotatedSampleDirection = vec2(cosVal * sampleDirection.x - sinVal * sampleDirection.y, sinVal * sampleDirection.x + cosVal * sampleDirection.y);\n        float localAO = 0.0;\n        float localStepSize = stepSize;\n\n        //Loop for each step\n        for (int j = 0; j < 6; j++)\n        {\n            vec2 newCoords = v_textureCoordinates + rotatedSampleDirection * localStepSize * pixelSize;\n\n            //Exception Handling\n            if(newCoords.x > 1.0 || newCoords.y > 1.0 || newCoords.x < 0.0 || newCoords.y < 0.0)\n            {\n                break;\n            }\n\n            float stepDepthInfo = czm_readDepth(depthTexture, newCoords);\n            vec4 stepPosInCamera = clipToEye(newCoords, stepDepthInfo);\n            vec3 diffVec = stepPosInCamera.xyz - posInCamera.xyz;\n            float len = length(diffVec);\n\n            if (len > lengthCap)\n            {\n                break;\n            }\n\n            float dotVal = clamp(dot(normalInCamera, normalize(diffVec)), 0.0, 1.0 );\n            float weight = len / lengthCap;\n            weight = 1.0 - weight * weight;\n\n            if (dotVal < bias)\n            {\n                dotVal = 0.0;\n            }\n\n            localAO = max(localAO, dotVal * weight);\n            localStepSize += stepSize;\n        }\n        ao += localAO;\n    }\n\n    ao /= 4.0;\n    ao = 1.0 - clamp(ao, 0.0, 1.0);\n    ao = pow(ao, intensity);\n    gl_FragColor = vec4(vec3(ao), 1.0);\n}\n",uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),t=Lm("czm_ambient_occlusion_blur");t.uniforms.stepSize=.86;var a=new Rm({name:"czm_ambient_occlusion_generate_blur",stages:[e,t]}),i=new Mm({name:"czm_ambient_occlusion_composite",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D ambientOcclusionTexture;\nuniform bool ambientOcclusionOnly;\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 color = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 ao = texture2D(ambientOcclusionTexture, v_textureCoordinates).rgb;\n    gl_FragColor.rgb = ambientOcclusionOnly ? ao : ao * color;\n}\n",uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:a.name}}),n={};return Object.defineProperties(n,{intensity:{get:function(){return e.uniforms.intensity},set:function(t){e.uniforms.intensity=t}},bias:{get:function(){return e.uniforms.bias},set:function(t){e.uniforms.bias=t}},lengthCap:{get:function(){return e.uniforms.lengthCap},set:function(t){e.uniforms.lengthCap=t}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(t){e.uniforms.stepSize=t}},frustumLength:{get:function(){return e.uniforms.frustumLength},set:function(t){e.uniforms.frustumLength=t}},randomTexture:{get:function(){return e.uniforms.randomTexture},set:function(t){e.uniforms.randomTexture=t}},delta:{get:function(){return t.uniforms.delta},set:function(e){t.uniforms.delta=e}},sigma:{get:function(){return t.uniforms.sigma},set:function(e){t.uniforms.sigma=e}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(e){t.uniforms.stepSize=e}},ambientOcclusionOnly:{get:function(){return i.uniforms.ambientOcclusionOnly},set:function(e){i.uniforms.ambientOcclusionOnly=e}}}),new Rm({name:"czm_ambient_occlusion",stages:[a,i],inputPreviousStageTexture:!1,uniforms:n})},Nm.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};Nm.createFXAAStage=function(){return new Mm({name:"czm_FXAA",fragmentShader:"#define FXAA_QUALITY_PRESET 39 \n/**\n * @license\n * Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *  * Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *  * Neither the name of NVIDIA CORPORATION nor the names of its\n *    contributors may be used to endorse or promote products derived\n *    from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// NVIDIA GameWorks Graphics Samples GitHub link: https://github.com/NVIDIAGameWorks/GraphicsSamples\n// Original FXAA 3.11 shader link: https://github.com/NVIDIAGameWorks/GraphicsSamples/blob/master/samples/es3-kepler/FXAA/FXAA3_11.h\n\n// Steps used to integrate into Cesium:\n// * The following defines are set:\n//       #define FXAA_PC 1\n//       #define FXAA_WEBGL_1 1\n//       #define FXAA_GREEN_AS_LUMA 1\n//       #define FXAA_EARLY_EXIT 1\n//       #define FXAA_GLSL_120 1\n// * All other preprocessor directives besides the FXAA_QUALITY__P* directives were removed.\n// * Double underscores are invalid for preprocessor directives so replace them with a single underscore. Replace\n//   /FXAA_QUALITY__P(.*)/g with /FXAA_QUALITY__P$1/.\n// * There are no implicit conversions from ivec* to vec* so replace:\n//       #define FxaaInt2 ivec2\n//           with\n//       #define FxaaInt2 vec2\n// * The texture2DLod function is only available in vertex shaders so replace:\n//       #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n//       #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n//           with\n//       #define FxaaTexTop(t, p) texture2D(t, p)\n//       #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n// * FXAA_QUALITY_PRESET is prepended in the javascript code. We may want to expose that setting in the future.\n// * The following parameters to FxaaPixelShader are unused and can be removed:\n//       fxaaConsolePosPos\n//       fxaaConsoleRcpFrameOpt\n//       fxaaConsoleRcpFrameOpt2\n//       fxaaConsole360RcpFrameOpt2\n//       fxaaConsoleEdgeSharpness\n//       fxaaConsoleEdgeThreshold\n//       fxaaConsoleEdgeThresholdMi\n//       fxaaConsole360ConstDir\n\n//\n// Choose the quality preset.\n// This needs to be compiled into the shader as it effects code.\n// Best option to include multiple presets is to\n// in each shader define the preset, then include this file.\n//\n// OPTIONS\n// -----------------------------------------------------------------------\n// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n// 39       - no dither, very expensive\n//\n// NOTES\n// -----------------------------------------------------------------------\n// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n// 13 = about same speed as FXAA 3.9 and better than 12\n// 23 = closest to FXAA 3.9 visually and performance wise\n//  _ = the lowest digit is directly related to performance\n// _  = the highest digit is directly related to style\n//\n//#define FXAA_QUALITY_PRESET 12\n\n\n#if (FXAA_QUALITY_PRESET == 10)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 3.0\n    #define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 3.0\n    #define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 4.0\n    #define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 4.0\n    #define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 4.0\n    #define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n    #define FXAA_QUALITY_PS 3\n    #define FXAA_QUALITY_P0 1.5\n    #define FXAA_QUALITY_P1 2.0\n    #define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n    #define FXAA_QUALITY_PS 4\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n    #define FXAA_QUALITY_PS 5\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n    #define FXAA_QUALITY_PS 6\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n    #define FXAA_QUALITY_PS 7\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 3.0\n    #define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n    #define FXAA_QUALITY_PS 8\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 4.0\n    #define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n    #define FXAA_QUALITY_PS 9\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 4.0\n    #define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n    #define FXAA_QUALITY_PS 10\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 4.0\n    #define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n    #define FXAA_QUALITY_PS 11\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 4.0\n    #define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.5\n    #define FXAA_QUALITY_P2 2.0\n    #define FXAA_QUALITY_P3 2.0\n    #define FXAA_QUALITY_P4 2.0\n    #define FXAA_QUALITY_P5 2.0\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n    #define FXAA_QUALITY_PS 12\n    #define FXAA_QUALITY_P0 1.0\n    #define FXAA_QUALITY_P1 1.0\n    #define FXAA_QUALITY_P2 1.0\n    #define FXAA_QUALITY_P3 1.0\n    #define FXAA_QUALITY_P4 1.0\n    #define FXAA_QUALITY_P5 1.5\n    #define FXAA_QUALITY_P6 2.0\n    #define FXAA_QUALITY_P7 2.0\n    #define FXAA_QUALITY_P8 2.0\n    #define FXAA_QUALITY_P9 2.0\n    #define FXAA_QUALITY_P10 4.0\n    #define FXAA_QUALITY_P11 8.0\n#endif\n\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\n\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\nFxaaFloat4 FxaaPixelShader(\n    //\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = center of pixel\n    FxaaFloat2 pos,\n    //\n    // Input color texture.\n    // {rgb_} = color in linear or perceptual color space\n    // if (FXAA_GREEN_AS_LUMA == 0)\n    //     {___a} = luma in perceptual color space (not linear)\n    FxaaTex tex,\n    //\n    // Only used on FXAA Quality.\n    // This must be from a constant/uniform.\n    // {x_} = 1.0/screenWidthInPixels\n    // {_y} = 1.0/screenHeightInPixels\n    FxaaFloat2 fxaaQualityRcpFrame,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_SUBPIX define.\n    // It is here now to allow easier tuning.\n    // Choose the amount of sub-pixel aliasing removal.\n    // This can effect sharpness.\n    //   1.00 - upper limit (softer)\n    //   0.75 - default amount of filtering\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n    //   0.25 - almost off\n    //   0.00 - completely off\n    FxaaFloat fxaaQualitySubpix,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // The minimum amount of local contrast required to apply algorithm.\n    //   0.333 - too little (faster)\n    //   0.250 - low quality\n    //   0.166 - default\n    //   0.125 - high quality\n    //   0.063 - overkill (slower)\n    FxaaFloat fxaaQualityEdgeThreshold,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n    //   0.0625 - high quality (faster)\n    //   0.0312 - visible limit (slower)\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaQualityEdgeThresholdMin\n) {\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posM;\n    posM.x = pos.x;\n    posM.y = pos.y;\n    FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n    #define lumaM rgbyM.y\n    FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n/*--------------------------------------------------------------------------*/\n    FxaaFloat maxSM = max(lumaS, lumaM);\n    FxaaFloat minSM = min(lumaS, lumaM);\n    FxaaFloat maxESM = max(lumaE, maxSM);\n    FxaaFloat minESM = min(lumaE, minSM);\n    FxaaFloat maxWN = max(lumaN, lumaW);\n    FxaaFloat minWN = min(lumaN, lumaW);\n    FxaaFloat rangeMax = max(maxWN, maxESM);\n    FxaaFloat rangeMin = min(minWN, minESM);\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    FxaaFloat range = rangeMax - rangeMin;\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n    FxaaBool earlyExit = range < rangeMaxClamped;\n/*--------------------------------------------------------------------------*/\n    if(earlyExit)\n        return rgbyM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n    FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNS = lumaN + lumaS;\n    FxaaFloat lumaWE = lumaW + lumaE;\n    FxaaFloat subpixRcpRange = 1.0/range;\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n/*--------------------------------------------------------------------------*/\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat gradientN = lumaN - lumaM;\n    FxaaFloat gradientS = lumaS - lumaM;\n    FxaaFloat lumaNN = lumaN + lumaM;\n    FxaaFloat lumaSS = lumaS + lumaM;\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posB;\n    posB.x = posM.x;\n    posB.y = posM.y;\n    FxaaFloat2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posN;\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat2 posP;\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n    FxaaFloat subpixE = subpixC * subpixC;\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n/*--------------------------------------------------------------------------*/\n    if(!pairN) lumaNN = lumaSS;\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n    FxaaFloat subpixF = subpixD * subpixE;\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\n/*--------------------------------------------------------------------------*/\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n    FxaaBool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n/*--------------------------------------------------------------------------*/\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 3)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 4)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 5)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 6)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n/*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITY_PS > 7)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITY_PS > 8)\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITY_PS > 9)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITY_PS > 10)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITY_PS > 11)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITY_PS > 12)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n    #endif\n/*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n/*--------------------------------------------------------------------------*/\n    FxaaFloat dstN = posM.x - posN.x;\n    FxaaFloat dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n/*--------------------------------------------------------------------------*/\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    FxaaFloat spanLength = (dstP + dstN);\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\n/*--------------------------------------------------------------------------*/\n    FxaaBool directionN = dstN < dstP;\n    FxaaFloat dst = min(dstN, dstP);\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n    FxaaFloat subpixG = subpixF * subpixF;\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n    return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n}\n\nvarying vec2 v_textureCoordinates;\n\nuniform sampler2D colorTexture;\n\nconst float fxaaQualitySubpix = 0.5;\nconst float fxaaQualityEdgeThreshold = 0.125;\nconst float fxaaQualityEdgeThresholdMin = 0.0833;\n\nconst float fxaaChannelDiffThreshold = 0.12;\n\nvoid main()\n{\n    // Terrible hack:\n    // Don't run FXAA on grey fragments.\n    // Since most text is black or white, this tends to preserve it while allowing us to AA everything else\n    vec4 initialColor = texture2D(colorTexture, v_textureCoordinates);\n    if (abs(initialColor.r - initialColor.b) + abs(initialColor.r - initialColor.g) + abs(initialColor.g - initialColor.b) < fxaaChannelDiffThreshold) {\n        gl_FragColor = initialColor;\n        return;\n    }\n\n    vec2 fxaaQualityRcpFrame = vec2(1.0) / czm_viewport.zw;\n\n    vec4 color = FxaaPixelShader(\n        v_textureCoordinates,\n        colorTexture,\n        fxaaQualityRcpFrame,\n        fxaaQualitySubpix,\n        fxaaQualityEdgeThreshold,\n        fxaaQualityEdgeThresholdMin);\n    float alpha = texture2D(colorTexture, v_textureCoordinates).a;\n    gl_FragColor = vec4(color.rgb, alpha);\n}\n",sampleMode:Om.LINEAR})},Nm.createAcesTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Mm({name:"czm_aces",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n\n#ifdef AUTO_EXPOSURE\n    color /= texture2D(autoExposure, vec2(0.5)).r;\n#endif\n    color = czm_acesTonemapping(color);\n    color = czm_inverseGamma(color);\n\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Nm.createFilmicTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Mm({name:"czm_filmic",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See slides 142 and 143:\n//     http://www.gdcvault.com/play/1012459/Uncharted_2__HDR_Lighting\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n\n\tconst float A = 0.22; // shoulder strength\n\tconst float B = 0.30; // linear strength\n\tconst float C = 0.10; // linear angle\n\tconst float D = 0.20; // toe strength\n\tconst float E = 0.01; // toe numerator\n\tconst float F = 0.30; // toe denominator\n\n\tconst float white = 11.2; // linear white point value\n\n\tvec3 c = ((color * (A * color + C * B) + D * E) / (color * ( A * color + B) + D * F)) - E / F;\n\tfloat w = ((white * (A * white + C * B) + D * E) / (white * ( A * white + B) + D * F)) - E / F;\n\n\tc = czm_inverseGamma(c / w);\n\tgl_FragColor = vec4(c, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Nm.createReinhardTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Mm({name:"czm_reinhard",fragmentShader:t+="uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See equation 3:\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n    color = color / (1.0 + color);\n    color = czm_inverseGamma(color);\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{autoExposure:void 0}})},Nm.createModifiedReinhardTonemappingStage=function(e){var t=e?"#define AUTO_EXPOSURE\n":"";return new Mm({name:"czm_modified_reinhard",fragmentShader:t+="uniform sampler2D colorTexture;\nuniform vec3 white;\n\nvarying vec2 v_textureCoordinates;\n\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\n\n// See equation 4:\n//    http://www.cs.utah.edu/~reinhard/cdrom/tonemap.pdf\n\nvoid main()\n{\n    vec4 fragmentColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 color = fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\n    float exposure = texture2D(autoExposure, vec2(0.5)).r;\n    color /= exposure;\n#endif\n    color = (color * (1.0 + color / white)) / (1.0 + color);\n    color = czm_inverseGamma(color);\n    gl_FragColor = vec4(color, fragmentColor.a);\n}\n",uniforms:{white:b.default.WHITE,autoExposure:void 0}})},Nm.createAutoExposureStage=function(){return new Cm},Nm.createBlackAndWhiteStage=function(){return new Mm({name:"czm_black_and_white",fragmentShader:"uniform sampler2D colorTexture;\nuniform float gradations;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n#ifdef CZM_SELECTED_FEATURE\n    if (czm_selected()) {\n        gl_FragColor = vec4(rgb, 1.0);\n        return;\n    }\n#endif\n    float luminance = czm_luminance(rgb);\n    float darkness = luminance * gradations;\n    darkness = (darkness - fract(darkness)) / gradations;\n    gl_FragColor = vec4(vec3(darkness), 1.0);\n}\n",uniforms:{gradations:5}})},Nm.createBrightnessStage=function(){return new Mm({name:"czm_brightness",fragmentShader:"uniform sampler2D colorTexture;\nuniform float brightness;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 target = vec3(0.0);\n    gl_FragColor = vec4(mix(target, rgb, brightness), 1.0);\n}\n",uniforms:{brightness:.5}})},Nm.createNightVisionStage=function(){return new Mm({name:"czm_night_vision",fragmentShader:"uniform sampler2D colorTexture;\n\nvarying vec2 v_textureCoordinates;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(void)\n{\n    float noiseValue = rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;\n    vec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n    vec3 green = vec3(0.0, 1.0, 0.0);\n    gl_FragColor = vec4((noiseValue + rgb) * green, 1.0);\n}\n"})},Nm.createDepthViewStage=function(){return new Mm({name:"czm_depth_view",fragmentShader:"uniform sampler2D depthTexture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main(void)\n{\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    gl_FragColor = vec4(vec3(depth), 1.0);\n}\n"})},Nm.createLensFlareStage=function(){return new Mm({name:"czm_lens_flare",fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D dirtTexture;\nuniform sampler2D starTexture;\nuniform vec2 dirtTextureDimensions;\nuniform float distortion;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform float dirtAmount;\nuniform float earthRadius;\nuniform float intensity;\n\nvarying vec2 v_textureCoordinates;\n\n// whether it is in space or not\n// 6500000.0 is empirical value\n#define DISTANCE_TO_SPACE 6500000.0\n\n// return ndc from world coordinate biased earthRadius\nvec4 getNDCFromWC(vec3 WC, float earthRadius)\n{\n    vec4 positionEC = czm_view * vec4(WC, 1.0);\n    positionEC = vec4(positionEC.x + earthRadius, positionEC.y, positionEC.z, 1.0);\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    return czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\n}\n\n// Check if current pixel is included Earth\n// if then mask it gradually\nfloat isInEarth(vec2 texcoord, vec2 sceneSize)\n{\n    vec2 NDC = texcoord * 2.0 - 1.0;\n    vec4 earthPosSC = getNDCFromWC(vec3(0.0), 0.0);\n    vec4 earthPosSCEdge = getNDCFromWC(vec3(0.0), earthRadius * 1.5);\n    NDC.xy -= earthPosSC.xy;\n\n    float X = abs(NDC.x) * sceneSize.x;\n    float Y = abs(NDC.y) * sceneSize.y;\n\n    return clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));\n}\n\n// For Chromatic effect\nvec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)\n{\n    vec2 sceneSize = czm_viewport.zw;\n    vec3 color;\n    if(isSpace)\n    {\n        color.r = isInEarth(texcoord + direction * distortion.r, sceneSize) * texture2D(tex, texcoord + direction * distortion.r).r;\n        color.g = isInEarth(texcoord + direction * distortion.g, sceneSize) * texture2D(tex, texcoord + direction * distortion.g).g;\n        color.b = isInEarth(texcoord + direction * distortion.b, sceneSize) * texture2D(tex, texcoord + direction * distortion.b).b;\n    }\n    else\n    {\n        color.r = texture2D(tex, texcoord + direction * distortion.r).r;\n        color.g = texture2D(tex, texcoord + direction * distortion.g).g;\n        color.b = texture2D(tex, texcoord + direction * distortion.b).b;\n    }\n    return vec4(clamp(color, 0.0, 1.0), 0.0);\n}\n\nvoid main(void)\n{\n    vec4 originalColor = texture2D(colorTexture, v_textureCoordinates);\n    vec3 rgb = originalColor.rgb;\n    bool isSpace = length(czm_viewerPositionWC.xyz) > DISTANCE_TO_SPACE;\n\n    // Sun position\n    vec4 sunPos = czm_morphTime == 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);\n    vec4 sunPositionEC = czm_view * sunPos;\n    vec4 sunPositionWC = czm_eyeToWindowCoordinates(sunPositionEC);\n    sunPos = czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);\n\n    // If sun is not in the screen space, use original color.\n    if(!isSpace || !((sunPos.x >= -1.1 && sunPos.x <= 1.1) && (sunPos.y >= -1.1 && sunPos.y <= 1.1)))\n    {\n        // Lens flare is disabled when not in space until #5932 is fixed.\n        //    https://github.com/CesiumGS/cesium/issues/5932\n        gl_FragColor = originalColor;\n        return;\n    }\n\n    vec2 texcoord = vec2(1.0) - v_textureCoordinates;\n    vec2 pixelSize = czm_pixelRatio / czm_viewport.zw;\n    vec2 invPixelSize = 1.0 / pixelSize;\n    vec3 distortionVec = pixelSize.x * vec3(-distortion, 0.0, distortion);\n\n    // ghost vector to image centre:\n    vec2 ghostVec = (vec2(0.5) - texcoord) * ghostDispersal;\n    vec3 direction = normalize(vec3(ghostVec, 0.0));\n\n    // sample ghosts:\n    vec4 result = vec4(0.0);\n    vec4 ghost = vec4(0.0);\n    for (int i = 0; i < 4; ++i)\n    {\n        vec2 offset = fract(texcoord + ghostVec * float(i));\n        // Only bright spots from the centre of the source image\n        ghost += textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);\n    }\n    result += ghost;\n\n    // sample halo\n    vec2 haloVec = normalize(ghostVec) * haloWidth;\n    float weightForHalo = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\n    weightForHalo = pow(1.0 - weightForHalo, 5.0);\n\n    result += textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;\n\n    // dirt on lens\n    vec2 dirtTexCoords = (v_textureCoordinates * invPixelSize) / dirtTextureDimensions;\n    if (dirtTexCoords.x > 1.0)\n    {\n        dirtTexCoords.x = mod(floor(dirtTexCoords.x), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);\n    }\n    if (dirtTexCoords.y > 1.0)\n    {\n        dirtTexCoords.y = mod(floor(dirtTexCoords.y), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);\n    }\n    result += dirtAmount * texture2D(dirtTexture, dirtTexCoords);\n\n    // Rotating starburst texture's coordinate\n    // dot(czm_view[0].xyz, vec3(0.0, 0.0, 1.0)) + dot(czm_view[1].xyz, vec3(0.0, 1.0, 0.0))\n    float camrot = czm_view[0].z + czm_view[1].y;\n    float cosValue = cos(camrot);\n    float sinValue = sin(camrot);\n    mat3 rotation = mat3(\n        cosValue, -sinValue, 0.0,\n        sinValue, cosValue, 0.0,\n        0.0, 0.0, 1.0\n    );\n\n    vec3 st1 = vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);\n    vec3 st2 = vec3((rotation * st1).xy, 1.0);\n    vec3 st3 = st2 * 0.5 + vec3(0.5);\n    vec2 lensStarTexcoord = st3.xy;\n    float weightForLensFlare = length(vec3(sunPos.xy, 0.0));\n    float oneMinusWeightForLensFlare = max(1.0 - weightForLensFlare, 0.0);\n\n    if (!isSpace)\n    {\n        result *= oneMinusWeightForLensFlare * intensity * 0.2;\n    }\n    else\n    {\n        result *= oneMinusWeightForLensFlare * intensity;\n        result *= texture2D(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;\n    }\n\n    result += texture2D(colorTexture, v_textureCoordinates);\n\n    gl_FragColor = result;\n}\n",uniforms:{dirtTexture:a(1625),starTexture:a(1626),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:d.default.WGS84.maximumRadius}})};var jm=Nm;function Vm(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1}function Um(e){for(;Object(s.default)(e.length);)e=e.get(e.length-1);return e.name}function Bm(e,t,a,i,n){if(!i.enabled||!i._isSupported(t))return n;var r=a[i.name]={};Object(s.default)(n)&&(r[Um(e.getStageByName(n))]=!0);var o=i.uniforms;if(Object(s.default)(o))for(var l=Object.getOwnPropertyNames(o),u=l.length,d=0;d<u;++d){var c=o[l[d]];if("string"==typeof c){var f=e.getStageByName(c);Object(s.default)(f)&&(r[Um(f)]=!0)}}return i.name}function zm(e,t,a,i,n){if(Object(s.default)(i.enabled)&&!i.enabled||Object(s.default)(i._isSupported)&&!i._isSupported(t))return n;for(var r,o,l=n,u=!Object(s.default)(i.inputPreviousStageTexture)||i.inputPreviousStageTexture,d=n,c=i.length,f=0;f<c;++f){var h=i.get(f);d=Object(s.default)(h.length)?zm(e,t,a,h,n):Bm(e,t,a,h,n),u&&(n=d)}if(u)for(r=1;r<c;++r)o=Um(i.get(r)),Object(s.default)(a[o])||(a[o]={}),a[o][l]=!0;else for(r=1;r<c;++r)for(var m=a[o=Um(i.get(r))],p=0;p<r;++p)m[Um(i.get(p))]=!0;return d}function Hm(e,t,a){var i,n,r=e._collection.getStageByName(t),o=r._textureScale,l=r._forcePowerOfTwo,u=r._pixelFormat,d=r._pixelDatatype,c=r._clearColor,f=e._framebuffers,h=f.length;for(i=0;i<h;++i)if(o===(n=f[i]).textureScale&&l===n.forcePowerOfTwo&&u===n.pixelFormat&&d===n.pixelDatatype&&b.default.equals(c,n.clearColor)){for(var m=n.stages,p=m.length,_=!1,g=0;g<p;++g)if(a[m[g]]){_=!0;break}if(!_)break}return Object(s.default)(n)&&i<h?(n.stages.push(t),n):(n={textureScale:o,forcePowerOfTwo:l,pixelFormat:u,pixelDatatype:d,clearColor:c,stages:[t],buffer:void 0,clear:void 0},f.push(n),n)}function km(e,t){var a=function(e,t){var a={};if(Object(s.default)(e.ambientOcclusion)){var i=e.ambientOcclusion,n=e.bloom,r=e._tonemapping,o=e.fxaa,l=zm(e,t,a,i,void 0);l=Bm(e,t,a,r,l=zm(e,t,a,n,l)),Bm(e,t,a,o,l=zm(e,t,a,e,l))}else zm(e,t,a,e,void 0);return a}(e._collection,t);for(var i in a)a.hasOwnProperty(i)&&(e._stageNameToFramebuffer[i]=Hm(e,i,a[i]))}function Gm(e){for(var t=e._framebuffers,a=t.length,i=0;i<a;++i){var n=t[i];n.buffer=n.buffer&&n.buffer.destroy(),n.buffer=void 0}}Vm.prototype.updateDependencies=function(){this._updateDependencies=!0},Vm.prototype.update=function(e){var t=this._collection,a=this._updateDependencies,i=Object(s.default)(t.ambientOcclusion)&&t.ambientOcclusion.enabled&&t.ambientOcclusion._isSupported(e),n=Object(s.default)(t.bloom)&&t.bloom.enabled&&t.bloom._isSupported(e),r=Object(s.default)(t._tonemapping)&&t._tonemapping.enabled&&t._tonemapping._isSupported(e),o=Object(s.default)(t.fxaa)&&t.fxaa.enabled&&t.fxaa._isSupported(e),l=!Object(s.default)(t._activeStages)||t._activeStages.length>0||i||n||r||o;if((a||!l&&this._framebuffers.length>0)&&(Gm(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),a||l){0===this._framebuffers.length&&km(this,e);var u=e.drawingBufferWidth,d=e.drawingBufferHeight,c=this._width!==u||this._height!==d;(a||c)&&(this._width=u,this._height=d,this._updateDependencies=!1,Gm(this),function(e,t){for(var a=e._width,i=e._height,n=e._framebuffers,r=n.length,o=0;o<r;++o){var s=n[o],l=s.textureScale,u=Math.ceil(a*l),d=Math.ceil(i*l),c=Math.min(u,d);s.forcePowerOfTwo&&(J.default.isPowerOfTwo(c)||(c=J.default.nextPowerOfTwo(c)),u=c,d=c),s.buffer=new Hr.a({context:t,colorTextures:[new D.a({context:t,width:u,height:d,pixelFormat:s.pixelFormat,pixelDatatype:s.pixelDatatype})]}),s.clear=new Br.a({color:s.clearColor,framebuffer:s.buffer})}}(this,e))}},Vm.prototype.clear=function(e){for(var t=this._framebuffers,a=0;a<t.length;++a)t[a].clear.execute(e)},Vm.prototype.getStageByName=function(e){return this._collection.getStageByName(e)},Vm.prototype.getOutputTexture=function(e){return this._collection.getOutputTexture(e)},Vm.prototype.getFramebuffer=function(e){var t=this._stageNameToFramebuffer[e];if(Object(s.default)(t))return t.buffer},Vm.prototype.isDestroyed=function(){return!1},Vm.prototype.destroy=function(){return Gm(this),Object(l.default)(this)};var Wm=Vm,Ym={REINHARD:0,MODIFIED_REINHARD:1,FILMIC:2,ACES:3,validate:function(e){return e===Ym.REINHARD||e===Ym.MODIFIED_REINHARD||e===Ym.FILMIC||e===Ym.ACES}},Xm=Object.freeze(Ym),Qm=[];function qm(){var e=jm.createFXAAStage(),t=jm.createAmbientOcclusionStage(),a=jm.createBloomStage();this._autoExposureEnabled=!1,this._autoExposure=jm.createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.tonemapper=Xm.ACES;var i=this._tonemapping;e.enabled=!1,t.enabled=!1,a.enabled=!1,i.enabled=!1;var n=new Wm(this),r={},o=Qm;for(o.push(e,t,a,i);o.length>0;){var l=o.pop();r[l.name]=l,l._textureCache=n;var u=l.length;if(Object(s.default)(u))for(var d=0;d<u;++d)o.push(l.get(d))}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;var c=this;t.uniforms.randomTexture=function(){return c._randomTexture},this._ao=t,this._bloom=a,this._fxaa=e,this._lastLength=void 0,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=r,this._textureCache=n}function Zm(e){if(e._stagesRemoved){e._stagesRemoved=!1;for(var t=[],a=e._stages,i=a.length,n=0,r=0;n<i;++n){var o=a[n];o&&(o._index=r++,t.push(o))}e._stages=t}}function Km(e){for(;Object(s.default)(e.length);)e=e.get(e.length-1);return e.outputTexture}function Jm(e,t,a,i,n){if(Object(s.default)(e.execute))e.execute(t,a,i,n);else{var r,o=e.length;if(e.inputPreviousStageTexture)for(Jm(e.get(0),t,a,i,n),r=1;r<o;++r)Jm(e.get(r),t,Km(e.get(r-1)),i,n);else for(r=0;r<o;++r)Jm(e.get(r),t,a,i,n)}}Object.defineProperties(qm.prototype,{ready:{get:function(){for(var e=!1,t=this._stages,a=t.length-1;a>=0;--a){var i=t[a];e=e||i.ready&&i.enabled}var n=this._fxaa,r=this._ao,o=this._bloom,s=this._tonemapping;return e=(e=(e=(e=e||n.ready&&n.enabled)||r.ready&&r.enabled)||o.ready&&o.enabled)||s.ready&&s.enabled}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return Zm(this),this._stages.length}},outputTexture:{get:function(){var e=this._fxaa;if(e.enabled&&e.ready)return this.getOutputTexture(e.name);for(var t=this._stages,a=t.length-1;a>=0;--a){var i=t[a];if(Object(s.default)(i)&&i.ready&&i.enabled)return this.getOutputTexture(i.name)}var n=this._tonemapping;if(n.enabled&&n.ready)return this.getOutputTexture(n.name);var r=this._bloom;if(r.enabled&&r.ready)return this.getOutputTexture(r.name);var o=this._ao;return o.enabled&&o.ready?this.getOutputTexture(o.name):void 0}},hasSelected:{get:function(){for(var e=Object(pm.a)(this._stages);e.length>0;){var t=e.pop();if(Object(s.default)(t)){if(Object(s.default)(t.selected))return!0;var a=t.length;if(Object(s.default)(a))for(var i=0;i<a;++i)e.push(t.get(i))}}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(e){if(this._tonemapper!==e){Object(s.default)(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());var t,a=this._autoExposureEnabled;switch(e){case Xm.REINHARD:t=jm.createReinhardTonemappingStage(a);break;case Xm.MODIFIED_REINHARD:t=jm.createModifiedReinhardTonemappingStage(a);break;case Xm.FILMIC:t=jm.createFilmicTonemappingStage(a);break;default:t=jm.createAcesTonemappingStage(a)}if(a){var i=this._autoExposure;t.uniforms.autoExposure=function(){return i.outputTexture}}this._tonemapper=e,this._tonemapping=t,Object(s.default)(this._stageNames)&&(this._stageNames[t.name]=t,t._textureCache=this._textureCache),this._textureCacheDirty=!0}}}}),qm.prototype.add=function(e){var t=this._stageNames,a=Qm;for(a.push(e);a.length>0;){var i=a.pop();t[i.name]=i,i._textureCache=this._textureCache;var n=i.length;if(Object(s.default)(n))for(var r=0;r<n;++r)a.push(i.get(r))}var o=this._stages;return e._index=o.length,o.push(e),this._textureCacheDirty=!0,e},qm.prototype.remove=function(e){if(!this.contains(e))return!1;var t=this._stageNames,a=Qm;for(a.push(e);a.length>0;){var i=a.pop();delete t[i.name];var n=i.length;if(Object(s.default)(n))for(var r=0;r<n;++r)a.push(i.get(r))}return this._stages[e._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,e._index=void 0,e._textureCache=void 0,e.destroy(),!0},qm.prototype.contains=function(e){return Object(s.default)(e)&&Object(s.default)(e._index)&&e._textureCache===this._textureCache},qm.prototype.get=function(e){return Zm(this),this._stages[e]},qm.prototype.removeAll=function(){for(var e=this._stages,t=e.length,a=0;a<t;++a)this.remove(e[a]);e.length=0},qm.prototype.getStageByName=function(e){return this._stageNames[e]},qm.prototype.update=function(e,t,a){Zm(this);var i=this._activeStages,n=this._activeStages=this._previousActiveStages;this._previousActiveStages=i;var r,o,l=this._stages,u=n.length=l.length,d=0;for(r=0;r<u;++r)(o=l[r]).ready&&o.enabled&&o._isSupported(e)&&(n[d++]=o);n.length=d;var c=d!==i.length;if(!c)for(r=0;r<d;++r)if(n[r]!==i[r]){c=!0;break}var f=this._ao,h=this._bloom,m=this._autoExposure,p=this._tonemapping,_=this._fxaa;p.enabled=a;var g=f.enabled&&f._isSupported(e),v=h.enabled&&h._isSupported(e),y=p.enabled&&p._isSupported(e),b=_.enabled&&_._isSupported(e);if((c||this._textureCacheDirty||d!==this._lastLength||g!==this._aoEnabled||v!==this._bloomEnabled||y!==this._tonemappingEnabled||b!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._lastLength=d,this._aoEnabled=g,this._bloomEnabled=v,this._tonemappingEnabled=y,this._fxaaEnabled=b,this._textureCacheDirty=!1),Object(s.default)(this._randomTexture)&&!g&&(this._randomTexture.destroy(),this._randomTexture=void 0),!Object(s.default)(this._randomTexture)&&g){u=196608;var w=new Uint8Array(u);for(r=0;r<u;r+=3)w[r]=Math.floor(255*Math.random());this._randomTexture=new D.a({context:e,pixelFormat:_e.a.RGB,pixelDatatype:we.a.UNSIGNED_BYTE,source:{arrayBufferView:w,width:256,height:256},sampler:new Ce.a({wrapS:Te.a.REPEAT,wrapT:Te.a.REPEAT,minificationFilter:xe.a.NEAREST,magnificationFilter:Oe.a.NEAREST})})}for(this._textureCache.update(e),_.update(e,t),f.update(e,t),h.update(e,t),p.update(e,t),this._autoExposureEnabled&&m.update(e,t),u=l.length,r=0;r<u;++r)l[r].update(e,t)},qm.prototype.clear=function(e){this._textureCache.clear(e),this._autoExposureEnabled&&this._autoExposure.clear(e)},qm.prototype.getOutputTexture=function(e){var t=this.getStageByName(e);if(Object(s.default)(t))return Km(t)},qm.prototype.execute=function(e,t,a,i){var n=this._activeStages,r=n.length,o=this._fxaa,s=this._ao,l=this._bloom,u=this._autoExposure,d=this._tonemapping,c=s.enabled&&s._isSupported(e),f=l.enabled&&l._isSupported(e),h=this._autoExposureEnabled,m=d.enabled&&d._isSupported(e),p=o.enabled&&o._isSupported(e);if(p||c||f||m||0!==r){var _=t;c&&s.ready&&(Jm(s,e,_,a,i),_=Km(s)),f&&l.ready&&(Jm(l,e,_,a,i),_=Km(l)),h&&u.ready&&Jm(u,e,_,a,i),m&&d.ready&&(Jm(d,e,_,a,i),_=Km(d));var g=_;if(r>0){Jm(n[0],e,_,a,i);for(var v=1;v<r;++v)Jm(n[v],e,Km(n[v-1]),a,i);g=Km(n[r-1])}p&&o.ready&&Jm(o,e,g,a,i)}},qm.prototype.copy=function(e,t){if(!Object(s.default)(this._copyColorCommand)){var a=this;this._copyColorCommand=e.createViewportQuadCommand(Od,{uniformMap:{colorTexture:function(){return a.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},qm.prototype.isDestroyed=function(){return!1},qm.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),Object(l.default)(this)};var $m=qm,ep=a(211);function tp(e){this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}tp.prototype.completeMorph=function(){Object(s.default)(this._completeMorph)&&this._completeMorph()},tp.prototype.morphTo2D=function(e,t){Object(s.default)(this._completeMorph)&&this._completeMorph();var a=this._scene;this._previousMode=a.mode,this._morphToOrthographic=a.camera.frustum instanceof te.a,this._previousMode!==V.a.SCENE2D&&this._previousMode!==V.a.MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,V.a.SCENE2D,!0),a._mode=V.a.MORPHING,a.camera._setTransform($.default.IDENTITY),this._previousMode===V.a.COLUMBUS_VIEW?function(e,t){t*=.5;var a=e._scene,i=a.camera,r=n.default.clone(i.position,Vp),o=n.default.clone(i.direction,Up),l=n.default.clone(i.up,Bp),u=n.default.negate(n.default.UNIT_Z,Hp),d=n.default.clone(n.default.UNIT_Y,kp),c=zp;if(t>0)n.default.clone(n.default.ZERO,zp),c.z=5*a.mapProjection.ellipsoid.maximumRadius;else{n.default.clone(r,zp);var f=Wp;$.default.multiplyByPoint($l.TRANSFORM_2D,r,f.origin),$.default.multiplyByPointAsVector($l.TRANSFORM_2D,o,f.direction);var h=a.globe;if(Object(s.default)(h)){var m=h.pickWorldCoordinates(f,a,!0,Yp);Object(s.default)(m)&&($.default.multiplyByPoint($l.TRANSFORM_2D_INVERSE,m,c),c.z+=n.default.distance(r,c))}}var p=Gp;p.right=.5*c.z,p.left=-p.right,p.top=p.right*(a.drawingBufferHeight/a.drawingBufferWidth),p.bottom=-p.top;var _=Xp;_.position=c,_.direction=u,_.up=d,_.frustum=p;var g=r_(_);function v(e,t){e.position.z=t}_p(e,g);var y=a.tweens.add({duration:t,easingFunction:zo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Lp(r,c,e.time,i.position),Lp(o,u,e.time,i.direction),Lp(l,d,e.time,i.up),n.default.cross(i.direction,i.up,i.right),n.default.normalize(i.right,i.right),i._adjustOrthographicFrustum(!0)},complete:function(){jp(e,t,_,v,g)}});e._currentTweens.push(y)}(this,e):function(e,t,a){t*=.5;var i=e._scene,r=i.camera,o=qp;if(t>0)n.default.clone(n.default.ZERO,o.position),o.position.z=5*a.maximumRadius,n.default.negate(n.default.UNIT_Z,o.direction),n.default.clone(n.default.UNIT_Y,o.up);else{a.cartesianToCartographic(r.positionWC,Qp),i.mapProjection.project(Qp,o.position),n.default.negate(n.default.UNIT_Z,o.direction),n.default.clone(n.default.UNIT_Y,o.up);var l=Jp;n.default.clone(o.position2D,l.origin);var u=n.default.clone(r.directionWC,l.direction),d=a.scaleToGeodeticSurface(r.positionWC,e_),c=qn.default.eastNorthUpToFixedFrame(d,a,$p);$.default.inverseTransformation(c,c),$.default.multiplyByPointAsVector(c,u,u),$.default.multiplyByPointAsVector($l.TRANSFORM_2D,u,u);var f=i.globe;if(Object(s.default)(f)){var h=f.pickWorldCoordinates(l,i,!0,Kp);if(Object(s.default)(h)){var m=n.default.distance(o.position2D,h);h.x+=m,n.default.clone(h,o.position2D)}}}function p(e,t){e.position.x=t}$.default.multiplyByPoint($l.TRANSFORM_2D,o.position,o.position2D),$.default.multiplyByPointAsVector($l.TRANSFORM_2D,o.direction,o.direction2D),$.default.multiplyByPointAsVector($l.TRANSFORM_2D,o.up,o.up2D);var _=o.frustum;_.right=.5*o.position.z,_.left=-_.right,_.top=_.right*(i.drawingBufferHeight/i.drawingBufferWidth),_.bottom=-_.top;var g=Zp;$.default.multiplyByPoint($l.TRANSFORM_2D_INVERSE,o.position2D,g.position),n.default.clone(o.direction,g.direction),n.default.clone(o.up,g.up),g.frustum=_;var v=r_(g);_p(e,v),a_(e,t,o,(function(){jp(e,t,o,p,v)}))}(this,e,t),0===e&&Object(s.default)(this._completeMorph)&&this._completeMorph())};var ap=new n.default,ip=new n.default,np=new n.default,rp=new n.default,op=new n.default,sp=new n.default,lp=new n.default,up=new y.default,dp=new $.default,cp=new Lr.a,fp=new te.a,hp={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};tp.prototype.morphToColumbusView=function(e,t){Object(s.default)(this._completeMorph)&&this._completeMorph();var a=this._scene;if(this._previousMode=a.mode,this._previousMode!==V.a.COLUMBUS_VIEW&&this._previousMode!==V.a.MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,V.a.COLUMBUS_VIEW,!0),a.camera._setTransform($.default.IDENTITY);var i,r=ap,o=ip,l=np;if(e>0)r.x=0,r.y=-1,r.z=1,r=n.default.multiplyByScalar(n.default.normalize(r,r),5*t.maximumRadius,r),n.default.negate(n.default.normalize(r,o),o),n.default.cross(n.default.UNIT_X,o,l);else{var u=a.camera;if(this._previousMode===V.a.SCENE2D)n.default.clone(u.position,r),r.z=u.frustum.right-u.frustum.left,n.default.negate(n.default.UNIT_Z,o),n.default.clone(n.default.UNIT_Y,l);else{n.default.clone(u.positionWC,r),n.default.clone(u.directionWC,o),n.default.clone(u.upWC,l);var d=t.scaleToGeodeticSurface(r,lp),c=qn.default.eastNorthUpToFixedFrame(d,t,dp);$.default.inverseTransformation(c,c),a.mapProjection.project(t.cartesianToCartographic(r,up),r),$.default.multiplyByPointAsVector(c,o,o),$.default.multiplyByPointAsVector(c,l,l)}}this._morphToOrthographic?((i=fp).width=a.camera.frustum.right-a.camera.frustum.left,i.aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight):((i=cp).aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight,i.fov=J.default.toRadians(60));var f=hp;f.position=r,f.direction=o,f.up=l,f.frustum=i;var h=function(e){return function(t){var a=t._scene;a._mode=V.a.COLUMBUS_VIEW,a.morphTime=V.a.getMorphTime(V.a.COLUMBUS_VIEW),gp(t);var i=a.camera;(t._previousModeMode!==V.a.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,n.default.clone(e.position,i.position),n.default.clone(e.direction,i.direction),n.default.clone(e.up,i.up),n.default.cross(i.direction,i.up,i.right),n.default.normalize(i.right,i.right));var r=i.frustum;a.frameState.useLogDepth&&(r.near=.1,r.far=1e10);var o=Object(s.default)(t._completeMorph);t._completeMorph=void 0,a.camera.update(a.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,V.a.COLUMBUS_VIEW,o)}}(f);_p(this,h),this._previousMode===V.a.SCENE2D?function(e,t,a,i){t*=.5;var r=e._scene,o=r.camera,s=n.default.clone(a.position,Ip),l=n.default.clone(a.direction,Rp),u=n.default.clone(a.up,Np);function d(){o.frustum=a.frustum.clone();var d=n.default.clone(o.position,Dp),c=n.default.clone(o.direction,Fp),f=n.default.clone(o.up,Mp);d.z=s.z;var h=r.tweens.add({duration:t,easingFunction:zo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Lp(d,s,e.time,o.position),Lp(c,l,e.time,o.direction),Lp(f,u,e.time,o.up),n.default.cross(o.direction,o.up,o.right),n.default.normalize(o.right,o.right)},complete:function(){i(e)}});e._currentTweens.push(h)}r._mode=V.a.MORPHING,e._morphToOrthographic?d():t_(e,0,a,d)}(this,e,f,h):(f.position2D=$.default.multiplyByPoint($l.TRANSFORM_2D,r,rp),f.direction2D=$.default.multiplyByPointAsVector($l.TRANSFORM_2D,o,op),f.up2D=$.default.multiplyByPointAsVector($l.TRANSFORM_2D,l,sp),a._mode=V.a.MORPHING,a_(this,e,f,h)),0===e&&Object(s.default)(this._completeMorph)&&this._completeMorph()}};var mp={position:new n.default,direction:new n.default,up:new n.default,frustum:void 0},pp=new Lr.a;function _p(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new m.default(e._scene.canvas);var a=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=a,e._morphHandler.setInputAction(a,ep.default.LEFT_DOWN),e._morphHandler.setInputAction(a,ep.default.MIDDLE_DOWN),e._morphHandler.setInputAction(a,ep.default.RIGHT_DOWN),e._morphHandler.setInputAction(a,ep.default.WHEEL)}}function gp(e){for(var t=e._currentTweens,a=0;a<t.length;++a)t[a].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}tp.prototype.morphTo3D=function(e,t){Object(s.default)(this._completeMorph)&&this._completeMorph();var a=this._scene;if(this._previousMode=a.mode,this._previousMode!==V.a.SCENE3D&&this._previousMode!==V.a.MORPHING){if(this._scene.morphStart.raiseEvent(this,this._previousMode,V.a.SCENE3D,!0),a._mode=V.a.MORPHING,a.camera._setTransform($.default.IDENTITY),this._previousMode===V.a.SCENE2D)!function(e,t,a){t/=3;var i,r,o=e._scene,s=o.camera;t>0?(i=mp,n.default.fromDegrees(0,0,5*a.maximumRadius,a,i.position),n.default.negate(i.position,i.direction),n.default.normalize(i.direction,i.direction),n.default.clone(n.default.UNIT_Z,i.up)):(s.position.z=s.frustum.right-s.frustum.left,i=wp(e,a));e._morphToOrthographic?((r=Sp).aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,r.width=s.frustum.right-s.frustum.left):((r=pp).aspectRatio=o.drawingBufferWidth/o.drawingBufferHeight,r.fov=J.default.toRadians(60));i.frustum=r;var l,u=n_(i);_p(e,u),l=e._morphToOrthographic?function(){Pp(e,t,i,u)}:function(){t_(e,t,i,(function(){Pp(e,t,i,u)}))};t>0?(o._mode=V.a.SCENE2D,s.flyTo({duration:t,destination:n.default.fromDegrees(0,0,5*a.maximumRadius,a,Ip),complete:function(){o._mode=V.a.MORPHING,l()}})):l()}(this,e,t);else{var i,r;e>0?(i=mp,n.default.fromDegrees(0,0,5*t.maximumRadius,t,i.position),n.default.negate(i.position,i.direction),n.default.normalize(i.direction,i.direction),n.default.clone(n.default.UNIT_Z,i.up)):i=wp(this,t);var o=a.camera;o.frustum instanceof te.a?r=o.frustum.clone():((r=pp).aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight,r.fov=J.default.toRadians(60)),i.frustum=r;var l=n_(i);_p(this,l),Pp(this,e,i,l)}0===e&&Object(s.default)(this._completeMorph)&&this._completeMorph()}},tp.prototype.isDestroyed=function(){return!1},tp.prototype.destroy=function(){return gp(this),Object(l.default)(this)};var vp=new y.default,yp=new n.default,bp=new $.default;function wp(e,t){var a=e._scene,i=a.camera,n=mp,r=n.position,o=n.direction,s=n.up,l=a.mapProjection.unproject(i.position,vp);t.cartographicToCartesian(l,r);var u=t.scaleToGeodeticSurface(r,yp),d=qn.default.eastNorthUpToFixedFrame(u,t,bp);return $.default.multiplyByPointAsVector(d,i.direction,o),$.default.multiplyByPointAsVector(d,i.up,s),n}var Cp=new n.default,Op=new n.default,xp=new n.default,Tp=new n.default,Ep=new n.default,Ap=new n.default;function Pp(e,t,a,i){t*=.5;var r=e._scene,o=r.camera,s=n.default.clone(o.position,Cp),l=n.default.clone(o.direction,Op),u=n.default.clone(o.up,xp),d=$.default.multiplyByPoint($l.TRANSFORM_2D_INVERSE,a.position,Tp),c=$.default.multiplyByPointAsVector($l.TRANSFORM_2D_INVERSE,a.direction,Ep),f=$.default.multiplyByPointAsVector($l.TRANSFORM_2D_INVERSE,a.up,Ap);var h=r.tweens.add({duration:t,easingFunction:zo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Lp(s,d,e.time,o.position),Lp(l,c,e.time,o.direction),Lp(u,f,e.time,o.up),n.default.cross(o.direction,o.up,o.right),n.default.normalize(o.right,o.right)},complete:function(){i_(e,r,0,1,t,i)}});e._currentTweens.push(h)}var Sp=new te.a,Dp=new n.default,Fp=new n.default,Mp=new n.default,Ip=new n.default,Rp=new n.default,Np=new n.default;function Lp(e,t,a,i){return n.default.lerp(e,t,a,i)}function jp(e,t,a,i,n){var r=e._scene,o=r.camera;if(!(o.frustum instanceof te.a)){var s=o.frustum.fov,l=.5*J.default.RADIANS_PER_DEGREE,u=a.position.z*Math.tan(.5*s);o.frustum.far=u/Math.tan(.5*l)+1e7;var d=r.tweens.add({duration:t,easingFunction:zo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){o.frustum.fov=J.default.lerp(s,l,e.time);var t=u/Math.tan(.5*o.frustum.fov);i(o,t)},complete:function(){o.frustum=a.frustum.clone(),n(e)}});e._currentTweens.push(d)}}var Vp=new n.default,Up=new n.default,Bp=new n.default,zp=new n.default,Hp=new n.default,kp=new n.default,Gp=new ba.a,Wp=new E.default,Yp=new n.default,Xp={position:void 0,direction:void 0,up:void 0,frustum:void 0};var Qp=new y.default,qp={position:new n.default,direction:new n.default,up:new n.default,position2D:new n.default,direction2D:new n.default,up2D:new n.default,frustum:new ba.a},Zp={position:new n.default,direction:new n.default,up:new n.default,frustum:void 0},Kp=new n.default,Jp=new E.default,$p=new $.default,e_=new n.default;function t_(e,t,a,i){var n=e._scene,r=n.camera,o=r.frustum.right-r.frustum.left;r.frustum=a.frustum.clone();var s=r.frustum.fov,l=.5*J.default.RADIANS_PER_DEGREE,u=o*Math.tan(.5*s);r.frustum.far=u/Math.tan(.5*l)+1e7,r.frustum.fov=l;var d=n.tweens.add({duration:t,easingFunction:zo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){r.frustum.fov=J.default.lerp(l,s,e.time),r.position.z=u/Math.tan(.5*r.frustum.fov)},complete:function(){i(e)}});e._currentTweens.push(d)}function a_(e,t,a,i){var r=e._scene,o=r.camera,s=n.default.clone(o.position,Dp),l=n.default.clone(o.direction,Fp),u=n.default.clone(o.up,Mp),d=n.default.clone(a.position2D,Ip),c=n.default.clone(a.direction2D,Rp),f=n.default.clone(a.up2D,Np);var h=r.tweens.add({duration:t,easingFunction:zo.default.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(e){Lp(s,d,e.time,o.position),Lp(l,c,e.time,o.direction),Lp(u,f,e.time,o.up),n.default.cross(o.direction,o.up,o.right),n.default.normalize(o.right,o.right),o._adjustOrthographicFrustum(!0)},complete:function(){i_(e,r,1,0,t,i)}});e._currentTweens.push(h)}function i_(e,t,a,i,n,r){var o={object:t,property:"morphTime",startValue:a,stopValue:i,duration:n,easingFunction:zo.default.QUARTIC_OUT};Object(s.default)(r)&&(o.complete=function(){r(e)});var l=t.tweens.addProperty(o);e._currentTweens.push(l)}function n_(e){return function(t){var a=t._scene;a._mode=V.a.SCENE3D,a.morphTime=V.a.getMorphTime(V.a.SCENE3D),gp(t);var i=a.camera;(t._previousMode!==V.a.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,n.default.clone(e.position,i.position),n.default.clone(e.direction,i.direction),n.default.clone(e.up,i.up),n.default.cross(i.direction,i.up,i.right),n.default.normalize(i.right,i.right),i.frustum=e.frustum.clone());var r=i.frustum;a.frameState.useLogDepth&&(r.near=.1,r.far=1e10);var o=Object(s.default)(t._completeMorph);t._completeMorph=void 0,a.camera.update(a.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,V.a.SCENE3D,o)}}function r_(e){return function(t){var a=t._scene;a._mode=V.a.SCENE2D,a.morphTime=V.a.getMorphTime(V.a.SCENE2D),gp(t);var i=a.camera;n.default.clone(e.position,i.position),i.position.z=2*a.mapProjection.ellipsoid.maximumRadius,n.default.clone(e.direction,i.direction),n.default.clone(e.up,i.up),n.default.cross(i.direction,i.up,i.right),n.default.normalize(i.right,i.right),i.frustum=e.frustum.clone();var r=Object(s.default)(t._completeMorph);t._completeMorph=void 0,a.camera.update(a.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,V.a.SCENE2D,r)}}var o_=tp,s_=a(278),l_=a(136),u_=Object.freeze({LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4});function d_(e,t){var a=e;return Object(s.default)(t)&&(a+="+"+t),a}function c_(e,t,a){var i=d_(u_.PINCH,t),n=e._update,r=e._isDown,o=e._eventStartPosition,l=e._pressTime,u=e._releaseTime;n[i]=!0,r[i]=!1,o[i]=new k.default;var d=e._movement[i];Object(s.default)(d)||(d=e._movement[i]={}),d.distance={startPosition:new k.default,endPosition:new k.default},d.angleAndHeight={startPosition:new k.default,endPosition:new k.default},d.prevAngle=0,e._eventHandler.setInputAction((function(t){e._buttonsDown++,r[i]=!0,l[i]=new Date,k.default.lerp(t.position1,t.position2,.5,o[i])}),ep.default.PINCH_START,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),r[i]=!1,u[i]=new Date}),ep.default.PINCH_END,t),e._eventHandler.setInputAction((function(e){if(r[i]){n[i]?(l=e,u=d,k.default.clone(l.distance.startPosition,u.distance.startPosition),k.default.clone(l.distance.endPosition,u.distance.endPosition),k.default.clone(l.angleAndHeight.startPosition,u.angleAndHeight.startPosition),k.default.clone(l.angleAndHeight.endPosition,u.angleAndHeight.endPosition),n[i]=!1,d.prevAngle=d.angleAndHeight.startPosition.x):(k.default.clone(e.distance.endPosition,d.distance.endPosition),k.default.clone(e.angleAndHeight.endPosition,d.angleAndHeight.endPosition));for(var t=d.angleAndHeight.endPosition.x,o=d.prevAngle,s=2*Math.PI;t>=o+Math.PI;)t-=s;for(;t<o-Math.PI;)t+=s;d.angleAndHeight.endPosition.x=-t*a.clientWidth/12,d.angleAndHeight.startPosition.x=-o*a.clientWidth/12}var l,u}),ep.default.PINCH_MOVE,t)}function f_(e,t){var a=d_(u_.WHEEL,t),i=e._update;i[a]=!0;var n=e._movement[a];Object(s.default)(n)||(n=e._movement[a]={}),n.startPosition=new k.default,n.endPosition=new k.default,e._eventHandler.setInputAction((function(e){var t=15*J.default.toRadians(e);i[a]?(k.default.clone(k.default.ZERO,n.startPosition),n.endPosition.x=0,n.endPosition.y=t,i[a]=!1):n.endPosition.y=n.endPosition.y+t}),ep.default.WHEEL,t)}function h_(e,t,a){var i=d_(a,t),n=e._isDown,r=e._eventStartPosition,o=e._pressTime,l=e._releaseTime;n[i]=!1,r[i]=new k.default;var u,d,c=e._lastMovement[i];Object(s.default)(c)||(c=e._lastMovement[i]={startPosition:new k.default,endPosition:new k.default,valid:!1}),a===u_.LEFT_DRAG?(u=ep.default.LEFT_DOWN,d=ep.default.LEFT_UP):a===u_.RIGHT_DRAG?(u=ep.default.RIGHT_DOWN,d=ep.default.RIGHT_UP):a===u_.MIDDLE_DRAG&&(u=ep.default.MIDDLE_DOWN,d=ep.default.MIDDLE_UP),e._eventHandler.setInputAction((function(t){e._buttonsDown++,c.valid=!1,n[i]=!0,o[i]=new Date,k.default.clone(t.position,r[i])}),u,t),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),n[i]=!1,l[i]=new Date}),d,t)}function m_(e,t){k.default.clone(e.startPosition,t.startPosition),k.default.clone(e.endPosition,t.endPosition)}function p_(e,t){var a=e._update,i=e._movement,n=e._lastMovement,r=e._isDown;for(var o in u_)if(u_.hasOwnProperty(o)){var l=u_[o];if(Object(s.default)(l)){var u=d_(l,t);a[u]=!0,Object(s.default)(e._lastMovement[u])||(e._lastMovement[u]={startPosition:new k.default,endPosition:new k.default,valid:!1}),Object(s.default)(e._movement[u])||(e._movement[u]={startPosition:new k.default,endPosition:new k.default})}}e._eventHandler.setInputAction((function(o){for(var l in u_)if(u_.hasOwnProperty(l)){var u=u_[l];if(Object(s.default)(u)){var d=d_(u,t);r[d]&&(a[d]?(m_(i[d],n[d]),n[d].valid=!0,m_(o,i[d]),a[d]=!1):k.default.clone(o.endPosition,i[d].endPosition))}}k.default.clone(o.endPosition,e._currentMousePosition)}),ep.default.MOUSE_MOVE,t)}function __(e){for(var t in this._eventHandler=new m.default(e),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new k.default,f_(this,void 0),c_(this,void 0,e),h_(this,void 0,u_.LEFT_DRAG),h_(this,void 0,u_.RIGHT_DRAG),h_(this,void 0,u_.MIDDLE_DRAG),p_(this,void 0),s_.default)if(s_.default.hasOwnProperty(t)){var a=s_.default[t];Object(s.default)(a)&&(f_(this,a),c_(this,a,e),h_(this,a,u_.LEFT_DRAG),h_(this,a,u_.RIGHT_DRAG),h_(this,a,u_.MIDDLE_DRAG),p_(this,a))}}Object.defineProperties(__.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var e=!(this._update[d_(u_.WHEEL)]&&this._update[d_(u_.WHEEL,s_.default.SHIFT)]&&this._update[d_(u_.WHEEL,s_.default.CTRL)]&&this._update[d_(u_.WHEEL,s_.default.ALT)]);return this._buttonsDown>0||e}}}),__.prototype.isMoving=function(e,t){var a=d_(e,t);return!this._update[a]},__.prototype.getMovement=function(e,t){var a=d_(e,t);return this._movement[a]},__.prototype.getLastMovement=function(e,t){var a=d_(e,t),i=this._lastMovement[a];if(i.valid)return i},__.prototype.isButtonDown=function(e,t){var a=d_(e,t);return this._isDown[a]},__.prototype.getStartMousePosition=function(e,t){if(e===u_.WHEEL)return this._currentMousePosition;var a=d_(e,t);return this._eventStartPosition[a]},__.prototype.getButtonPressTime=function(e,t){var a=d_(e,t);return this._pressTime[a]},__.prototype.getButtonReleaseTime=function(e,t){var a=d_(e,t);return this._releaseTime[a]},__.prototype.reset=function(){for(var e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)},__.prototype.isDestroyed=function(){return!1},__.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),Object(l.default)(this)};var g_=__,v_=a(408);function y_(e){this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=u_.LEFT_DRAG,this.zoomEventTypes=[u_.RIGHT_DRAG,u_.WHEEL,u_.PINCH],this.rotateEventTypes=u_.LEFT_DRAG,this.tiltEventTypes=[u_.MIDDLE_DRAG,u_.PINCH,{eventType:u_.LEFT_DRAG,modifier:s_.default.CTRL},{eventType:u_.RIGHT_DRAG,modifier:s_.default.CTRL}],this.lookEventTypes={eventType:u_.LEFT_DRAG,modifier:s_.default.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=e,this._globe=void 0,this._ellipsoid=void 0,this._aggregator=new g_(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement","_lastInertiaTranslateMovement"]},this._tweens=new v_.default,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new k.default(-1,-1),this._tiltCenter=new n.default,this._rotateMousePosition=new k.default(-1,-1),this._rotateStartPosition=new n.default,this._strafeStartPosition=new n.default,this._strafeMousePosition=new k.default,this._strafeEndMousePosition=new k.default,this._zoomMouseStart=new k.default(-1,-1),this._zoomWorldPosition=new n.default,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;var t=e.mapProjection;this._maxCoord=t.project(new y.default(Math.PI,J.default.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}var b_=.4;function w_(e,t,a,i,n,r,o){var l=r[o];Object(s.default)(l)||(l=r[o]={startPosition:new k.default,endPosition:new k.default,motion:new k.default,inertiaEnabled:!0});var u,d=e.getButtonPressTime(t,a),c=e.getButtonReleaseTime(t,a),f=d&&c&&(c.getTime()-d.getTime())/1e3,h=new Date,m=c&&(h.getTime()-c.getTime())/1e3;if(d&&c&&f<b_){var p=function(e,t){if(e<0)return 0;var a=25*(1-t);return Math.exp(-a*e)}(m,i),_=e.getLastMovement(t,a);if(!Object(s.default)(_)||(u=_,k.default.equalsEpsilon(u.startPosition,u.endPosition,J.default.EPSILON14))||!l.inertiaEnabled)return;if(l.motion.x=.5*(_.endPosition.x-_.startPosition.x),l.motion.y=.5*(_.endPosition.y-_.startPosition.y),l.startPosition=k.default.clone(_.startPosition,l.startPosition),l.endPosition=k.default.multiplyByScalar(l.motion,p,l.endPosition),l.endPosition=k.default.add(l.startPosition,l.endPosition,l.endPosition),isNaN(l.endPosition.x)||isNaN(l.endPosition.y)||k.default.distance(l.startPosition,l.endPosition)<.5)return;if(!e.isButtonDown(t,a))n(r,e.getStartMousePosition(t,a),l)}}function C_(e,t){if(Object(s.default)(t)){var a=e[t];Object(s.default)(a)&&(a.inertiaEnabled=!0);var i=e._inertiaDisablers[t];if(Object(s.default)(i))for(var n=i.length,r=0;r<n;++r)a=e[i[r]],Object(s.default)(a)&&(a.inertiaEnabled=!1)}}var O_=[];function x_(e,t,a,i,n,r){if(Object(s.default)(a)){var o=e._aggregator;Array.isArray(a)||(O_[0]=a,a=O_);for(var l=a.length,u=0;u<l;++u){var d=a[u],c=Object(s.default)(d.eventType)?d.eventType:d,f=d.modifier,h=o.isMoving(c,f)&&o.getMovement(c,f),m=o.getStartMousePosition(c,f);e.enableInputs&&t&&(h?(i(e,m,h),C_(e,r)):n<1&&w_(o,c,f,n,i,e,r))}}}var T_=new E.default,E_=new n.default,A_=new k.default,P_=new n.default,S_=new k.default,D_=new n.default,F_=new n.default,M_=new n.default,I_=new n.default,R_=new n.default,N_=new n.default,L_=new n.default,j_=new n.default,V_=new n.default,U_=new n.default,B_=new n.default,z_=new n.default,H_=new n.default,k_=new n.default,G_=new n.default,W_=new n.default,Y_=new n.default,X_=new n.default,Q_={orientation:new Go.default};function q_(e,t,a,i,r,o){var l=1;Object(s.default)(o)&&(l=J.default.clamp(Math.abs(o),.25,1));var u=e.minimumZoomDistance*l,d=e.maximumZoomDistance,c=i*(r-u);c=J.default.clamp(c,e._minimumZoomRate,e._maximumZoomRate);var f=(a.endPosition.y-a.startPosition.y)/e._scene.canvas.clientHeight,h=c*(f=Math.min(f,e.maximumMovementRatio));if(e.enableCollisionDetection||0===e.minimumZoomDistance||!Object(s.default)(e._globe)){if(h>0&&Math.abs(r-u)<1)return;if(h<0&&Math.abs(r-d)<1)return;r-h<u?h=r-u-1:r-h>d&&(h=r-d)}var m=e._scene,p=m.camera,_=m.mode,g=Q_.orientation;if(g.heading=p.heading,g.pitch=p.pitch,g.roll=p.roll,p.frustum instanceof te.a)Math.abs(h)>0&&(p.zoomIn(h),p._adjustOrthographicFrustum());else{var v,y=k.default.equals(t,e._zoomMouseStart),b=e._zoomingOnVector,w=e._rotatingZoom;if(y||(e._zoomMouseStart=k.default.clone(t,e._zoomMouseStart),Object(s.default)(e._globe)&&(_===V.a.SCENE2D?(v=p.getPickRay(t,T_).origin,v=n.default.fromElements(v.y,v.z,v.x)):v=sg(e,t,E_)),Object(s.default)(v)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=n.default.clone(v,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,b=e._zoomingOnVector=!1,w=e._rotatingZoom=!1,e._zoomingUnderground=e._cameraUnderground),e._useZoomWorldPosition){var C=_===V.a.COLUMBUS_VIEW;if(p.positionCartographic.height<2e6&&(w=!0),!y||w){if(_===V.a.SCENE2D){var O=e._zoomWorldPosition,x=p.position;if(!n.default.equals(O,x)&&p.positionCartographic.height<2*e._maxCoord.x){var T=p.position.x,E=n.default.subtract(O,x,P_);n.default.normalize(E,E);var A=n.default.distance(O,x)*h/(.5*p.getMagnitude());p.move(E,.5*A),(p.position.x<0&&T>0||p.position.x>0&&T<0)&&(v=p.getPickRay(t,T_).origin,v=n.default.fromElements(v.y,v.z,v.x),e._zoomWorldPosition=n.default.clone(v,e._zoomWorldPosition))}}else if(_===V.a.SCENE3D){var P=n.default.normalize(p.position,R_);if(e._cameraUnderground||e._zoomingUnderground||p.positionCartographic.height<3e3&&Math.abs(n.default.dot(p.direction,P))<.6)C=!0;else{var S=m.canvas,D=S_;D.x=S.clientWidth/2,D.y=S.clientHeight/2;var F=sg(e,D,D_);if(Object(s.default)(F)&&p.positionCartographic.height<1e6){var M=L_;n.default.clone(p.position,M);var I=e._zoomWorldPosition,R=N_;if(R=n.default.normalize(I,R),n.default.dot(R,P)<0)return;var N=G_,L=U_;n.default.clone(p.direction,L),n.default.add(M,n.default.multiplyByScalar(L,1e3,W_),N);var j=B_,U=z_;n.default.subtract(I,M,j),n.default.normalize(j,U);var B=n.default.dot(P,U);if(B>=0)return void(e._zoomMouseStart.x=-1);var z=Math.acos(-B),H=n.default.magnitude(M),G=n.default.magnitude(I),W=H-h,Y=n.default.magnitude(j),X=Math.asin(J.default.clamp(Y/G*Math.sin(z),-1,1))-Math.asin(J.default.clamp(W/G*Math.sin(z),-1,1))+z,Q=j_;n.default.normalize(M,Q);var q=V_;q=n.default.cross(U,Q,q),q=n.default.normalize(q,q),n.default.normalize(n.default.cross(Q,q,W_),L),n.default.multiplyByScalar(n.default.normalize(N,W_),n.default.magnitude(N)-h,N),n.default.normalize(M,M),n.default.multiplyByScalar(M,W,M);var Z=H_;n.default.multiplyByScalar(n.default.add(n.default.multiplyByScalar(Q,Math.cos(X)-1,Y_),n.default.multiplyByScalar(L,Math.sin(X),X_),W_),W,Z),n.default.add(M,Z,M),n.default.normalize(N,Q),n.default.normalize(n.default.cross(Q,q,W_),L);var K=k_;return n.default.multiplyByScalar(n.default.add(n.default.multiplyByScalar(Q,Math.cos(X)-1,Y_),n.default.multiplyByScalar(L,Math.sin(X),X_),W_),n.default.magnitude(N),K),n.default.add(N,K,N),n.default.clone(M,p.position),n.default.normalize(n.default.subtract(N,M,W_),p.direction),n.default.clone(p.direction,p.direction),n.default.cross(p.direction,p.up,p.right),n.default.cross(p.right,p.direction,p.up),void p.setView(Q_)}if(Object(s.default)(F)){var $=n.default.normalize(F,F_),ee=n.default.normalize(e._zoomWorldPosition,M_),ae=n.default.dot(ee,$);if(ae>0&&ae<1){var ie=J.default.acosClamped(ae),ne=n.default.cross(ee,$,I_),re=h/(Math.abs(ie)>J.default.toRadians(20)?.75*p.positionCartographic.height:p.positionCartographic.height-h);p.rotate(ne,ie*re)}}else C=!0}}e._rotatingZoom=!C}if(!y&&C||b){var oe=Gc.default.wgs84ToWindowCoordinates(m,e._zoomWorldPosition,A_),se=(_!==V.a.COLUMBUS_VIEW&&k.default.equals(t,e._zoomMouseStart)&&Object(s.default)(oe)?p.getPickRay(oe,T_):p.getPickRay(t,T_)).direction;_!==V.a.COLUMBUS_VIEW&&_!==V.a.SCENE2D||n.default.fromElements(se.y,se.z,se.x,se),p.move(se,h),e._zoomingOnVector=!0}else p.zoomIn(h);e._cameraUnderground||p.setView(Q_)}else p.zoomIn(h)}}var Z_=new E.default,K_=new E.default,J_=new n.default;function $_(e,t,a){var i=e._scene.camera,r=i.getPickRay(a.startPosition,Z_).origin,o=i.getPickRay(a.endPosition,K_).origin;r=n.default.fromElements(r.y,r.z,r.x,r),o=n.default.fromElements(o.y,o.z,o.x,o);var s=n.default.subtract(r,o,J_),l=n.default.magnitude(s);l>0&&(n.default.normalize(s,s),i.move(s,l))}function eg(e,t,a){Object(s.default)(a.distance)&&(a=a.distance);var i=e._scene.camera;q_(e,t,a,e._zoomFactor,i.getMagnitude())}var tg=new k.default,ag=new k.default;function ig(e,t,a){if(Object(s.default)(a.angleAndHeight))!function(e,t,a){var i=e._rotateFactor*e._rotateRateRangeAdjustment;i>e._maximumRotateRate&&(i=e._maximumRotateRate);i<e._minimumRotateRate&&(i=e._minimumRotateRate);var n=e._scene,r=n.camera,o=n.canvas,s=(a.endPosition.x-a.startPosition.x)/o.clientWidth;s=Math.min(s,e.maximumMovementRatio);var l=i*s*Math.PI*4;r.twistRight(l)}(e,0,a.angleAndHeight);else{var i=e._scene,n=i.camera,r=i.canvas,o=r.clientWidth,l=r.clientHeight,u=tg;u.x=2/o*a.startPosition.x-1,u.y=2/l*(l-a.startPosition.y)-1,u=k.default.normalize(u,u);var d=ag;d.x=2/o*a.endPosition.x-1,d.y=2/l*(l-a.endPosition.y)-1,d=k.default.normalize(d,d);var c=J.default.acosClamped(u.x);u.y<0&&(c=J.default.TWO_PI-c);var f=J.default.acosClamped(d.x);d.y<0&&(f=J.default.TWO_PI-f);var h=f-c;n.twistRight(h)}}var ng=new E.default,rg=new n.default,og=new n.default;function sg(e,t,a){var i=e._scene,r=e._globe,o=i.camera;if(Object(s.default)(r)){var l,u=!e._cameraUnderground;i.pickPositionSupported&&(l=i.pickPositionWorldCoordinates(t,rg));var d=o.getPickRay(t,ng),c=r.pickWorldCoordinates(d,i,u,og);return(Object(s.default)(l)?n.default.distance(l,o.positionWC):Number.POSITIVE_INFINITY)<(Object(s.default)(c)?n.default.distance(c,o.positionWC):Number.POSITIVE_INFINITY)?n.default.clone(l,a):n.default.clone(c,a)}}var lg=new y.default;function ug(e){var t=e._ellipsoid,a=e._scene,i=a.camera,n=0;if(a.mode===V.a.SCENE3D){var r=t.cartesianToCartographic(i.position,lg);Object(s.default)(r)&&(n=r.height)}else n=i.position.z;var l=Object(o.default)(e._scene.globeHeight,0);return Math.abs(l-n)}var dg=new n.default;function cg(e,t){var a=t.origin,i=t.direction,r=ug(e),o=n.default.normalize(a,dg),s=Math.abs(n.default.dot(o,i));return r*(s=2*Math.max(s,.5))}function fg(e,t,a,i){var r=n.default.distance(t.origin,a),o=ug(e);return r>J.default.clamp(5*o,e._minimumUndergroundPickDistance,e._maximumUndergroundPickDistance)&&(r=Math.min(r,o/5),r=Math.max(r,100)),E.default.getPoint(t,r,i)}function hg(e,t,a,i){var r;return Object(s.default)(a)?(r=n.default.distance(t.origin,a))>e._maximumUndergroundPickDistance&&(r=ug(e)):r=ug(e),E.default.getPoint(t,r,i)}var mg=new k.default;function pg(e,t){var a=t.endPosition,i=k.default.subtract(t.endPosition,t.startPosition,mg),n=e._strafeEndMousePosition;k.default.add(n,i,n),t.endPosition=n,Zg(e,t,e._strafeStartPosition),t.endPosition=a}var _g=new E.default,gg=new E.default,vg=new n.default,yg=new n.default,bg=new n.default,wg=new n.default,Cg=new l_.a(n.default.UNIT_X,0),Og=new k.default,xg=new k.default;function Tg(e,t,a){if(n.default.equals(t,e._translateMousePosition)||(e._looking=!1),n.default.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking)Lv(e,t,a);else if(e._strafing)pg(e,a);else{var i,r=e._scene.camera,o=e._cameraUnderground,l=k.default.clone(a.startPosition,Og),u=k.default.clone(a.endPosition,xg),d=r.getPickRay(l,_g),c=n.default.clone(n.default.ZERO,wg),f=n.default.UNIT_X;if(r.position.z<e._minimumPickingTerrainHeight&&(i=sg(e,l,vg),Object(s.default)(i)&&(c.x=i.x)),o||c.x>r.position.z&&Object(s.default)(i)){var h=i;return o&&(h=hg(e,d,i,vg)),k.default.clone(t,e._strafeMousePosition),k.default.clone(t,e._strafeEndMousePosition),n.default.clone(h,e._strafeStartPosition),e._strafing=!0,void Zg(e,a,e._strafeStartPosition)}var m=l_.a.fromPointNormal(c,f,Cg);d=r.getPickRay(l,_g);var p=x.default.rayPlane(d,m,vg),_=r.getPickRay(u,gg),g=x.default.rayPlane(_,m,yg);if(!Object(s.default)(p)||!Object(s.default)(g))return e._looking=!0,Lv(e,t,a),void k.default.clone(t,e._translateMousePosition);var v=n.default.subtract(p,g,bg),y=v.x;v.x=v.y,v.y=v.z,v.z=y;var b=n.default.magnitude(v);b>J.default.EPSILON6&&(n.default.normalize(v,v),r.move(v,b))}}var Eg=new k.default,Ag=new E.default,Pg=new n.default,Sg=new n.default,Dg=new $.default,Fg=new $.default,Mg=new n.default,Ig=new l_.a(n.default.UNIT_X,0),Rg=new n.default,Ng=new y.default,Lg=new $.default,jg=new xi.default,Vg=new Oi.default,Ug=new n.default;function Bg(e,t,a){if(Object(s.default)(a.angleAndHeight)&&(a=a.angleAndHeight),k.default.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)Lv(e,t,a);else{var i=e._scene.camera;e._tiltCVOffMap||!e.onMap()||Math.abs(i.position.z)>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,function(e,t,a){var i=e._scene,r=i.camera,o=i.canvas,l=Eg;l.x=o.clientWidth/2,l.y=o.clientHeight/2;var u,c=r.getPickRay(l,Ag),f=n.default.UNIT_X,h=c.origin,m=c.direction,p=n.default.dot(f,m);Math.abs(p)>J.default.EPSILON6&&(u=-n.default.dot(f,h)/p);if(!Object(s.default)(u)||u<=0)return e._looking=!0,Lv(e,t,a),void k.default.clone(t,e._tiltCenterMousePosition);var _=n.default.multiplyByScalar(m,u,Pg);n.default.add(h,_,_);var g=i.mapProjection,v=g.ellipsoid;n.default.fromElements(_.y,_.z,_.x,_);var y=g.unproject(_,Ng);v.cartographicToCartesian(y,_);var b=qn.default.eastNorthUpToFixedFrame(_,v,Dg),w=e._globe,C=e._ellipsoid;e._globe=void 0,e._ellipsoid=d.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var O=$.default.clone(r.transform,Lg);r._setTransform(b),nv(e,t,a,n.default.UNIT_Z),r._setTransform(O),e._globe=w,e._ellipsoid=C;var x=C.maximumRadius;e._rotateFactor=1/x,e._rotateRateRangeAdjustment=x}(e,t,a)):function(e,t,a){var i,r,o=e._scene,l=o.camera,u=e._cameraUnderground,c=n.default.UNIT_X;if(k.default.equals(t,e._tiltCenterMousePosition))i=n.default.clone(e._tiltCenter,Pg);else{if(l.position.z<e._minimumPickingTerrainHeight&&(i=sg(e,t,Pg)),!Object(s.default)(i)){var f,h=(r=l.getPickRay(t,Ag)).origin,m=r.direction,p=n.default.dot(c,m);if(Math.abs(p)>J.default.EPSILON6&&(f=-n.default.dot(c,h)/p),!Object(s.default)(f)||f<=0)return e._looking=!0,Lv(e,t,a),void k.default.clone(t,e._tiltCenterMousePosition);i=n.default.multiplyByScalar(m,f,Pg),n.default.add(h,i,i)}u&&(Object(s.default)(r)||(r=l.getPickRay(t,Ag)),fg(e,r,i,i)),k.default.clone(t,e._tiltCenterMousePosition),n.default.clone(i,e._tiltCenter)}var _=o.canvas,g=Eg;g.x=_.clientWidth/2,g.y=e._tiltCenterMousePosition.y,r=l.getPickRay(g,Ag);var v=n.default.clone(n.default.ZERO,Mg);v.x=i.x;var y=l_.a.fromPointNormal(v,c,Ig),b=x.default.rayPlane(r,y,Sg),w=l._projection,C=w.ellipsoid;n.default.fromElements(i.y,i.z,i.x,i);var O=w.unproject(i,Ng);C.cartographicToCartesian(O,i);var T,E=qn.default.eastNorthUpToFixedFrame(i,C,Dg);Object(s.default)(b)?(n.default.fromElements(b.y,b.z,b.x,b),O=w.unproject(b,Ng),C.cartographicToCartesian(O,b),T=qn.default.eastNorthUpToFixedFrame(b,C,Fg)):T=E;var A=e._globe,P=e._ellipsoid;e._globe=void 0,e._ellipsoid=d.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var S=n.default.UNIT_Z,D=$.default.clone(l.transform,Lg);l._setTransform(E);var F=n.default.cross(n.default.UNIT_Z,n.default.normalize(l.position,Rg),Rg),M=n.default.dot(l.right,F);if(nv(e,t,a,S,!1,!0),l._setTransform(T),M<0){var I=a.startPosition.y-a.endPosition.y;(u&&I<0||!u&&I>0)&&(S=void 0);var R=l.constrainedAxis;l.constrainedAxis=void 0,nv(e,t,a,S,!0,!1),l.constrainedAxis=R}else nv(e,t,a,S,!0,!1);if(Object(s.default)(l.constrainedAxis)){var N=n.default.cross(l.direction,l.constrainedAxis,Ug);n.default.equalsEpsilon(N,n.default.ZERO,J.default.EPSILON6)||(n.default.dot(N,l.right)<0&&n.default.negate(N,N),n.default.cross(N,l.direction,l.up),n.default.cross(l.direction,l.up,l.right),n.default.normalize(l.up,l.up),n.default.normalize(l.right,l.right))}l._setTransform(D),e._globe=A,e._ellipsoid=P;var L=P.maximumRadius;e._rotateFactor=1/L,e._rotateRateRangeAdjustment=L;var j=n.default.clone(l.positionWC,Rg);e.enableCollisionDetection&&Uv(e);if(!n.default.equals(l.positionWC,j)){l._setTransform(T),l.worldToCameraCoordinatesPoint(j,j);var V=n.default.magnitudeSquared(j);n.default.magnitudeSquared(l.position)>V&&(n.default.normalize(l.position,l.position),n.default.multiplyByScalar(l.position,Math.sqrt(V),l.position));var U=n.default.angleBetween(j,l.position),B=n.default.cross(j,l.position,j);n.default.normalize(B,B);var z=xi.default.fromAxisAngle(B,U,jg),H=Oi.default.fromQuaternion(z,Vg);Oi.default.multiplyByVector(H,l.direction,l.direction),Oi.default.multiplyByVector(H,l.up,l.up),n.default.cross(l.direction,l.up,l.right),n.default.cross(l.right,l.direction,l.up),l._setTransform(D)}}(e,t,a)}}var zg=new k.default,Hg=new E.default,kg=new n.default;function Gg(e,t,a){Object(s.default)(a.distance)&&(a=a.distance);var i,r=e._scene,o=r.camera,l=r.canvas,u=e._cameraUnderground;u?i=t:((i=zg).x=l.clientWidth/2,i.y=l.clientHeight/2);var d,c,f=o.getPickRay(i,Hg),h=f.origin,m=f.direction,p=o.position.z;if(p<e._minimumPickingTerrainHeight&&(d=sg(e,i,kg)),Object(s.default)(d)&&(c=n.default.distance(h,d)),u){var _=cg(e,f);c=Object(s.default)(c)?Math.min(c,_):_}if(!Object(s.default)(c)){var g=n.default.UNIT_X;c=-n.default.dot(g,h)/n.default.dot(g,m)}q_(e,t,a,e._zoomFactor,c)}var Wg=new E.default,Yg=new l_.a(n.default.UNIT_X,0),Xg=new n.default,Qg=new n.default,qg=new n.default;function Zg(e,t,a){var i=e._scene,r=i.camera,o=r.getPickRay(t.endPosition,Wg),l=n.default.clone(r.direction,Qg);i.mode===V.a.COLUMBUS_VIEW&&n.default.fromElements(l.z,l.x,l.y,l);var u=l_.a.fromPointNormal(a,l,Yg),d=x.default.rayPlane(o,u,Xg);Object(s.default)(d)&&(l=n.default.subtract(a,d,l),i.mode===V.a.COLUMBUS_VIEW&&n.default.fromElements(l.y,l.z,l.x,l),n.default.add(r.position,l,r.position))}var Kg=new n.default,Jg=new y.default,$g=new n.default,ev=new d.default,tv=new n.default,av=new n.default;function iv(e,t,a){var i=e._scene.camera,r=e._cameraUnderground,o=e._ellipsoid;if($.default.equals(i.transform,$.default.IDENTITY)){var l,u,c=o.geodeticSurfaceNormal(i.position,tv);if(k.default.equals(t,e._rotateMousePosition))if(e._looking)Lv(e,t,a,c);else if(e._rotating)nv(e,t,a);else if(e._strafing)pg(e,a);else{if(n.default.magnitude(i.position)<n.default.magnitude(e._rotateStartPosition))return;l=n.default.magnitude(e._rotateStartPosition),(u=$g).x=u.y=u.z=l,hv(e,t,a,o=d.default.fromCartesian3(u,ev))}else{e._looking=!1,e._rotating=!1,e._strafing=!1;var f=o.cartesianToCartographic(i.positionWC,Jg).height,h=e._globe;if(Object(s.default)(h)&&f<e._minimumPickingTerrainHeight){var m=sg(e,a.startPosition,qg);if(Object(s.default)(m)){var p=!1,_=i.getPickRay(a.startPosition,ng);if(r)p=!0,hg(e,_,m,m);else{var g=o.geodeticSurfaceNormal(m,av);p=!!(Math.abs(n.default.dot(_.direction,g))<.05)||n.default.magnitude(i.position)<n.default.magnitude(m)}p?(k.default.clone(t,e._strafeEndMousePosition),n.default.clone(m,e._strafeStartPosition),e._strafing=!0,Zg(e,a,e._strafeStartPosition)):(l=n.default.magnitude(m),(u=$g).x=u.y=u.z=l,hv(e,t,a,o=d.default.fromCartesian3(u,ev)),n.default.clone(m,e._rotateStartPosition))}else e._looking=!0,Lv(e,t,a,c)}else Object(s.default)(i.pickEllipsoid(a.startPosition,e._ellipsoid,Kg))?(hv(e,t,a,e._ellipsoid),n.default.clone(Kg,e._rotateStartPosition)):f>e._minimumTrackBallHeight?(e._rotating=!0,nv(e,t,a)):(e._looking=!0,Lv(e,t,a,c));k.default.clone(t,e._rotateMousePosition)}}else nv(e,t,a)}function nv(e,t,a,i,r,l){r=Object(o.default)(r,!1),l=Object(o.default)(l,!1);var u=e._scene,d=u.camera,c=u.canvas,f=d.constrainedAxis;Object(s.default)(i)&&(d.constrainedAxis=i);var h=n.default.magnitude(d.position),m=e._rotateFactor*(h-e._rotateRateRangeAdjustment);m>e._maximumRotateRate&&(m=e._maximumRotateRate),m<e._minimumRotateRate&&(m=e._minimumRotateRate);var p=(a.startPosition.x-a.endPosition.x)/c.clientWidth,_=(a.startPosition.y-a.endPosition.y)/c.clientHeight;p=Math.min(p,e.maximumMovementRatio),_=Math.min(_,e.maximumMovementRatio);var g=m*p*Math.PI*2,v=m*_*Math.PI;r||d.rotateRight(g),l||d.rotateUp(v),d.constrainedAxis=f}var rv=G.a.clone(G.a.UNIT_W),ov=G.a.clone(G.a.UNIT_W),sv=new n.default,lv=new n.default,uv=new n.default,dv=new n.default,cv=new k.default,fv=new k.default;function hv(e,t,a,i){var r=e._scene.camera,o=k.default.clone(a.startPosition,cv),l=k.default.clone(a.endPosition,fv),u=r.pickEllipsoid(o,i,rv),d=r.pickEllipsoid(l,i,ov);if(!Object(s.default)(u)||!Object(s.default)(d))return e._rotating=!0,void nv(e,0,a);if(u=r.worldToCameraCoordinates(u,u),d=r.worldToCameraCoordinates(d,d),Object(s.default)(r.constrainedAxis)){var c=r.constrainedAxis,f=n.default.mostOrthogonalAxis(c,sv);n.default.cross(f,c,f),n.default.normalize(f,f);var h=n.default.cross(c,f,lv),m=n.default.magnitude(u),p=n.default.dot(c,u),_=Math.acos(p/m),g=n.default.multiplyByScalar(c,p,uv);n.default.subtract(u,g,g),n.default.normalize(g,g);var v=n.default.magnitude(d),y=n.default.dot(c,d),b=Math.acos(y/v),w=n.default.multiplyByScalar(c,y,dv);n.default.subtract(d,w,w),n.default.normalize(w,w);var C=Math.acos(n.default.dot(g,f));n.default.dot(g,h)<0&&(C=J.default.TWO_PI-C);var O=Math.acos(n.default.dot(w,f));n.default.dot(w,h)<0&&(O=J.default.TWO_PI-O);var x,T=C-O;x=n.default.equalsEpsilon(c,r.position,J.default.EPSILON2)?r.right:n.default.cross(c,r.position,sv);var E,A=n.default.cross(c,x,sv),P=n.default.dot(A,n.default.subtract(u,c,lv)),S=n.default.dot(A,n.default.subtract(d,c,lv));E=P>0&&S>0?b-_:P>0&&S<=0?n.default.dot(r.position,c)>0?-_-b:_+b:_-b,r.rotateRight(T),r.rotateUp(E)}else{n.default.normalize(u,u),n.default.normalize(d,d);var D=n.default.dot(u,d),F=n.default.cross(u,d,sv);if(D<1&&!n.default.equalsEpsilon(F,n.default.ZERO,J.default.EPSILON14)){var M=Math.acos(D);r.rotate(F,M)}}}var mv=new n.default,pv=new y.default;function _v(e,t,a){Object(s.default)(a.distance)&&(a=a.distance);var i,r=e._ellipsoid,o=e._scene,l=o.camera,u=o.canvas,d=e._cameraUnderground;d?i=t:((i=zg).x=u.clientWidth/2,i.y=u.clientHeight/2);var c,f,h=l.getPickRay(i,Hg),m=r.cartesianToCartographic(l.position,pv).height;if(m<e._minimumPickingTerrainHeight&&(c=sg(e,i,kg)),Object(s.default)(c)&&(f=n.default.distance(h.origin,c)),d){var p=cg(e,h);f=Object(s.default)(f)?Math.min(f,p):p}Object(s.default)(f)||(f=m);var _=n.default.normalize(l.position,mv);q_(e,t,a,e._zoomFactor,f,n.default.dot(_,l.direction))}var gv=new k.default,vv=new E.default,yv=new n.default,bv=new n.default,wv=new $.default,Cv=new $.default,Ov=new $.default,xv=new xi.default,Tv=new Oi.default,Ev=new y.default,Av=new n.default;function Pv(e,t,a){var i=e._scene.camera;if($.default.equals(i.transform,$.default.IDENTITY))if(Object(s.default)(a.angleAndHeight)&&(a=a.angleAndHeight),k.default.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){var r=e._ellipsoid.geodeticSurfaceNormal(i.position,Av);Lv(e,t,a,r)}else{var o=e._ellipsoid.cartesianToCartographic(i.position,Ev);e._tiltOnEllipsoid||o.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,function(e,t,a){var i=e._ellipsoid,r=e._scene,o=r.camera,l=.25*e.minimumZoomDistance,u=i.cartesianToCartographic(o.positionWC,Sv).height;if(u-l-1<J.default.EPSILON3&&a.endPosition.y-a.startPosition.y<0)return;var c=r.canvas,f=gv;f.x=c.clientWidth/2,f.y=c.clientHeight/2;var h,m=o.getPickRay(f,vv),p=x.default.rayEllipsoid(m,i);if(Object(s.default)(p))h=E.default.getPoint(m,p.start,yv);else{if(!(u>e._minimumTrackBallHeight)){e._looking=!0;var _=e._ellipsoid.geodeticSurfaceNormal(o.position,Av);return Lv(e,t,a,_),void k.default.clone(t,e._tiltCenterMousePosition)}var g=x.default.grazingAltitudeLocation(m,i);if(!Object(s.default)(g))return;var v=i.cartesianToCartographic(g,Ev);v.height=0,h=i.cartographicToCartesian(v,yv)}var y=qn.default.eastNorthUpToFixedFrame(h,i,wv),b=e._globe,w=e._ellipsoid;e._globe=void 0,e._ellipsoid=d.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var C=$.default.clone(o.transform,Ov);o._setTransform(y),nv(e,0,a,n.default.UNIT_Z),o._setTransform(C),e._globe=b,e._ellipsoid=w;var O=w.maximumRadius;e._rotateFactor=1/O,e._rotateRateRangeAdjustment=O}(e,t,a)):function(e,t,a){var i,r,o,l=e._ellipsoid,u=e._scene,c=u.camera,f=e._cameraUnderground;if(k.default.equals(t,e._tiltCenterMousePosition))i=n.default.clone(e._tiltCenter,yv);else{if(i=sg(e,t,yv),!Object(s.default)(i)){if(r=c.getPickRay(t,vv),o=x.default.rayEllipsoid(r,l),!Object(s.default)(o)){if(l.cartesianToCartographic(c.position,Ev).height<=e._minimumTrackBallHeight){e._looking=!0;var h=e._ellipsoid.geodeticSurfaceNormal(c.position,Av);Lv(e,t,a,h),k.default.clone(t,e._tiltCenterMousePosition)}return}i=E.default.getPoint(r,o.start,yv)}f&&(Object(s.default)(r)||(r=c.getPickRay(t,vv)),fg(e,r,i,i)),k.default.clone(t,e._tiltCenterMousePosition),n.default.clone(i,e._tiltCenter)}var m=u.canvas,p=gv;p.x=m.clientWidth/2,p.y=e._tiltCenterMousePosition.y,r=c.getPickRay(p,vv);var _=n.default.magnitude(i),g=n.default.fromElements(_,_,_,$g),v=d.default.fromCartesian3(g,ev);if(o=x.default.rayEllipsoid(r,v),!Object(s.default)(o))return;var y=n.default.magnitude(r.origin)>_?o.start:o.stop,b=E.default.getPoint(r,y,bv),w=qn.default.eastNorthUpToFixedFrame(i,l,wv),C=qn.default.eastNorthUpToFixedFrame(b,v,Cv),O=e._globe,T=e._ellipsoid;e._globe=void 0,e._ellipsoid=d.default.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var A=n.default.UNIT_Z,P=$.default.clone(c.transform,Ov);c._setTransform(w);var S=n.default.cross(b,c.positionWC,Ug),D=n.default.dot(c.rightWC,S);if(nv(e,0,a,A,!1,!0),c._setTransform(C),D<0){var F=a.startPosition.y-a.endPosition.y;(f&&F<0||!f&&F>0)&&(A=void 0);var M=c.constrainedAxis;c.constrainedAxis=void 0,nv(e,0,a,A,!0,!1),c.constrainedAxis=M}else nv(e,0,a,A,!0,!1);if(Object(s.default)(c.constrainedAxis)){var I=n.default.cross(c.direction,c.constrainedAxis,Ug);n.default.equalsEpsilon(I,n.default.ZERO,J.default.EPSILON6)||(n.default.dot(I,c.right)<0&&n.default.negate(I,I),n.default.cross(I,c.direction,c.up),n.default.cross(c.direction,c.up,c.right),n.default.normalize(c.up,c.up),n.default.normalize(c.right,c.right))}c._setTransform(P),e._globe=O,e._ellipsoid=T;var R=T.maximumRadius;e._rotateFactor=1/R,e._rotateRateRangeAdjustment=R;var N=n.default.clone(c.positionWC,Ug);e.enableCollisionDetection&&Uv(e);if(!n.default.equals(c.positionWC,N)){c._setTransform(C),c.worldToCameraCoordinatesPoint(N,N);var L=n.default.magnitudeSquared(N);n.default.magnitudeSquared(c.position)>L&&(n.default.normalize(c.position,c.position),n.default.multiplyByScalar(c.position,Math.sqrt(L),c.position));var j=n.default.angleBetween(N,c.position),V=n.default.cross(N,c.position,N);n.default.normalize(V,V);var U=xi.default.fromAxisAngle(V,j,xv),B=Oi.default.fromQuaternion(U,Tv);Oi.default.multiplyByVector(B,c.direction,c.direction),Oi.default.multiplyByVector(B,c.up,c.up),n.default.cross(c.direction,c.up,c.right),n.default.cross(c.right,c.direction,c.up),c._setTransform(P)}}(e,t,a)}}var Sv=new y.default;var Dv=new k.default,Fv=new k.default,Mv=new E.default,Iv=new E.default,Rv=new n.default,Nv=new n.default;function Lv(e,t,a,i){var r=e._scene.camera,l=Dv;l.x=a.startPosition.x,l.y=0;var u=Fv;u.x=a.endPosition.x,u.y=0;var d,c,f=r.getPickRay(l,Mv),h=r.getPickRay(u,Iv),m=0;r.frustum instanceof te.a?(d=f.origin,c=h.origin,n.default.add(r.direction,d,d),n.default.add(r.direction,c,c),n.default.subtract(d,r.position,d),n.default.subtract(c,r.position,c),n.default.normalize(d,d),n.default.normalize(c,c)):(d=f.direction,c=h.direction);var p=n.default.dot(d,c);p<1&&(m=Math.acos(p)),m=a.startPosition.x>a.endPosition.x?-m:m;var _=e._horizontalRotationAxis;if(Object(s.default)(i)?r.look(i,-m):Object(s.default)(_)?r.look(_,-m):r.lookLeft(m),l.x=0,l.y=a.startPosition.y,u.x=0,u.y=a.endPosition.y,f=r.getPickRay(l,Mv),h=r.getPickRay(u,Iv),m=0,r.frustum instanceof te.a?(d=f.origin,c=h.origin,n.default.add(r.direction,d,d),n.default.add(r.direction,c,c),n.default.subtract(d,r.position,d),n.default.subtract(c,r.position,c),n.default.normalize(d,d),n.default.normalize(c,c)):(d=f.direction,c=h.direction),(p=n.default.dot(d,c))<1&&(m=Math.acos(p)),m=a.startPosition.y>a.endPosition.y?-m:m,i=Object(o.default)(i,_),Object(s.default)(i)){var g=r.direction,v=n.default.negate(i,Rv),y=n.default.equalsEpsilon(g,i,J.default.EPSILON2),b=n.default.equalsEpsilon(g,v,J.default.EPSILON2);if(y||b)(y&&m<0||b&&m>0)&&r.look(r.right,-m);else{p=n.default.dot(g,i);var w=J.default.acosClamped(p);m>0&&m>w&&(m=w-J.default.EPSILON4),p=n.default.dot(g,v),w=J.default.acosClamped(p),m<0&&-m>w&&(m=-w+J.default.EPSILON4);var C=n.default.cross(i,g,Nv);r.look(C,m)}}else r.lookUp(m)}var jv=new $.default,Vv=new y.default;function Uv(e){e._adjustedHeightForTerrain=!0;var t=e._scene,a=t.mode,i=t.globe;if(Object(s.default)(i)&&a!==V.a.SCENE2D&&a!==V.a.MORPHING){var r,o,l=t.camera,u=i.ellipsoid,d=t.mapProjection;$.default.equals(l.transform,$.default.IDENTITY)||(r=$.default.clone(l.transform,jv),o=n.default.magnitude(l.position),l._setTransform($.default.IDENTITY));var c=Vv;a===V.a.SCENE3D?u.cartesianToCartographic(l.position,c):d.unproject(l.position,c);var f=!1;if(c.height<e._minimumCollisionTerrainHeight){var h=e._scene.globeHeight;if(Object(s.default)(h)){var m=h+e.minimumZoomDistance;c.height<m&&(c.height=m,a===V.a.SCENE3D?u.cartographicToCartesian(c,l.position):d.project(c,l.position),f=!0)}}Object(s.default)(r)&&(l._setTransform(r),f&&(n.default.normalize(l.position,l.position),n.default.negate(l.position,l.direction),n.default.multiplyByScalar(l.position,Math.max(o,e.minimumZoomDistance),l.position),n.default.normalize(l.direction,l.direction),n.default.cross(l.direction,l.up,l.right),n.default.cross(l.right,l.direction,l.up)))}}y_.prototype.onMap=function(){var e=this._scene,t=e.mode,a=e.camera;return t!==V.a.COLUMBUS_VIEW||Math.abs(a.position.x)-this._maxCoord.x<0&&Math.abs(a.position.y)-this._maxCoord.y<0};var Bv=new n.default,zv=new n.default;y_.prototype.update=function(){var e=this._scene,t=e.camera,a=e.globe,i=e.mode;$.default.equals(t.transform,$.default.IDENTITY)?(this._globe=a,this._ellipsoid=Object(s.default)(this._globe)?this._globe.ellipsoid:e.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=d.default.UNIT_SPHERE),this._cameraUnderground=e.cameraUnderground&&Object(s.default)(this._globe),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*e.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*e.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*e.terrainExaggeration;var r=this._ellipsoid.maximumRadius;this._rotateFactor=1/r,this._rotateRateRangeAdjustment=r,this._adjustedHeightForTerrain=!1;var o,l,u=n.default.clone(t.positionWC,Bv),c=n.default.clone(t.directionWC,zv);(i===V.a.SCENE2D?(l=(o=this)._scene.mapMode2D===Yo.ROTATE,$.default.equals($.default.IDENTITY,o._scene.camera.transform)?(x_(o,o.enableTranslate,o.translateEventTypes,$_,o.inertiaTranslate,"_lastInertiaTranslateMovement"),x_(o,o.enableZoom,o.zoomEventTypes,eg,o.inertiaZoom,"_lastInertiaZoomMovement"),l&&x_(o,o.enableRotate,o.tiltEventTypes,ig,o.inertiaSpin,"_lastInertiaTiltMovement")):(x_(o,o.enableZoom,o.zoomEventTypes,eg,o.inertiaZoom,"_lastInertiaZoomMovement"),l&&x_(o,o.enableRotate,o.translateEventTypes,ig,o.inertiaSpin,"_lastInertiaSpinMovement"))):i===V.a.COLUMBUS_VIEW?(this._horizontalRotationAxis=n.default.UNIT_Z,function(e){var t=e._scene.camera;if($.default.equals($.default.IDENTITY,t.transform)){var a=e._tweens;if(e._aggregator.anyButtonDown&&a.removeAll(),x_(e,e.enableTilt,e.tiltEventTypes,Bg,e.inertiaSpin,"_lastInertiaTiltMovement"),x_(e,e.enableTranslate,e.translateEventTypes,Tg,e.inertiaTranslate,"_lastInertiaTranslateMovement"),x_(e,e.enableZoom,e.zoomEventTypes,Gg,e.inertiaZoom,"_lastInertiaZoomMovement"),x_(e,e.enableLook,e.lookEventTypes,Lv),!e._aggregator.anyButtonDown&&!a.contains(e._tween)){var i=t.createCorrectPositionTween(e.bounceAnimationTime);Object(s.default)(i)&&(e._tween=a.add(i))}a.update()}else x_(e,e.enableRotate,e.rotateEventTypes,nv,e.inertiaSpin,"_lastInertiaSpinMovement"),x_(e,e.enableZoom,e.zoomEventTypes,_v,e.inertiaZoom,"_lastInertiaZoomMovement")}(this)):i===V.a.SCENE3D&&(this._horizontalRotationAxis=void 0,function(e){x_(e,e.enableRotate,e.rotateEventTypes,iv,e.inertiaSpin,"_lastInertiaSpinMovement"),x_(e,e.enableZoom,e.zoomEventTypes,_v,e.inertiaZoom,"_lastInertiaZoomMovement"),x_(e,e.enableTilt,e.tiltEventTypes,Pv,e.inertiaSpin,"_lastInertiaTiltMovement"),x_(e,e.enableLook,e.lookEventTypes,Lv)}(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain)&&((!n.default.equals(u,t.positionWC)||!n.default.equals(c,t.directionWC))&&Uv(this));this._aggregator.reset()},y_.prototype.isDestroyed=function(){return!1},y_.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),Object(l.default)(this)};var Hv=y_,kv="uniform sampler2D colorTexture;\nuniform sampler2D colorTexture2;\n\nuniform vec2 center;\nuniform float radius;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 color0 = texture2D(colorTexture, v_textureCoordinates);\n    vec4 color1 = texture2D(colorTexture2, v_textureCoordinates);\n\n    float x = length(gl_FragCoord.xy - center) / radius;\n    float t = smoothstep(0.5, 0.8, x);\n    gl_FragColor = mix(color0 + color1, color1, t);\n}\n",Gv='uniform sampler2D colorTexture;\n\nuniform float avgLuminance;\nuniform float threshold;\nuniform float offset;\n\nvarying vec2 v_textureCoordinates;\n\nfloat key(float avg)\n{\n    float guess = 1.5 - (1.5 / (avg * 0.1 + 1.0));\n    return max(0.0, guess) + 0.1;\n}\n\n// See section 9. "The bright-pass filter" of Realtime HDR Rendering\n// http://www.cg.tuwien.ac.at/research/publications/2007/Luksch_2007_RHR/Luksch_2007_RHR-RealtimeHDR%20.pdf\n\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec3 xyz = czm_RGBToXYZ(color.rgb);\n    float luminance = xyz.r;\n\n    float scaledLum = key(avgLuminance) * luminance / avgLuminance;\n    float brightLum = max(scaledLum - threshold, 0.0);\n    float brightness = brightLum / (offset + brightLum);\n\n    xyz.r = brightness;\n    gl_FragColor = vec4(czm_XYZToRGB(xyz), 1.0);\n}\n';function Wv(){this._sceneFramebuffer=new Ef;var e=new Array(6);e[0]=new Mm({fragmentShader:Od,textureScale:.125,forcePowerOfTwo:!0,sampleMode:Om.LINEAR});var t=e[1]=new Mm({fragmentShader:Gv,uniforms:{avgLuminance:.5,threshold:.25,offset:.1},textureScale:.125,forcePowerOfTwo:!0}),a=this;this._delta=1,this._sigma=2,this._blurStep=new k.default,e[2]=new Mm({fragmentShader:_m,uniforms:{step:function(){return a._blurStep.x=a._blurStep.y=1/t.outputTexture.width,a._blurStep},delta:function(){return a._delta},sigma:function(){return a._sigma},direction:0},textureScale:.125,forcePowerOfTwo:!0}),e[3]=new Mm({fragmentShader:_m,uniforms:{step:function(){return a._blurStep.x=a._blurStep.y=1/t.outputTexture.width,a._blurStep},delta:function(){return a._delta},sigma:function(){return a._sigma},direction:1},textureScale:.125,forcePowerOfTwo:!0}),e[4]=new Mm({fragmentShader:Od,sampleMode:Om.LINEAR}),this._uCenter=new k.default,this._uRadius=void 0,e[5]=new Mm({fragmentShader:kv,uniforms:{center:function(){return a._uCenter},radius:function(){return a._uRadius},colorTexture2:function(){return a._sceneFramebuffer.getFramebuffer().getColorTexture(0)}}}),this._stages=new Rm({stages:e});for(var i=new Wm(this),n=e.length,r=0;r<n;++r)e[r]._textureCache=i;this._textureCache=i,this.length=e.length}Wv.prototype.get=function(e){return this._stages.get(e)},Wv.prototype.getStageByName=function(e){for(var t=this._stages.length,a=0;a<t;++a){var i=this._stages.get(a);if(i.name===e)return i}};var Yv=new G.a,Xv=new k.default,Qv=new k.default,qv=new $.default;Wv.prototype.clear=function(e,t,a){this._sceneFramebuffer.clear(e,t,a),this._textureCache.clear(e)},Wv.prototype.update=function(e){var t=e.context,a=e.viewport,i=this._sceneFramebuffer;i.update(t,a);var n=i.getFramebuffer();return this._textureCache.update(t),this._stages.update(t,!1),function(e,t,a){var i=t.uniformState,n=i.sunPositionWC,r=i.view,o=i.viewProjection,s=i.projection,l=$.default.computeViewportTransformation(a,0,1,qv),u=$.default.multiplyByPoint(r,n,Yv),d=qn.default.pointToGLWindowCoordinates(o,l,n,Xv);u.x+=J.default.SOLAR_RADIUS;var c=qn.default.pointToGLWindowCoordinates(s,l,u,u),f=30*k.default.magnitude(k.default.subtract(c,d,c))*2,h=Qv;h.x=f,h.y=f,e._uCenter=k.default.clone(d,e._uCenter),e._uRadius=.15*Math.max(h.x,h.y);var m=t.drawingBufferWidth,p=t.drawingBufferHeight,_=e._stages,g=_.get(0),v=g.outputTexture.width,y=g.outputTexture.height,b=new fr.default;b.width=v,b.height=y,l=$.default.computeViewportTransformation(b,0,1,qv),d=qn.default.pointToGLWindowCoordinates(o,l,n,Xv),h.x*=v/m,h.y*=y/p;var w=g.scissorRectangle;w.x=Math.max(d.x-.5*h.x,0),w.y=Math.max(d.y-.5*h.y,0),w.width=Math.min(h.x,m),w.height=Math.min(h.y,p);for(var C=1;C<4;++C)fr.default.clone(w,_.get(C).scissorRectangle)}(this,t,a),n},Wv.prototype.execute=function(e){var t=this._sceneFramebuffer.getFramebuffer().getColorTexture(0),a=this._stages,i=a.length;a.get(0).execute(e,t);for(var n=1;n<i;++n)a.get(n).execute(e,a.get(n-1).outputTexture)},Wv.prototype.copy=function(e,t){if(!Object(s.default)(this._copyColorCommand)){var a=this;this._copyColorCommand=e.createViewportQuadCommand(Od,{uniformMap:{colorTexture:function(){return a._stages.get(a._stages.length-1).outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)},Wv.prototype.isDestroyed=function(){return!1},Wv.prototype.destroy=function(){return this._textureCache.destroy(),this._stages.destroy(),Object(l.default)(this)};var Zv=Wv;function Kv(){this._cachedShowFrustumsShaders={}}var Jv=new b.default;var $v=new ue.a;Kv.prototype.executeDebugShowFrustumsCommand=function(e,t,a){var i=t.shaderProgram.id,n=this._cachedShowFrustumsShaders[i];Object(s.default)(n)||(n=function(e,t){var a=e.context,i=t,n=i.fragmentShaderSource.clone(),r=[];n.sources=n.sources.map((function(e){e=S.a.replaceMain(e,"czm_Debug_main");for(var t,a=/gl_FragData\[(\d+)\]/g;null!==(t=a.exec(e));)-1===r.indexOf(t[1])&&r.push(t[1]);return e}));var o,s=r.length,l="";if(l+="uniform vec3 debugShowCommandsColor;\n",l+="uniform vec3 debugShowFrustumsColor;\n",l+="void main() \n{ \n    czm_Debug_main(); \n",s>0)for(o=0;o<s;++o)l+="    gl_FragData["+r[o]+"].rgb *= debugShowCommandsColor;\n",l+="    gl_FragData["+r[o]+"].rgb *= debugShowFrustumsColor;\n";else l+="    gl_FragColor.rgb *= debugShowCommandsColor;\n",l+="    gl_FragColor.rgb *= debugShowFrustumsColor;\n";l+="}",n.sources.push(l);var u=function(e){var t={},a=e.vertexAttributes;for(var i in a)a.hasOwnProperty(i)&&(t[i]=a[i].index);return t}(i);return L.a.fromCache({context:a,vertexShaderSource:i.vertexShaderSource,fragmentShaderSource:n,attributeLocations:u})}(e,t.shaderProgram),this._cachedShowFrustumsShaders[i]=n);var r=ue.a.shallowClone(t,$v);r.shaderProgram=n,r.uniformMap=function(e,t){var a;return a=Object(s.default)(t.uniformMap)?t.uniformMap:{},Object(s.default)(a.debugShowCommandsColor)||Object(s.default)(a.debugShowFrustumsColor)?a:(a.debugShowCommandsColor=function(){return e.debugShowCommands?(Object(s.default)(t._debugColor)||(t._debugColor=b.default.fromRandom()),t._debugColor):b.default.WHITE},a.debugShowFrustumsColor=function(){return e.debugShowFrustums?(Jv.red=1&t.debugOverlappingFrustums?1:0,Jv.green=2&t.debugOverlappingFrustums?1:0,Jv.blue=4&t.debugOverlappingFrustums?1:0,Jv.alpha=1,Jv):b.default.WHITE},a)}(e,t),r.execute(e.context,a)};var ey=Kv,ty=function(e){return function(){e.frameState.afterRender.push((function(){e.requestRender()}))}};function ay(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).canvas,a=e.creditContainer,i=e.creditViewport,n=Object(W.default)(e.contextOptions);Object(s.default)(n)||(n={}),Object(s.default)(n.webgl)||(n.webgl={}),n.webgl.powerPreference=Object(o.default)(n.webgl.powerPreference,"high-performance");var r=Object(s.default)(a),l=new jo(t,n);r||((a=document.createElement("div")).style.position="absolute",a.style.bottom="0",a.style["text-shadow"]="0 0 2px #000000",a.style.color="#ffffff",a.style["font-size"]="10px",a.style["padding-right"]="5px",t.parentNode.appendChild(a)),Object(s.default)(i)||(i=t.parentNode),this._id=Object(hr.default)(),this._jobScheduler=new Pc,this._frameState=new Cd(l,new au.default(a," • ",i),this._jobScheduler),this._frameState.scene3DOnly=Object(o.default)(e.scene3DOnly,!1),this._removeCreditContainer=!r,this._creditContainer=a,this._canvas=t,this._context=l,this._computeEngine=new Yr(l),this._globe=void 0,this._globeTranslucencyState=new yc,this._primitives=new kc.a,this._groundPrimitives=new kc.a,this._globeHeight=void 0,this._cameraUnderground=!1,this._logDepthBuffer=l.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new v_.default,this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=Object(o.default)(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new $u,this._clearColorCommand=new Br.a({color:new b.default,stencil:0,owner:this}),this._depthClearCommand=new Br.a({depth:1,owner:this}),this._stencilClearCommand=new Br.a({stencil:0}),this._classificationStencilClearCommand=new Br.a({stencil:0,renderState:ce.a.fromCache({stencilMask:Td.a.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new o_(this),this._preUpdate=new C.default,this._postUpdate=new C.default,this._renderError=new C.default,this._preRender=new C.default,this._postRender=new C.default,this._minimumDisableDepthTestDistance=0,this._debugInspector=new ey,this.rethrowRenderErrors=!1,this.completeMorphOnUserInput=!0,this.morphStart=new C.default,this.morphComplete=new C.default,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=b.default.clone(b.default.BLACK),this._mode=V.a.SCENE3D,this._mapProjection=Object(s.default)(e.mapProjection)?e.mapProjection:new _r.a,this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowGlobeDepth=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.fog=new wd,this._shadowMapCamera=new $l(this),this.shadowMap=new mh({context:l,lightCamera:this._shadowMapCamera,enabled:Object(o.default)(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=b.default.clone(b.default.WHITE),this._actualInvertClassificationColor=b.default.clone(this._invertClassificationColor),this._invertClassification=new xc,this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new $m,this._brdfLutGenerator=new Bo,this._terrainExaggeration=Object(o.default)(e.terrainExaggeration,1),this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new Hv(this),this._cameraUnderground=!1,this._mapMode2D=Object(o.default)(e.mapMode2D,Yo.INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,separatePrimitiveFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=Object(o.default)(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=Object(o.default)(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=Vr.a.requestCompletedEvent.addEventListener(ty(this)),this._removeTaskProcessorListenerCallback=Ur.default.taskCompletedEvent.addEventListener(ty(this)),this._removeGlobeCallbacks=[];var u=new fr.default(0,0,l.drawingBufferWidth,l.drawingBufferHeight),d=new $l(this);this._logDepthBuffer&&(d.frustum.near=.1,d.frustum.far=1e10),this.preloadFlightCamera=new $l(this),this.preloadFlightCullingVolume=void 0,this._picking=new mm(this),this._defaultView=new Oh(this,d,u),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new oo,dy(this,0,ci.default.now()),this.updateFrameState(),this.initializeFrame()}function iy(e,t,a){var i=e._frameState,n=e._context,r=e._view.oit,o=i.shadowState.lightShadowMaps,l=i.shadowState.lightShadowsEnabled,u=t.derivedCommands;Object(s.default)(t.pickId)&&(u.picking=od.createPickDerivedCommand(e,t,n,u.picking)),t.pickOnly||(u.depth=od.createDepthOnlyDerivedCommand(e,t,n,u.depth)),u.originalCommand=t,e._hdr&&(u.hdr=od.createHdrCommand(t,n,u.hdr),u=(t=u.hdr.command).derivedCommands),l&&t.receiveShadows&&(u.shadows=mh.createReceiveDerivedCommand(o,t,a,n,u.shadows)),t.pass===de.a.TRANSLUCENT&&Object(s.default)(r)&&r.isSupported()&&(l&&t.receiveShadows?(u.oit=Object(s.default)(u.oit)?u.oit:{},u.oit.shadows=r.createDerivedCommands(u.shadows.receiveCommand,n,u.oit.shadows)):u.oit=r.createDerivedCommands(t,n,u.oit))}Object.defineProperties(ay.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return le.a.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return le.a.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return Sc.a.isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,function(e,t){for(var a=0;a<e._removeGlobeCallbacks.length;++a)e._removeGlobeCallbacks[a]();e._removeGlobeCallbacks.length=0;var i=[];Object(s.default)(t)&&(i.push(t.imageryLayersUpdatedEvent.addEventListener(ty(e))),i.push(t.terrainProviderChanged.addEventListener(ty(e)))),e._removeGlobeCallbacks=i}(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(Object(s.default)(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(Object(s.default)(this.globe))return this.globe.terrainProvider},set:function(e){Object(s.default)(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(Object(s.default)(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===V.a.SCENE2D?this.morphTo2D(0):e===V.a.SCENE3D?this.morphTo3D(0):e===V.a.COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},useWebVR:{get:function(){return this._useWebVR},set:function(e){this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new $l(this),Object(s.default)(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new cd(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(e){this._frameState.imagerySplitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){var t=this._context,a=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=a!==this._hdr,this._hdr=a}},highDynamicRangeSupported:{get:function(){var e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return.9999}},globeHeight:{get:function(){return this._globeHeight}}}),ay.prototype.getCompressedTextureFormatSupported=function(e){var t=this.context;return("WEBGL_compressed_texture_s3tc"===e||"s3tc"===e)&&t.s3tc||("WEBGL_compressed_texture_pvrtc"===e||"pvrtc"===e)&&t.pvrtc||("WEBGL_compressed_texture_etc1"===e||"etc1"===e)&&t.etc1},ay.prototype.updateDerivedCommands=function(e){if(Object(s.default)(e.derivedCommands)){var t=this._frameState,a=this._context,i=!1,n=t.shadowState.lastDirtyTime;e.lastDirtyTime!==n&&(e.lastDirtyTime=n,e.dirty=!0,i=!0);var r=t.useLogDepth,o=this._hdr,l=e.derivedCommands,u=Object(s.default)(l.logDepth),d=Object(s.default)(l.hdr),c=Object(s.default)(l.originalCommand),f=r&&!u,h=o&&!d,m=!(r&&o||c);if(e.dirty=e.dirty||f||h||m,e.dirty){e.dirty=!1;var p=t.shadowState.shadowMaps;t.shadowState.shadowsEnabled&&e.castShadows&&(l.shadows=mh.createCastDerivedCommand(p,e,i,a,l.shadows)),(u||f)&&(l.logDepth=od.createLogDepthCommand(e,a,l.logDepth),iy(this,l.logDepth.command,i)),(c||m)&&iy(this,e,i)}}};var ny,ry=new tu({pass:eu.a.RENDER}),oy=new tu({pass:eu.a.PRELOAD}),sy=new tu({pass:eu.a.PRELOAD_FLIGHT}),ly=new tu({pass:eu.a.REQUEST_RENDER_MODE_DEFER_CHECK}),uy=new v.default;function dy(e,t,a){var i=e._frameState;i.frameNumber=t,i.time=ci.default.clone(a,i.time)}ay.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1},ay.prototype.updateFrameState=function(){var e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=function(e){var t=e.globe;if(e._mode===V.a.SCENE3D&&Object(s.default)(t)&&t.show&&!e._cameraUnderground&&!e._globeTranslucencyState.translucent){var a=t.ellipsoid,i=e.frameState.minimumTerrainHeight;return uy.radius=a.minimumRadius+i,ny=Nr.fromBoundingSphere(uy,e.camera.positionWC,ny)}}(this),t.terrainExaggeration=this._terrainExaggeration,t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof te.a||this.camera.frustum instanceof ba.a),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState,Object(s.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=b.default.clone(this.invertClassificationColor,this._actualInvertClassificationColor),xc.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,Object(s.default)(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0},ay.prototype.isVisible=function(e,t,a){return Object(s.default)(e)&&(!Object(s.default)(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==K.default.OUTSIDE&&(!Object(s.default)(a)||!e.occlude||!e.boundingVolume.isOccluded(a)))};var cy=new $.default(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);function fy(e,t,a,i,r){var o=t._frameState;if(!Object(s.default)(t.debugCommandFilter)||t.debugCommandFilter(e))if(e instanceof Br.a)e.execute(a,i);else{e.debugShowBoundingVolume&&Object(s.default)(e.boundingVolume)&&function(e,t,a,i){var r,o=t._frameState,l=o.context,u=e.boundingVolume;Object(s.default)(t._debugVolume)&&t._debugVolume.destroy();var d=n.default.clone(u.center);if(o.mode!==V.a.SCENE3D){d=$.default.multiplyByPoint(cy,d,d);var c=o.mapProjection,f=c.unproject(d);d=c.ellipsoid.cartographicToCartesian(f)}if(Object(s.default)(u.radius)){var h=u.radius;r=q.a.toWireframe(pr.a.createGeometry(new pr.a({radii:new n.default(h,h,h),vertexFormat:je.a.FLAT_VERTEX_FORMAT}))),t._debugVolume=new Ve.a({geometryInstances:new Q.a({geometry:r,modelMatrix:$.default.fromTranslation(d),attributes:{color:new Y.a(1,0,0,1)}}),appearance:new je.a({flat:!0,translucent:!1}),asynchronous:!1})}else{var m=u.halfAxes;r=q.a.toWireframe(Zn.a.createGeometry(Zn.a.fromDimensions({dimensions:new n.default(2,2,2),vertexFormat:je.a.FLAT_VERTEX_FORMAT}))),t._debugVolume=new Ve.a({geometryInstances:new Q.a({geometry:r,modelMatrix:$.default.fromRotationTranslation(m,d,new $.default),attributes:{color:new Y.a(1,0,0,1)}}),appearance:new je.a({flat:!0,translucent:!1}),asynchronous:!1})}var p,_=o.commandList,g=o.commandList=[];t._debugVolume.update(o),e=g[0],o.useLogDepth&&(e=od.createLogDepthCommand(e,l).command),Object(s.default)(i)&&(p=a.framebuffer,a.framebuffer=i),e.execute(l,a),Object(s.default)(p)&&(a.framebuffer=p),o.commandList=_}(e,t,i,r),o.useLogDepth&&Object(s.default)(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);var l=o.passes;if(!l.pick&&!l.depth&&t._hdr&&Object(s.default)(e.derivedCommands)&&Object(s.default)(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),l.pick||l.depth){if(l.pick&&!l.depth&&Object(s.default)(e.derivedCommands.picking))return void(e=e.derivedCommands.picking.pickCommand).execute(a,i);if(Object(s.default)(e.derivedCommands.depth))return void(e=e.derivedCommands.depth.depthOnlyCommand).execute(a,i)}t.debugShowCommands||t.debugShowFrustums?t._debugInspector.executeDebugShowFrustumsCommand(t,e,i):o.shadowState.lightShadowsEnabled&&e.receiveShadows&&Object(s.default)(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(a,i):e.execute(a,i)}}function hy(e,t,a,i){var n=t._frameState,r=e.derivedCommands;Object(s.default)(r)&&(n.useLogDepth&&Object(s.default)(r.logDepth)&&(e=r.logDepth.command),r=e.derivedCommands,Object(s.default)(r.picking)?(e=r.picking.pickCommand).execute(a,i):Object(s.default)(r.depth)&&(e=r.depth.depthOnlyCommand).execute(a,i))}function my(e,t,a){return t.boundingVolume.distanceSquaredTo(a)-e.boundingVolume.distanceSquaredTo(a)}function py(e,t,a){return e.boundingVolume.distanceSquaredTo(a)-t.boundingVolume.distanceSquaredTo(a)+J.default.EPSILON12}function _y(e,t,a,i,n){var r=e.context;br(i,my,e.camera.positionWC),Object(s.default)(n)&&t(n.unclassifiedCommand,e,r,a);for(var o=i.length,l=0;l<o;++l)t(i[l],e,r,a)}function gy(e,t,a,i,n){var r=e.context;br(i,py,e.camera.positionWC),Object(s.default)(n)&&t(n.unclassifiedCommand,e,r,a);for(var o=i.length,l=0;l<o;++l)t(i[l],e,r,a)}function vy(e,t){var a=e._view.debugGlobeDepths,i=a[t];return!Object(s.default)(i)&&e.context.depthTexture&&(i=new Nd,a[t]=i),i}cy=$.default.inverseTransformation(cy,cy);var yy=new Lr.a,by=new jr.a,wy=new te.a,Cy=new ba.a;function Oy(e,t){var a,i=e.camera,n=e.context,r=e.frameState,o=n.uniformState;o.updateCamera(i),(a=Object(s.default)(i.frustum.fov)?i.frustum.clone(yy):Object(s.default)(i.frustum.infiniteProjectionMatrix)?i.frustum.clone(by):Object(s.default)(i.frustum.width)?i.frustum.clone(wy):i.frustum.clone(Cy)).near=i.frustum.near,a.far=i.frustum.far,o.updateFrustum(a),o.updatePass(de.a.ENVIRONMENT);var l,u=r.passes,d=u.pick,c=e._environmentState,f=e._view,h=c.renderTranslucentDepthForPick,m=c.useWebVR;if(!d){var p,_=c.skyBoxCommand;if(Object(s.default)(_)&&fy(_,e,n,t),c.isSkyAtmosphereVisible&&fy(c.skyAtmosphereCommand,e,n,t),c.isSunVisible)if(c.sunDrawCommand.execute(n,t),e.sunBloom&&!m)p=c.useGlobeDepthFramebuffer?f.globeDepth.framebuffer:c.usePostProcess?f.sceneFramebuffer.getFramebuffer():c.originalFramebuffer,e._sunPostProcess.execute(n),e._sunPostProcess.copy(n,p),t.framebuffer=p;c.isMoonVisible&&c.moonCommand.execute(n,t)}c.useOIT?(Object(s.default)(e._executeOITFunction)||(e._executeOITFunction=function(e,t,a,i,n){f.oit.executeCommands(e,t,a,i,n)}),l=e._executeOITFunction):l=u.render?_y:gy;for(var g,v=f.frustumCommandsList,y=v.length,b=c.clearGlobeDepth,w=c.useDepthPlane,C=e._globeTranslucencyState,O=C.translucent,x=e._view.globeTranslucencyFramebuffer,T=c.separatePrimitiveFramebuffer=!1,E=e._depthClearCommand,A=e._stencilClearCommand,P=e._classificationStencilClearCommand,S=e._depthPlane,D=c.usePostProcessSelected,F=i.position.z,M=0;M<y;++M){var I=y-M-1,R=v[I];e.mode===V.a.SCENE2D?(i.position.z=F-R.near+1,a.far=Math.max(1,R.far-R.near),a.near=1,o.update(r),o.updateFrustum(a)):(a.near=0!==I?R.near*e.opaqueFrustumNearOffset:R.near,a.far=R.far,o.updateFrustum(a));var N,L=e.debugShowGlobeDepth?vy(e,I):f.globeDepth;T&&(t.framebuffer=L.framebuffer),e.debugShowGlobeDepth&&Object(s.default)(L)&&c.useGlobeDepthFramebuffer&&(L.update(n,t,f.viewport,e._hdr,b),L.clear(n,t,e._clearColorCommand.color),N=t.framebuffer,t.framebuffer=L.framebuffer),E.execute(n,t),n.stencilBuffer&&A.execute(n,t),o.updatePass(de.a.GLOBE);var j,U=R.commands[de.a.GLOBE],B=R.indices[de.a.GLOBE];if(O)C.executeGlobeCommands(R,fy,x,e,t);else for(g=0;g<B;++g)fy(U[g],e,n,t);if(Object(s.default)(L)&&c.useGlobeDepthFramebuffer&&L.executeCopyDepth(n,t),e.debugShowGlobeDepth&&Object(s.default)(L)&&c.useGlobeDepthFramebuffer&&(t.framebuffer=N),!c.renderTranslucentDepthForPick)if(o.updatePass(de.a.TERRAIN_CLASSIFICATION),U=R.commands[de.a.TERRAIN_CLASSIFICATION],B=R.indices[de.a.TERRAIN_CLASSIFICATION],O)C.executeGlobeClassificationCommands(R,fy,x,e,t);else for(g=0;g<B;++g)fy(U[g],e,n,t);if(b&&(E.execute(n,t),w&&S.execute(n,t)),T&&(t.framebuffer=L.primitiveFramebuffer),!c.useInvertClassification||d||c.renderTranslucentDepthForPick){for(o.updatePass(de.a.CESIUM_3D_TILE),U=R.commands[de.a.CESIUM_3D_TILE],B=R.indices[de.a.CESIUM_3D_TILE],g=0;g<B;++g)fy(U[g],e,n,t);if(B>0&&(Object(s.default)(L)&&c.useGlobeDepthFramebuffer&&L.executeUpdateDepth(n,t,b),!c.renderTranslucentDepthForPick))for(o.updatePass(de.a.CESIUM_3D_TILE_CLASSIFICATION),U=R.commands[de.a.CESIUM_3D_TILE_CLASSIFICATION],B=R.indices[de.a.CESIUM_3D_TILE_CLASSIFICATION],g=0;g<B;++g)fy(U[g],e,n,t)}else{e._invertClassification.clear(n,t);var z=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo,o.updatePass(de.a.CESIUM_3D_TILE),U=R.commands[de.a.CESIUM_3D_TILE],B=R.indices[de.a.CESIUM_3D_TILE],g=0;g<B;++g)fy(U[g],e,n,t);for(Object(s.default)(L)&&c.useGlobeDepthFramebuffer&&L.executeUpdateDepth(n,t,b),o.updatePass(de.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),U=R.commands[de.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],B=R.indices[de.a.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],g=0;g<B;++g)fy(U[g],e,n,t);for(t.framebuffer=z,e._invertClassification.executeClassified(n,t),1===r.invertClassificationColor.alpha&&e._invertClassification.executeUnclassified(n,t),B>0&&n.stencilBuffer&&P.execute(n,t),o.updatePass(de.a.CESIUM_3D_TILE_CLASSIFICATION),U=R.commands[de.a.CESIUM_3D_TILE_CLASSIFICATION],B=R.indices[de.a.CESIUM_3D_TILE_CLASSIFICATION],g=0;g<B;++g)fy(U[g],e,n,t)}for(B>0&&n.stencilBuffer&&A.execute(n,t),o.updatePass(de.a.OPAQUE),U=R.commands[de.a.OPAQUE],B=R.indices[de.a.OPAQUE],g=0;g<B;++g)fy(U[g],e,n,t);if(0!==I&&e.mode!==V.a.SCENE2D&&(a.near=R.near,o.updateFrustum(a)),!d&&c.useInvertClassification&&r.invertClassificationColor.alpha<1&&(j=e._invertClassification),o.updatePass(de.a.TRANSLUCENT),(U=R.commands[de.a.TRANSLUCENT]).length=R.indices[de.a.TRANSLUCENT],l(e,fy,t,U,j),n.depthTexture&&e.useDepthPicking&&(c.useGlobeDepthFramebuffer||h)){var H=h?t.framebuffer.depthStencilTexture:L.framebuffer.depthStencilTexture,k=e._picking.getPickDepth(e,I);k.update(n,H),k.executeCopyDepth(n,t)}if(T&&(t.framebuffer=L.framebuffer),!d&&D){var G=t.framebuffer;if(t.framebuffer=f.sceneFramebuffer.getIdFramebuffer(),a.near=0!==I?R.near*e.opaqueFrustumNearOffset:R.near,a.far=R.far,o.updateFrustum(a),o.updatePass(de.a.GLOBE),U=R.commands[de.a.GLOBE],B=R.indices[de.a.GLOBE],O)C.executeGlobeCommands(R,hy,x,e,t);else for(g=0;g<B;++g)hy(U[g],e,n,t);for(b&&(E.framebuffer=t.framebuffer,E.execute(n,t),E.framebuffer=void 0),b&&w&&S.execute(n,t),o.updatePass(de.a.CESIUM_3D_TILE),U=R.commands[de.a.CESIUM_3D_TILE],B=R.indices[de.a.CESIUM_3D_TILE],g=0;g<B;++g)hy(U[g],e,n,t);for(o.updatePass(de.a.OPAQUE),U=R.commands[de.a.OPAQUE],B=R.indices[de.a.OPAQUE],g=0;g<B;++g)hy(U[g],e,n,t);for(o.updatePass(de.a.TRANSLUCENT),U=R.commands[de.a.TRANSLUCENT],B=R.indices[de.a.TRANSLUCENT],g=0;g<B;++g)hy(U[g],e,n,t);t.framebuffer=G}}}function xy(e){e.context.uniformState.updatePass(de.a.COMPUTE);var t=e._environmentState.sunComputeCommand;Object(s.default)(t)&&t.execute(e._computeEngine);for(var a=e._computeCommandList,i=a.length,n=0;n<i;++n)a[n].execute(e._computeEngine)}function Ty(e,t,a){for(var i=a.shadowMapCullingVolume,n=a.isPointLight,r=a.passes,o=r.length,s=t.length,l=0;l<s;++l){var u=t[l];if(e.updateDerivedCommands(u),u.castShadows&&(u.pass===de.a.GLOBE||u.pass===de.a.CESIUM_3D_TILE||u.pass===de.a.OPAQUE||u.pass===de.a.TRANSLUCENT)&&e.isVisible(u,i))if(n)for(var d=0;d<o;++d)r[d].commandList.push(u);else if(1===o)r[0].commandList.push(u);else for(var c=!1,f=o-1;f>=0;--f){var h=r[f].cullingVolume;if(e.isVisible(u,h))r[f].commandList.push(u),c=!0;else if(c)break}}}function Ey(e){var t=e.frameState,a=t.shadowState.shadowMaps,i=a.length;if(t.shadowState.shadowsEnabled)for(var n=e.context,r=n.uniformState,o=0;o<i;++o){var s=a[o];if(!s.outOfView){var l,u=s.passes,d=u.length;for(l=0;l<d;++l)u[l].commandList.length=0;for(Ty(e,e.frameState.commandList,s),l=0;l<d;++l){var c=s.passes[l];r.updateCamera(c.camera),s.updatePass(n,l);for(var f=c.commandList.length,h=0;h<f;++h){var m=c.commandList[h];r.updatePass(m.pass),fy(m.derivedCommands.shadows.castCommands[o],e,n,c.passState)}}}}}var Ay=new n.default;ay.prototype.updateAndExecuteCommands=function(e,t){var a=this._frameState.mode;this._environmentState.useWebVR?function(e,t,a){var i=e._view,r=i.camera,s=e._environmentState.renderTranslucentDepthForPick;Uy(e,t,a),s||Vy(e);i.createPotentiallyVisibleSet(e),s||(xy(e),Ey(e));var l=t.viewport;l.x=0,l.y=0,l.width=.5*l.width;var u=$l.clone(r,e._cameraVR);u.frustum=r.frustum;var d=r.frustum.near,c=d*Object(o.default)(e.focalLength,5),f=Object(o.default)(e.eyeSeparation,c/30),h=n.default.multiplyByScalar(u.right,.5*f,Ay);r.frustum.aspectRatio=l.width/l.height;var m=.5*f*d/c;n.default.add(u.position,h,r.position),r.frustum.xOffset=m,Oy(e,t),l.x=l.width,n.default.subtract(u.position,h,r.position),r.frustum.xOffset=-m,Oy(e,t),$l.clone(u,r)}(this,e,t):a!==V.a.SCENE2D||this._mapMode2D===Yo.ROTATE?Ly(!0,this,e,t):(Uy(this,e,t),function(e,t){var a=e.context,i=e.frameState,r=e.camera,o=t.viewport,s=fr.default.clone(o,Ny);t.viewport=s;var l=Py,u=Sy;e.mapProjection.project(l,u);var d=n.default.clone(r.position,Dy),c=$.default.clone(r.transform,My),f=r.frustum.clone();r._setTransform($.default.IDENTITY);var h=$.default.computeViewportTransformation(s,0,1,Fy),m=r.frustum.projectionMatrix,p=r.positionWC.y,_=n.default.fromElements(J.default.sign(p)*u.x-p,0,-r.positionWC.x,Iy),g=qn.default.pointToGLWindowCoordinates(m,h,_,Ry);g.x=Math.floor(g.x);var v=s.x,y=s.width;if(0===p||g.x<=v||g.x>=v+y)Ly(!0,e,t);else if(Math.abs(v+.5*y-g.x)<1)s.width=g.x-s.x,r.position.x*=J.default.sign(r.position.x),r.frustum.right=0,i.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),a.uniformState.update(i),Ly(!0,e,t),s.x=g.x,r.position.x=-r.position.x,r.frustum.right=-r.frustum.left,r.frustum.left=0,i.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),a.uniformState.update(i),Ly(!1,e,t);else if(g.x>v+.5*y){s.width=g.x-v;var b=r.frustum.right;r.frustum.right=u.x-p,i.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),a.uniformState.update(i),Ly(!0,e,t),s.x=g.x,s.width=v+y-g.x,r.position.x=-r.position.x,r.frustum.left=-r.frustum.right,r.frustum.right=b-2*r.frustum.right,i.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),a.uniformState.update(i),Ly(!1,e,t)}else{s.x=g.x,s.width=v+y-g.x;var w=r.frustum.left;r.frustum.left=-u.x-p,i.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),a.uniformState.update(i),Ly(!0,e,t),s.x=v,s.width=g.x-v,r.position.x=-r.position.x,r.frustum.right=-r.frustum.left,r.frustum.left=w-2*r.frustum.left,i.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),a.uniformState.update(i),Ly(!1,e,t)}r._setTransform(c),n.default.clone(d,r.position),r.frustum=f.clone(),t.viewport=o}(this,e))};var Py=new y.default(Math.PI,J.default.PI_OVER_TWO),Sy=new n.default,Dy=new n.default,Fy=new $.default,My=new $.default,Iy=new n.default,Ry=new n.default,Ny=new fr.default;function Ly(e,t,a,i){var n=t._environmentState,r=t._view,o=n.renderTranslucentDepthForPick;e||o||(t.frameState.commandList.length=0),o||Vy(t),r.createPotentiallyVisibleSet(t),e&&(Object(s.default)(i)&&Uy(t,a,i),o||(xy(t),Ey(t))),Oy(t,a)}var jy=new mr.a;function Vy(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),function(e){var t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new Wu({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),Object(s.default)(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}(e),function(e){var t=e._frameState,a=t.shadowMaps,i=a.length,n=i>0&&!t.passes.pick&&e.mode===V.a.SCENE3D;if(n!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=n),t.shadowState.lightShadowsEnabled=!1,n){for(var r=0;r<i;++r)if(a[r]!==t.shadowState.shadowMaps[r]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(var o=0;o<i;++o){var s=a[o];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}(e),e._globe&&e._globe.render(t)}function Uy(e,t,a){var i=e._context,n=e._frameState,r=e._environmentState,o=e._view,l=e._frameState.passes.pick,u=r.useWebVR;r.originalFramebuffer=t.framebuffer,Object(s.default)(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!u?e._sunPostProcess=new Zv:Object(s.default)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!Object(s.default)(e.sun)&&Object(s.default)(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);var d=e._clearColorCommand;b.default.clone(a,d.color),d.execute(i,t);var c=r.useGlobeDepthFramebuffer=Object(s.default)(o.globeDepth);c&&(o.globeDepth.update(i,t,o.viewport,e._hdr,r.clearGlobeDepth),o.globeDepth.clear(i,t,a));var f=o.oit,h=r.useOIT=!l&&Object(s.default)(f)&&f.isSupported();h&&(f.update(i,t,o.globeDepth.framebuffer,e._hdr),f.clear(i,t,a),r.useOIT=f.isSupported());var m,p=e.postProcessStages,_=r.usePostProcess=!l&&(e._hdr||p.length>0||p.ambientOcclusion.enabled||p.fxaa.enabled||p.bloom.enabled);if(r.usePostProcessSelected=!1,_&&(o.sceneFramebuffer.update(i,o.viewport,e._hdr),o.sceneFramebuffer.clear(i,t,a),p.update(i,n.useLogDepth,e._hdr),p.clear(i),_=r.usePostProcess=p.ready,r.usePostProcessSelected=_&&p.hasSelected),r.isSunVisible&&e.sunBloom&&!u?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(i,t,a)):c?t.framebuffer=o.globeDepth.framebuffer:_&&(t.framebuffer=o.sceneFramebuffer.getFramebuffer()),Object(s.default)(t.framebuffer)&&d.execute(i,t),r.useInvertClassification=!l&&Object(s.default)(t.framebuffer)&&e.invertClassification)if(1===e.frameState.invertClassificationColor.alpha&&r.useGlobeDepthFramebuffer&&(m=o.globeDepth.framebuffer),Object(s.default)(m)||i.depthTexture){if(e._invertClassification.previousFramebuffer=m,e._invertClassification.update(i),e._invertClassification.clear(i,t),e.frameState.invertClassificationColor.alpha<1&&h){var g=e._invertClassification.unclassifiedCommand,v=g.derivedCommands;v.oit=f.createDerivedCommands(g,i,v.oit)}}else r.useInvertClassification=!1;e._globeTranslucencyState.translucent&&o.globeTranslucencyFramebuffer.updateAndClear(e._hdr,o.viewport,i,t)}function By(e){e._jobScheduler.resetBudgets();var t=e._frameState;e.primitives.prePassesUpdate(t),Object(s.default)(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function zy(e){var t=e._frameState;e.primitives.postPassesUpdate(t),Vr.a.update()}ay.prototype.updateEnvironment=function(){var e=this._frameState,t=this._view,a=this._environmentState,i=e.passes.render,n=e.passes.offscreen,r=this.skyAtmosphere,o=this.globe,l=this._globeTranslucencyState;if(!i||this._mode!==V.a.SCENE2D&&t.camera.frustum instanceof te.a||!l.environmentVisible)a.skyAtmosphereCommand=void 0,a.skyBoxCommand=void 0,a.sunDrawCommand=void 0,a.sunComputeCommand=void 0,a.moonCommand=void 0;else{Object(s.default)(r)?(Object(s.default)(o)&&(r.setDynamicAtmosphereColor(o.enableLighting&&o.dynamicAtmosphereLighting,o.dynamicAtmosphereLightingFromSun),a.isReadyForAtmosphere=a.isReadyForAtmosphere||o._surface._tilesToRender.length>0),a.skyAtmosphereCommand=r.update(e,o),Object(s.default)(a.skyAtmosphereCommand)&&this.updateDerivedCommands(a.skyAtmosphereCommand)):a.skyAtmosphereCommand=void 0,a.skyBoxCommand=Object(s.default)(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;var u=Object(s.default)(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;a.sunDrawCommand=Object(s.default)(u)?u.drawCommand:void 0,a.sunComputeCommand=Object(s.default)(u)?u.computeCommand:void 0,a.moonCommand=Object(s.default)(this.moon)?this.moon.update(e):void 0}var d=a.clearGlobeDepth=Object(s.default)(o)&&o.show&&(!o.depthTestAgainstTerrain||this.mode===V.a.SCENE2D);(a.useDepthPlane=d&&this.mode===V.a.SCENE3D&&l.useDepthPlane)&&this._depthPlane.update(e),a.renderTranslucentDepthForPick=!1,a.useWebVR=this._useWebVR&&this.mode!==V.a.SCENE2D&&!n;for(var c=e.mode!==V.a.SCENE3D||l.sunVisibleThroughGlobe?void 0:e.occluder,f=e.cullingVolume,h=jy.planes,m=0;m<5;++m)h[m]=f.planes[m];f=jy,a.isSkyAtmosphereVisible=Object(s.default)(a.skyAtmosphereCommand)&&a.isReadyForAtmosphere,a.isSunVisible=this.isVisible(a.sunDrawCommand,f,c),a.isMoonVisible=this.isVisible(a.moonCommand,f,c);var p=this.specularEnvironmentMaps,_=this._specularEnvironmentMapAtlas;!Object(s.default)(p)||Object(s.default)(_)&&_.url===p?!Object(s.default)(p)&&Object(s.default)(_)&&(_.destroy(),this._specularEnvironmentMapAtlas=void 0):(_=_&&_.destroy(),this._specularEnvironmentMapAtlas=new Sc.a(p)),Object(s.default)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)},ay.prototype.resolveFramebuffers=function(e){var t=this._context,a=this._frameState,i=this._environmentState,n=this._view,r=n.globeDepth,s=i.useOIT,l=i.useGlobeDepthFramebuffer,u=i.usePostProcess,d=i.originalFramebuffer,c=l?r.framebuffer:void 0,f=n.sceneFramebuffer.getFramebuffer(),h=n.sceneFramebuffer.getIdFramebuffer();if(i.separatePrimitiveFramebuffer&&r.executeMergeColor(t,e),s&&(e.framebuffer=u?f:d,n.oit.execute(t,e)),u){var m=f;l&&!s&&(m=c);var p=this.postProcessStages,_=m.getColorTexture(0),g=h.getColorTexture(0),v=Object(o.default)(c,f).depthStencilTexture;p.execute(t,_,v,g),p.copy(t,d)}s||u||!l||(e.framebuffer=d,r.executeCopyColor(t,e));var y=a.useLogDepth;this.debugShowGlobeDepth&&l&&vy(this,this.debugShowDepthFrustum-1).executeDebugGlobeDepth(t,e,y);this.debugShowPickDepth&&l&&this._picking.getPickDepth(this,this.debugShowDepthFrustum-1).executeDebugPickDepth(t,e,y)},ay.prototype.initializeFrame=function(){120==this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this._globeHeight=function(e){var t=e._globe,a=e.camera.positionCartographic;if(Object(s.default)(t)&&t.show&&Object(s.default)(a))return t.getHeight(a)}(this),this._cameraUnderground=function(e){var t=e.camera,a=e._mode,i=e.globe,n=e._screenSpaceCameraController,r=t.positionCartographic;if(!Object(s.default)(r))return!1;if(!n.onMap()&&r.height<0)return!0;if(!Object(s.default)(i)||!i.show||a===V.a.SCENE2D||a===V.a.MORPHING)return!1;var o=e._globeHeight;return Object(s.default)(o)&&r.height<o}(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),Object(s.default)(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};var Hy=new b.default;function ky(e){var t=e._frameState,a=e.context,i=a.uniformState,r=e._defaultView;e._view=r,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=ry;var l=Object(o.default)(e.backgroundColor,b.default.BLACK);e._hdr&&((l=b.default.clone(l,Hy)).red=Math.pow(l.red,e.gamma),l.green=Math.pow(l.green,e.gamma),l.blue=Math.pow(l.blue,e.gamma)),t.backgroundColor=l,e.fog.update(t),i.update(t);var u=e.shadowMap;Object(s.default)(u)&&u.enabled&&(!Object(s.default)(e.light)||e.light instanceof oo?n.default.negate(i.sunDirectionWC,e._shadowMapCamera.direction):n.default.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(u)),e._computeCommandList.length=0,e._overlayCommandList.length=0;var d=r.viewport;d.x=0,d.y=0,d.width=a.drawingBufferWidth,d.height=a.drawingBufferHeight;var c=r.passState;c.framebuffer=void 0,c.blendingEnabled=void 0,c.scissorTest=void 0,c.viewport=fr.default.clone(d,c.viewport),Object(s.default)(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(c,l),e.resolveFramebuffers(c),c.framebuffer=void 0,function(e,t){e.context.uniformState.updatePass(de.a.OVERLAY);for(var a=e.context,i=e._overlayCommandList,n=i.length,r=0;r<n;++r)i[r].execute(a,t)}(e,c),Object(s.default)(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),a.endFrame()}function Gy(e,t){try{t(e)}catch(t){if(e._renderError.raiseEvent(e,t),e.rethrowRenderErrors)throw t}}function Wy(e){return e._picking.updateMostDetailedRayPicks(e)}function Yy(e){var t=e._frameState;oy.camera=t.camera,oy.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,oy)}function Xy(e){var t=e._frameState;t.camera.canPreloadFlight()&&(sy.camera=e.preloadFlightCamera,sy.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,sy))}function Qy(e){e.primitives.updateForPass(e._frameState,ly)}ay.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);var t=this._frameState;t.newFrame=!1,Object(s.default)(e)||(e=ci.default.now());var a=this._view.checkForCameraUpdates(this),i=!this.requestRenderMode||this._renderRequested||a||this._logDepthBufferDirty||this._hdrDirty||this.mode===V.a.MORPHING;if(!i&&Object(s.default)(this.maximumRenderTimeChange)&&Object(s.default)(this._lastRenderTime)){var n=Math.abs(ci.default.secondsDifference(this._lastRenderTime,e));i=i||n>this.maximumRenderTimeChange}i&&(this._lastRenderTime=ci.default.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1,dy(this,J.default.incrementWrap(t.frameNumber,15e6,1),e),t.newFrame=!0);Gy(this,By),this.primitives.show&&(Gy(this,Wy),Gy(this,Yy),Gy(this,Xy),i||Gy(this,Qy)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),Gy(this,ky)),function(e,t){if(e.debugShowFramesPerSecond){if(!Object(s.default)(e._performanceDisplay)){var a=document.createElement("div");a.className="cesium-performanceDisplay-defaultContainer",e._canvas.parentNode.appendChild(a);var i=new Mc({container:a});e._performanceDisplay=i,e._performanceContainer=a}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else Object(s.default)(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}(this,i),Gy(this,zy),function(e){for(var t=e._frameState.afterRender,a=0,i=t.length;a<i;++a)t[a](),e.requestRender();t.length=0}(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())},ay.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)},ay.prototype.requestRender=function(){this._renderRequested=!0},ay.prototype.clampLineWidth=function(e){return Math.max(le.a.minimumAliasedLineWidth,Math.min(e,le.a.maximumAliasedLineWidth))},ay.prototype.pick=function(e,t,a){return this._picking.pick(this,e,t,a)},ay.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)},ay.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)},ay.prototype.drillPick=function(e,t,a,i){return this._picking.drillPick(this,e,t,a,i)},ay.prototype.pickFromRay=function(e,t,a){return this._picking.pickFromRay(this,e,t,a)},ay.prototype.drillPickFromRay=function(e,t,a,i){return this._picking.drillPickFromRay(this,e,t,a,i)},ay.prototype.pickFromRayMostDetailed=function(e,t,a){return this._picking.pickFromRayMostDetailed(this,e,t,a)},ay.prototype.drillPickFromRayMostDetailed=function(e,t,a,i){return this._picking.drillPickFromRayMostDetailed(this,e,t,a,i)},ay.prototype.sampleHeight=function(e,t,a){return this._picking.sampleHeight(this,e,t,a)},ay.prototype.clampToHeight=function(e,t,a,i){return this._picking.clampToHeight(this,e,t,a,i)},ay.prototype.sampleHeightMostDetailed=function(e,t,a){return this._picking.sampleHeightMostDetailed(this,e,t,a)},ay.prototype.clampToHeightMostDetailed=function(e,t,a){return this._picking.clampToHeightMostDetailed(this,e,t,a)},ay.prototype.cartesianToCanvasCoordinates=function(e,t){return Gc.default.wgs84ToWindowCoordinates(this,e,t)},ay.prototype.completeMorph=function(){this._transitioner.completeMorph()},ay.prototype.morphTo2D=function(e){var t,a=this.globe;t=Object(s.default)(a)?a.ellipsoid:this.mapProjection.ellipsoid,e=Object(o.default)(e,2),this._transitioner.morphTo2D(e,t)},ay.prototype.morphToColumbusView=function(e){var t,a=this.globe;t=Object(s.default)(a)?a.ellipsoid:this.mapProjection.ellipsoid,e=Object(o.default)(e,2),this._transitioner.morphToColumbusView(e,t)},ay.prototype.morphTo3D=function(e){var t,a=this.globe;t=Object(s.default)(a)?a.ellipsoid:this.mapProjection.ellipsoid,e=Object(o.default)(e,2),this._transitioner.morphTo3D(e,t)},ay.prototype.isDestroyed=function(){return!1},ay.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),Object(s.default)(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(var e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,Object(l.default)(this)};var qy=ay,Zy="/**\n * @license\n * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * * Redistributions of source code must retain the above copyright notice,\n *   this list of conditions and the following disclaimer.\n * * Redistributions in binary form must reproduce the above copyright notice,\n *   this list of conditions and the following disclaimer in the documentation\n *   and/or other materials provided with the distribution.\n * * Neither the name of the project nor the names of its contributors may be\n *   used to endorse or promote products derived from this software without\n *   specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Modifications made by Cesium GS, Inc.\n */\n\n // Code:  http://sponeil.net/\n // GPU Gems 2 Article:  https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\n\nconst float Kr = 0.0025;\nconst float Kr4PI = Kr * 4.0 * czm_pi;\nconst float Km = 0.0015;\nconst float Km4PI = Km * 4.0 * czm_pi;\nconst float ESun = 15.0;\nconst float KmESun = Km * ESun;\nconst float KrESun = Kr * ESun;\nconst vec3 InvWavelength = vec3(\n    5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n    9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n    19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\nconst float rayleighScaleDepth = 0.25;\n\nconst int nSamples = 2;\nconst float fSamples = 2.0;\n\nconst float g = -0.95;\nconst float g2 = g * g;\n\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift; // Hue, saturation, brightness\n#endif\n\nuniform vec3 u_radiiAndDynamicAtmosphereColor; // outer radius, inner radius, dynamic atmosphere color flag\n\nfloat scale(float cosAngle)\n{\n    float x = 1.0 - cosAngle;\n    return rayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvec3 getLightDirection(vec3 positionWC)\n{\n    float lightEnum = u_radiiAndDynamicAtmosphereColor.z;\n    vec3 lightDirection =\n        positionWC * float(lightEnum == 0.0) +\n        czm_lightDirectionWC * float(lightEnum == 1.0) +\n        czm_sunDirectionWC * float(lightEnum == 2.0);\n    return normalize(lightDirection);\n}\n\nvoid calculateRayScatteringFromSpace(in vec3 positionWC, in vec3 ray, in float innerRadius, in float outerRadius, inout float far, out vec3 start, out float startOffset)\n{\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float cameraHeight = length(positionWC);\n    float B = 2.0 * dot(positionWC, ray);\n    float C = cameraHeight * cameraHeight - outerRadius * outerRadius;\n    float det = max(0.0, B * B - 4.0 * C);\n    float near = 0.5 * (-B - sqrt(det));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    start = positionWC + ray * near;\n    far -= near;\n    float startAngle = dot(ray, start) / outerRadius;\n    float startDepth = exp(-1.0 / rayleighScaleDepth);\n    startOffset = startDepth * scale(startAngle);\n}\n\nvoid calculateRayScatteringFromGround(in vec3 positionWC, in vec3 ray, in float atmosphereScale, in float innerRadius, out vec3 start, out float startOffset)\n{\n    // Calculate the ray's starting position, then calculate its scattering offset\n    float cameraHeight = length(positionWC);\n    start = positionWC;\n    float height = length(start);\n    float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - cameraHeight));\n    float startAngle = dot(ray, start) / height;\n    startOffset = depth*scale(startAngle);\n}\n\nczm_raySegment rayEllipsoidIntersection(czm_ray ray, vec3 inverseRadii)\n{\n    vec3 o = inverseRadii * (czm_inverseView * vec4(ray.origin, 1.0)).xyz;\n    vec3 d = inverseRadii * (czm_inverseView * vec4(ray.direction, 0.0)).xyz;\n\n    float a = dot(d, d);\n    float b = dot(d, o);\n    float c = dot(o, o) - 1.0;\n    float discriminant = b * b - a * c;\n    if (discriminant < 0.0)\n    {\n        return czm_emptyRaySegment;\n    }\n    discriminant = sqrt(discriminant);\n    float t1 = (-b - discriminant) / a;\n    float t2 = (-b + discriminant) / a;\n\n    if (t1 < 0.0 && t2 < 0.0)\n    {\n        return czm_emptyRaySegment;\n    }\n\n    if (t1 < 0.0 && t2 >= 0.0)\n    {\n        t1 = 0.0;\n    }\n\n    return czm_raySegment(t1, t2);\n}\n\nvec3 getAdjustedPosition(vec3 positionWC, float innerRadius)\n{\n  // Adjust the camera position so that atmosphere color looks the same wherever the eye height is the same\n  float cameraHeight = czm_eyeHeight + innerRadius;\n  return normalize(positionWC) * cameraHeight;\n}\n\nvec3 getTranslucentPosition(vec3 positionWC, vec3 outerPositionWC, float innerRadius, out bool intersectsEllipsoid)\n{\n    vec3 directionWC = normalize(outerPositionWC - positionWC);\n    vec3 directionEC = czm_viewRotation * directionWC;\n    czm_ray viewRay = czm_ray(vec3(0.0), directionEC);\n    czm_raySegment raySegment = rayEllipsoidIntersection(viewRay, czm_ellipsoidInverseRadii);\n    intersectsEllipsoid = raySegment.start >= 0.0;\n\n    if (intersectsEllipsoid)\n    {\n        return positionWC + raySegment.stop * directionWC;\n    }\n\n    return getAdjustedPosition(positionWC, innerRadius);\n}\n\nvoid calculateMieColorAndRayleighColor(vec3 outerPositionWC, out vec3 mieColor, out vec3 rayleighColor)\n{\n    // Unpack attributes\n    float outerRadius = u_radiiAndDynamicAtmosphereColor.x;\n    float innerRadius = u_radiiAndDynamicAtmosphereColor.y;\n\n#ifdef GLOBE_TRANSLUCENT\n    bool intersectsEllipsoid = false;\n    vec3 startPositionWC = getTranslucentPosition(czm_viewerPositionWC, outerPositionWC, innerRadius, intersectsEllipsoid);\n#else\n    vec3 startPositionWC = getAdjustedPosition(czm_viewerPositionWC, innerRadius);\n#endif\n\n    vec3 lightDirection = getLightDirection(startPositionWC);\n\n    // Get the ray from the start position to the outer position and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 ray = outerPositionWC - startPositionWC;\n    float far = length(ray);\n    ray /= far;\n\n    float atmosphereScale = 1.0 / (outerRadius - innerRadius);\n\n    vec3 start;\n    float startOffset;\n\n#ifdef SKY_FROM_SPACE\n#ifdef GLOBE_TRANSLUCENT\n    if (intersectsEllipsoid)\n    {\n        calculateRayScatteringFromGround(startPositionWC, ray, atmosphereScale, innerRadius, start, startOffset);\n    }\n    else\n    {\n        calculateRayScatteringFromSpace(startPositionWC, ray, innerRadius, outerRadius, far, start, startOffset);\n    }\n#else\n    calculateRayScatteringFromSpace(startPositionWC, ray, innerRadius, outerRadius, far, start, startOffset);\n#endif\n#else\n    calculateRayScatteringFromGround(startPositionWC, ray, atmosphereScale, innerRadius, start, startOffset);\n#endif\n\n    // Initialize the scattering loop variables\n    float sampleLength = far / fSamples;\n    float scaledLength = sampleLength * atmosphereScale;\n    vec3 sampleRay = ray * sampleLength;\n    vec3 samplePoint = start + sampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 frontColor = vec3(0.0, 0.0, 0.0);\n\n    for (int i = 0; i<nSamples; i++)\n    {\n        float height = length(samplePoint);\n        float depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - height));\n        float fLightAngle = dot(lightDirection, samplePoint) / height;\n        float fCameraAngle = dot(ray, samplePoint) / height;\n        float fScatter = (startOffset + depth*(scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n        frontColor += attenuate * (depth * scaledLength);\n        samplePoint += sampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    mieColor = frontColor * KmESun;\n    rayleighColor = frontColor * (InvWavelength * KrESun);\n\n    // Cap mie and rayleigh colors to prevent NaNs when vertex interpolation happens\n    mieColor = min(mieColor, vec3(10000000.0));\n    rayleighColor = min(rayleighColor, vec3(10000000.0));\n}\n\nvec4 calculateFinalColor(vec3 positionWC, vec3 toCamera, vec3 lightDirection, vec3 mieColor, vec3 rayleighColor)\n{\n    // Extra normalize added for Android\n    float cosAngle = dot(lightDirection, normalize(toCamera)) / length(toCamera);\n    float rayleighPhase = 0.75 * (1.0 + cosAngle * cosAngle);\n    float miePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cosAngle * cosAngle) / pow(1.0 + g2 - 2.0 * g * cosAngle, 1.5);\n\n    vec3 rgb = rayleighPhase * rayleighColor + miePhase * mieColor;\n\n    const float exposure = 2.0;\n    vec3 rgbExposure = vec3(1.0) - exp(-exposure * rgb);\n\n#ifndef HDR\n    rgb = rgbExposure;\n#endif\n\n#ifdef COLOR_CORRECT\n    // Convert rgb color to hsb\n    vec3 hsb = czm_RGBToHSB(rgb);\n    // Perform hsb shift\n    hsb.x += u_hsbShift.x; // hue\n    hsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0); // saturation\n    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0; // brightness\n    // Convert shifted hsb back to rgb\n    rgb = czm_HSBToRGB(hsb);\n#endif\n\n    float outerRadius = u_radiiAndDynamicAtmosphereColor.x;\n    float innerRadius = u_radiiAndDynamicAtmosphereColor.y;\n    float lightEnum = u_radiiAndDynamicAtmosphereColor.z;\n\n    float cameraHeight = czm_eyeHeight + innerRadius;\n\n    // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n    float atmosphereAlpha = clamp((outerRadius - cameraHeight) / (outerRadius - innerRadius), 0.0, 1.0);\n\n    // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n    float nightAlpha = (lightEnum != 0.0) ? clamp(dot(normalize(positionWC), lightDirection), 0.0, 1.0) : 1.0;\n    atmosphereAlpha *= pow(nightAlpha, 0.5);\n\n    vec4 finalColor = vec4(rgb, mix(clamp(rgbExposure.b, 0.0, 1.0), 1.0, atmosphereAlpha) * smoothstep(0.0, 1.0, czm_morphTime));\n\n    if (mieColor.b > 1.0)\n    {\n        // Fade atmosphere below the ellipsoid. As the camera zooms further away from the ellipsoid draw\n        // a larger atmosphere ring to cover empty space of lower LOD globe tiles.\n        float strength = mieColor.b;\n        float minDistance = outerRadius;\n        float maxDistance = outerRadius * 3.0;\n        float maxStrengthLerp = 1.0 - clamp((maxDistance - cameraHeight) / (maxDistance - minDistance), 0.0, 1.0);\n        float maxStrength = mix(100.0, 10000.0, maxStrengthLerp);\n        strength = min(strength, maxStrength);\n        float alpha = 1.0 - (strength / maxStrength);\n        finalColor.a = alpha;\n    }\n\n    return finalColor;\n}\n",Ky="varying vec3 v_outerPositionWC;\n\n#ifdef SPLIT_ATMOSPHERE\nuniform float u_splitDirection;\n#endif\n\n#ifndef PER_FRAGMENT_ATMOSPHERE\nvarying vec3 v_mieColor;\nvarying vec3 v_rayleighColor;\n#endif\n\nvoid main (void)\n{\n#ifdef SPLIT_ATMOSPHERE\n    float splitPosition = czm_imagerySplitPosition;\n    if (u_splitDirection < 0.0 && gl_FragCoord.x > splitPosition) {\n        discard;\n    } else if (u_splitDirection > 0.0 && gl_FragCoord.x < splitPosition) {\n        discard;\n    }\n#endif\n\n    vec3 toCamera = czm_viewerPositionWC - v_outerPositionWC;\n    vec3 lightDirection = getLightDirection(czm_viewerPositionWC);\n    vec3 mieColor;\n    vec3 rayleighColor;\n\n#ifdef PER_FRAGMENT_ATMOSPHERE\n    calculateMieColorAndRayleighColor(v_outerPositionWC, mieColor, rayleighColor);\n#else\n    mieColor = v_mieColor;\n    rayleighColor = v_rayleighColor;\n#endif\n\n    gl_FragColor = calculateFinalColor(czm_viewerPositionWC, toCamera, lightDirection, mieColor, rayleighColor);\n}\n",Jy="attribute vec4 position;\n\nvarying vec3 v_outerPositionWC;\n\n#ifndef PER_FRAGMENT_ATMOSPHERE\nvarying vec3 v_mieColor;\nvarying vec3 v_rayleighColor;\n#endif\n\nvoid main(void)\n{\n    vec4 positionWC = czm_model * position;\n\n#ifndef PER_FRAGMENT_ATMOSPHERE\n    calculateMieColorAndRayleighColor(positionWC.xyz, v_mieColor, v_rayleighColor);\n#endif\n    v_outerPositionWC = positionWC.xyz;\n    gl_Position = czm_modelViewProjection * position;\n}\n",$y=a(170);
/**
 * @license
 * Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * * Redistributions of source code must retain the above copyright notice,
 *   this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright notice,
 *   this list of conditions and the following disclaimer in the documentation
 *   and/or other materials provided with the distribution.
 * * Neither the name of the project nor the names of its contributors may be
 *   used to endorse or promote products derived from this software without
 *   specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Modifications made by Cesium GS, Inc.
 */function eb(e){e=Object(o.default)(e,d.default.WGS84),this.show=!0,this.perFragmentAtmosphere=!1,this._ellipsoid=e;var t=n.default.multiplyByScalar(e.radii,1.025,new n.default);this._scaleMatrix=$.default.fromScale(t),this._modelMatrix=new $.default,this._command=new ue.a({owner:this,modelMatrix:this._modelMatrix}),this._spSkyFromSpace=void 0,this._spSkyFromAtmosphere=void 0,this._flags=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.splitDirection=O.default.NONE,this._splitDirection=void 0,this._hueSaturationBrightness=new n.default;var a=new n.default;a.x=1.025*e.maximumRadius,a.y=e.maximumRadius,a.z=0,this._radiiAndDynamicAtmosphereColor=a;var i=this;this._command.uniformMap={u_radiiAndDynamicAtmosphereColor:function(){return i._radiiAndDynamicAtmosphereColor},u_hsbShift:function(){return i._hueSaturationBrightness.x=i.hueShift,i._hueSaturationBrightness.y=i.saturationShift,i._hueSaturationBrightness.z=i.brightnessShift,i._hueSaturationBrightness},u_splitDirection:function(){return i.splitDirection}}}Object.defineProperties(eb.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),eb.prototype.setDynamicAtmosphereColor=function(e,t){var a=e?t?2:1:0;this._radiiAndDynamicAtmosphereColor.z=a};var tb=new $.default;eb.prototype.update=function(e,t){if(this.show){var a=e.mode;if((a===V.a.SCENE3D||a===V.a.MORPHING)&&e.passes.render){var i=$.default.fromRotationTranslation(e.context.uniformState.inverseViewRotation,n.default.ZERO,tb),r=$.default.multiplyTransformation(i,$y.default.Y_UP_TO_Z_UP,tb),o=$.default.multiply(this._scaleMatrix,r,tb);$.default.clone(o,this._modelMatrix);var l,u=e.context,d=(l=this,!(J.default.equalsEpsilon(l.hueShift,0,J.default.EPSILON7)&&J.default.equalsEpsilon(l.saturationShift,0,J.default.EPSILON7)&&J.default.equalsEpsilon(l.brightnessShift,0,J.default.EPSILON7))),c=e.globeTranslucencyState.translucent,f=this.perFragmentAtmosphere||c||!Object(s.default)(t)||!t.show,h=this._command;if(!Object(s.default)(h.vertexArray)){var m=pr.a.createGeometry(new pr.a({radii:new n.default(1,1,1),slicePartitions:256,stackPartitions:256,vertexFormat:Kn.default.POSITION_ONLY}));h.vertexArray=fe.a.fromGeometry({context:u,geometry:m,attributeLocations:q.a.createAttributeLocations(m),bufferUsage:se.a.STATIC_DRAW}),h.renderState=ce.a.fromCache({cull:{enabled:!0,face:er.a.FRONT},blending:he.a.ALPHA_BLEND,depthMask:!1})}var p=0===this.splitDirection?0:this.splitDirection<0?1:2,_=d|f<<2|c<<3||p<<4;if(_!==this._flags){this._flags=_;var g=[];d&&g.push("COLOR_CORRECT"),f&&g.push("PER_FRAGMENT_ATMOSPHERE"),c&&g.push("GLOBE_TRANSLUCENT"),this.splitDirection!==O.default.NONE&&g.push("SPLIT_ATMOSPHERE");var v=new S.a({defines:g.concat("SKY_FROM_SPACE"),sources:[Zy,Jy]}),y=new S.a({defines:g.concat("SKY_FROM_SPACE"),sources:[Zy,Ky]});this._spSkyFromSpace=L.a.fromCache({context:u,vertexShaderSource:v,fragmentShaderSource:y}),v=new S.a({defines:g.concat("SKY_FROM_ATMOSPHERE"),sources:[Zy,Jy]}),y=new S.a({defines:g.concat("SKY_FROM_ATMOSPHERE"),sources:[Zy,Ky]}),this._spSkyFromAtmosphere=L.a.fromCache({context:u,vertexShaderSource:v,fragmentShaderSource:y})}var b=e.camera.positionWC;return n.default.magnitude(b)>this._radiiAndDynamicAtmosphereColor.x?h.shaderProgram=this._spSkyFromSpace:h.shaderProgram=this._spSkyFromAtmosphere,h}}},eb.prototype.isDestroyed=function(){return!1},eb.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),Object(l.default)(this)};var ab=eb;var ib=function(e,t){var a={flipY:!0,preferImageBitmap:!0},i=[P.default.createIfNeeded(t.positiveX).fetchImage(a),P.default.createIfNeeded(t.negativeX).fetchImage(a),P.default.createIfNeeded(t.positiveY).fetchImage(a),P.default.createIfNeeded(t.negativeY).fetchImage(a),P.default.createIfNeeded(t.positiveZ).fetchImage(a),P.default.createIfNeeded(t.negativeZ).fetchImage(a)];return R.default.all(i,(function(t){return new Jr.a({context:e,source:{positiveX:t[0],negativeX:t[1],positiveY:t[2],negativeY:t[3],positiveZ:t[4],negativeZ:t[5]}})}))};function nb(e){this.sources=e.sources,this._sources=void 0,this.show=Object(o.default)(e.show,!0),this._command=new ue.a({modelMatrix:$.default.clone($.default.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}nb.prototype.update=function(e,t){var a=this;if(this.show&&(e.mode===V.a.SCENE3D||e.mode===V.a.MORPHING)&&e.passes.render){var i=e.context;if(this._sources!==this.sources){this._sources=this.sources;var r=this.sources;"string"==typeof r.positiveX?ib(i,this._sources).then((function(e){a._cubeMap=a._cubeMap&&a._cubeMap.destroy(),a._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new Jr.a({context:i,source:r}))}var o=this._command;if(!Object(s.default)(o.vertexArray)){o.uniformMap={u_cubeMap:function(){return a._cubeMap}};var l=Zn.a.createGeometry(Zn.a.fromDimensions({dimensions:new n.default(2,2,2),vertexFormat:Kn.default.POSITION_ONLY})),u=this._attributeLocations=q.a.createAttributeLocations(l);o.vertexArray=fe.a.fromGeometry({context:i,geometry:l,attributeLocations:u,bufferUsage:se.a.STATIC_DRAW}),o.renderState=ce.a.fromCache({blending:he.a.ALPHA_BLEND})}if(!Object(s.default)(o.shaderProgram)||this._useHdr!==t){var d=new S.a({defines:[t?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n    gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n}\n"]});o.shaderProgram=L.a.fromCache({context:i,vertexShaderSource:"attribute vec3 position;\n\nvarying vec3 v_texCoord;\n\nvoid main()\n{\n    vec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n    gl_Position = czm_projection * vec4(p, 1.0);\n    v_texCoord = position.xyz;\n}\n",fragmentShaderSource:d,attributeLocations:this._attributeLocations}),this._useHdr=t}if(Object(s.default)(this._cubeMap))return o}},nb.prototype.isDestroyed=function(){return!1},nb.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),Object(l.default)(this)};var rb=nb,ob=a(425);function sb(){this.show=!0,this._drawCommand=new ue.a({primitiveType:ae.a.TRIANGLES,boundingVolume:new v.default,owner:this}),this._commands={drawCommand:this._drawCommand,computeCommand:void 0},this._boundingVolume=new v.default,this._boundingVolume2D=new v.default,this._texture=void 0,this._drawingBufferWidth=void 0,this._drawingBufferHeight=void 0,this._radiusTS=void 0,this._size=void 0,this.glowFactor=1,this._glowFactorDirty=!1,this._useHdr=void 0;var e=this;this._uniformMap={u_texture:function(){return e._texture},u_size:function(){return e._size}}}Object.defineProperties(sb.prototype,{glowFactor:{get:function(){return this._glowFactor},set:function(e){e=Math.max(e,0),this._glowFactor=e,this._glowFactorDirty=!0}}});var lb=new k.default,ub=new k.default,db=new G.a,cb=new G.a;sb.prototype.update=function(e,t,a){if(this.show){var i=e.mode;if(i!==V.a.SCENE2D&&i!==V.a.MORPHING&&e.passes.render){var r=e.context,o=t.viewport.width,l=t.viewport.height;if(!Object(s.default)(this._texture)||o!==this._drawingBufferWidth||l!==this._drawingBufferHeight||this._glowFactorDirty||a!==this._useHdr){this._texture=this._texture&&this._texture.destroy(),this._drawingBufferWidth=o,this._drawingBufferHeight=l,this._glowFactorDirty=!1,this._useHdr=a;var u=Math.max(o,l);u=Math.pow(2,Math.ceil(Math.log(u)/Math.log(2))-2),u=Math.max(1,u);var d=a?r.halfFloatingPointTexture?we.a.HALF_FLOAT:we.a.FLOAT:we.a.UNSIGNED_BYTE;this._texture=new D.a({context:r,width:u,height:u,pixelFormat:_e.a.RGBA,pixelDatatype:d}),this._glowLengthTS=5*this._glowFactor,this._radiusTS=1/(1+2*this._glowLengthTS)*.5;var c=this,f={u_radiusTS:function(){return c._radiusTS}};this._commands.computeCommand=new ob.a({fragmentShaderSource:"uniform float u_radiusTS;\n\nvarying vec2 v_textureCoordinates;\n\nvec2 rotate(vec2 p, vec2 direction)\n{\n    return vec2(p.x * direction.x - p.y * direction.y, p.x * direction.y + p.y * direction.x);\n}\n\nvec4 addBurst(vec2 position, vec2 direction, float lengthScalar)\n{\n    vec2 rotatedPosition = rotate(position, direction) * vec2(25.0, 0.75);\n    float radius = length(rotatedPosition) * lengthScalar;\n    float burst = 1.0 - smoothstep(0.0, 0.55, radius);\n    return vec4(burst);\n}\n\nvoid main()\n{\n    float lengthScalar = 2.0 / sqrt(2.0);\n    vec2 position = v_textureCoordinates - vec2(0.5);\n    float radius = length(position) * lengthScalar;\n    float surface = step(radius, u_radiusTS);\n    vec4 color = vec4(vec2(1.0), surface + 0.2, surface);\n\n    float glow = 1.0 - smoothstep(0.0, 0.55, radius);\n    color.ba += mix(vec2(0.0), vec2(1.0), glow) * 0.75;\n\n    vec4 burst = vec4(0.0);\n\n    // The following loop has been manually unrolled for speed, to\n    // avoid sin() and cos().\n    //\n    //for (float i = 0.4; i < 3.2; i += 1.047) {\n    //    vec2 direction = vec2(sin(i), cos(i));\n    //    burst += 0.4 * addBurst(position, direction, lengthScalar);\n    //\n    //    direction = vec2(sin(i - 0.08), cos(i - 0.08));\n    //    burst += 0.3 * addBurst(position, direction, lengthScalar);\n    //}\n\n    burst += 0.4 * addBurst(position, vec2(0.38942,  0.92106), lengthScalar);  // angle == 0.4\n    burst += 0.4 * addBurst(position, vec2(0.99235,  0.12348), lengthScalar);  // angle == 0.4 + 1.047\n    burst += 0.4 * addBurst(position, vec2(0.60327, -0.79754), lengthScalar);  // angle == 0.4 + 1.047 * 2.0\n\n    burst += 0.3 * addBurst(position, vec2(0.31457,  0.94924), lengthScalar);  // angle == 0.4 - 0.08\n    burst += 0.3 * addBurst(position, vec2(0.97931,  0.20239), lengthScalar);  // angle == 0.4 + 1.047 - 0.08\n    burst += 0.3 * addBurst(position, vec2(0.66507, -0.74678), lengthScalar);  // angle == 0.4 + 1.047 * 2.0 - 0.08\n\n    // End of manual loop unrolling.\n\n    color += clamp(burst, vec4(0.0), vec4(1.0)) * 0.15;\n\n    gl_FragColor = clamp(color, vec4(0.0), vec4(1.0));\n}\n",outputTexture:this._texture,uniformMap:f,persists:!1,owner:this,postExecute:function(){c._commands.computeCommand=void 0}})}var h=this._drawCommand;if(!Object(s.default)(h.vertexArray)){var m={direction:0},p=new Uint8Array(8);p[0]=0,p[1]=0,p[2]=255,p[3]=0,p[4]=255,p[5]=255,p[6]=0,p[7]=255;var _=oe.a.createVertexBuffer({context:r,typedArray:p,usage:se.a.STATIC_DRAW}),g=[{index:m.direction,vertexBuffer:_,componentsPerAttribute:2,normalize:!0,componentDatatype:Xr.a.UNSIGNED_BYTE}],y=oe.a.createIndexBuffer({context:r,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:se.a.STATIC_DRAW,indexDatatype:Z.a.UNSIGNED_SHORT});h.vertexArray=new fe.a({context:r,attributes:g,indexBuffer:y}),h.shaderProgram=L.a.fromCache({context:r,vertexShaderSource:"attribute vec2 direction;\n\nuniform float u_size;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() \n{\n    vec4 position;\n    if (czm_morphTime == 1.0)\n    {\n        position = vec4(czm_sunPositionWC, 1.0);\n    }\n    else\n    {\n        position = vec4(czm_sunPositionColumbusView.zxy, 1.0);\n    }\n    \n    vec4 positionEC = czm_view * position;\n    vec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\n    \n    vec2 halfSize = vec2(u_size * 0.5);\n    halfSize *= ((direction * 2.0) - 1.0);\n    \n    gl_Position = czm_viewportOrthographic * vec4(positionWC.xy + halfSize, -positionWC.z, 1.0);\n    \n    v_textureCoordinates = direction;\n}\n",fragmentShaderSource:"uniform sampler2D u_texture;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main()\n{\n    vec4 color = texture2D(u_texture, v_textureCoordinates);\n    gl_FragColor = czm_gammaCorrect(color);\n}\n",attributeLocations:m}),h.renderState=ce.a.fromCache({blending:he.a.ALPHA_BLEND}),h.uniformMap=this._uniformMap}var b=r.uniformState.sunPositionWC,w=r.uniformState.sunPositionColumbusView,C=this._boundingVolume,O=this._boundingVolume2D;n.default.clone(b,C.center),O.center.x=w.z,O.center.y=w.x,O.center.z=w.y,C.radius=J.default.SOLAR_RADIUS+J.default.SOLAR_RADIUS*this._glowLengthTS,O.radius=C.radius,i===V.a.SCENE3D?v.default.clone(C,h.boundingVolume):i===V.a.COLUMBUS_VIEW&&v.default.clone(O,h.boundingVolume);var x=Gc.default.computeActualWgs84Position(e,b,cb),T=n.default.magnitude(n.default.subtract(x,e.camera.position,cb)),E=r.uniformState.projection,A=db;A.x=0,A.y=0,A.z=-T,A.w=1;var P=$.default.multiplyByVector(E,A,cb),S=Gc.default.clipToGLWindowCoordinates(t.viewport,P,lb);A.x=J.default.SOLAR_RADIUS;var F=$.default.multiplyByVector(E,A,cb),M=Gc.default.clipToGLWindowCoordinates(t.viewport,F,ub);return this._size=k.default.magnitude(k.default.subtract(M,S,cb)),this._size=2*this._size*(1+2*this._glowLengthTS),this._size=Math.ceil(this._size),this._commands}}},sb.prototype.isDestroyed=function(){return!1},sb.prototype.destroy=function(){var e=this._drawCommand;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._texture=this._texture&&this._texture.destroy(),Object(l.default)(this)};var fb=sb;function hb(e){return Object(i.default)("Assets/Textures/SkyBox/tycho2t3_80_"+e+".jpg")}function mb(e){var t=e._useBrowserRecommendedResolution?1:window.devicePixelRatio;return t*=e._resolutionScale,Object(s.default)(e._scene)&&(e._scene.pixelRatio=t),t}function pb(e){var t=e._canvas,a=t.clientWidth,i=t.clientHeight,n=mb(e);e._canvasClientWidth=a,e._canvasClientHeight=i,a*=n,i*=n,t.width=a,t.height=i,e._canRender=0!==a&&0!==i,e._lastDevicePixelRatio=window.devicePixelRatio}function _b(e){var t=e._canvas,a=t.width,i=t.height;if(0!==a&&0!==i){var n=e._scene.camera.frustum;Object(s.default)(n.aspectRatio)?n.aspectRatio=a/i:(n.top=n.right*(i/a),n.bottom=-n.top)}}function gb(e,t){e=Object(Dc.default)(e),t=Object(o.default)(t,o.default.EMPTY_OBJECT);var a=document.createElement("div");a.className="cesium-widget",e.appendChild(a);var i=document.createElement("canvas"),l=c.default.supportsImageRenderingPixelated();function u(){i!==i.ownerDocument.activeElement&&i.ownerDocument.activeElement.blur()}this._supportsImageRenderingPixelated=l,l&&(i.style.imageRendering=c.default.imageRenderingValue()),i.oncontextmenu=function(){return!1},i.onselectstart=function(){return!1},i.addEventListener("mousedown",u),i.addEventListener("pointerdown",u),a.appendChild(i);var f=document.createElement("div");f.className="cesium-widget-credits";var h=Object(s.default)(t.creditContainer)?Object(Dc.default)(t.creditContainer):a;h.appendChild(f);var p=Object(s.default)(t.creditViewport)?Object(Dc.default)(t.creditViewport):a,_=Object(o.default)(t.showRenderLoopErrors,!0),v=Object(o.default)(t.useBrowserRecommendedResolution,!0);this._element=a,this._container=e,this._canvas=i,this._canvasClientWidth=0,this._canvasClientHeight=0,this._lastDevicePixelRatio=0,this._creditViewport=p,this._creditContainer=h,this._innerCreditContainer=f,this._canRender=!1,this._renderLoopRunning=!1,this._showRenderLoopErrors=_,this._resolutionScale=1,this._useBrowserRecommendedResolution=v,this._forceResize=!1,this._clock=Object(s.default)(t.clock)?t.clock:new r.default,pb(this);try{var y=new qy({canvas:i,contextOptions:t.contextOptions,creditContainer:f,creditViewport:p,mapProjection:t.mapProjection,orderIndependentTranslucency:t.orderIndependentTranslucency,scene3DOnly:Object(o.default)(t.scene3DOnly,!1),terrainExaggeration:t.terrainExaggeration,shadows:t.shadows,mapMode2D:t.mapMode2D,requestRenderMode:t.requestRenderMode,maximumRenderTimeChange:t.maximumRenderTimeChange});this._scene=y,y.camera.constrainedAxis=n.default.UNIT_Z,mb(this),_b(this);var b=Object(o.default)(y.mapProjection.ellipsoid,d.default.WGS84),w=t.globe;Object(s.default)(w)||(w=new ui(b)),!1!==w&&(y.globe=w,y.globe.shadows=Object(o.default)(t.terrainShadows,Ue.default.RECEIVE_ONLY));var C=t.skyBox;Object(s.default)(C)||(C=new rb({sources:{positiveX:hb("px"),negativeX:hb("mx"),positiveY:hb("py"),negativeY:hb("my"),positiveZ:hb("pz"),negativeZ:hb("mz")}})),!1!==C&&(y.skyBox=C,y.sun=new fb,y.moon=new cr);var O=t.skyAtmosphere;Object(s.default)(O)||(O=new ab(b)),!1!==O&&(y.skyAtmosphere=O);var x=!1!==t.globe&&t.imageryProvider;Object(s.default)(x)||(x=g()),!1!==x&&y.imageryLayers.addImageryProvider(x),Object(s.default)(t.terrainProvider)&&!1!==t.globe&&(y.terrainProvider=t.terrainProvider),this._screenSpaceEventHandler=new m.default(i),Object(s.default)(t.sceneMode)&&(t.sceneMode===V.a.SCENE2D&&this._scene.morphTo2D(0),t.sceneMode===V.a.COLUMBUS_VIEW&&this._scene.morphToColumbusView(0)),this._useDefaultRenderLoop=void 0,this.useDefaultRenderLoop=Object(o.default)(t.useDefaultRenderLoop,!0),this._targetFrameRate=void 0,this.targetFrameRate=t.targetFrameRate;var T=this;this._onRenderError=function(e,t){if(T._useDefaultRenderLoop=!1,T._renderLoopRunning=!1,T._showRenderLoopErrors){T.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,t)}},y.renderError.addEventListener(this._onRenderError)}catch(e){if(_){this.showErrorPanel("Error constructing CesiumWidget.",'Visit <a href="http://get.webgl.org">http://get.webgl.org</a> to verify that your web browser and hardware support WebGL.  Consider trying a different web browser or updating your video drivers.  Detailed error information is below:',e)}throw e}}Object.defineProperties(gb.prototype,{container:{get:function(){return this._container}},canvas:{get:function(){return this._canvas}},creditContainer:{get:function(){return this._creditContainer}},creditViewport:{get:function(){return this._creditViewport}},scene:{get:function(){return this._scene}},imageryLayers:{get:function(){return this._scene.imageryLayers}},terrainProvider:{get:function(){return this._scene.terrainProvider},set:function(e){this._scene.terrainProvider=e}},camera:{get:function(){return this._scene.camera}},clock:{get:function(){return this._clock}},screenSpaceEventHandler:{get:function(){return this._screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate=e}},useDefaultRenderLoop:{get:function(){return this._useDefaultRenderLoop},set:function(e){this._useDefaultRenderLoop!==e&&(this._useDefaultRenderLoop=e,e&&!this._renderLoopRunning&&function(e){e._renderLoopRunning=!0;var t=0;Object(h.default)((function a(i){if(!e.isDestroyed())if(e._useDefaultRenderLoop)try{var n=e._targetFrameRate;if(Object(s.default)(n)){var r=1e3/n,o=i-t;o>r&&(e.resize(),e.render(),t=i-o%r),Object(h.default)(a)}else e.resize(),e.render(),Object(h.default)(a)}catch(t){if(e._useDefaultRenderLoop=!1,e._renderLoopRunning=!1,e._showRenderLoopErrors){e.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,t)}}else e._renderLoopRunning=!1}))}(this))}},resolutionScale:{get:function(){return this._resolutionScale},set:function(e){this._resolutionScale!==e&&(this._resolutionScale=e,this._forceResize=!0)}},useBrowserRecommendedResolution:{get:function(){return this._useBrowserRecommendedResolution},set:function(e){this._useBrowserRecommendedResolution!==e&&(this._useBrowserRecommendedResolution=e,this._forceResize=!0)}}}),gb.prototype.showErrorPanel=function(e,t,a){var i=this._element,n=document.createElement("div");n.className="cesium-widget-errorPanel";var r=document.createElement("div");r.className="cesium-widget-errorPanel-content",n.appendChild(r);var o=document.createElement("div");o.className="cesium-widget-errorPanel-header",o.appendChild(document.createTextNode(e)),r.appendChild(o);var l=document.createElement("div");function u(){l.style.maxHeight=Math.max(Math.round(.9*i.clientHeight-100),30)+"px"}l.className="cesium-widget-errorPanel-scroll",r.appendChild(l),u(),Object(s.default)(window.addEventListener)&&window.addEventListener("resize",u,!1);var d=Object(s.default)(t),c=Object(s.default)(a);if(d||c){var h=document.createElement("div");if(h.className="cesium-widget-errorPanel-message",l.appendChild(h),c){var m=Object(f.default)(a);d||("string"==typeof a&&(a=new Error(a)),t=Object(f.default)({name:a.name,message:a.message}),m=a.stack),"undefined"!=typeof console&&console.error(e+"\n"+t+"\n"+m);var p=document.createElement("div");p.className="cesium-widget-errorPanel-message-details collapsed";var _=document.createElement("span");_.className="cesium-widget-errorPanel-more-details",_.appendChild(document.createTextNode("See more...")),p.appendChild(_),p.onclick=function(e){p.removeChild(_),p.appendChild(document.createTextNode(m)),p.className="cesium-widget-errorPanel-message-details",r.className="cesium-widget-errorPanel-content expanded",p.onclick=void 0},l.appendChild(p)}h.innerHTML="<p>"+t+"</p>"}var g=document.createElement("div");g.className="cesium-widget-errorPanel-buttonPanel",r.appendChild(g);var v=document.createElement("button");v.setAttribute("type","button"),v.className="cesium-button",v.appendChild(document.createTextNode("OK")),v.onclick=function(){Object(s.default)(u)&&Object(s.default)(window.removeEventListener)&&window.removeEventListener("resize",u,!1),i.removeChild(n)},g.appendChild(v),i.appendChild(n)},gb.prototype.isDestroyed=function(){return!1},gb.prototype.destroy=function(){Object(s.default)(this._scene)&&(this._scene.renderError.removeEventListener(this._onRenderError),this._scene=this._scene.destroy()),this._container.removeChild(this._element),this._creditContainer.removeChild(this._innerCreditContainer),Object(l.default)(this)},gb.prototype.resize=function(){var e=this._canvas;(this._forceResize||this._canvasClientWidth!==e.clientWidth||this._canvasClientHeight!==e.clientHeight||this._lastDevicePixelRatio!==window.devicePixelRatio)&&(this._forceResize=!1,pb(this),_b(this),this._scene.requestRender())},gb.prototype.forceResize=function(){this._lastWidth=0,this.resize()},gb.prototype.render=function(){if(this._canRender){this._scene.initializeFrame();var e=this._clock.tick();this._scene.render(e)}else this._clock.tick()};t.default=gb},764:function(e,t,a){"use strict";a.r(t);var i=a(150),n=a(33),r=(a(15),a(74)),o=a(9),s=a(8),l=a(18),u=a(144),d=a(371),c=a(246),f=a(369);function h(){this._length=0,this._collections={},this._collectionsArray=[],this.show=!0}Object.defineProperties(h.prototype,{length:{get:function(){return this._length}}}),h.prototype.add=function(e,t){t=Object(o.default)(t,0);var a=this._collections[t];if(!Object(s.default)(a)){(a=new f.a({destroyPrimitives:!1}))._zIndex=t,this._collections[t]=a;for(var i=this._collectionsArray,n=0;n<i.length&&i[n]._zIndex<t;)n++;i.splice(n,0,a)}return a.add(e),this._length++,e._zIndex=t,e},h.prototype.set=function(e,t){return t===e._zIndex?e:(this.remove(e,!0),this.add(e,t),e)},h.prototype.remove=function(e,t){if(this.contains(e)){var a,i=e._zIndex,n=this._collections[i];return(a=t?n.remove(e):n.removeAndDestroy(e))&&this._length--,0===n.length&&(this._collectionsArray.splice(this._collectionsArray.indexOf(n),1),this._collections[i]=void 0,n.destroy()),a}return!1},h.prototype.removeAll=function(){for(var e=this._collectionsArray,t=0;t<e.length;t++){var a=e[t];a.destroyPrimitives=!0,a.destroy()}this._collections={},this._collectionsArray=[],this._length=0},h.prototype.contains=function(e){if(!Object(s.default)(e))return!1;var t=this._collections[e._zIndex];return Object(s.default)(t)&&t.contains(e)},h.prototype.update=function(e){if(this.show)for(var t=this._collectionsArray,a=0;a<t.length;a++)t[a].update(e)},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this.removeAll(),Object(l.default)(this)};var m=h,p=a(80),_=a(58),g=a(24),v=a(12),y=a(21),b=a(10),w=a(87),C=a(118),O=a(69),x=a(154),T=a(143),E=a(88),A=a(39),P=y.default.WHITE,S=v.default.ZERO,D=O.default.NONE,F=g.default.ZERO,M=v.default.ZERO,I=x.default.CENTER,R=T.default.CENTER,N=new v.default,L=new y.default,j=new v.default,V=new g.default,U=new C.a,B=new C.a,z=new C.a,H=new _.default,k=new w.a;function G(e){this.entity=e,this.billboard=void 0,this.textureValue=void 0}function W(e,t){t.collectionChanged.addEventListener(W.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new p.default,this._onCollectionChanged(t,t.values,[],[])}function Y(e,t,a){Object(s.default)(e)&&(e.billboard=void 0,a.removeBillboard(t))}W.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,n=t.length;i<n;i++){var r,o,l=t[i],u=l.entity,d=u._billboard,c=l.billboard,f=u.isShowing&&u.isAvailable(e)&&A.default.getValueOrDefault(d._show,e,!0);if(f&&(o=A.default.getValueOrUndefined(u._position,e,N),r=A.default.getValueOrUndefined(d._image,e),f=Object(s.default)(o)&&Object(s.default)(r)),f){A.default.isConstant(u._position)||(a._clusterDirty=!0),Object(s.default)(c)||((c=a.getBillboard(u)).id=u,c.image=void 0,l.billboard=c),c.show=f,Object(s.default)(c.image)&&l.textureValue===r||(c.image=r,l.textureValue=r),c.position=o,c.color=A.default.getValueOrDefault(d._color,e,P,L),c.eyeOffset=A.default.getValueOrDefault(d._eyeOffset,e,S,j),c.heightReference=A.default.getValueOrDefault(d._heightReference,e,D),c.pixelOffset=A.default.getValueOrDefault(d._pixelOffset,e,F,V),c.scale=A.default.getValueOrDefault(d._scale,e,1),c.rotation=A.default.getValueOrDefault(d._rotation,e,0),c.alignedAxis=A.default.getValueOrDefault(d._alignedAxis,e,M),c.horizontalOrigin=A.default.getValueOrDefault(d._horizontalOrigin,e,I),c.verticalOrigin=A.default.getValueOrDefault(d._verticalOrigin,e,R),c.width=A.default.getValueOrUndefined(d._width,e),c.height=A.default.getValueOrUndefined(d._height,e),c.scaleByDistance=A.default.getValueOrUndefined(d._scaleByDistance,e,U),c.translucencyByDistance=A.default.getValueOrUndefined(d._translucencyByDistance,e,B),c.pixelOffsetScaleByDistance=A.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,z),c.sizeInMeters=A.default.getValueOrDefault(d._sizeInMeters,e,!1),c.distanceDisplayCondition=A.default.getValueOrUndefined(d._distanceDisplayCondition,e,k),c.disableDepthTestDistance=A.default.getValueOrUndefined(d._disableDepthTestDistance,e);var h=A.default.getValueOrUndefined(d._imageSubRegion,e,H);Object(s.default)(h)&&c.setImageSubRegion(c._imageId,h)}else Y(l,u,a)}return!0},W.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.billboard))return E.default.FAILED;var i=a.billboard;if(i.heightReference===O.default.NONE)t.center=v.default.clone(i.position,t.center);else{if(!Object(s.default)(i._clampedPosition))return E.default.PENDING;t.center=v.default.clone(i._clampedPosition,t.center)}return t.radius=0,E.default.DONE},W.prototype.isDestroyed=function(){return!1},W.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(W.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeBillboard(e[t]);return Object(l.default)(this)},W.prototype._onCollectionChanged=function(e,t,a,i){var n,r,o=this._items,l=this._cluster;for(n=t.length-1;n>-1;n--)r=t[n],Object(s.default)(r._billboard)&&Object(s.default)(r._position)&&o.set(r.id,new G(r));for(n=i.length-1;n>-1;n--)r=i[n],Object(s.default)(r._billboard)&&Object(s.default)(r._position)?o.contains(r.id)||o.set(r.id,new G(r)):(Y(o.get(r.id),r,l),o.remove(r.id));for(n=a.length-1;n>-1;n--)r=a[n],Y(o.get(r.id),r,l),o.remove(r.id)};var X=W,Q=a(210),q=a(23),Z=a(137),K=a(78),J=a(326),$=a(215);function ee(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.translucent,!0),a=Object(o.default)(e.closed,!1),i=Object(o.default)(e.materialSupport,ee.MaterialSupport.TEXTURED);this.material=Object(s.default)(e.material)?e.material:$.a.fromType($.a.ColorType),this.translucent=t,this._vertexShaderSource=Object(o.default)(e.vertexShaderSource,i.vertexShaderSource),this._fragmentShaderSource=Object(o.default)(e.fragmentShaderSource,i.fragmentShaderSource),this._renderState=J.a.getDefaultRenderState(t,a,e.renderState),this._closed=a,this._materialSupport=i,this._vertexFormat=i.vertexFormat,this._flat=Object(o.default)(e.flat,!1),this._faceForward=Object(o.default)(e.faceForward,!a)}Object.defineProperties(ee.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),ee.prototype.getFragmentShaderSource=J.a.prototype.getFragmentShaderSource,ee.prototype.isTranslucent=J.a.prototype.isTranslucent,ee.prototype.getRenderState=J.a.prototype.getRenderState,ee.MaterialSupport={BASIC:Object.freeze({vertexFormat:K.default.POSITION_AND_NORMAL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),TEXTURED:Object.freeze({vertexFormat:K.default.POSITION_NORMAL_AND_ST,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"}),ALL:Object.freeze({vertexFormat:K.default.ALL,vertexShaderSource:"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\n\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec4 p = czm_computePosition();\n\n    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    v_tangentEC = czm_normal * tangent;                       // tangent in eye coordinates\n    v_bitangentEC = czm_normal * bitangent;                   // bitangent in eye coordinates\n    v_st = st;\n\n    gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n",fragmentShaderSource:"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\n\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    mat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\n\n    vec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.tangentToEyeMatrix = tangentToEyeMatrix;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    czm_material material = czm_getMaterial(materialInput);\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n"})};var te=ee,ae=a(73),ie=a(97),ne=a(368),re=a(340),oe=a(68),se=a(35);function le(e,t){e=Object(o.default)(e,0),t=Object(o.default)(t,Number.MAX_VALUE),this.value=new Float32Array([e,t])}Object.defineProperties(le.prototype,{componentDatatype:{get:function(){return se.a.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}}),le.fromDistanceDisplayCondition=function(e){return new le(e.near,e.far)},le.toValue=function(e,t){return Object(s.default)(t)?(t[0]=e.near,t[1]=e.far,t):new Float32Array([e.near,e.far])};var ue=le,de=a(63),ce=a(86),fe=a(85),he=a(139),me=a(90),pe=a(72),_e=a(114);function ge(){b.default.throwInstantiationError()}Object.defineProperties(ge.prototype,{isConstant:{get:b.default.throwInstantiationError},definitionChanged:{get:b.default.throwInstantiationError}}),ge.prototype.getType=b.default.throwInstantiationError,ge.prototype.getValue=b.default.throwInstantiationError,ge.prototype.equals=b.default.throwInstantiationError,ge.getValue=function(e,t,a){var i;return Object(s.default)(t)&&(i=t.getType(e),Object(s.default)(i))?(Object(s.default)(a)&&a.type===i||(a=$.a.fromType(i)),t.getValue(e,a.uniforms),a):(Object(s.default)(a)&&a.type===$.a.ColorType||(a=$.a.fromType($.a.ColorType)),y.default.clone(y.default.WHITE,a.uniforms.color),a)};var ve=ge;function ye(e,t,a){this._primitives=t,this._orderedGroundPrimitives=a,this._primitive=void 0,this._outlinePrimitive=void 0,this._geometryUpdater=e,this._options=e._options,this._entity=e._entity,this._material=void 0}ye.prototype._isHidden=function(e,t,a){return!e.isShowing||!e.isAvailable(a)||!A.default.getValueOrDefault(t.show,a,!0)},ye.prototype._setOptions=b.default.throwInstantiationError,ye.prototype.update=function(e){var t=this._geometryUpdater,a=t._onTerrain,i=this._primitives,n=this._orderedGroundPrimitives;a?n.remove(this._primitive):(i.removeAndDestroy(this._primitive),i.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0),this._primitive=void 0;var r=this._entity,o=r[this._geometryUpdater._geometryPropertyName];if(this._setOptions(r,o,e),!this._isHidden(r,o,e)){var l=this._geometryUpdater.shadowsProperty.getValue(e),u=this._options;if(!Object(s.default)(o.fill)||o.fill.getValue(e)){var d,f=t.fillMaterialProperty,h=f instanceof pe.default,m=t._getIsClosed(u);if(h)d=new ae.a({closed:m,flat:a&&!t._supportsMaterialsforEntitiesOnTerrain});else{var p=ve.getValue(e,f,this._material);this._material=p,d=new te({material:p,translucent:p.isTranslucent(),closed:m})}if(a)u.vertexFormat=ae.a.VERTEX_FORMAT,this._primitive=n.add(new c.a({geometryInstances:this._geometryUpdater.createFillGeometryInstance(e),appearance:d,asynchronous:!1,shadows:l,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(e)}),A.default.getValueOrUndefined(this._geometryUpdater.zIndex,e));else{u.vertexFormat=d.vertexFormat;var _=this._geometryUpdater.createFillGeometryInstance(e);h&&(d.translucent=255!==_.attributes.color.value[3]),this._primitive=i.add(new _e.a({geometryInstances:_,appearance:d,asynchronous:!1,shadows:l}))}}if(!a&&Object(s.default)(o.outline)&&o.outline.getValue(e)){var g=this._geometryUpdater.createOutlineGeometryInstance(e),v=A.default.getValueOrDefault(o.outlineWidth,e,1);this._outlinePrimitive=i.add(new _e.a({geometryInstances:g,appearance:new ae.a({flat:!0,translucent:255!==g.attributes.color.value[3],renderState:{lineWidth:t._scene.clampLineWidth(v)}}),asynchronous:!1,shadows:l}))}}},ye.prototype.getBoundingSphere=function(e){var t,a=this._entity,i=this._primitive,r=this._outlinePrimitive;return Object(s.default)(i)&&i.show&&i.ready&&(t=i.getGeometryInstanceAttributes(a),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(n.default.clone(t.boundingSphere,e),E.default.DONE):Object(s.default)(r)&&r.show&&r.ready&&(t=r.getGeometryInstanceAttributes(a),Object(s.default)(t)&&Object(s.default)(t.boundingSphere))?(n.default.clone(t.boundingSphere,e),E.default.DONE):Object(s.default)(i)&&!i.ready||Object(s.default)(r)&&!r.ready?E.default.PENDING:E.default.FAILED},ye.prototype.isDestroyed=function(){return!1},ye.prototype.destroy=function(){var e=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):e.removeAndDestroy(this._primitive),e.removeAndDestroy(this._outlinePrimitive),Object(l.default)(this)};var be=ye,we=a(187),Ce=a(179),Oe=a(145),xe=new pe.default(y.default.WHITE),Te=new Ce.a(!0),Ee=new Ce.a(!0),Ae=new Ce.a(!1),Pe=new Ce.a(y.default.BLACK),Se=new Ce.a(ie.default.DISABLED),De=new Ce.a(new w.a),Fe=new Ce.a(Z.a.BOTH);function Me(e){var t=e.entity,a=e.geometryPropertyName;this._entity=t,this._scene=e.scene,this._fillEnabled=!1,this._isClosed=!1,this._onTerrain=!1,this._dynamic=!1,this._outlineEnabled=!1,this._geometryChanged=new q.default,this._showProperty=void 0,this._materialProperty=void 0,this._showOutlineProperty=void 0,this._outlineColorProperty=void 0,this._outlineWidth=1,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._options=e.geometryOptions,this._geometryPropertyName=a,this._id=a+"-"+t.id,this._observedPropertyNames=e.observedPropertyNames,this._supportsMaterialsforEntitiesOnTerrain=Oe.default.supportsMaterialsforEntitiesOnTerrain(e.scene)}Object.defineProperties(Me.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&A.default.isConstant(this._showProperty)&&A.default.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!Object(s.default)(this._entity.availability)&&A.default.isConstant(this._showProperty)&&A.default.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}}),Me.prototype.isOutlineVisible=function(e){var t=this._entity,a=this._outlineEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e);return Object(o.default)(a,!1)},Me.prototype.isFilled=function(e){var t=this._entity,a=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e);return Object(o.default)(a,!1)},Me.prototype.createFillGeometryInstance=b.default.throwInstantiationError,Me.prototype.createOutlineGeometryInstance=b.default.throwInstantiationError,Me.prototype.isDestroyed=function(){return!1},Me.prototype.destroy=function(){Object(l.default)(this)},Me.prototype._isHidden=function(e,t){var a=t.show;return Object(s.default)(a)&&a.isConstant&&!a.getValue(fe.default.MINIMUM_VALUE)},Me.prototype._isOnTerrain=function(e,t){return!1},Me.prototype._getIsClosed=function(e){return!0},Me.prototype._isDynamic=b.default.throwInstantiationError,Me.prototype._setStaticOptions=b.default.throwInstantiationError,Me.prototype._onEntityPropertyChanged=function(e,t,a,i){if(-1!==this._observedPropertyNames.indexOf(t)){var n=this._entity[this._geometryPropertyName];if(Object(s.default)(n)){var r=n.fill,l=!Object(s.default)(r)||!r.isConstant||r.getValue(fe.default.MINIMUM_VALUE),u=n.outline,d=Object(s.default)(u);if(d&&u.isConstant&&(d=u.getValue(fe.default.MINIMUM_VALUE)),l||d){var c=n.show;if(this._isHidden(e,n))(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));else{this._materialProperty=Object(o.default)(n.material,xe),this._fillProperty=Object(o.default)(r,Ee),this._showProperty=Object(o.default)(c,Te),this._showOutlineProperty=Object(o.default)(n.outline,Ae),this._outlineColorProperty=d?Object(o.default)(n.outlineColor,Pe):void 0,this._shadowsProperty=Object(o.default)(n.shadows,Se),this._distanceDisplayConditionProperty=Object(o.default)(n.distanceDisplayCondition,De),this._classificationTypeProperty=Object(o.default)(n.classificationType,Fe),this._fillEnabled=l;var f=this._isOnTerrain(e,n)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof pe.default);if(d&&f&&(Object(we.a)(we.a.geometryOutlines),d=!1),this._onTerrain=f,this._outlineEnabled=d,this._isDynamic(e,n))this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this));else{this._setStaticOptions(e,n),this._isClosed=this._getIsClosed(this._options);var h=n.outlineWidth;this._outlineWidth=Object(s.default)(h)?h.getValue(fe.default.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this)}}}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}else(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this))}},Me.prototype.createDynamicUpdater=function(e,t){return new this.constructor.DynamicGeometryUpdater(this,e,t)};var Ie=Me,Re=a(177),Ne=a(30),Le=a(14),je=a(44),Ve=new v.default,Ue=new Ne.default;function Be(e,t,a,i){this._scene=e,this._heightReference=a,this._extrudedHeightReference=i,this._positionProperty=t,this._position=new v.default,this._cartographicPosition=new Ne.default,this._normal=new v.default,this._definitionChanged=new q.default,this._terrainHeight=0,this._removeCallbackFunc=void 0,this._removeEventListener=void 0,this._removeModeListener=void 0;var n=this;if(Object(s.default)(e.globe)&&(this._removeEventListener=e.terrainProviderChanged.addEventListener((function(){n._updateClamping()})),this._removeModeListener=e.morphComplete.addEventListener((function(){n._updateClamping()}))),t.isConstant){var r=t.getValue(fe.default.MINIMUM_VALUE,Ve);if(!Object(s.default)(r)||v.default.equals(r,v.default.ZERO)||!Object(s.default)(e.globe))return;this._position=v.default.clone(r,this._position),this._updateClamping(),this._normal=e.globe.ellipsoid.geodeticSurfaceNormal(r,this._normal)}}Object.defineProperties(Be.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),Be.prototype._updateClamping=function(){Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc();var e=this._scene,t=e.globe,a=this._position;if(Object(s.default)(t)&&!v.default.equals(a,v.default.ZERO)){var i=t.ellipsoid,n=t._surface,r=this,o=i.cartesianToCartographic(a,this._cartographicPosition),l=t.getHeight(o);Object(s.default)(l)?this._terrainHeight=l:this._terrainHeight=0,this._removeCallbackFunc=n.updateHeight(o,(function(t){if(e.mode===je.a.SCENE3D){var a=i.cartesianToCartographic(t,Ue);r._terrainHeight=a.height}else r._terrainHeight=t.x;r.definitionChanged.raiseEvent()}))}else this._terrainHeight=0},Be.prototype.getValue=function(e,t){var a=A.default.getValueOrDefault(this._heightReference,e,O.default.NONE),i=A.default.getValueOrDefault(this._extrudedHeightReference,e,O.default.NONE);if(a===O.default.NONE&&i!==O.default.RELATIVE_TO_GROUND)return this._position=v.default.clone(v.default.ZERO,this._position),v.default.clone(v.default.ZERO,t);if(this._positionProperty.isConstant)return v.default.multiplyByScalar(this._normal,this._terrainHeight,t);var n=this._scene,r=this._positionProperty.getValue(e,Ve);if(!Object(s.default)(r)||v.default.equals(r,v.default.ZERO)||!Object(s.default)(n.globe))return v.default.clone(v.default.ZERO,t);if(v.default.equalsEpsilon(this._position,r,Le.default.EPSILON10))return v.default.multiplyByScalar(this._normal,this._terrainHeight,t);this._position=v.default.clone(r,this._position),this._updateClamping();var o=n.globe.ellipsoid.geodeticSurfaceNormal(r,this._normal);return v.default.multiplyByScalar(o,this._terrainHeight,t)},Be.prototype.isDestroyed=function(){return!1},Be.prototype.destroy=function(){return Object(s.default)(this._removeEventListener)&&this._removeEventListener(),Object(s.default)(this._removeModeListener)&&this._removeModeListener(),Object(s.default)(this._removeCallbackFunc)&&this._removeCallbackFunc(),Object(l.default)(this)};var ze=Be;var He=function(e,t,a,i){if(Ie.prototype._onEntityPropertyChanged.call(this,e,t,a,i),-1!==this._observedPropertyNames.indexOf(t)){var n=this._entity[this._geometryPropertyName];if(Object(s.default)(n)){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var r=n.heightReference;if(Object(s.default)(r)){var o=new Re.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new ze(this._scene,o,r)}}}},ke=v.default.ZERO,Ge=new v.default,We=new v.default,Ye=new y.default;function Xe(e){this.id=e,this.vertexFormat=void 0,this.dimensions=void 0,this.offsetAttribute=void 0}function Qe(e,t){Ie.call(this,{entity:e,scene:t,geometryOptions:new Xe(e),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]}),this._onEntityPropertyChanged(e,"box",e.box,void 0)}function qe(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(Qe.prototype=Object.create(Ie.prototype),Qe.prototype.constructor=Qe),Object.defineProperties(Qe.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Qe.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),n=new me.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),r=this._distanceDisplayConditionProperty.getValue(e),o={show:n,distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),color:void 0,offset:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,Ye)),Object(s.default)(t)||(t=y.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,ke,Ge))),new de.a({id:a,geometry:ne.a.fromDimensions(this._options),modelMatrix:a.computeModelMatrixForHeightReference(e,a.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:o})},Qe.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,Ye),n=this._distanceDisplayConditionProperty.getValue(e),r={show:new me.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(i),distanceDisplayCondition:ue.fromDistanceDisplayCondition(n),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,ke,Ge))),new de.a({id:t,geometry:re.a.fromDimensions(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:r})},Qe.prototype._computeCenter=function(e,t){return A.default.getValueOrUndefined(this._entity.position,e,t)},Qe.prototype._isHidden=function(e,t){return!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||Ie.prototype._isHidden.call(this,e,t)},Qe.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&A.default.isConstant(e.orientation)&&t.dimensions.isConstant&&A.default.isConstant(t.outlineWidth))},Qe.prototype._setStaticOptions=function(e,t){var a=A.default.getValueOrDefault(t.heightReference,fe.default.MINIMUM_VALUE,O.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof pe.default?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,i.dimensions=t.dimensions.getValue(fe.default.MINIMUM_VALUE,i.dimensions),i.offsetAttribute=a!==O.default.NONE?ce.a.ALL:void 0},Qe.prototype._onEntityPropertyChanged=He,Qe.DynamicGeometryUpdater=qe,Object(s.default)(Object.create)&&(qe.prototype=Object.create(be.prototype),qe.prototype.constructor=qe),qe.prototype._isHidden=function(e,t,a){var i=A.default.getValueOrUndefined(e.position,a,We),n=this._options.dimensions;return!Object(s.default)(i)||!Object(s.default)(n)||be.prototype._isHidden.call(this,e,t,a)},qe.prototype._setOptions=function(e,t,a){var i=A.default.getValueOrDefault(t.heightReference,a,O.default.NONE),n=this._options;n.dimensions=A.default.getValueOrUndefined(t.dimensions,a,n.dimensions),n.offsetAttribute=i!==O.default.NONE?ce.a.ALL:void 0};var Ze=Qe,Ke=a(94),Je=a(135),$e=a(196),et=a(43),tt=a(239),at=a(50),it=a(228),nt=a(28),rt=a(56),ot=a(62),st=[new v.default,new v.default],lt=new v.default,ut=new v.default,dt=new v.default,ct=new v.default,ft=new v.default,ht=new v.default,mt=new v.default,pt=new v.default,_t=new v.default,gt=new v.default,vt=new v.default,yt={},bt=new Ne.default;function wt(e,t,a,i){var n,r=e[0],o=e[1],s=v.default.angleBetween(r,o),l=Math.ceil(s/i),u=new Array(l);if(t===a){for(n=0;n<l;n++)u[n]=t;return u.push(a),u}var d=(a-t)/l;for(n=1;n<l;n++){var c=t+n*d;u[n]=c}return u[0]=t,u.push(a),u}var Ct=new v.default,Ot=new v.default;var xt=new v.default(-1,0,0),Tt=new nt.default,Et=new nt.default,At=new et.default,Pt=et.default.IDENTITY.clone(),St=new v.default,Dt=new at.a,Ft=new v.default;function Mt(e,t,a,i,n,r,o,s){var l=St,u=Dt;Tt=ot.default.eastNorthUpToFixedFrame(e,n,Tt),l=nt.default.multiplyByPointAsVector(Tt,xt,l);var d=function(e,t,a,i){var n=new it.default(a,i),r=n.projectPointOntoPlane(v.default.add(a,e,Ct),Ct),o=n.projectPointOntoPlane(v.default.add(a,t,Ot),Ot),s=g.default.angleBetween(r,o);return o.x*r.y-o.y*r.x>=0?-s:s}(l=v.default.normalize(l,l),t,e,n);At=et.default.fromRotationZ(d,At),Ft.z=r,Tt=nt.default.multiplyTransformation(Tt,nt.default.fromRotationTranslation(At,Ft,Et),Tt);var c=Pt;c[0]=o;for(var f=0;f<s;f++)for(var h=0;h<a.length;h+=3)u=v.default.fromArray(a,h,u),u=et.default.multiplyByVector(c,u,u),u=nt.default.multiplyByPoint(Tt,u,u),i.push(u.x,u.y,u.z);return i}var It=new v.default;function Rt(e,t,a,i,n,r,o){for(var s=0;s<e.length;s+=3){i=Mt(v.default.fromArray(e,s,It),t,a,i,n,r[s/3],o,1)}return i}function Nt(e,t){for(var a=e.length,i=new Array(3*a),n=0,r=t.x+t.width/2,o=t.y+t.height/2,s=0;s<a;s++)i[n++]=e[s].x-r,i[n++]=0,i[n++]=e[s].y-o;return i}var Lt=new rt.default,jt=new v.default,Vt=new et.default;function Ut(e,t,a,i,n,r,o,s,l,u){var d,c,f=v.default.angleBetween(v.default.subtract(t,e,gt),v.default.subtract(a,e,vt)),h=i===$e.a.BEVELED?0:Math.ceil(f/Le.default.toRadians(5));if(d=n?et.default.fromQuaternion(rt.default.fromAxisAngle(v.default.negate(e,gt),f/(h+1),Lt),Vt):et.default.fromQuaternion(rt.default.fromAxisAngle(e,f/(h+1),Lt),Vt),t=v.default.clone(t,jt),h>0)for(var m=u?2:1,p=0;p<h;p++)t=et.default.multiplyByVector(d,t,t),c=v.default.subtract(t,e,gt),c=v.default.normalize(c,c),n||(c=v.default.negate(c,c)),o=Mt(r.scaleToGeodeticSurface(t,vt),c,s,o,r,l,1,m);else c=v.default.subtract(t,e,gt),c=v.default.normalize(c,c),n||(c=v.default.negate(c,c)),o=Mt(r.scaleToGeodeticSurface(t,vt),c,s,o,r,l,1,1),a=v.default.clone(a,jt),c=v.default.subtract(a,e,gt),c=v.default.normalize(c,c),n||(c=v.default.negate(c,c)),o=Mt(r.scaleToGeodeticSurface(a,vt),c,s,o,r,l,1,1);return o}yt.removeDuplicatesFromShape=function(e){for(var t=e.length,a=[],i=t-1,n=0;n<t;i=n++){var r=e[i],o=e[n];g.default.equals(r,o)||a.push(o)}return a},yt.angleIsGreaterThanPi=function(e,t,a,i){var n=new it.default(a,i),r=n.projectPointOntoPlane(v.default.add(a,e,Ct),Ct),o=n.projectPointOntoPlane(v.default.add(a,t,Ot),Ot);return o.x*r.y-o.y*r.x>=0};var Bt=new v.default,zt=new v.default;yt.computePositions=function(e,t,a,i,n){var r=i._ellipsoid,o=function(e,t){for(var a=new Array(e.length),i=0;i<e.length;i++){var n=e[i];bt=t.cartesianToCartographic(n,bt),a[i]=bt.height,e[i]=t.scaleToGeodeticSurface(n,n)}return a}(e,r),s=i._granularity,l=i._cornerType,u=n?function(e,t){var a=e.length,i=new Array(6*a),n=0,r=t.x+t.width/2,o=t.y+t.height/2,s=e[0];i[n++]=s.x-r,i[n++]=0,i[n++]=s.y-o;for(var l=1;l<a;l++){var u=(s=e[l]).x-r,d=s.y-o;i[n++]=u,i[n++]=0,i[n++]=d,i[n++]=u,i[n++]=0,i[n++]=d}return s=e[0],i[n++]=s.x-r,i[n++]=0,i[n++]=s.y-o,i}(t,a):Nt(t,a),d=n?Nt(t,a):void 0,c=a.height/2,f=a.width/2,h=e.length,m=[],p=n?[]:void 0,_=lt,g=ut,y=dt,b=ct,w=ft,C=ht,O=mt,x=pt,T=_t,E=e[0],A=e[1];b=r.geodeticSurfaceNormal(E,b),_=v.default.subtract(A,E,_),_=v.default.normalize(_,_),x=v.default.cross(b,_,x),x=v.default.normalize(x,x);var P,S=o[0],D=o[1];n&&(p=Mt(E,x,d,p,r,S+c,1,1)),T=v.default.clone(E,T),E=A,g=v.default.negate(_,g);for(var F=1;F<h-1;F++){var M=n?2:1;A=e[F+1],_=v.default.subtract(A,E,_),_=v.default.normalize(_,_),y=v.default.add(_,g,y),y=v.default.normalize(y,y),b=r.geodeticSurfaceNormal(E,b);var I=v.default.multiplyByScalar(b,v.default.dot(_,b),Bt);v.default.subtract(_,I,I),v.default.normalize(I,I);var R=v.default.multiplyByScalar(b,v.default.dot(g,b),zt);if(v.default.subtract(g,R,R),v.default.normalize(R,R),!Le.default.equalsEpsilon(Math.abs(v.default.dot(I,R)),1,Le.default.EPSILON7)){y=v.default.cross(y,b,y),y=v.default.cross(b,y,y),y=v.default.normalize(y,y);var N=1/Math.max(.25,v.default.magnitude(v.default.cross(y,g,gt))),L=yt.angleIsGreaterThanPi(_,g,E,r);L?(w=v.default.add(E,v.default.multiplyByScalar(y,N*f,y),w),C=v.default.add(w,v.default.multiplyByScalar(x,f,C),C),st[0]=v.default.clone(T,st[0]),st[1]=v.default.clone(C,st[1]),P=wt(st,S+c,D+c,s),m=Rt(tt.a.generateArc({positions:st,granularity:s,ellipsoid:r}),x,u,m,r,P,1),x=v.default.cross(b,_,x),x=v.default.normalize(x,x),O=v.default.add(w,v.default.multiplyByScalar(x,f,O),O),l===$e.a.ROUNDED||l===$e.a.BEVELED?Ut(w,C,O,l,L,r,m,u,D+c,n):m=Mt(E,y=v.default.negate(y,y),u,m,r,D+c,N,M),T=v.default.clone(O,T)):(w=v.default.add(E,v.default.multiplyByScalar(y,N*f,y),w),C=v.default.add(w,v.default.multiplyByScalar(x,-f,C),C),st[0]=v.default.clone(T,st[0]),st[1]=v.default.clone(C,st[1]),P=wt(st,S+c,D+c,s),m=Rt(tt.a.generateArc({positions:st,granularity:s,ellipsoid:r}),x,u,m,r,P,1),x=v.default.cross(b,_,x),x=v.default.normalize(x,x),O=v.default.add(w,v.default.multiplyByScalar(x,-f,O),O),l===$e.a.ROUNDED||l===$e.a.BEVELED?Ut(w,C,O,l,L,r,m,u,D+c,n):m=Mt(E,y,u,m,r,D+c,N,M),T=v.default.clone(O,T)),g=v.default.negate(_,g)}else m=Mt(T,x,u,m,r,S+c,1,1),T=E;S=D,D=o[F+1],E=A}st[0]=v.default.clone(T,st[0]),st[1]=v.default.clone(E,st[1]),P=wt(st,S+c,D+c,s),m=Rt(tt.a.generateArc({positions:st,granularity:s,ellipsoid:r}),x,u,m,r,P,1),n&&(p=Mt(E,x,d,p,r,D+c,1,1)),h=m.length;var j=n?h+p.length:h,V=new Float64Array(j);return V.set(m),n&&V.set(p,h),V};var Ht=yt,kt={},Gt=new v.default,Wt=new v.default,Yt=new v.default,Xt=new v.default,Qt=[new v.default,new v.default],qt=new v.default,Zt=new v.default,Kt=new v.default,Jt=new v.default,$t=new v.default,ea=new v.default,ta=new v.default,aa=new v.default,ia=new v.default,na=new v.default,ra=new rt.default,oa=new et.default;function sa(e,t,a,i,n){var r,o=v.default.angleBetween(v.default.subtract(t,e,Gt),v.default.subtract(a,e,Wt)),s=i===$e.a.BEVELED?1:Math.ceil(o/Le.default.toRadians(5))+1,l=3*s,u=new Array(l);u[l-3]=a.x,u[l-2]=a.y,u[l-1]=a.z,r=n?et.default.fromQuaternion(rt.default.fromAxisAngle(v.default.negate(e,Gt),o/s,ra),oa):et.default.fromQuaternion(rt.default.fromAxisAngle(e,o/s,ra),oa);var d=0;t=v.default.clone(t,Gt);for(var c=0;c<s;c++)t=et.default.multiplyByVector(r,t,t),u[d++]=t.x,u[d++]=t.y,u[d++]=t.z;return u}function la(e,t,a,i){var n=Gt;return i?n=v.default.add(e,t,n):(t=v.default.negate(t,t),n=v.default.add(e,t,n)),[n.x,n.y,n.z,a.x,a.y,a.z]}function ua(e,t,a,i){for(var n=new Array(e.length),r=new Array(e.length),o=v.default.multiplyByScalar(t,a,Gt),s=v.default.negate(o,Wt),l=0,u=e.length-1,d=0;d<e.length;d+=3){var c=v.default.fromArray(e,d,Yt),f=v.default.add(c,s,Xt);n[l++]=f.x,n[l++]=f.y,n[l++]=f.z;var h=v.default.add(c,o,Xt);r[u--]=h.z,r[u--]=h.y,r[u--]=h.x}return i.push(n,r),i}kt.addAttribute=function(e,t,a,i){var n=t.x,r=t.y,o=t.z;Object(s.default)(a)&&(e[a]=n,e[a+1]=r,e[a+2]=o),Object(s.default)(i)&&(e[i]=o,e[i-1]=r,e[i-2]=n)};var da=new v.default,ca=new v.default;kt.computePositions=function(e){var t=e.granularity,a=e.positions,i=e.ellipsoid,n=e.width/2,r=e.cornerType,o=e.saveAttributes,s=qt,l=Zt,u=Kt,d=Jt,c=$t,f=ea,h=ta,m=aa,p=ia,_=na,g=[],y=o?[]:void 0,b=o?[]:void 0,w=a[0],C=a[1];l=v.default.normalize(v.default.subtract(C,w,l),l),s=i.geodeticSurfaceNormal(w,s),d=v.default.normalize(v.default.cross(s,l,d),d),o&&(y.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),h=v.default.clone(w,h),w=C,u=v.default.negate(l,u);var O,x,T=[],E=a.length;for(O=1;O<E-1;O++){s=i.geodeticSurfaceNormal(w,s),C=a[O+1],l=v.default.normalize(v.default.subtract(C,w,l),l),c=v.default.normalize(v.default.add(l,u,c),c);var A=v.default.multiplyByScalar(s,v.default.dot(l,s),da);v.default.subtract(l,A,A),v.default.normalize(A,A);var P=v.default.multiplyByScalar(s,v.default.dot(u,s),ca);if(v.default.subtract(u,P,P),v.default.normalize(P,P),!Le.default.equalsEpsilon(Math.abs(v.default.dot(A,P)),1,Le.default.EPSILON7)){c=v.default.cross(c,s,c),c=v.default.cross(s,c,c),c=v.default.normalize(c,c);var S=n/Math.max(.25,v.default.magnitude(v.default.cross(c,u,Gt))),D=Ht.angleIsGreaterThanPi(l,u,w,i);c=v.default.multiplyByScalar(c,S,c),D?(m=v.default.add(w,c,m),_=v.default.add(m,v.default.multiplyByScalar(d,n,_),_),p=v.default.add(m,v.default.multiplyByScalar(d,2*n,p),p),Qt[0]=v.default.clone(h,Qt[0]),Qt[1]=v.default.clone(_,Qt[1]),g=ua(tt.a.generateArc({positions:Qt,granularity:t,ellipsoid:i}),d,n,g),o&&(y.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),f=v.default.clone(p,f),d=v.default.normalize(v.default.cross(s,l,d),d),p=v.default.add(m,v.default.multiplyByScalar(d,2*n,p),p),h=v.default.add(m,v.default.multiplyByScalar(d,n,h),h),r===$e.a.ROUNDED||r===$e.a.BEVELED?T.push({leftPositions:sa(m,f,p,r,D)}):T.push({leftPositions:la(w,v.default.negate(c,c),p,D)})):(p=v.default.add(w,c,p),_=v.default.add(p,v.default.negate(v.default.multiplyByScalar(d,n,_),_),_),m=v.default.add(p,v.default.negate(v.default.multiplyByScalar(d,2*n,m),m),m),Qt[0]=v.default.clone(h,Qt[0]),Qt[1]=v.default.clone(_,Qt[1]),g=ua(tt.a.generateArc({positions:Qt,granularity:t,ellipsoid:i}),d,n,g),o&&(y.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),f=v.default.clone(m,f),d=v.default.normalize(v.default.cross(s,l,d),d),m=v.default.add(p,v.default.negate(v.default.multiplyByScalar(d,2*n,m),m),m),h=v.default.add(p,v.default.negate(v.default.multiplyByScalar(d,n,h),h),h),r===$e.a.ROUNDED||r===$e.a.BEVELED?T.push({rightPositions:sa(p,f,m,r,D)}):T.push({rightPositions:la(w,c,m,D)})),u=v.default.negate(l,u)}w=C}return s=i.geodeticSurfaceNormal(w,s),Qt[0]=v.default.clone(h,Qt[0]),Qt[1]=v.default.clone(w,Qt[1]),g=ua(tt.a.generateArc({positions:Qt,granularity:t,ellipsoid:i}),d,n,g),o&&(y.push(d.x,d.y,d.z),b.push(s.x,s.y,s.z)),r===$e.a.ROUNDED&&(x=function(e){var t=qt,a=Zt,i=Kt,n=e[1];a=v.default.fromArray(e[1],n.length-3,a),i=v.default.fromArray(e[0],0,i);var r=sa(t=v.default.midpoint(a,i,t),a,i,$e.a.ROUNDED,!1),o=e.length-1,s=e[o-1];return n=e[o],a=v.default.fromArray(s,s.length-3,a),i=v.default.fromArray(n,0,i),[r,sa(t=v.default.midpoint(a,i,t),a,i,$e.a.ROUNDED,!1)]}(g)),{positions:g,corners:T,lefts:y,normals:b,endPositions:x}};var fa=kt,ha=a(27),ma=a(51),pa=a(52),_a=a(64),ga=a(47),va=a(159),ya=a(46),ba=a(29),wa=new v.default,Ca=new v.default,Oa=new v.default,xa=new v.default,Ta=new v.default,Ea=new v.default,Aa=new v.default,Pa=new v.default;function Sa(e,t){for(var a=0;a<e.length;a++)e[a]=t.scaleToGeodeticSurface(e[a],e[a]);return e}function Da(e,t,a,i,n,r){var o=e.normals,s=e.tangents,l=e.bitangents,u=v.default.normalize(v.default.cross(a,t,Aa),Aa);r.normal&&fa.addAttribute(o,t,i,n),r.tangent&&fa.addAttribute(s,u,i,n),r.bitangent&&fa.addAttribute(l,a,i,n)}function Fa(e,t,a){var i,n,r,o=e.positions,l=e.corners,u=e.endPositions,d=e.lefts,c=e.normals,f=new _a.a,h=0,m=0,p=0;for(n=0;n<o.length;n+=2)h+=r=o[n].length-3,p+=2*r,m+=o[n+1].length-3;for(h+=3,m+=3,n=0;n<l.length;n++){i=l[n];var _=l[n].leftPositions;Object(s.default)(_)?(h+=r=_.length,p+=r):(m+=r=l[n].rightPositions.length,p+=r)}var g,y=Object(s.default)(u);y&&(h+=g=u[0].length-3,m+=g,p+=6*(g/=3));var b,w,C,O,x,T,E=h+m,A=new Float64Array(E),P={normals:t.normal?new Float32Array(E):void 0,tangents:t.tangent?new Float32Array(E):void 0,bitangents:t.bitangent?new Float32Array(E):void 0},S=0,D=E-1,F=wa,M=Ca,I=g/2,R=ga.a.createTypedArray(E/3,p),N=0;if(y){T=Oa,x=xa;var L=u[0];for(F=v.default.fromArray(c,0,F),M=v.default.fromArray(d,0,M),n=0;n<I;n++)T=v.default.fromArray(L,3*(I-1-n),T),x=v.default.fromArray(L,3*(I+n),x),fa.addAttribute(A,x,S),fa.addAttribute(A,T,void 0,D),Da(P,F,M,S,D,t),O=(w=S/3)+1,C=(b=(D-2)/3)-1,R[N++]=b,R[N++]=w,R[N++]=C,R[N++]=C,R[N++]=w,R[N++]=O,S+=3,D-=3}var j,V,U=0,B=0,z=o[U++],H=o[U++];for(A.set(z,S),A.set(H,D-H.length+1),M=v.default.fromArray(d,B,M),r=H.length-3,n=0;n<r;n+=3)j=a.geodeticSurfaceNormal(v.default.fromArray(z,n,Aa),Aa),V=a.geodeticSurfaceNormal(v.default.fromArray(H,r-n,Pa),Pa),Da(P,F=v.default.normalize(v.default.add(j,V,F),F),M,S,D,t),O=(w=S/3)+1,C=(b=(D-2)/3)-1,R[N++]=b,R[N++]=w,R[N++]=C,R[N++]=C,R[N++]=w,R[N++]=O,S+=3,D-=3;for(j=a.geodeticSurfaceNormal(v.default.fromArray(z,r,Aa),Aa),V=a.geodeticSurfaceNormal(v.default.fromArray(H,r,Pa),Pa),F=v.default.normalize(v.default.add(j,V,F),F),B+=3,n=0;n<l.length;n++){var k,G,W,Y=(i=l[n]).leftPositions,X=i.rightPositions,Q=Ea,q=Oa,Z=xa;if(F=v.default.fromArray(c,B,F),Object(s.default)(Y)){for(Da(P,F,M,void 0,D,t),D-=3,G=O,W=C,k=0;k<Y.length/3;k++)Q=v.default.fromArray(Y,3*k,Q),R[N++]=G,R[N++]=W-k-1,R[N++]=W-k,fa.addAttribute(A,Q,void 0,D),q=v.default.fromArray(A,3*(W-k-1),q),Z=v.default.fromArray(A,3*G,Z),Da(P,F,M=v.default.normalize(v.default.subtract(q,Z,M),M),void 0,D,t),D-=3;Q=v.default.fromArray(A,3*G,Q),q=v.default.subtract(v.default.fromArray(A,3*W,q),Q,q),Z=v.default.subtract(v.default.fromArray(A,3*(W-k),Z),Q,Z),Da(P,F,M=v.default.normalize(v.default.add(q,Z,M),M),S,void 0,t),S+=3}else{for(Da(P,F,M,S,void 0,t),S+=3,G=C,W=O,k=0;k<X.length/3;k++)Q=v.default.fromArray(X,3*k,Q),R[N++]=G,R[N++]=W+k,R[N++]=W+k+1,fa.addAttribute(A,Q,S),q=v.default.fromArray(A,3*G,q),Z=v.default.fromArray(A,3*(W+k),Z),Da(P,F,M=v.default.normalize(v.default.subtract(q,Z,M),M),S,void 0,t),S+=3;Q=v.default.fromArray(A,3*G,Q),q=v.default.subtract(v.default.fromArray(A,3*(W+k),q),Q,q),Z=v.default.subtract(v.default.fromArray(A,3*W,Z),Q,Z),Da(P,F,M=v.default.normalize(v.default.negate(v.default.add(Z,q,M),M),M),void 0,D,t),D-=3}for(z=o[U++],H=o[U++],z.splice(0,3),H.splice(H.length-3,3),A.set(z,S),A.set(H,D-H.length+1),r=H.length-3,B+=3,M=v.default.fromArray(d,B,M),k=0;k<H.length;k+=3)j=a.geodeticSurfaceNormal(v.default.fromArray(z,k,Aa),Aa),V=a.geodeticSurfaceNormal(v.default.fromArray(H,r-k,Pa),Pa),Da(P,F=v.default.normalize(v.default.add(j,V,F),F),M,S,D,t),w=(O=S/3)-1,b=(C=(D-2)/3)+1,R[N++]=b,R[N++]=w,R[N++]=C,R[N++]=C,R[N++]=w,R[N++]=O,S+=3,D-=3;S-=3,D+=3}if(Da(P,F=v.default.fromArray(c,c.length-3,F),M,S,D,t),y){S+=3,D-=3,T=Oa,x=xa;var K=u[1];for(n=0;n<I;n++)T=v.default.fromArray(K,3*(g-n-1),T),x=v.default.fromArray(K,3*n,x),fa.addAttribute(A,T,void 0,D),fa.addAttribute(A,x,S),Da(P,F,M,S,D,t),w=(O=S/3)-1,b=(C=(D-2)/3)+1,R[N++]=b,R[N++]=w,R[N++]=C,R[N++]=C,R[N++]=w,R[N++]=O,S+=3,D-=3}if(f.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:A}),t.st){var J,$,ee=new Float32Array(E/3*2),te=0;if(y){h/=3,m/=3;var ae,ie=Math.PI/(g+1);$=1/(h-g+1),J=1/(m-g+1);var ne=g/2;for(n=ne+1;n<g+1;n++)ae=Le.default.PI_OVER_TWO+ie*n,ee[te++]=J*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(n=1;n<m-g+1;n++)ee[te++]=n*J,ee[te++]=0;for(n=g;n>ne;n--)ae=Le.default.PI_OVER_TWO-n*ie,ee[te++]=1-J*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(n=ne;n>0;n--)ae=Le.default.PI_OVER_TWO-ie*n,ee[te++]=1-$*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae));for(n=h-g;n>0;n--)ee[te++]=n*$,ee[te++]=1;for(n=1;n<ne+1;n++)ae=Le.default.PI_OVER_TWO+ie*n,ee[te++]=$*(1+Math.cos(ae)),ee[te++]=.5*(1+Math.sin(ae))}else{for($=1/((h/=3)-1),J=1/((m/=3)-1),n=0;n<m;n++)ee[te++]=n*J,ee[te++]=0;for(n=h;n>0;n--)ee[te++]=(n-1)*$,ee[te++]=1}f.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:ee})}return t.normal&&(f.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:P.normals})),t.tangent&&(f.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:P.tangents})),t.bitangent&&(f.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:P.bitangents})),{attributes:f,indices:R}}function Ma(e,t,a){a[t++]=e[0],a[t++]=e[1],a[t++]=e[2];for(var i=3;i<e.length;i+=3){var n=e[i],r=e[i+1],o=e[i+2];a[t++]=n,a[t++]=r,a[t++]=o,a[t++]=n,a[t++]=r,a[t++]=o}return a[t++]=e[0],a[t++]=e[1],a[t++]=e[2],a}function Ia(e,t){var a=new K.default({position:t.position,normal:t.normal||t.bitangent||e.shadowVolume,tangent:t.tangent,bitangent:t.normal||t.bitangent,st:t.st}),i=e.ellipsoid,n=Fa(fa.computePositions(e),a,i),r=e.height,o=e.extrudedHeight,l=n.attributes,u=n.indices,d=l.position.values,c=d.length,f=new Float64Array(6*c),h=new Float64Array(c);h.set(d);var m,p=new Float64Array(4*c);p=Ma(d=va.a.scaleToGeodeticHeight(d,r,i),0,p),p=Ma(h=va.a.scaleToGeodeticHeight(h,o,i),2*c,p),f.set(d),f.set(h,c),f.set(p,2*c),l.position.values=f,l=function(e,t){if(!(t.normal||t.tangent||t.bitangent||t.st))return e;var a,i,n=e.position.values;(t.normal||t.bitangent)&&(a=e.normal.values,i=e.bitangent.values);var r,o=e.position.values.length/18,s=3*o,l=2*o,u=2*s;if(t.normal||t.bitangent||t.tangent){var d=t.normal?new Float32Array(6*s):void 0,c=t.tangent?new Float32Array(6*s):void 0,f=t.bitangent?new Float32Array(6*s):void 0,h=wa,m=Ca,p=Oa,_=xa,g=Ta,y=Ea,b=u;for(r=0;r<s;r+=3){var w=b+u;h=v.default.fromArray(n,r,h),m=v.default.fromArray(n,r+s,m),p=v.default.fromArray(n,(r+3)%s,p),m=v.default.subtract(m,h,m),p=v.default.subtract(p,h,p),_=v.default.normalize(v.default.cross(m,p,_),_),t.normal&&(fa.addAttribute(d,_,w),fa.addAttribute(d,_,w+3),fa.addAttribute(d,_,b),fa.addAttribute(d,_,b+3)),(t.tangent||t.bitangent)&&(y=v.default.fromArray(a,r,y),t.bitangent&&(fa.addAttribute(f,y,w),fa.addAttribute(f,y,w+3),fa.addAttribute(f,y,b),fa.addAttribute(f,y,b+3)),t.tangent&&(g=v.default.normalize(v.default.cross(y,_,g),g),fa.addAttribute(c,g,w),fa.addAttribute(c,g,w+3),fa.addAttribute(c,g,b),fa.addAttribute(c,g,b+3))),b+=6}if(t.normal){for(d.set(a),r=0;r<s;r+=3)d[r+s]=-a[r],d[r+s+1]=-a[r+1],d[r+s+2]=-a[r+2];e.normal.values=d}else e.normal=void 0;if(t.bitangent?(f.set(i),f.set(i,s),e.bitangent.values=f):e.bitangent=void 0,t.tangent){var C=e.tangent.values;c.set(C),c.set(C,s),e.tangent.values=c}}if(t.st){var O=e.st.values,x=new Float32Array(6*l);x.set(O),x.set(O,l);for(var T=2*l,E=0;E<2;E++){for(x[T++]=O[0],x[T++]=O[1],r=2;r<l;r+=2){var A=O[r],P=O[r+1];x[T++]=A,x[T++]=P,x[T++]=A,x[T++]=P}x[T++]=O[0],x[T++]=O[1]}e.st.values=x}return e}(l,t);var _=c/3;if(e.shadowVolume){var g=l.normal.values;c=g.length;var y=new Float32Array(6*c);for(m=0;m<c;m++)g[m]=-g[m];y.set(g,c),y=Ma(g,4*c,y),l.extrudeDirection=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:y}),t.normal||(l.normal=void 0)}if(Object(s.default)(e.offsetAttribute)){var b=new Uint8Array(6*_);if(e.offsetAttribute===ce.a.TOP)b=Object(Ke.a)(b,1,0,_),b=Object(Ke.a)(b,1,2*_,4*_);else{var w=e.offsetAttribute===ce.a.NONE?0:1;b=Object(Ke.a)(b,w)}l.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}var C=u.length,O=_+_,x=ga.a.createTypedArray(f.length/3,2*C+3*O);x.set(u);var T,E,A,P,S=C;for(m=0;m<C;m+=3){var D=u[m],F=u[m+1],M=u[m+2];x[S++]=M+_,x[S++]=F+_,x[S++]=D+_}for(m=0;m<O;m+=2)A=(T=m+O)+1,P=(E=T+O)+1,x[S++]=T,x[S++]=E,x[S++]=A,x[S++]=A,x[S++]=E,x[S++]=P;return{attributes:l,indices:x}}var Ra=new v.default,Na=new v.default,La=new Ne.default;function ja(e,t,a,i,n,r){var o=v.default.subtract(t,e,Ra);v.default.normalize(o,o);var s=a.geodeticSurfaceNormal(e,Na),l=v.default.cross(o,s,Ra);v.default.multiplyByScalar(l,i,l);var u=n.latitude,d=n.longitude,c=r.latitude,f=r.longitude;v.default.add(e,l,Na),a.cartesianToCartographic(Na,La);var h=La.latitude,m=La.longitude;u=Math.min(u,h),d=Math.min(d,m),c=Math.max(c,h),f=Math.max(f,m),v.default.subtract(e,l,Na),a.cartesianToCartographic(Na,La),h=La.latitude,m=La.longitude,u=Math.min(u,h),d=Math.min(d,m),c=Math.max(c,h),f=Math.max(f,m),n.latitude=u,n.longitude=d,r.latitude=c,r.longitude=f}var Va=new v.default,Ua=new v.default,Ba=new Ne.default,za=new Ne.default;function Ha(e,t,a,i,n){e=Sa(e,t);var r=Object(Je.a)(e,v.default.equalsEpsilon),o=r.length;if(o<2||a<=0)return new ba.default;var l,u,d=.5*a;if(Ba.latitude=Number.POSITIVE_INFINITY,Ba.longitude=Number.POSITIVE_INFINITY,za.latitude=Number.NEGATIVE_INFINITY,za.longitude=Number.NEGATIVE_INFINITY,i===$e.a.ROUNDED){var c=r[0];v.default.subtract(c,r[1],Va),v.default.normalize(Va,Va),v.default.multiplyByScalar(Va,d,Va),v.default.add(c,Va,Ua),t.cartesianToCartographic(Ua,La),l=La.latitude,u=La.longitude,Ba.latitude=Math.min(Ba.latitude,l),Ba.longitude=Math.min(Ba.longitude,u),za.latitude=Math.max(za.latitude,l),za.longitude=Math.max(za.longitude,u)}for(var f=0;f<o-1;++f)ja(r[f],r[f+1],t,d,Ba,za);var h=r[o-1];v.default.subtract(h,r[o-2],Va),v.default.normalize(Va,Va),v.default.multiplyByScalar(Va,d,Va),v.default.add(h,Va,Ua),ja(h,Ua,t,d,Ba,za),i===$e.a.ROUNDED&&(t.cartesianToCartographic(Ua,La),l=La.latitude,u=La.longitude,Ba.latitude=Math.min(Ba.latitude,l),Ba.longitude=Math.min(Ba.longitude,u),za.latitude=Math.max(za.latitude,l),za.longitude=Math.max(za.longitude,u));var m=Object(s.default)(n)?n:new ba.default;return m.north=za.latitude,m.south=Ba.latitude,m.east=za.longitude,m.west=Ba.longitude,m}function ka(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.width,i=Object(o.default)(e.height,0),n=Object(o.default)(e.extrudedHeight,i);this._positions=t,this._ellipsoid=ha.default.clone(Object(o.default)(e.ellipsoid,ha.default.WGS84)),this._vertexFormat=K.default.clone(Object(o.default)(e.vertexFormat,K.default.DEFAULT)),this._width=a,this._height=Math.max(i,n),this._extrudedHeight=Math.min(i,n),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this.packedLength=1+t.length*v.default.packedLength+ha.default.packedLength+K.default.packedLength+7}ka.pack=function(e,t,a){a=Object(o.default)(a,0);var i=e._positions,n=i.length;t[a++]=n;for(var r=0;r<n;++r,a+=v.default.packedLength)v.default.pack(i[r],t,a);return ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,K.default.pack(e._vertexFormat,t,a),a+=K.default.packedLength,t[a++]=e._width,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._cornerType,t[a++]=e._granularity,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Ga=ha.default.clone(ha.default.UNIT_SPHERE),Wa=new K.default,Ya={positions:void 0,ellipsoid:Ga,vertexFormat:Wa,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};ka.unpack=function(e,t,a){t=Object(o.default)(t,0);for(var i=e[t++],n=new Array(i),r=0;r<i;++r,t+=v.default.packedLength)n[r]=v.default.unpack(e,t);var l=ha.default.unpack(e,t,Ga);t+=ha.default.packedLength;var u=K.default.unpack(e,t,Wa);t+=K.default.packedLength;var d=e[t++],c=e[t++],f=e[t++],h=e[t++],m=e[t++],p=1===e[t++],_=e[t];return Object(s.default)(a)?(a._positions=n,a._ellipsoid=ha.default.clone(l,a._ellipsoid),a._vertexFormat=K.default.clone(u,a._vertexFormat),a._width=d,a._height=c,a._extrudedHeight=f,a._cornerType=h,a._granularity=m,a._shadowVolume=p,a._offsetAttribute=-1===_?void 0:_,a):(Ya.positions=n,Ya.width=d,Ya.height=c,Ya.extrudedHeight=f,Ya.cornerType=h,Ya.granularity=m,Ya.shadowVolume=p,Ya.offsetAttribute=-1===_?void 0:_,new ka(Ya))},ka.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,i=e.width;return Ha(a,Object(o.default)(e.ellipsoid,ha.default.WGS84),i,Object(o.default)(e.cornerType,$e.a.ROUNDED),t)},ka.createGeometry=function(e){var t=e._positions,a=e._width,i=e._ellipsoid;t=Sa(t,i);var r=Object(Je.a)(t,v.default.equalsEpsilon);if(!(r.length<2||a<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Le.default.equalsEpsilon(l,u,0,Le.default.EPSILON2),c=e._vertexFormat,f={ellipsoid:i,positions:r,width:a,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!0};if(d)f.height=l,f.extrudedHeight=u,f.shadowVolume=e._shadowVolume,f.offsetAttribute=e._offsetAttribute,o=Ia(f,c);else if((o=Fa(fa.computePositions(f),c,i)).attributes.position.values=va.a.scaleToGeodeticHeight(o.attributes.position.values,l,i),Object(s.default)(e._offsetAttribute)){var h=e._offsetAttribute===ce.a.NONE?0:1,m=o.attributes.position.values.length,p=new Uint8Array(m/3);Object(Ke.a)(p,h),o.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:p})}var _=o.attributes,g=n.default.fromVertices(_.position.values,void 0,3);return c.position||(o.attributes.position.values=void 0),new ma.a({attributes:_,indices:o.indices,primitiveType:ya.a.TRIANGLES,boundingSphere:g,offsetAttribute:e._offsetAttribute})}},ka.createShadowVolume=function(e,t,a){var i=e._granularity,n=e._ellipsoid,r=t(i,n),o=a(i,n);return new ka({positions:e._positions,width:e._width,cornerType:e._cornerType,ellipsoid:n,granularity:i,extrudedHeight:r,height:o,vertexFormat:K.default.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(ka.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=Ha(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});var Xa=ka,Qa=new v.default,qa=new v.default,Za=new v.default;function Ka(e,t){var a,i,n,r=[],o=e.positions,l=e.corners,u=e.endPositions,d=new _a.a,c=0,f=0,h=0;for(i=0;i<o.length;i+=2)c+=n=o[i].length-3,h+=n/3*4,f+=o[i+1].length-3;for(c+=3,f+=3,i=0;i<l.length;i++){a=l[i];var m=l[i].leftPositions;Object(s.default)(m)?(c+=n=m.length,h+=n/3*2):(f+=n=l[i].rightPositions.length,h+=n/3*2)}var p,_=Object(s.default)(u);_&&(c+=p=u[0].length-3,f+=p,h+=4*(p/=3));var g,y,b,w,C,O,x=c+f,T=new Float64Array(x),E=0,A=x-1,P=p/2,S=ga.a.createTypedArray(x/3,h+4),D=0;if(S[D++]=E/3,S[D++]=(A-2)/3,_){r.push(E/3),O=Qa,C=qa;var F=u[0];for(i=0;i<P;i++)O=v.default.fromArray(F,3*(P-1-i),O),C=v.default.fromArray(F,3*(P+i),C),fa.addAttribute(T,C,E),fa.addAttribute(T,O,void 0,A),w=(y=E/3)+1,b=(g=(A-2)/3)-1,S[D++]=g,S[D++]=b,S[D++]=y,S[D++]=w,E+=3,A-=3}var M=0,I=o[M++],R=o[M++];for(T.set(I,E),T.set(R,A-R.length+1),n=R.length-3,r.push(E/3,(A-2)/3),i=0;i<n;i+=3)w=(y=E/3)+1,b=(g=(A-2)/3)-1,S[D++]=g,S[D++]=b,S[D++]=y,S[D++]=w,E+=3,A-=3;for(i=0;i<l.length;i++){var N,L,j=(a=l[i]).leftPositions,V=a.rightPositions,U=Za;if(Object(s.default)(j)){for(A-=3,L=b,r.push(w),N=0;N<j.length/3;N++)U=v.default.fromArray(j,3*N,U),S[D++]=L-N-1,S[D++]=L-N,fa.addAttribute(T,U,void 0,A),A-=3;r.push(L-Math.floor(j.length/6)),t===$e.a.BEVELED&&r.push((A-2)/3+1),E+=3}else{for(E+=3,L=w,r.push(b),N=0;N<V.length/3;N++)U=v.default.fromArray(V,3*N,U),S[D++]=L+N,S[D++]=L+N+1,fa.addAttribute(T,U,E),E+=3;r.push(L+Math.floor(V.length/6)),t===$e.a.BEVELED&&r.push(E/3-1),A-=3}for(I=o[M++],R=o[M++],I.splice(0,3),R.splice(R.length-3,3),T.set(I,E),T.set(R,A-R.length+1),n=R.length-3,N=0;N<R.length;N+=3)y=(w=E/3)-1,g=(b=(A-2)/3)+1,S[D++]=g,S[D++]=b,S[D++]=y,S[D++]=w,E+=3,A-=3;E-=3,A+=3,r.push(E/3,(A-2)/3)}if(_){E+=3,A-=3,O=Qa,C=qa;var B=u[1];for(i=0;i<P;i++)O=v.default.fromArray(B,3*(p-i-1),O),C=v.default.fromArray(B,3*i,C),fa.addAttribute(T,O,void 0,A),fa.addAttribute(T,C,E),y=(w=E/3)-1,g=(b=(A-2)/3)+1,S[D++]=g,S[D++]=b,S[D++]=y,S[D++]=w,E+=3,A-=3;r.push(E/3)}else r.push(E/3,(A-2)/3);return S[D++]=E/3,S[D++]=(A-2)/3,d.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:T}),{attributes:d,indices:S,wallIndices:r}}function Ja(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.width,i=Object(o.default)(e.height,0),n=Object(o.default)(e.extrudedHeight,i);this._positions=t,this._ellipsoid=ha.default.clone(Object(o.default)(e.ellipsoid,ha.default.WGS84)),this._width=a,this._height=Math.max(i,n),this._extrudedHeight=Math.min(i,n),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._offsetAttribute=e.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+t.length*v.default.packedLength+ha.default.packedLength+6}Ja.pack=function(e,t,a){a=Object(o.default)(a,0);var i=e._positions,n=i.length;t[a++]=n;for(var r=0;r<n;++r,a+=v.default.packedLength)v.default.pack(i[r],t,a);return ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,t[a++]=e._width,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._cornerType,t[a++]=e._granularity,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var $a=ha.default.clone(ha.default.UNIT_SPHERE),ei={positions:void 0,ellipsoid:$a,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};Ja.unpack=function(e,t,a){t=Object(o.default)(t,0);for(var i=e[t++],n=new Array(i),r=0;r<i;++r,t+=v.default.packedLength)n[r]=v.default.unpack(e,t);var l=ha.default.unpack(e,t,$a);t+=ha.default.packedLength;var u=e[t++],d=e[t++],c=e[t++],f=e[t++],h=e[t++],m=e[t];return Object(s.default)(a)?(a._positions=n,a._ellipsoid=ha.default.clone(l,a._ellipsoid),a._width=u,a._height=d,a._extrudedHeight=c,a._cornerType=f,a._granularity=h,a._offsetAttribute=-1===m?void 0:m,a):(ei.positions=n,ei.width=u,ei.height=d,ei.extrudedHeight=c,ei.cornerType=f,ei.granularity=h,ei.offsetAttribute=-1===m?void 0:m,new Ja(ei))},Ja.createGeometry=function(e){var t=e._positions,a=e._width,i=e._ellipsoid;t=function(e,t){for(var a=0;a<e.length;a++)e[a]=t.scaleToGeodeticSurface(e[a],e[a]);return e}(t,i);var r=Object(Je.a)(t,v.default.equalsEpsilon);if(!(r.length<2||a<=0)){var o,l=e._height,u=e._extrudedHeight,d=!Le.default.equalsEpsilon(l,u,0,Le.default.EPSILON2),c={ellipsoid:i,positions:r,width:a,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!1};if(d)c.height=l,c.extrudedHeight=u,c.offsetAttribute=e._offsetAttribute,o=function(e){var t=e.ellipsoid,a=Ka(fa.computePositions(e),e.cornerType),i=a.wallIndices,n=e.height,r=e.extrudedHeight,o=a.attributes,l=a.indices,u=o.position.values,d=u.length,c=new Float64Array(d);c.set(u);var f,h=new Float64Array(2*d);if(u=va.a.scaleToGeodeticHeight(u,n,t),c=va.a.scaleToGeodeticHeight(c,r,t),h.set(u),h.set(c,d),o.position.values=h,d/=3,Object(s.default)(e.offsetAttribute)){var m=new Uint8Array(2*d);if(e.offsetAttribute===ce.a.TOP)m=Object(Ke.a)(m,1,0,d);else{var p=e.offsetAttribute===ce.a.NONE?0:1;m=Object(Ke.a)(m,p)}o.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:m})}var _=l.length,g=ga.a.createTypedArray(h.length/3,2*(_+i.length));g.set(l);var v,y,b=_;for(f=0;f<_;f+=2){var w=l[f],C=l[f+1];g[b++]=w+d,g[b++]=C+d}for(f=0;f<i.length;f++)y=(v=i[f])+d,g[b++]=v,g[b++]=y;return{attributes:o,indices:g}}(c);else if((o=Ka(fa.computePositions(c),c.cornerType)).attributes.position.values=va.a.scaleToGeodeticHeight(o.attributes.position.values,l,i),Object(s.default)(e._offsetAttribute)){var f=o.attributes.position.values.length,h=new Uint8Array(f/3),m=e._offsetAttribute===ce.a.NONE?0:1;Object(Ke.a)(h,m),o.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:h})}var p=o.attributes,_=n.default.fromVertices(p.position.values,void 0,3);return new ma.a({attributes:p,indices:o.indices,primitiveType:ya.a.LINES,boundingSphere:_,offsetAttribute:e._offsetAttribute})}};var ti=Ja,ai=new Ce.a(0);function ii(e){Ie.call(this,e),this._zIndex=0,this._terrainOffsetProperty=void 0}Object(s.default)(Object.create)&&(ii.prototype=Object.create(Ie.prototype),ii.prototype.constructor=ii),Object.defineProperties(ii.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),ii.prototype._isOnTerrain=function(e,t){return this._fillEnabled&&!Object(s.default)(t.height)&&!Object(s.default)(t.extrudedHeight)&&c.a.isSupported(this._scene)},ii.prototype._getIsClosed=function(e){var t=e.height,a=e.extrudedHeight;return 0===t||Object(s.default)(a)&&a!==t},ii.prototype._computeCenter=b.default.throwInstantiationError,ii.prototype._onEntityPropertyChanged=function(e,t,a,i){if(Ie.prototype._onEntityPropertyChanged.call(this,e,t,a,i),-1!==this._observedPropertyNames.indexOf(t)){var n=this._entity[this._geometryPropertyName];if(Object(s.default)(n)){Object(s.default)(n.zIndex)&&(Object(s.default)(n.height)||Object(s.default)(n.extrudedHeight))&&Object(we.a)(we.a.geometryZIndex),this._zIndex=Object(o.default)(n.zIndex,ai),Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);var r=n.heightReference,l=n.extrudedHeightReference;if(Object(s.default)(r)||Object(s.default)(l)){var u=new Re.default(this._computeCenter.bind(this),!this._dynamic);this._terrainOffsetProperty=new ze(this._scene,u,r,l)}}}},ii.prototype.destroy=function(){Object(s.default)(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),Ie.prototype.destroy.call(this)},ii.getGeometryHeight=function(e,t){if(Object(s.default)(e))return t!==O.default.CLAMP_TO_GROUND?e:0;t!==O.default.NONE&&Object(we.a)(we.a.geometryHeightReference)},ii.getGeometryExtrudedHeight=function(e,t){if(Object(s.default)(e))return t!==O.default.CLAMP_TO_GROUND?e:ii.CLAMP_TO_GROUND;t!==O.default.NONE&&Object(we.a)(we.a.geometryExtrudedHeightReference)},ii.CLAMP_TO_GROUND="clamp",ii.computeGeometryOffsetAttribute=function(e,t,a,i){Object(s.default)(e)&&Object(s.default)(t)||(t=O.default.NONE),Object(s.default)(a)&&Object(s.default)(i)||(i=O.default.NONE);var n=0;return t!==O.default.NONE&&n++,i===O.default.RELATIVE_TO_GROUND&&n++,2===n?ce.a.ALL:1===n?ce.a.TOP:void 0};var ni=ii,ri=new y.default,oi=v.default.ZERO,si=new v.default,li=new ba.default;function ui(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.cornerType=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.offsetAttribute=void 0}function di(e,t){ni.call(this,{entity:e,scene:t,geometryOptions:new ui(e),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]}),this._onEntityPropertyChanged(e,"corridor",e.corridor,void 0)}function ci(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(di.prototype=Object.create(ni.prototype),di.prototype.constructor=di),di.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),n={show:new me.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,ri)),Object(s.default)(t)||(t=y.default.WHITE),n.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,oi,si))),new de.a({id:a,geometry:new Xa(this._options),attributes:n})},di.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,ri),n={show:new me.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(i),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,oi,si))),new de.a({id:t,geometry:new ti(this._options),attributes:n})},di.prototype._computeCenter=function(e,t){var a=A.default.getValueOrUndefined(this._entity.corridor.positions,e);if(Object(s.default)(a)&&0!==a.length)return v.default.clone(a[Math.floor(a.length/2)],t)},di.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.width)||Ie.prototype._isHidden.call(this,e,t)},di.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!A.default.isConstant(t.height)||!A.default.isConstant(t.extrudedHeight)||!A.default.isConstant(t.granularity)||!A.default.isConstant(t.width)||!A.default.isConstant(t.outlineWidth)||!A.default.isConstant(t.cornerType)||!A.default.isConstant(t.zIndex)||this._onTerrain&&!A.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof pe.default)},di.prototype._setStaticOptions=function(e,t){var a=A.default.getValueOrUndefined(t.height,fe.default.MINIMUM_VALUE),n=A.default.getValueOrDefault(t.heightReference,fe.default.MINIMUM_VALUE,O.default.NONE),r=A.default.getValueOrUndefined(t.extrudedHeight,fe.default.MINIMUM_VALUE),o=A.default.getValueOrDefault(t.extrudedHeightReference,fe.default.MINIMUM_VALUE,O.default.NONE);Object(s.default)(r)&&!Object(s.default)(a)&&(a=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof pe.default?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,l.positions=t.positions.getValue(fe.default.MINIMUM_VALUE,l.positions),l.width=t.width.getValue(fe.default.MINIMUM_VALUE),l.granularity=A.default.getValueOrUndefined(t.granularity,fe.default.MINIMUM_VALUE),l.cornerType=A.default.getValueOrUndefined(t.cornerType,fe.default.MINIMUM_VALUE),l.offsetAttribute=ni.computeGeometryOffsetAttribute(a,n,r,o),l.height=ni.getGeometryHeight(a,n),(r=ni.getGeometryExtrudedHeight(r,o))===ni.CLAMP_TO_GROUND&&(r=i.a.getMinimumMaximumHeights(Xa.computeRectangle(l,li)).minimumTerrainHeight),l.extrudedHeight=r},di.DynamicGeometryUpdater=ci,Object(s.default)(Object.create)&&(ci.prototype=Object.create(be.prototype),ci.prototype.constructor=ci),ci.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.positions)||!Object(s.default)(i.width)||be.prototype._isHidden.call(this,e,t,a)},ci.prototype._setOptions=function(e,t,a){var n=this._options,r=A.default.getValueOrUndefined(t.height,a),o=A.default.getValueOrDefault(t.heightReference,a,O.default.NONE),l=A.default.getValueOrUndefined(t.extrudedHeight,a),u=A.default.getValueOrDefault(t.extrudedHeightReference,a,O.default.NONE);Object(s.default)(l)&&!Object(s.default)(r)&&(r=0),n.positions=A.default.getValueOrUndefined(t.positions,a),n.width=A.default.getValueOrUndefined(t.width,a),n.granularity=A.default.getValueOrUndefined(t.granularity,a),n.cornerType=A.default.getValueOrUndefined(t.cornerType,a),n.offsetAttribute=ni.computeGeometryOffsetAttribute(r,o,l,u),n.height=ni.getGeometryHeight(r,o),(l=ni.getGeometryExtrudedHeight(l,u))===ni.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(Xa.computeRectangle(n,li)).minimumTerrainHeight),n.extrudedHeight=l};var fi=di,hi={computePositions:function(e,t,a,i,n){var r,o=.5*e,s=-o,l=i+i,u=new Float64Array(3*(n?2*l:l)),d=0,c=0,f=n?3*l:0,h=n?3*(l+i):3*i;for(r=0;r<i;r++){var m=r/i*Le.default.TWO_PI,p=Math.cos(m),_=Math.sin(m),g=p*a,v=_*a,y=p*t,b=_*t;u[c+f]=g,u[c+f+1]=v,u[c+f+2]=s,u[c+h]=y,u[c+h+1]=b,u[c+h+2]=o,c+=3,n&&(u[d++]=g,u[d++]=v,u[d++]=s,u[d++]=y,u[d++]=b,u[d++]=o)}return u}},mi=hi,pi=new g.default,_i=new v.default,gi=new v.default,vi=new v.default,yi=new v.default;function bi(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,a=e.topRadius,i=e.bottomRadius,n=Object(o.default)(e.vertexFormat,K.default.DEFAULT),r=Object(o.default)(e.slices,128);this._length=t,this._topRadius=a,this._bottomRadius=i,this._vertexFormat=K.default.clone(n),this._slices=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderGeometry"}bi.packedLength=K.default.packedLength+5,bi.pack=function(e,t,a){return a=Object(o.default)(a,0),K.default.pack(e._vertexFormat,t,a),a+=K.default.packedLength,t[a++]=e._length,t[a++]=e._topRadius,t[a++]=e._bottomRadius,t[a++]=e._slices,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var wi,Ci=new K.default,Oi={vertexFormat:Ci,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};bi.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=K.default.unpack(e,t,Ci);t+=K.default.packedLength;var n=e[t++],r=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(a)?(a._vertexFormat=K.default.clone(i,a._vertexFormat),a._length=n,a._topRadius=r,a._bottomRadius=l,a._slices=u,a._offsetAttribute=-1===d?void 0:d,a):(Oi.length=n,Oi.topRadius=r,Oi.bottomRadius=l,Oi.slices=u,Oi.offsetAttribute=-1===d?void 0:d,new bi(Oi))},bi.createGeometry=function(e){var t=e._length,a=e._topRadius,i=e._bottomRadius,r=e._vertexFormat,o=e._slices;if(!(t<=0||a<0||i<0||0===a&&0===i)){var l,u=o+o,d=o+u,c=u+u,f=mi.computePositions(t,a,i,o,!0),h=r.st?new Float32Array(2*c):void 0,m=r.normal?new Float32Array(3*c):void 0,p=r.tangent?new Float32Array(3*c):void 0,_=r.bitangent?new Float32Array(3*c):void 0,y=r.normal||r.tangent||r.bitangent;if(y){var b=r.tangent||r.bitangent,w=0,C=0,O=0,x=Math.atan2(i-a,t),T=_i;T.z=Math.sin(x);var E=Math.cos(x),A=vi,P=gi;for(l=0;l<o;l++){var S=l/o*Le.default.TWO_PI,D=E*Math.cos(S),F=E*Math.sin(S);y&&(T.x=D,T.y=F,b&&(A=v.default.normalize(v.default.cross(v.default.UNIT_Z,T,A),A)),r.normal&&(m[w++]=T.x,m[w++]=T.y,m[w++]=T.z,m[w++]=T.x,m[w++]=T.y,m[w++]=T.z),r.tangent&&(p[C++]=A.x,p[C++]=A.y,p[C++]=A.z,p[C++]=A.x,p[C++]=A.y,p[C++]=A.z),r.bitangent&&(P=v.default.normalize(v.default.cross(T,A,P),P),_[O++]=P.x,_[O++]=P.y,_[O++]=P.z,_[O++]=P.x,_[O++]=P.y,_[O++]=P.z))}for(l=0;l<o;l++)r.normal&&(m[w++]=0,m[w++]=0,m[w++]=-1),r.tangent&&(p[C++]=1,p[C++]=0,p[C++]=0),r.bitangent&&(_[O++]=0,_[O++]=-1,_[O++]=0);for(l=0;l<o;l++)r.normal&&(m[w++]=0,m[w++]=0,m[w++]=1),r.tangent&&(p[C++]=1,p[C++]=0,p[C++]=0),r.bitangent&&(_[O++]=0,_[O++]=1,_[O++]=0)}var M=12*o-12,I=ga.a.createTypedArray(c,M),R=0,N=0;for(l=0;l<o-1;l++)I[R++]=N,I[R++]=N+2,I[R++]=N+3,I[R++]=N,I[R++]=N+3,I[R++]=N+1,N+=2;for(I[R++]=u-2,I[R++]=0,I[R++]=1,I[R++]=u-2,I[R++]=1,I[R++]=u-1,l=1;l<o-1;l++)I[R++]=u+l+1,I[R++]=u+l,I[R++]=u;for(l=1;l<o-1;l++)I[R++]=d,I[R++]=d+l,I[R++]=d+l+1;var L=0;if(r.st){var j=Math.max(a,i);for(l=0;l<c;l++){var V=v.default.fromArray(f,3*l,yi);h[L++]=(V.x+j)/(2*j),h[L++]=(V.y+j)/(2*j)}}var U=new _a.a;r.position&&(U.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:f})),r.normal&&(U.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),r.tangent&&(U.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),r.bitangent&&(U.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),r.st&&(U.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),pi.x=.5*t,pi.y=Math.max(i,a);var B=new n.default(v.default.ZERO,g.default.magnitude(pi));if(Object(s.default)(e._offsetAttribute)){t=f.length;var z=new Uint8Array(t/3),H=e._offsetAttribute===ce.a.NONE?0:1;Object(Ke.a)(z,H),U.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:z})}return new ma.a({attributes:U,indices:I,primitiveType:ya.a.TRIANGLES,boundingSphere:B,offsetAttribute:e._offsetAttribute})}},bi.getUnitCylinder=function(){return Object(s.default)(wi)||(wi=bi.createGeometry(new bi({topRadius:1,bottomRadius:1,length:1,vertexFormat:K.default.POSITION_ONLY}))),wi};var xi=bi,Ti=new g.default;function Ei(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).length,a=e.topRadius,i=e.bottomRadius,n=Object(o.default)(e.slices,128),r=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0);this._length=t,this._topRadius=a,this._bottomRadius=i,this._slices=n,this._numberOfVerticalLines=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createCylinderOutlineGeometry"}Ei.packedLength=6,Ei.pack=function(e,t,a){return a=Object(o.default)(a,0),t[a++]=e._length,t[a++]=e._topRadius,t[a++]=e._bottomRadius,t[a++]=e._slices,t[a++]=e._numberOfVerticalLines,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Ai={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};Ei.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=e[t++],n=e[t++],r=e[t++],l=e[t++],u=e[t++],d=e[t];return Object(s.default)(a)?(a._length=i,a._topRadius=n,a._bottomRadius=r,a._slices=l,a._numberOfVerticalLines=u,a._offsetAttribute=-1===d?void 0:d,a):(Ai.length=i,Ai.topRadius=n,Ai.bottomRadius=r,Ai.slices=l,Ai.numberOfVerticalLines=u,Ai.offsetAttribute=-1===d?void 0:d,new Ei(Ai))},Ei.createGeometry=function(e){var t=e._length,a=e._topRadius,i=e._bottomRadius,r=e._slices,o=e._numberOfVerticalLines;if(!(t<=0||a<0||i<0||0===a&&0===i)){var l,u=2*r,d=mi.computePositions(t,a,i,r,!1),c=2*r;if(o>0){var f=Math.min(o,r);l=Math.round(r/f),c+=f}var h,m=ga.a.createTypedArray(u,2*c),p=0;for(h=0;h<r-1;h++)m[p++]=h,m[p++]=h+1,m[p++]=h+r,m[p++]=h+1+r;if(m[p++]=r-1,m[p++]=0,m[p++]=r+r-1,m[p++]=r,o>0)for(h=0;h<r;h+=l)m[p++]=h,m[p++]=h+r;var _=new _a.a;_.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:d}),Ti.x=.5*t,Ti.y=Math.max(i,a);var y=new n.default(v.default.ZERO,g.default.magnitude(Ti));if(Object(s.default)(e._offsetAttribute)){t=d.length;var b=new Uint8Array(t/3),w=e._offsetAttribute===ce.a.NONE?0:1;Object(Ke.a)(b,w),_.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}return new ma.a({attributes:_,indices:m,primitiveType:ya.a.LINES,boundingSphere:y,offsetAttribute:e._offsetAttribute})}};var Pi=Ei,Si=v.default.ZERO,Di=new v.default,Fi=new v.default,Mi=new y.default;function Ii(e){this.id=e,this.vertexFormat=void 0,this.length=void 0,this.topRadius=void 0,this.bottomRadius=void 0,this.slices=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Ri(e,t){Ie.call(this,{entity:e,scene:t,geometryOptions:new Ii(e),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]}),this._onEntityPropertyChanged(e,"cylinder",e.cylinder,void 0)}function Ni(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(Ri.prototype=Object.create(Ie.prototype),Ri.prototype.constructor=Ri),Object.defineProperties(Ri.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),Ri.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),n=new me.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),r=this._distanceDisplayConditionProperty.getValue(e),o={show:n,distanceDisplayCondition:ue.fromDistanceDisplayCondition(r),color:void 0,offset:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,Mi)),Object(s.default)(t)||(t=y.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(o.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Si,Di))),new de.a({id:a,geometry:new xi(this._options),modelMatrix:a.computeModelMatrixForHeightReference(e,a.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:o})},Ri.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,Mi),n=this._distanceDisplayConditionProperty.getValue(e),r={show:new me.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(i),distanceDisplayCondition:ue.fromDistanceDisplayCondition(n),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Si,Di))),new de.a({id:t,geometry:new Pi(this._options),modelMatrix:t.computeModelMatrixForHeightReference(e,t.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:r})},Ri.prototype._computeCenter=function(e,t){return A.default.getValueOrUndefined(this._entity.position,e,t)},Ri.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.length)||!Object(s.default)(t.topRadius)||!Object(s.default)(t.bottomRadius)||Ie.prototype._isHidden.call(this,e,t)},Ri.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&A.default.isConstant(e.orientation)&&t.length.isConstant&&t.topRadius.isConstant&&t.bottomRadius.isConstant&&A.default.isConstant(t.slices)&&A.default.isConstant(t.outlineWidth)&&A.default.isConstant(t.numberOfVerticalLines))},Ri.prototype._setStaticOptions=function(e,t){var a=A.default.getValueOrDefault(t.heightReference,fe.default.MINIMUM_VALUE,O.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof pe.default?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,i.length=t.length.getValue(fe.default.MINIMUM_VALUE),i.topRadius=t.topRadius.getValue(fe.default.MINIMUM_VALUE),i.bottomRadius=t.bottomRadius.getValue(fe.default.MINIMUM_VALUE),i.slices=A.default.getValueOrUndefined(t.slices,fe.default.MINIMUM_VALUE),i.numberOfVerticalLines=A.default.getValueOrUndefined(t.numberOfVerticalLines,fe.default.MINIMUM_VALUE),i.offsetAttribute=a!==O.default.NONE?ce.a.ALL:void 0},Ri.prototype._onEntityPropertyChanged=He,Ri.DynamicGeometryUpdater=Ni,Object(s.default)(Object.create)&&(Ni.prototype=Object.create(be.prototype),Ni.prototype.constructor=Ni),Ni.prototype._isHidden=function(e,t,a){var i=this._options,n=A.default.getValueOrUndefined(e.position,a,Fi);return!Object(s.default)(n)||!Object(s.default)(i.length)||!Object(s.default)(i.topRadius)||!Object(s.default)(i.bottomRadius)||be.prototype._isHidden.call(this,e,t,a)},Ni.prototype._setOptions=function(e,t,a){var i=A.default.getValueOrDefault(t.heightReference,a,O.default.NONE),n=this._options;n.length=A.default.getValueOrUndefined(t.length,a),n.topRadius=A.default.getValueOrUndefined(t.topRadius,a),n.bottomRadius=A.default.getValueOrUndefined(t.bottomRadius,a),n.slices=A.default.getValueOrUndefined(t.slices,a),n.numberOfVerticalLines=A.default.getValueOrUndefined(t.numberOfVerticalLines,a),n.offsetAttribute=i!==O.default.NONE?ce.a.ALL:void 0};var Li=Ri;function ji(e,t){this._primitives=e,this._orderedGroundPrimitives=t,this._dynamicUpdaters=new p.default}ji.prototype.add=function(e,t){this._dynamicUpdaters.set(t.id,t.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))},ji.prototype.remove=function(e){var t=e.id,a=this._dynamicUpdaters.get(t);Object(s.default)(a)&&(this._dynamicUpdaters.remove(t),a.destroy())},ji.prototype.update=function(e){for(var t=this._dynamicUpdaters.values,a=0,i=t.length;a<i;a++)t[a].update(e);return!0},ji.prototype.removeAllPrimitives=function(){for(var e=this._dynamicUpdaters.values,t=0,a=e.length;t<a;t++)e[t].destroy();this._dynamicUpdaters.removeAll()},ji.prototype.getBoundingSphere=function(e,t){return e=this._dynamicUpdaters.get(e.id),Object(s.default)(e)&&Object(s.default)(e.getBoundingSphere)?e.getBoundingSphere(t):E.default.FAILED};var Vi=ji,Ui={},Bi=new v.default,zi=new v.default,Hi=new rt.default,ki=new et.default;function Gi(e,t,a,i,n,r,o,s,l,u){var d=e+t;v.default.multiplyByScalar(i,Math.cos(d),Bi),v.default.multiplyByScalar(a,Math.sin(d),zi),v.default.add(Bi,zi,Bi);var c=Math.cos(e);c*=c;var f=Math.sin(e);f*=f;var h=r/Math.sqrt(o*c+n*f)/s;return rt.default.fromAxisAngle(Bi,h,Hi),et.default.fromQuaternion(Hi,ki),et.default.multiplyByVector(ki,l,u),v.default.normalize(u,u),v.default.multiplyByScalar(u,s,u),u}var Wi=new v.default,Yi=new v.default,Xi=new v.default,Qi=new v.default;Ui.raisePositionsToHeight=function(e,t,a){for(var i=t.ellipsoid,n=t.height,r=t.extrudedHeight,o=a?e.length/3*2:e.length/3,s=new Float64Array(3*o),l=e.length,u=a?l:0,d=0;d<l;d+=3){var c=d+1,f=d+2,h=v.default.fromArray(e,d,Wi);i.scaleToGeodeticSurface(h,h);var m=v.default.clone(h,Yi),p=i.geodeticSurfaceNormal(h,Qi),_=v.default.multiplyByScalar(p,n,Xi);v.default.add(h,_,h),a&&(v.default.multiplyByScalar(p,r,_),v.default.add(m,_,m),s[d+u]=m.x,s[c+u]=m.y,s[f+u]=m.z),s[d]=h.x,s[c]=h.y,s[f]=h.z}return s};var qi=new v.default,Zi=new v.default,Ki=new v.default;Ui.computeEllipsePositions=function(e,t,a){var i=e.semiMinorAxis,n=e.semiMajorAxis,r=e.rotation,o=e.center,s=8*e.granularity,l=i*i,u=n*n,d=n*i,c=v.default.magnitude(o),f=v.default.normalize(o,qi),h=v.default.cross(v.default.UNIT_Z,o,Zi);h=v.default.normalize(h,h);var m=v.default.cross(f,h,Ki),p=1+Math.ceil(Le.default.PI_OVER_TWO/s),_=Le.default.PI_OVER_TWO/(p-1),g=Le.default.PI_OVER_TWO-p*_;g<0&&(p-=Math.ceil(Math.abs(g)/_));var y,b,w,C,O,x=t?new Array(3*(p*(p+2)*2)):void 0,T=0,E=Wi,A=Yi,P=4*p*3,S=P-1,D=0,F=a?new Array(P):void 0;for(E=Gi(g=Le.default.PI_OVER_TWO,r,m,h,l,d,u,c,f,E),t&&(x[T++]=E.x,x[T++]=E.y,x[T++]=E.z),a&&(F[S--]=E.z,F[S--]=E.y,F[S--]=E.x),g=Le.default.PI_OVER_TWO-_,y=1;y<p+1;++y){if(E=Gi(g,r,m,h,l,d,u,c,f,E),A=Gi(Math.PI-g,r,m,h,l,d,u,c,f,A),t){for(x[T++]=E.x,x[T++]=E.y,x[T++]=E.z,w=2*y+2,b=1;b<w-1;++b)C=b/(w-1),O=v.default.lerp(E,A,C,Xi),x[T++]=O.x,x[T++]=O.y,x[T++]=O.z;x[T++]=A.x,x[T++]=A.y,x[T++]=A.z}a&&(F[S--]=E.z,F[S--]=E.y,F[S--]=E.x,F[D++]=A.x,F[D++]=A.y,F[D++]=A.z),g=Le.default.PI_OVER_TWO-(y+1)*_}for(y=p;y>1;--y){if(E=Gi(-(g=Le.default.PI_OVER_TWO-(y-1)*_),r,m,h,l,d,u,c,f,E),A=Gi(g+Math.PI,r,m,h,l,d,u,c,f,A),t){for(x[T++]=E.x,x[T++]=E.y,x[T++]=E.z,w=2*(y-1)+2,b=1;b<w-1;++b)C=b/(w-1),O=v.default.lerp(E,A,C,Xi),x[T++]=O.x,x[T++]=O.y,x[T++]=O.z;x[T++]=A.x,x[T++]=A.y,x[T++]=A.z}a&&(F[S--]=E.z,F[S--]=E.y,F[S--]=E.x,F[D++]=A.x,F[D++]=A.y,F[D++]=A.z)}E=Gi(-(g=Le.default.PI_OVER_TWO),r,m,h,l,d,u,c,f,E);var M={};return t&&(x[T++]=E.x,x[T++]=E.y,x[T++]=E.z,M.positions=x,M.numPts=p),a&&(F[S--]=E.z,F[S--]=E.y,F[S--]=E.x,M.outerPositions=F),M};var Ji=Ui,$i=a(105),en=a(121),tn=new v.default,an=new v.default,nn=new v.default,rn=new v.default,on=new g.default,sn=new et.default,ln=new et.default,un=new rt.default,dn=new v.default,cn=new v.default,fn=new v.default,hn=new Ne.default,mn=new v.default,pn=new g.default,_n=new g.default;function gn(e,t,a){var i=t.vertexFormat,n=t.center,r=t.semiMajorAxis,o=t.semiMinorAxis,l=t.ellipsoid,u=t.stRotation,d=a?e.length/3*2:e.length/3,c=t.shadowVolume,f=i.st?new Float32Array(2*d):void 0,h=i.normal?new Float32Array(3*d):void 0,m=i.tangent?new Float32Array(3*d):void 0,p=i.bitangent?new Float32Array(3*d):void 0,_=c?new Float32Array(3*d):void 0,y=0,b=dn,w=cn,C=fn,O=new $i.a(l),x=O.project(l.cartesianToCartographic(n,hn),mn),T=l.scaleToGeodeticSurface(n,tn);l.geodeticSurfaceNormal(T,T);var E=sn,A=ln;if(0!==u){var P=rt.default.fromAxisAngle(T,u,un);E=et.default.fromQuaternion(P,E),P=rt.default.fromAxisAngle(T,-u,un),A=et.default.fromQuaternion(P,A)}else E=et.default.clone(et.default.IDENTITY,E),A=et.default.clone(et.default.IDENTITY,A);for(var S=g.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,pn),D=g.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,_n),F=e.length,M=a?F:0,I=M/3*2,R=0;R<F;R+=3){var N=R+1,L=R+2,j=v.default.fromArray(e,R,tn);if(i.st){var V=et.default.multiplyByVector(E,j,an),U=O.project(l.cartesianToCartographic(V,hn),nn);v.default.subtract(U,x,U),on.x=(U.x+r)/(2*r),on.y=(U.y+o)/(2*o),S.x=Math.min(on.x,S.x),S.y=Math.min(on.y,S.y),D.x=Math.max(on.x,D.x),D.y=Math.max(on.y,D.y),a&&(f[y+I]=on.x,f[y+1+I]=on.y),f[y++]=on.x,f[y++]=on.y}(i.normal||i.tangent||i.bitangent||c)&&(b=l.geodeticSurfaceNormal(j,b),c&&(_[R+M]=-b.x,_[N+M]=-b.y,_[L+M]=-b.z),(i.normal||i.tangent||i.bitangent)&&((i.tangent||i.bitangent)&&(w=v.default.normalize(v.default.cross(v.default.UNIT_Z,b,w),w),et.default.multiplyByVector(A,w,w)),i.normal&&(h[R]=b.x,h[N]=b.y,h[L]=b.z,a&&(h[R+M]=-b.x,h[N+M]=-b.y,h[L+M]=-b.z)),i.tangent&&(m[R]=w.x,m[N]=w.y,m[L]=w.z,a&&(m[R+M]=-w.x,m[N+M]=-w.y,m[L+M]=-w.z)),i.bitangent&&(C=v.default.normalize(v.default.cross(b,w,C),C),p[R]=C.x,p[N]=C.y,p[L]=C.z,a&&(p[R+M]=C.x,p[N+M]=C.y,p[L+M]=C.z))))}if(i.st){F=f.length;for(var B=0;B<F;B+=2)f[B]=(f[B]-S.x)/(D.x-S.x),f[B+1]=(f[B+1]-S.y)/(D.y-S.y)}var z=new _a.a;if(i.position){var H=Ji.raisePositionsToHeight(e,t,a);z.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:H})}if(i.st&&(z.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:f})),i.normal&&(z.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:h})),i.tangent&&(z.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),i.bitangent&&(z.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),c&&(z.extrudeDirection=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),a&&Object(s.default)(t.offsetAttribute)){var k=new Uint8Array(d);if(t.offsetAttribute===ce.a.TOP)k=Object(Ke.a)(k,1,0,d/2);else{var G=t.offsetAttribute===ce.a.NONE?0:1;k=Object(Ke.a)(k,G)}z.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:k})}return z}function vn(e){var t,a,i,n,r,o=new Array(e*(e+1)*12-6),s=0;for(t=0,i=1,n=0;n<3;n++)o[s++]=i++,o[s++]=t,o[s++]=i;for(n=2;n<e+1;++n){for(i=n*(n+1)-1,t=(n-1)*n-1,o[s++]=i++,o[s++]=t,o[s++]=i,a=2*n,r=0;r<a-1;++r)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;o[s++]=i++,o[s++]=t,o[s++]=i}for(a=2*e,++i,++t,n=0;n<a-1;++n)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;for(o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t++,o[s++]=t,++t,n=e-1;n>1;--n){for(o[s++]=t++,o[s++]=t,o[s++]=i,a=2*n,r=0;r<a-1;++r)o[s++]=i,o[s++]=t++,o[s++]=t,o[s++]=i++,o[s++]=t,o[s++]=i;o[s++]=t++,o[s++]=t++,o[s++]=i++}for(n=0;n<3;n++)o[s++]=t++,o[s++]=t,o[s++]=i;return o}var yn=new v.default;var bn=new n.default,wn=new n.default;function Cn(e){var t=e.center,a=e.ellipsoid,i=e.semiMajorAxis,r=v.default.multiplyByScalar(a.geodeticSurfaceNormal(t,tn),e.height,tn);bn.center=v.default.add(t,r,bn.center),bn.radius=i,r=v.default.multiplyByScalar(a.geodeticSurfaceNormal(t,r),e.extrudedHeight,r),wn.center=v.default.add(t,r,wn.center),wn.radius=i;var o=Ji.computeEllipsePositions(e,!0,!0),l=o.positions,u=o.numPts,d=o.outerPositions,c=n.default.union(bn,wn),f=gn(l,e,!0),h=vn(u),m=h.length;h.length=2*m;for(var p=l.length/3,_=0;_<m;_+=3)h[_+m]=h[_+2]+p,h[_+1+m]=h[_+1]+p,h[_+2+m]=h[_]+p;var y=ga.a.createTypedArray(2*p/3,h),b=new ma.a({attributes:f,indices:y,primitiveType:ya.a.TRIANGLES}),w=function(e,t){var a=t.vertexFormat,i=t.center,n=t.semiMajorAxis,r=t.semiMinorAxis,o=t.ellipsoid,l=t.height,u=t.extrudedHeight,d=t.stRotation,c=e.length/3*2,f=new Float64Array(3*c),h=a.st?new Float32Array(2*c):void 0,m=a.normal?new Float32Array(3*c):void 0,p=a.tangent?new Float32Array(3*c):void 0,_=a.bitangent?new Float32Array(3*c):void 0,y=t.shadowVolume,b=y?new Float32Array(3*c):void 0,w=0,C=dn,O=cn,x=fn,T=new $i.a(o),E=T.project(o.cartesianToCartographic(i,hn),mn),A=o.scaleToGeodeticSurface(i,tn);o.geodeticSurfaceNormal(A,A);for(var P=rt.default.fromAxisAngle(A,d,un),S=et.default.fromQuaternion(P,sn),D=g.default.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,pn),F=g.default.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,_n),M=e.length,I=M/3*2,R=0;R<M;R+=3){var N,L=R+1,j=R+2,V=v.default.fromArray(e,R,tn);if(a.st){var U=et.default.multiplyByVector(S,V,an),B=T.project(o.cartesianToCartographic(U,hn),nn);v.default.subtract(B,E,B),on.x=(B.x+n)/(2*n),on.y=(B.y+r)/(2*r),D.x=Math.min(on.x,D.x),D.y=Math.min(on.y,D.y),F.x=Math.max(on.x,F.x),F.y=Math.max(on.y,F.y),h[w+I]=on.x,h[w+1+I]=on.y,h[w++]=on.x,h[w++]=on.y}V=o.scaleToGeodeticSurface(V,V),N=v.default.clone(V,an),C=o.geodeticSurfaceNormal(V,C),y&&(b[R+M]=-C.x,b[L+M]=-C.y,b[j+M]=-C.z);var z=v.default.multiplyByScalar(C,l,rn);if(V=v.default.add(V,z,V),z=v.default.multiplyByScalar(C,u,z),N=v.default.add(N,z,N),a.position&&(f[R+M]=N.x,f[L+M]=N.y,f[j+M]=N.z,f[R]=V.x,f[L]=V.y,f[j]=V.z),a.normal||a.tangent||a.bitangent){x=v.default.clone(C,x);var H=v.default.fromArray(e,(R+3)%M,rn);v.default.subtract(H,V,H);var k=v.default.subtract(N,V,nn);C=v.default.normalize(v.default.cross(k,H,C),C),a.normal&&(m[R]=C.x,m[L]=C.y,m[j]=C.z,m[R+M]=C.x,m[L+M]=C.y,m[j+M]=C.z),a.tangent&&(O=v.default.normalize(v.default.cross(x,C,O),O),p[R]=O.x,p[L]=O.y,p[j]=O.z,p[R+M]=O.x,p[R+1+M]=O.y,p[R+2+M]=O.z),a.bitangent&&(_[R]=x.x,_[L]=x.y,_[j]=x.z,_[R+M]=x.x,_[L+M]=x.y,_[j+M]=x.z)}}if(a.st){M=h.length;for(var G=0;G<M;G+=2)h[G]=(h[G]-D.x)/(F.x-D.x),h[G+1]=(h[G+1]-D.y)/(F.y-D.y)}var W=new _a.a;if(a.position&&(W.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:f})),a.st&&(W.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),a.normal&&(W.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:m})),a.tangent&&(W.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:p})),a.bitangent&&(W.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),y&&(W.extrudeDirection=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),Object(s.default)(t.offsetAttribute)){var Y=new Uint8Array(c);if(t.offsetAttribute===ce.a.TOP)Y=Object(Ke.a)(Y,1,0,c/2);else{var X=t.offsetAttribute===ce.a.NONE?0:1;Y=Object(Ke.a)(Y,X)}W.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:Y})}return W}(d,e);h=function(e){for(var t=e.length/3,a=ga.a.createTypedArray(t,6*t),i=0,n=0;n<t;n++){var r=n,o=n+t,s=(r+1)%t,l=s+t;a[i++]=r,a[i++]=o,a[i++]=s,a[i++]=s,a[i++]=o,a[i++]=l}return a}(d);var C=ga.a.createTypedArray(2*d.length/3,h),O=new ma.a({attributes:w,indices:C,primitiveType:ya.a.TRIANGLES}),x=en.a.combineInstances([new de.a({geometry:b}),new de.a({geometry:O})]);return{boundingSphere:c,attributes:x[0].attributes,indices:x[0].indices}}function On(e,t,a,i,n,r,o){for(var s=Ji.computeEllipsePositions({center:e,semiMajorAxis:t,semiMinorAxis:a,rotation:i,granularity:n},!1,!0).outerPositions,l=s.length/3,u=new Array(l),d=0;d<l;++d)u[d]=v.default.fromArray(s,3*d);var c=ba.default.fromCartesianArray(u,r,o);return c.width>Le.default.PI&&(c.north=c.north>0?Le.default.PI_OVER_TWO-Le.default.EPSILON7:c.north,c.south=c.south<0?Le.default.EPSILON7-Le.default.PI_OVER_TWO:c.south,c.east=Le.default.PI,c.west=-Le.default.PI),c}function xn(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(e.ellipsoid,ha.default.WGS84),i=e.semiMajorAxis,n=e.semiMinorAxis,r=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.vertexFormat,K.default.DEFAULT),l=Object(o.default)(e.height,0),u=Object(o.default)(e.extrudedHeight,l);this._center=v.default.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=n,this._ellipsoid=ha.default.clone(a),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._height=Math.max(u,l),this._granularity=r,this._vertexFormat=K.default.clone(s),this._extrudedHeight=Math.min(u,l),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=e.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}xn.packedLength=v.default.packedLength+ha.default.packedLength+K.default.packedLength+9,xn.pack=function(e,t,a){return a=Object(o.default)(a,0),v.default.pack(e._center,t,a),a+=v.default.packedLength,ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,K.default.pack(e._vertexFormat,t,a),a+=K.default.packedLength,t[a++]=e._semiMajorAxis,t[a++]=e._semiMinorAxis,t[a++]=e._rotation,t[a++]=e._stRotation,t[a++]=e._height,t[a++]=e._granularity,t[a++]=e._extrudedHeight,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Tn=new v.default,En=new ha.default,An=new K.default,Pn={center:Tn,ellipsoid:En,vertexFormat:An,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};xn.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=v.default.unpack(e,t,Tn);t+=v.default.packedLength;var n=ha.default.unpack(e,t,En);t+=ha.default.packedLength;var r=K.default.unpack(e,t,An);t+=K.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],c=e[t++],f=e[t++],h=e[t++],m=e[t++],p=1===e[t++],_=e[t];return Object(s.default)(a)?(a._center=v.default.clone(i,a._center),a._ellipsoid=ha.default.clone(n,a._ellipsoid),a._vertexFormat=K.default.clone(r,a._vertexFormat),a._semiMajorAxis=l,a._semiMinorAxis=u,a._rotation=d,a._stRotation=c,a._height=f,a._granularity=h,a._extrudedHeight=m,a._shadowVolume=p,a._offsetAttribute=-1===_?void 0:_,a):(Pn.height=f,Pn.extrudedHeight=m,Pn.granularity=h,Pn.stRotation=c,Pn.rotation=d,Pn.semiMajorAxis=l,Pn.semiMinorAxis=u,Pn.shadowVolume=p,Pn.offsetAttribute=-1===_?void 0:_,new xn(Pn))},xn.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,i=Object(o.default)(e.ellipsoid,ha.default.WGS84),n=e.semiMajorAxis,r=e.semiMinorAxis,s=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE);return On(a,n,r,Object(o.default)(e.rotation,0),s,i,t)},xn.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,a=e._extrudedHeight,i=!Le.default.equalsEpsilon(t,a,0,Le.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var r,o={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,vertexFormat:e._vertexFormat,stRotation:e._stRotation};if(i)o.extrudedHeight=a,o.shadowVolume=e._shadowVolume,o.offsetAttribute=e._offsetAttribute,r=Cn(o);else if(r=function(e){var t=e.center;yn=v.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,yn),e.height,yn),yn=v.default.add(t,yn,yn);var a=new n.default(yn,e.semiMajorAxis),i=Ji.computeEllipsePositions(e,!0,!1),r=i.positions,o=i.numPts,s=gn(r,e,!1),l=vn(o);return{boundingSphere:a,attributes:s,indices:l=ga.a.createTypedArray(r.length/3,l)}}(o),Object(s.default)(e._offsetAttribute)){var l=r.attributes.position.values.length,u=new Uint8Array(l/3),d=e._offsetAttribute===ce.a.NONE?0:1;Object(Ke.a)(u,d),r.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:u})}return new ma.a({attributes:r.attributes,indices:r.indices,primitiveType:ya.a.TRIANGLES,boundingSphere:r.boundingSphere,offsetAttribute:e._offsetAttribute})}},xn.createShadowVolume=function(e,t,a){var i=e._granularity,n=e._ellipsoid,r=t(i,n),o=a(i,n);return new xn({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:n,rotation:e._rotation,stRotation:e._stRotation,granularity:i,extrudedHeight:r,height:o,vertexFormat:K.default.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(xn.prototype,{rectangle:{get:function(){return Object(s.default)(this._rectangle)||(this._rectangle=On(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];for(var a=Ji.computeEllipsePositions({center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,rotation:e._rotation,granularity:e._granularity},!1,!0).outerPositions,i=a.length/3,n=new Array(i),r=0;r<i;++r)n[r]=v.default.fromArray(a,3*r);var o=e._ellipsoid,s=e.rectangle;return ma.a._textureCoordinateRotationPoints(n,t,o,s)}(this)),this._textureCoordinateRotationPoints}}});var Sn=xn,Dn=new v.default,Fn=new v.default;var Mn=new n.default,In=new n.default;function Rn(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).center,a=Object(o.default)(e.ellipsoid,ha.default.WGS84),i=e.semiMajorAxis,n=e.semiMinorAxis,r=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),s=Object(o.default)(e.height,0),l=Object(o.default)(e.extrudedHeight,s);this._center=v.default.clone(t),this._semiMajorAxis=i,this._semiMinorAxis=n,this._ellipsoid=ha.default.clone(a),this._rotation=Object(o.default)(e.rotation,0),this._height=Math.max(l,s),this._granularity=r,this._extrudedHeight=Math.min(l,s),this._numberOfVerticalLines=Math.max(Object(o.default)(e.numberOfVerticalLines,16),0),this._offsetAttribute=e.offsetAttribute,this._workerName="createEllipseOutlineGeometry"}Rn.packedLength=v.default.packedLength+ha.default.packedLength+8,Rn.pack=function(e,t,a){return a=Object(o.default)(a,0),v.default.pack(e._center,t,a),a+=v.default.packedLength,ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,t[a++]=e._semiMajorAxis,t[a++]=e._semiMinorAxis,t[a++]=e._rotation,t[a++]=e._height,t[a++]=e._granularity,t[a++]=e._extrudedHeight,t[a++]=e._numberOfVerticalLines,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Nn=new v.default,Ln=new ha.default,jn={center:Nn,ellipsoid:Ln,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};Rn.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=v.default.unpack(e,t,Nn);t+=v.default.packedLength;var n=ha.default.unpack(e,t,Ln);t+=ha.default.packedLength;var r=e[t++],l=e[t++],u=e[t++],d=e[t++],c=e[t++],f=e[t++],h=e[t++],m=e[t];return Object(s.default)(a)?(a._center=v.default.clone(i,a._center),a._ellipsoid=ha.default.clone(n,a._ellipsoid),a._semiMajorAxis=r,a._semiMinorAxis=l,a._rotation=u,a._height=d,a._granularity=c,a._extrudedHeight=f,a._numberOfVerticalLines=h,a._offsetAttribute=-1===m?void 0:m,a):(jn.height=d,jn.extrudedHeight=f,jn.granularity=c,jn.rotation=u,jn.semiMajorAxis=r,jn.semiMinorAxis=l,jn.numberOfVerticalLines=h,jn.offsetAttribute=-1===m?void 0:m,new Rn(jn))},Rn.createGeometry=function(e){if(!(e._semiMajorAxis<=0||e._semiMinorAxis<=0)){var t=e._height,a=e._extrudedHeight,i=!Le.default.equalsEpsilon(t,a,0,Le.default.EPSILON2);e._center=e._ellipsoid.scaleToGeodeticSurface(e._center,e._center);var r,l={center:e._center,semiMajorAxis:e._semiMajorAxis,semiMinorAxis:e._semiMinorAxis,ellipsoid:e._ellipsoid,rotation:e._rotation,height:t,granularity:e._granularity,numberOfVerticalLines:e._numberOfVerticalLines};if(i)l.extrudedHeight=a,l.offsetAttribute=e._offsetAttribute,r=function(e){var t=e.center,a=e.ellipsoid,i=e.semiMajorAxis,r=v.default.multiplyByScalar(a.geodeticSurfaceNormal(t,Dn),e.height,Dn);Mn.center=v.default.add(t,r,Mn.center),Mn.radius=i,r=v.default.multiplyByScalar(a.geodeticSurfaceNormal(t,r),e.extrudedHeight,r),In.center=v.default.add(t,r,In.center),In.radius=i;var l=Ji.computeEllipsePositions(e,!1,!0).outerPositions,u=new _a.a({position:new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:Ji.raisePositionsToHeight(l,e,!0)})});l=u.position.values;var d=n.default.union(Mn,In),c=l.length/3;if(Object(s.default)(e.offsetAttribute)){var f=new Uint8Array(c);if(e.offsetAttribute===ce.a.TOP)f=Object(Ke.a)(f,1,0,c/2);else{var h=e.offsetAttribute===ce.a.NONE?0:1;f=Object(Ke.a)(f,h)}u.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:f})}var m=Object(o.default)(e.numberOfVerticalLines,16);m=Le.default.clamp(m,0,c/2);var p=ga.a.createTypedArray(c,2*c+2*m);c/=2;var _,g,y=0;for(_=0;_<c;++_)p[y++]=_,p[y++]=(_+1)%c,p[y++]=_+c,p[y++]=(_+1)%c+c;if(m>0){var b=Math.min(m,c);g=Math.round(c/b);var w=Math.min(g*m,c);for(_=0;_<w;_+=g)p[y++]=_,p[y++]=_+c}return{boundingSphere:d,attributes:u,indices:p}}(l);else if(r=function(e){var t=e.center;Fn=v.default.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(t,Fn),e.height,Fn),Fn=v.default.add(t,Fn,Fn);for(var a=new n.default(Fn,e.semiMajorAxis),i=Ji.computeEllipsePositions(e,!1,!0).outerPositions,r=new _a.a({position:new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:Ji.raisePositionsToHeight(i,e,!1)})}),o=i.length/3,s=ga.a.createTypedArray(o,2*o),l=0,u=0;u<o;++u)s[l++]=u,s[l++]=(u+1)%o;return{boundingSphere:a,attributes:r,indices:s}}(l),Object(s.default)(e._offsetAttribute)){var u=r.attributes.position.values.length,d=new Uint8Array(u/3),c=e._offsetAttribute===ce.a.NONE?0:1;Object(Ke.a)(d,c),r.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return new ma.a({attributes:r.attributes,indices:r.indices,primitiveType:ya.a.LINES,boundingSphere:r.boundingSphere,offsetAttribute:e._offsetAttribute})}};var Vn=Rn,Un=new y.default,Bn=v.default.ZERO,zn=new v.default,Hn=new ba.default;function kn(e){this.id=e,this.vertexFormat=void 0,this.center=void 0,this.semiMajorAxis=void 0,this.semiMinorAxis=void 0,this.rotation=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.numberOfVerticalLines=void 0,this.offsetAttribute=void 0}function Gn(e,t){ni.call(this,{entity:e,scene:t,geometryOptions:new kn(e),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]}),this._onEntityPropertyChanged(e,"ellipse",e.ellipse,void 0)}function Wn(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(Gn.prototype=Object.create(ni.prototype),Gn.prototype.constructor=Gn),Gn.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),n={show:new me.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,Un)),Object(s.default)(t)||(t=y.default.WHITE),n.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Bn,zn))),new de.a({id:a,geometry:new Sn(this._options),attributes:n})},Gn.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,Un),n=this._distanceDisplayConditionProperty.getValue(e),r={show:new me.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(i),distanceDisplayCondition:ue.fromDistanceDisplayCondition(n),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Bn,zn))),new de.a({id:t,geometry:new Vn(this._options),attributes:r})},Gn.prototype._computeCenter=function(e,t){return A.default.getValueOrUndefined(this._entity.position,e,t)},Gn.prototype._isHidden=function(e,t){var a=e.position;return!Object(s.default)(a)||!Object(s.default)(t.semiMajorAxis)||!Object(s.default)(t.semiMinorAxis)||Ie.prototype._isHidden.call(this,e,t)},Gn.prototype._isDynamic=function(e,t){return!e.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!A.default.isConstant(t.rotation)||!A.default.isConstant(t.height)||!A.default.isConstant(t.extrudedHeight)||!A.default.isConstant(t.granularity)||!A.default.isConstant(t.stRotation)||!A.default.isConstant(t.outlineWidth)||!A.default.isConstant(t.numberOfVerticalLines)||!A.default.isConstant(t.zIndex)||this._onTerrain&&!A.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof pe.default)},Gn.prototype._setStaticOptions=function(e,t){var a=A.default.getValueOrUndefined(t.height,fe.default.MINIMUM_VALUE),n=A.default.getValueOrDefault(t.heightReference,fe.default.MINIMUM_VALUE,O.default.NONE),r=A.default.getValueOrUndefined(t.extrudedHeight,fe.default.MINIMUM_VALUE),o=A.default.getValueOrDefault(t.extrudedHeightReference,fe.default.MINIMUM_VALUE,O.default.NONE);Object(s.default)(r)&&!Object(s.default)(a)&&(a=0);var l=this._options;l.vertexFormat=this._materialProperty instanceof pe.default?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,l.center=e.position.getValue(fe.default.MINIMUM_VALUE,l.center),l.semiMajorAxis=t.semiMajorAxis.getValue(fe.default.MINIMUM_VALUE,l.semiMajorAxis),l.semiMinorAxis=t.semiMinorAxis.getValue(fe.default.MINIMUM_VALUE,l.semiMinorAxis),l.rotation=A.default.getValueOrUndefined(t.rotation,fe.default.MINIMUM_VALUE),l.granularity=A.default.getValueOrUndefined(t.granularity,fe.default.MINIMUM_VALUE),l.stRotation=A.default.getValueOrUndefined(t.stRotation,fe.default.MINIMUM_VALUE),l.numberOfVerticalLines=A.default.getValueOrUndefined(t.numberOfVerticalLines,fe.default.MINIMUM_VALUE),l.offsetAttribute=ni.computeGeometryOffsetAttribute(a,n,r,o),l.height=ni.getGeometryHeight(a,n),(r=ni.getGeometryExtrudedHeight(r,o))===ni.CLAMP_TO_GROUND&&(r=i.a.getMinimumMaximumHeights(Sn.computeRectangle(l,Hn)).minimumTerrainHeight),l.extrudedHeight=r},Gn.DynamicGeometryUpdater=Wn,Object(s.default)(Object.create)&&(Wn.prototype=Object.create(be.prototype),Wn.prototype.constructor=Wn),Wn.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.center)||!Object(s.default)(i.semiMajorAxis)||!Object(s.default)(i.semiMinorAxis)||be.prototype._isHidden.call(this,e,t,a)},Wn.prototype._setOptions=function(e,t,a){var n=this._options,r=A.default.getValueOrUndefined(t.height,a),o=A.default.getValueOrDefault(t.heightReference,a,O.default.NONE),l=A.default.getValueOrUndefined(t.extrudedHeight,a),u=A.default.getValueOrDefault(t.extrudedHeightReference,a,O.default.NONE);Object(s.default)(l)&&!Object(s.default)(r)&&(r=0),n.center=A.default.getValueOrUndefined(e.position,a,n.center),n.semiMajorAxis=A.default.getValueOrUndefined(t.semiMajorAxis,a),n.semiMinorAxis=A.default.getValueOrUndefined(t.semiMinorAxis,a),n.rotation=A.default.getValueOrUndefined(t.rotation,a),n.granularity=A.default.getValueOrUndefined(t.granularity,a),n.stRotation=A.default.getValueOrUndefined(t.stRotation,a),n.numberOfVerticalLines=A.default.getValueOrUndefined(t.numberOfVerticalLines,a),n.offsetAttribute=ni.computeGeometryOffsetAttribute(r,o,l,u),n.height=ni.getGeometryHeight(r,o),(l=ni.getGeometryExtrudedHeight(l,u))===ni.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(Sn.computeRectangle(n,Hn)).minimumTerrainHeight),n.extrudedHeight=l};var Yn=Gn,Xn=a(512),Qn=a(657),qn=new pe.default(y.default.WHITE),Zn=v.default.ZERO,Kn=new v.default,Jn=new v.default,$n=new v.default,er=new y.default,tr=new v.default(1,1,1);function ar(e){this.id=e,this.vertexFormat=void 0,this.radii=void 0,this.innerRadii=void 0,this.minimumClock=void 0,this.maximumClock=void 0,this.minimumCone=void 0,this.maximumCone=void 0,this.stackPartitions=void 0,this.slicePartitions=void 0,this.subdivisions=void 0,this.offsetAttribute=void 0}function ir(e,t){Ie.call(this,{entity:e,scene:t,geometryOptions:new ar(e),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]}),this._onEntityPropertyChanged(e,"ellipsoid",e.ellipsoid,void 0)}function nr(e,t,a){be.call(this,e,t,a),this._scene=e._scene,this._modelMatrix=new nt.default,this._attributes=void 0,this._outlineAttributes=void 0,this._lastSceneMode=void 0,this._lastShow=void 0,this._lastOutlineShow=void 0,this._lastOutlineWidth=void 0,this._lastOutlineColor=void 0,this._lastOffset=new v.default,this._material={}}Object(s.default)(Object.create)&&(ir.prototype=Object.create(Ie.prototype),ir.prototype.constructor=ir),Object.defineProperties(ir.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),ir.prototype.createFillGeometryInstance=function(e,t,a){var i,n,r=this._entity,o=r.isAvailable(e),l=new me.a(o&&r.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),u=this._distanceDisplayConditionProperty.getValue(e),d={show:l,distanceDisplayCondition:ue.fromDistanceDisplayCondition(u),color:void 0,offset:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(n=this._materialProperty.color.getValue(e,er)),Object(s.default)(n)||(n=y.default.WHITE),i=oe.a.fromColor(n),d.color=i);return Object(s.default)(this._options.offsetAttribute)&&(d.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Zn,Kn))),new de.a({id:r,geometry:new Xn.a(this._options),modelMatrix:t?void 0:r.computeModelMatrixForHeightReference(e,r.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,a),attributes:d})},ir.prototype.createOutlineGeometryInstance=function(e,t,a){var i=this._entity,n=i.isAvailable(e),r=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,er),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new me.a(n&&i.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(r),distanceDisplayCondition:ue.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(l.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,Zn,Kn))),new de.a({id:i,geometry:new Qn.a(this._options),modelMatrix:t?void 0:i.computeModelMatrixForHeightReference(e,i.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,a),attributes:l})},ir.prototype._computeCenter=function(e,t){return A.default.getValueOrUndefined(this._entity.position,e,t)},ir.prototype._isHidden=function(e,t){return!Object(s.default)(e.position)||!Object(s.default)(t.radii)||Ie.prototype._isHidden.call(this,e,t)},ir.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&A.default.isConstant(e.orientation)&&t.radii.isConstant&&A.default.isConstant(t.innerRadii)&&A.default.isConstant(t.stackPartitions)&&A.default.isConstant(t.slicePartitions)&&A.default.isConstant(t.outlineWidth)&&A.default.isConstant(t.minimumClock)&&A.default.isConstant(t.maximumClock)&&A.default.isConstant(t.minimumCone)&&A.default.isConstant(t.maximumCone)&&A.default.isConstant(t.subdivisions))},ir.prototype._setStaticOptions=function(e,t){var a=A.default.getValueOrDefault(t.heightReference,fe.default.MINIMUM_VALUE,O.default.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof pe.default?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,i.radii=t.radii.getValue(fe.default.MINIMUM_VALUE,i.radii),i.innerRadii=A.default.getValueOrUndefined(t.innerRadii,i.radii),i.minimumClock=A.default.getValueOrUndefined(t.minimumClock,fe.default.MINIMUM_VALUE),i.maximumClock=A.default.getValueOrUndefined(t.maximumClock,fe.default.MINIMUM_VALUE),i.minimumCone=A.default.getValueOrUndefined(t.minimumCone,fe.default.MINIMUM_VALUE),i.maximumCone=A.default.getValueOrUndefined(t.maximumCone,fe.default.MINIMUM_VALUE),i.stackPartitions=A.default.getValueOrUndefined(t.stackPartitions,fe.default.MINIMUM_VALUE),i.slicePartitions=A.default.getValueOrUndefined(t.slicePartitions,fe.default.MINIMUM_VALUE),i.subdivisions=A.default.getValueOrUndefined(t.subdivisions,fe.default.MINIMUM_VALUE),i.offsetAttribute=a!==O.default.NONE?ce.a.ALL:void 0},ir.prototype._onEntityPropertyChanged=He,ir.DynamicGeometryUpdater=nr,Object(s.default)(Object.create)&&(nr.prototype=Object.create(be.prototype),nr.prototype.constructor=nr),nr.prototype.update=function(e){var t=this._entity,a=t.ellipsoid;if(!t.isShowing||!t.isAvailable(e)||!A.default.getValueOrDefault(a.show,e,!0))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var i=A.default.getValueOrUndefined(a.radii,e,Jn),n=Object(s.default)(i)?t.computeModelMatrixForHeightReference(e,a.heightReference,.5*i.z,this._scene.mapProjection.ellipsoid,this._modelMatrix):void 0;if(!Object(s.default)(n)||!Object(s.default)(i))return Object(s.default)(this._primitive)&&(this._primitive.show=!1),void(Object(s.default)(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1));var r=A.default.getValueOrDefault(a.fill,e,!0),l=A.default.getValueOrDefault(a.outline,e,!1),u=A.default.getValueOrClonedDefault(a.outlineColor,e,y.default.BLACK,er),d=ve.getValue(e,Object(o.default)(a.material,qn),this._material),c=A.default.getValueOrUndefined(a.innerRadii,e,$n),f=A.default.getValueOrUndefined(a.minimumClock,e),h=A.default.getValueOrUndefined(a.maximumClock,e),m=A.default.getValueOrUndefined(a.minimumCone,e),p=A.default.getValueOrUndefined(a.maximumCone,e),_=A.default.getValueOrUndefined(a.stackPartitions,e),g=A.default.getValueOrUndefined(a.slicePartitions,e),b=A.default.getValueOrUndefined(a.subdivisions,e),C=A.default.getValueOrDefault(a.outlineWidth,e,1),x=A.default.getValueOrDefault(a.heightReference,e,O.default.NONE),T=x!==O.default.NONE?ce.a.ALL:void 0,E=this._scene.mode,P=E===je.a.SCENE3D&&x===O.default.NONE,S=this._options,D=this._geometryUpdater.shadowsProperty.getValue(e),F=this._geometryUpdater.distanceDisplayConditionProperty.getValue(e),M=A.default.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,e,Zn,Kn);if(!P||this._lastSceneMode!==E||!Object(s.default)(this._primitive)||S.stackPartitions!==_||S.slicePartitions!==g||Object(s.default)(c)&&!v.default.equals(S.innerRadii!==c)||S.minimumClock!==f||S.maximumClock!==h||S.minimumCone!==m||S.maximumCone!==p||S.subdivisions!==b||this._lastOutlineWidth!==C||S.offsetAttribute!==T){var I=this._primitives;if(I.removeAndDestroy(this._primitive),I.removeAndDestroy(this._outlinePrimitive),this._primitive=void 0,this._outlinePrimitive=void 0,this._lastSceneMode=E,this._lastOutlineWidth=C,S.stackPartitions=_,S.slicePartitions=g,S.subdivisions=b,S.offsetAttribute=T,S.radii=v.default.clone(P?tr:i,S.radii),Object(s.default)(c))if(P){var R=v.default.magnitude(i);S.innerRadii=v.default.fromElements(c.x/R,c.y/R,c.z/R,S.innerRadii)}else S.innerRadii=v.default.clone(c,S.innerRadii);else S.innerRadii=void 0;S.minimumClock=f,S.maximumClock=h,S.minimumCone=m,S.maximumCone=p;var N=new te({material:d,translucent:d.isTranslucent(),closed:!0});S.vertexFormat=N.vertexFormat;var L=this._geometryUpdater.createFillGeometryInstance(e,P,this._modelMatrix);this._primitive=I.add(new _e.a({geometryInstances:L,appearance:N,asynchronous:!1,shadows:D}));var j=this._geometryUpdater.createOutlineGeometryInstance(e,P,this._modelMatrix);this._outlinePrimitive=I.add(new _e.a({geometryInstances:j,appearance:new ae.a({flat:!0,translucent:255!==j.attributes.color.value[3],renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(C)}}),asynchronous:!1,shadows:D})),this._lastShow=r,this._lastOutlineShow=l,this._lastOutlineColor=y.default.clone(u,this._lastOutlineColor),this._lastDistanceDisplayCondition=F,this._lastOffset=v.default.clone(M,this._lastOffset)}else if(this._primitive.ready){var V=this._primitive,U=this._outlinePrimitive;V.show=!0,U.show=!0,V.appearance.material=d;var B=this._attributes;Object(s.default)(B)||(B=V.getGeometryInstanceAttributes(t),this._attributes=B),r!==this._lastShow&&(B.show=me.a.toValue(r,B.show),this._lastShow=r);var z=this._outlineAttributes;Object(s.default)(z)||(z=U.getGeometryInstanceAttributes(t),this._outlineAttributes=z),l!==this._lastOutlineShow&&(z.show=me.a.toValue(l,z.show),this._lastOutlineShow=l),y.default.equals(u,this._lastOutlineColor)||(z.color=oe.a.toValue(u,z.color),y.default.clone(u,this._lastOutlineColor)),w.a.equals(F,this._lastDistanceDisplayCondition)||(B.distanceDisplayCondition=ue.toValue(F,B.distanceDisplayCondition),z.distanceDisplayCondition=ue.toValue(F,z.distanceDisplayCondition),w.a.clone(F,this._lastDistanceDisplayCondition)),v.default.equals(M,this._lastOffset)||(B.offset=he.a.toValue(M,B.offset),z.offset=he.a.toValue(M,B.offset),v.default.clone(M,this._lastOffset))}P&&(i.x=Math.max(i.x,.001),i.y=Math.max(i.y,.001),i.z=Math.max(i.z,.001),n=nt.default.multiplyByScale(n,i,n),this._primitive.modelMatrix=n,this._outlinePrimitive.modelMatrix=n)};var rr=ir;function or(e){e=Object(o.default)(e,o.default.EMPTY_OBJECT);var t=Object(o.default)(e.vertexFormat,K.default.DEFAULT);this._vertexFormat=t,this._workerName="createPlaneGeometry"}or.packedLength=K.default.packedLength,or.pack=function(e,t,a){return a=Object(o.default)(a,0),K.default.pack(e._vertexFormat,t,a),t};var sr=new K.default,lr={vertexFormat:sr};or.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=K.default.unpack(e,t,sr);return Object(s.default)(a)?(a._vertexFormat=K.default.clone(i,a._vertexFormat),a):new or(lr)};var ur=new v.default(-.5,-.5,0),dr=new v.default(.5,.5,0);or.createGeometry=function(e){var t,a,i=e._vertexFormat,r=new _a.a;if(i.position){if((a=new Float64Array(12))[0]=ur.x,a[1]=ur.y,a[2]=0,a[3]=dr.x,a[4]=ur.y,a[5]=0,a[6]=dr.x,a[7]=dr.y,a[8]=0,a[9]=ur.x,a[10]=dr.y,a[11]=0,r.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:a}),i.normal){var o=new Float32Array(12);o[0]=0,o[1]=0,o[2]=1,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=1,o[9]=0,o[10]=0,o[11]=1,r.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:o})}if(i.st){var s=new Float32Array(8);s[0]=0,s[1]=0,s[2]=1,s[3]=0,s[4]=1,s[5]=1,s[6]=0,s[7]=1,r.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:s})}if(i.tangent){var l=new Float32Array(12);l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l[6]=1,l[7]=0,l[8]=0,l[9]=1,l[10]=0,l[11]=0,r.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:l})}if(i.bitangent){var u=new Float32Array(12);u[0]=0,u[1]=1,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=1,u[8]=0,u[9]=0,u[10]=1,u[11]=0,r.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:u})}(t=new Uint16Array(6))[0]=0,t[1]=1,t[2]=2,t[3]=0,t[4]=2,t[5]=3}return new ma.a({attributes:r,indices:t,primitiveType:ya.a.TRIANGLES,boundingSphere:new n.default(v.default.ZERO,Math.sqrt(2))})};var cr=or;function fr(){this._workerName="createPlaneOutlineGeometry"}fr.packedLength=0,fr.pack=function(e,t){return t},fr.unpack=function(e,t,a){return Object(s.default)(a)?a:new fr};var hr=new v.default(-.5,-.5,0),mr=new v.default(.5,.5,0);fr.createGeometry=function(){var e=new _a.a,t=new Uint16Array(8),a=new Float64Array(12);return a[0]=hr.x,a[1]=hr.y,a[2]=hr.z,a[3]=mr.x,a[4]=hr.y,a[5]=hr.z,a[6]=mr.x,a[7]=mr.y,a[8]=hr.z,a[9]=hr.x,a[10]=mr.y,a[11]=hr.z,e.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:a}),t[0]=0,t[1]=1,t[2]=1,t[3]=2,t[4]=2,t[5]=3,t[6]=3,t[7]=0,new ma.a({attributes:e,indices:t,primitiveType:ya.a.LINES,boundingSphere:new n.default(v.default.ZERO,Math.sqrt(2))})};var pr=fr,_r=new v.default,gr=new y.default;function vr(e){this.id=e,this.vertexFormat=void 0,this.plane=void 0,this.dimensions=void 0}function yr(e,t){Ie.call(this,{entity:e,scene:t,geometryOptions:new vr(e),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]}),this._onEntityPropertyChanged(e,"plane",e.plane,void 0)}function br(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(yr.prototype=Object.create(Ie.prototype),yr.prototype.constructor=yr),yr.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,n=i.isAvailable(e),r=new me.a(n&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof pe.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(a=this._materialProperty.color.getValue(e,gr)),Object(s.default)(a)||(a=y.default.WHITE),t={show:r,distanceDisplayCondition:l,color:oe.a.fromColor(a)}):t={show:r,distanceDisplayCondition:l};var u=i.plane,d=this._options,c=i.computeModelMatrix(e),f=A.default.getValueOrDefault(u.plane,e,d.plane),h=A.default.getValueOrUndefined(u.dimensions,e,d.dimensions);return d.plane=f,d.dimensions=h,c=Pr(f,h,c,this._scene.mapProjection.ellipsoid,c),new de.a({id:i,geometry:new cr(this._options),modelMatrix:c,attributes:t})},yr.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,gr),n=this._distanceDisplayConditionProperty.getValue(e),r=t.plane,o=this._options,s=t.computeModelMatrix(e),l=A.default.getValueOrDefault(r.plane,e,o.plane),u=A.default.getValueOrUndefined(r.dimensions,e,o.dimensions);return o.plane=l,o.dimensions=u,s=Pr(l,u,s,this._scene.mapProjection.ellipsoid,s),new de.a({id:t,geometry:new pr,modelMatrix:s,attributes:{show:new me.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(i),distanceDisplayCondition:ue.fromDistanceDisplayCondition(n)}})},yr.prototype._isHidden=function(e,t){return!Object(s.default)(t.plane)||!Object(s.default)(t.dimensions)||!Object(s.default)(e.position)||Ie.prototype._isHidden.call(this,e,t)},yr.prototype._getIsClosed=function(e){return!1},yr.prototype._isDynamic=function(e,t){return!(e.position.isConstant&&A.default.isConstant(e.orientation)&&t.plane.isConstant&&t.dimensions.isConstant&&A.default.isConstant(t.outlineWidth))},yr.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof pe.default,i=this._options;i.vertexFormat=a?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,i.plane=t.plane.getValue(fe.default.MINIMUM_VALUE,i.plane),i.dimensions=t.dimensions.getValue(fe.default.MINIMUM_VALUE,i.dimensions)},yr.DynamicGeometryUpdater=br,Object(s.default)(Object.create)&&(br.prototype=Object.create(be.prototype),br.prototype.constructor=br),br.prototype._isHidden=function(e,t,a){var i=this._options,n=A.default.getValueOrUndefined(e.position,a,_r);return!Object(s.default)(n)||!Object(s.default)(i.plane)||!Object(s.default)(i.dimensions)||be.prototype._isHidden.call(this,e,t,a)},br.prototype._setOptions=function(e,t,a){var i=this._options;i.plane=A.default.getValueOrDefault(t.plane,a,i.plane),i.dimensions=A.default.getValueOrUndefined(t.dimensions,a,i.dimensions)};var wr=new v.default,Cr=new v.default,Or=new v.default,xr=new v.default,Tr=new v.default,Er=new rt.default,Ar=new et.default;function Pr(e,t,a,i,n){var r=e.normal,o=e.distance,s=v.default.multiplyByScalar(r,-o,Or);s=nt.default.multiplyByPoint(a,s,s);var l=nt.default.multiplyByPointAsVector(a,r,xr);v.default.normalize(l,l);var u=i.geodeticSurfaceNormal(s,Cr);Le.default.equalsEpsilon(Math.abs(v.default.dot(u,l)),1,Le.default.EPSILON8)&&(u=v.default.clone(v.default.UNIT_Z,u),Le.default.equalsEpsilon(Math.abs(v.default.dot(u,l)),1,Le.default.EPSILON8)&&(u=v.default.clone(v.default.UNIT_X,u)));var d=v.default.cross(u,l,wr);u=v.default.cross(l,d,u),v.default.normalize(d,d),v.default.normalize(u,u);var c=Ar;et.default.setColumn(c,0,d,c),et.default.setColumn(c,1,u,c),et.default.setColumn(c,2,l,c);var f=rt.default.fromRotationMatrix(c,Er),h=g.default.clone(t,Tr);return h.z=1,nt.default.fromTranslationQuaternionRotationScale(s,f,h,n)}yr.createPrimitiveMatrix=Pr;var Sr=yr,Dr=a(151),Fr=a(117),Mr={},Ir=new v.default,Rr=new v.default,Nr=new v.default,Lr=new v.default,jr=new Fr.a;function Vr(e,t,a,i,n){var r=v.default.subtract(e,t,Ir),o=v.default.dot(a,r),s=v.default.dot(i,r);return g.default.fromElements(o,s,n)}Mr.validOutline=function(e){var t=Fr.a.fromPoints(e,jr).halfAxes,a=et.default.getColumn(t,0,Rr),i=et.default.getColumn(t,1,Nr),n=et.default.getColumn(t,2,Lr),r=v.default.magnitude(a),o=v.default.magnitude(i),s=v.default.magnitude(n);return!(0===r&&(0===o||0===s)||0===o&&0===s)},Mr.computeProjectTo2DArguments=function(e,t,a,i){var n,r,o=Fr.a.fromPoints(e,jr),s=o.halfAxes,l=et.default.getColumn(s,0,Rr),u=et.default.getColumn(s,1,Nr),d=et.default.getColumn(s,2,Lr),c=v.default.magnitude(l),f=v.default.magnitude(u),h=v.default.magnitude(d),m=Math.min(c,f,h);return(0!==c||0!==f&&0!==h)&&(0!==f||0!==h)&&(m!==f&&m!==h||(n=l),m===c?n=u:m===h&&(r=u),m!==c&&m!==f||(r=d),v.default.normalize(n,a),v.default.normalize(r,i),v.default.clone(o.center,t),!0)},Mr.createProjectPointsTo2DFunction=function(e,t,a){return function(i){for(var n=new Array(i.length),r=0;r<i.length;r++)n[r]=Vr(i[r],e,t,a);return n}},Mr.createProjectPointTo2DFunction=function(e,t,a){return function(i,n){return Vr(i,e,t,a,n)}};var Ur=Mr,Br=a(279),zr=new v.default,Hr=new _.default,kr=new g.default,Gr=new g.default,Wr=new v.default,Yr=new v.default,Xr=new v.default,Qr=new v.default,qr=new v.default,Zr=new v.default,Kr=new rt.default,Jr=new et.default,$r=new et.default,eo=new v.default;function to(e,t,a,i,n,r,o,s){var l=e.positions,u=va.a.triangulate(e.positions2D,e.holes);u.length<3&&(u=[0,1,2]);var d=ga.a.createTypedArray(l.length,u.length);d.set(u);var c=Jr;if(0!==i){var f=rt.default.fromAxisAngle(r,i,Kr);if(c=et.default.fromQuaternion(f,c),t.tangent||t.bitangent){f=rt.default.fromAxisAngle(r,-i,Kr);var h=et.default.fromQuaternion(f,$r);o=v.default.normalize(et.default.multiplyByVector(h,o,o),o),t.bitangent&&(s=v.default.normalize(v.default.cross(r,o,s),s))}}else c=et.default.clone(et.default.IDENTITY,c);var m=Gr;t.st&&(m.x=a.x,m.y=a.y);for(var p=l.length,_=3*p,y=new Float64Array(_),b=t.normal?new Float32Array(_):void 0,w=t.tangent?new Float32Array(_):void 0,C=t.bitangent?new Float32Array(_):void 0,O=t.st?new Float32Array(2*p):void 0,x=0,T=0,E=0,A=0,P=0,S=0;S<p;S++){var D=l[S];if(y[x++]=D.x,y[x++]=D.y,y[x++]=D.z,t.st){var F=n(et.default.multiplyByVector(c,D,zr),kr);g.default.subtract(F,m,F);var M=Le.default.clamp(F.x/a.width,0,1),I=Le.default.clamp(F.y/a.height,0,1);O[P++]=M,O[P++]=I}t.normal&&(b[T++]=r.x,b[T++]=r.y,b[T++]=r.z),t.tangent&&(w[A++]=o.x,w[A++]=o.y,w[A++]=o.z),t.bitangent&&(C[E++]=s.x,C[E++]=s.y,C[E++]=s.z)}var R=new _a.a;return t.position&&(R.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:y})),t.normal&&(R.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),t.tangent&&(R.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:w})),t.bitangent&&(R.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:C})),t.st&&(R.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:O})),new ma.a({attributes:R,indices:d,primitiveType:ya.a.TRIANGLES})}function ao(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy,a=Object(o.default)(e.vertexFormat,K.default.DEFAULT);this._vertexFormat=K.default.clone(a),this._polygonHierarchy=t,this._stRotation=Object(o.default)(e.stRotation,0),this._ellipsoid=ha.default.clone(Object(o.default)(e.ellipsoid,ha.default.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=Br.default.computeHierarchyPackedLength(t)+K.default.packedLength+ha.default.packedLength+2}ao.fromPositions=function(e){return new ao({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},ao.pack=function(e,t,a){return a=Object(o.default)(a,0),a=Br.default.packPolygonHierarchy(e._polygonHierarchy,t,a),ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,K.default.pack(e._vertexFormat,t,a),a+=K.default.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var io=ha.default.clone(ha.default.UNIT_SPHERE),no=new K.default,ro={polygonHierarchy:{}};ao.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Br.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var n=ha.default.unpack(e,t,io);t+=ha.default.packedLength;var r=K.default.unpack(e,t,no);t+=K.default.packedLength;var l=e[t++],u=e[t];return Object(s.default)(a)||(a=new ao(ro)),a._polygonHierarchy=i,a._ellipsoid=ha.default.clone(n,a._ellipsoid),a._vertexFormat=K.default.clone(r,a._vertexFormat),a._stRotation=l,a.packedLength=u,a},ao.createGeometry=function(e){var t=e._vertexFormat,a=e._polygonHierarchy,i=e._stRotation,r=a.positions;if(!((r=Object(Je.a)(r,v.default.equalsEpsilon,!0)).length<3)){var o=Wr,s=Yr,l=Xr,u=qr,d=Zr;if(Ur.computeProjectTo2DArguments(r,Qr,u,d)){if(o=v.default.cross(u,d,o),o=v.default.normalize(o,o),!v.default.equalsEpsilon(Qr,v.default.ZERO,Le.default.EPSILON6)){var c=e._ellipsoid.geodeticSurfaceNormal(Qr,eo);v.default.dot(o,c)<0&&(o=v.default.negate(o,o),u=v.default.negate(u,u))}var f=Ur.createProjectPointsTo2DFunction(Qr,u,d),h=Ur.createProjectPointTo2DFunction(Qr,u,d);t.tangent&&(s=v.default.clone(u,s)),t.bitangent&&(l=v.default.clone(d,l));var m=Br.default.polygonsFromHierarchy(a,f,!1),p=m.hierarchy,_=m.polygons;if(0!==p.length){r=p[0].outerRing;for(var g=n.default.fromPoints(r),y=Br.default.computeBoundingRectangle(o,h,r,i,Hr),b=[],w=0;w<_.length;w++){var C=new de.a({geometry:to(_[w],t,y,i,h,o,s,l)});b.push(C)}var O=en.a.combineInstances(b)[0];O.attributes.position.values=new Float64Array(O.attributes.position.values),O.indices=ga.a.createTypedArray(O.attributes.position.values.length/3,O.indices);var x=O.attributes;return t.position||delete x.position,new ma.a({attributes:x,indices:O.indices,primitiveType:O.primitiveType,boundingSphere:g})}}}};var oo=ao;function so(e){for(var t=e.length,a=new Float64Array(3*t),i=ga.a.createTypedArray(t,2*t),n=0,r=0,o=0;o<t;o++){var s=e[o];a[n++]=s.x,a[n++]=s.y,a[n++]=s.z,i[r++]=o,i[r++]=(o+1)%t}var l=new _a.a({position:new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:a})});return new ma.a({attributes:l,indices:i,primitiveType:ya.a.LINES})}function lo(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polygonHierarchy;this._polygonHierarchy=t,this._workerName="createCoplanarPolygonOutlineGeometry",this.packedLength=Br.default.computeHierarchyPackedLength(t)+1}lo.fromPositions=function(e){return new lo({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions}})},lo.pack=function(e,t,a){return a=Object(o.default)(a,0),t[a=Br.default.packPolygonHierarchy(e._polygonHierarchy,t,a)]=e.packedLength,t};var uo={polygonHierarchy:{}};lo.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Br.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var n=e[t];return Object(s.default)(a)||(a=new lo(uo)),a._polygonHierarchy=i,a.packedLength=n,a},lo.createGeometry=function(e){var t=e._polygonHierarchy,a=t.positions;if(!((a=Object(Je.a)(a,v.default.equalsEpsilon,!0)).length<3)&&Ur.validOutline(a)){var i=Br.default.polygonOutlinesFromHierarchy(t,!1);if(0!==i.length){for(var r=[],o=0;o<i.length;o++){var s=new de.a({geometry:so(i[o])});r.push(s)}var l=en.a.combineInstances(r)[0],u=n.default.fromPoints(t.positions);return new ma.a({attributes:l.attributes,indices:l.indices,primitiveType:l.primitiveType,boundingSphere:u})}}};var co=lo,fo=a(227),ho=a(149),mo=new Ne.default,po=new Ne.default;function _o(e,t,a,i){var n=i.cartesianToCartographic(e,mo).height,r=i.cartesianToCartographic(t,po);r.height=n,i.cartographicToCartesian(r,t);var o=i.cartesianToCartographic(a,po);o.height=n-100,i.cartographicToCartesian(o,a)}var go=new _.default,vo=new v.default,yo=new v.default,bo=new v.default,wo=new v.default,Co=new v.default,Oo=new v.default,xo=new v.default,To=new v.default,Eo=new v.default,Ao=new g.default,Po=new g.default,So=new v.default,Do=new rt.default,Fo=new et.default,Mo=new et.default;function Io(e){var t=e.vertexFormat,a=e.geometry,i=e.shadowVolume,n=a.attributes.position.values,r=n.length,o=e.wall,l=e.top||o,u=e.bottom||o;if(t.st||t.normal||t.tangent||t.bitangent||i){var d=e.boundingRectangle,c=e.tangentPlane,f=e.ellipsoid,h=e.stRotation,m=e.perPositionHeight,p=Ao;p.x=d.x,p.y=d.y;var _,y=t.st?new Float32Array(r/3*2):void 0;t.normal&&(_=m&&l&&!o?a.attributes.normal.values:new Float32Array(r));var b=t.tangent?new Float32Array(r):void 0,w=t.bitangent?new Float32Array(r):void 0,C=i?new Float32Array(r):void 0,O=0,x=0,T=yo,E=bo,A=wo,P=!0,S=Fo,D=Mo;if(0!==h){var F=rt.default.fromAxisAngle(c._plane.normal,h,Do);S=et.default.fromQuaternion(F,S),F=rt.default.fromAxisAngle(c._plane.normal,-h,Do),D=et.default.fromQuaternion(F,D)}else S=et.default.clone(et.default.IDENTITY,S),D=et.default.clone(et.default.IDENTITY,D);var M=0,I=0;l&&u&&(M=r/2,I=r/3,r/=2);for(var R=0;R<r;R+=3){var N=v.default.fromArray(n,R,So);if(t.st){var L=et.default.multiplyByVector(S,N,vo);L=f.scaleToGeodeticSurface(L,L);var j=c.projectPointOntoPlane(L,Po);g.default.subtract(j,p,j);var V=Le.default.clamp(j.x/d.width,0,1),U=Le.default.clamp(j.y/d.height,0,1);u&&(y[O+I]=V,y[O+1+I]=U),l&&(y[O]=V,y[O+1]=U),O+=2}if(t.normal||t.tangent||t.bitangent||i){var B=x+1,z=x+2;if(o){if(R+3<r){var H=v.default.fromArray(n,R+3,Co);if(P){var k=v.default.fromArray(n,R+r,Oo);m&&_o(N,H,k,f),v.default.subtract(H,N,H),v.default.subtract(k,N,k),T=v.default.normalize(v.default.cross(k,H,T),T),P=!1}v.default.equalsEpsilon(H,N,Le.default.EPSILON10)&&(P=!0)}(t.tangent||t.bitangent)&&(A=f.geodeticSurfaceNormal(N,A),t.tangent&&(E=v.default.normalize(v.default.cross(A,T,E),E)))}else T=f.geodeticSurfaceNormal(N,T),(t.tangent||t.bitangent)&&(m&&(xo=v.default.fromArray(_,x,xo),To=v.default.cross(v.default.UNIT_Z,xo,To),To=v.default.normalize(et.default.multiplyByVector(D,To,To),To),t.bitangent&&(Eo=v.default.normalize(v.default.cross(xo,To,Eo),Eo))),E=v.default.cross(v.default.UNIT_Z,T,E),E=v.default.normalize(et.default.multiplyByVector(D,E,E),E),t.bitangent&&(A=v.default.normalize(v.default.cross(T,E,A),A)));t.normal&&(e.wall?(_[x+M]=T.x,_[B+M]=T.y,_[z+M]=T.z):u&&(_[x+M]=-T.x,_[B+M]=-T.y,_[z+M]=-T.z),(l&&!m||o)&&(_[x]=T.x,_[B]=T.y,_[z]=T.z)),i&&(o&&(T=f.geodeticSurfaceNormal(N,T)),C[x+M]=-T.x,C[B+M]=-T.y,C[z+M]=-T.z),t.tangent&&(e.wall?(b[x+M]=E.x,b[B+M]=E.y,b[z+M]=E.z):u&&(b[x+M]=-E.x,b[B+M]=-E.y,b[z+M]=-E.z),l&&(m?(b[x]=To.x,b[B]=To.y,b[z]=To.z):(b[x]=E.x,b[B]=E.y,b[z]=E.z))),t.bitangent&&(u&&(w[x+M]=A.x,w[B+M]=A.y,w[z+M]=A.z),l&&(m?(w[x]=Eo.x,w[B]=Eo.y,w[z]=Eo.z):(w[x]=A.x,w[B]=A.y,w[z]=A.z))),x+=3}}t.st&&(a.attributes.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:y})),t.normal&&(a.attributes.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:_})),t.tangent&&(a.attributes.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),t.bitangent&&(a.attributes.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:w})),i&&(a.attributes.extrudeDirection=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:C}))}if(e.extrude&&Object(s.default)(e.offsetAttribute)){var G=n.length/3,W=new Uint8Array(G);if(e.offsetAttribute===ce.a.TOP)l&&u||o?W=Object(Ke.a)(W,1,0,G/2):l&&(W=Object(Ke.a)(W,1));else{var Y=e.offsetAttribute===ce.a.NONE?0:1;W=Object(Ke.a)(W,Y)}a.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:W})}return a}var Ro=new Ne.default,No=new Ne.default,Lo={westOverIDL:0,eastOverIDL:0},jo=new fo.default;function Vo(e,t,a,i,n){if(n=Object(o.default)(n,new ba.default),!Object(s.default)(e)||e.length<3)return n.west=0,n.north=0,n.south=0,n.east=0,n;if(a===Dr.a.RHUMB)return ba.default.fromCartesianArray(e,t,n);jo.ellipsoid.equals(t)||(jo=new fo.default(void 0,void 0,t)),n.west=Number.POSITIVE_INFINITY,n.east=Number.NEGATIVE_INFINITY,n.south=Number.POSITIVE_INFINITY,n.north=Number.NEGATIVE_INFINITY,Lo.westOverIDL=Number.POSITIVE_INFINITY,Lo.eastOverIDL=Number.NEGATIVE_INFINITY;for(var r,l=1/Le.default.chordLength(i,t.maximumRadius),u=e.length,d=t.cartesianToCartographic(e[0],No),c=Ro,f=1;f<u;f++)r=c,c=d,d=t.cartesianToCartographic(e[f],r),jo.setEndPoints(c,d),Bo(jo,l,n,Lo);return r=c,c=d,d=t.cartesianToCartographic(e[0],r),jo.setEndPoints(c,d),Bo(jo,l,n,Lo),n.east-n.west>Lo.eastOverIDL-Lo.westOverIDL&&(n.west=Lo.westOverIDL,n.east=Lo.eastOverIDL,n.east>Le.default.PI&&(n.east=n.east-Le.default.TWO_PI),n.west>Le.default.PI&&(n.west=n.west-Le.default.TWO_PI)),n}var Uo=new Ne.default;function Bo(e,t,a,i){for(var n=e.surfaceDistance,r=Math.ceil(n*t),o=r>0?n/(r-1):Number.POSITIVE_INFINITY,s=0,l=0;l<r;l++){var u=e.interpolateUsingSurfaceDistance(s,Uo);s+=o;var d=u.longitude,c=u.latitude;a.west=Math.min(a.west,d),a.east=Math.max(a.east,d),a.south=Math.min(a.south,c),a.north=Math.max(a.north,c);var f=d>=0?d:d+Le.default.TWO_PI;i.westOverIDL=Math.min(i.westOverIDL,f),i.eastOverIDL=Math.max(i.eastOverIDL,f)}}var zo=[];function Ho(e,t,a,i,n,r,o,s,l){var u,d={walls:[]};if(r||o){var c,f,h=Br.default.createGeometryFromPositions(e,t,a,n,s,l),m=h.attributes.position.values,p=h.indices;if(r&&o){var _=m.concat(m);c=_.length/3,(f=ga.a.createTypedArray(c,2*p.length)).set(p);var g=p.length,v=c/2;for(u=0;u<g;u+=3){var y=f[u]+v,b=f[u+1]+v,w=f[u+2]+v;f[u+g]=w,f[u+1+g]=b,f[u+2+g]=y}if(h.attributes.position.values=_,n&&s.normal){var C=h.attributes.normal.values;h.attributes.normal.values=new Float32Array(_.length),h.attributes.normal.values.set(C)}h.indices=f}else if(o){for(c=m.length/3,f=ga.a.createTypedArray(c,p.length),u=0;u<p.length;u+=3)f[u]=p[u+2],f[u+1]=p[u+1],f[u+2]=p[u];h.indices=f}d.topAndBottom=new de.a({geometry:h})}var O=i.outerRing,x=it.default.fromPoints(O,e),T=x.projectPointsOntoPlane(O,zo),E=va.a.computeWindingOrder2D(T);E===ho.default.CLOCKWISE&&(O=O.slice().reverse());var A=Br.default.computeWallGeometry(O,e,a,n,l);d.walls.push(new de.a({geometry:A}));var P=i.holes;for(u=0;u<P.length;u++){var S=P[u];T=(x=it.default.fromPoints(S,e)).projectPointsOntoPlane(S,zo),(E=va.a.computeWindingOrder2D(T))===ho.default.COUNTER_CLOCKWISE&&(S=S.slice().reverse()),A=Br.default.computeWallGeometry(S,e,a,n,l),d.walls.push(new de.a({geometry:A}))}return d}function ko(e){var t=e.polygonHierarchy,a=Object(o.default)(e.vertexFormat,K.default.DEFAULT),i=Object(o.default)(e.ellipsoid,ha.default.WGS84),n=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.stRotation,0),l=Object(o.default)(e.perPositionHeight,!1),u=l&&Object(s.default)(e.extrudedHeight),d=Object(o.default)(e.height,0),c=Object(o.default)(e.extrudedHeight,d);if(!u){var f=Math.max(d,c);c=Math.min(d,c),d=f}this._vertexFormat=K.default.clone(a),this._ellipsoid=ha.default.clone(i),this._granularity=n,this._stRotation=r,this._height=d,this._extrudedHeight=c,this._closeTop=Object(o.default)(e.closeTop,!0),this._closeBottom=Object(o.default)(e.closeBottom,!0),this._polygonHierarchy=t,this._perPositionHeight=l,this._perPositionHeightExtrude=u,this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=e.offsetAttribute,this._arcType=Object(o.default)(e.arcType,Dr.a.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=Br.default.computeHierarchyPackedLength(t)+ha.default.packedLength+K.default.packedLength+12}ko.fromPositions=function(e){return new ko({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},ko.pack=function(e,t,a){return a=Object(o.default)(a,0),a=Br.default.packPolygonHierarchy(e._polygonHierarchy,t,a),ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,K.default.pack(e._vertexFormat,t,a),a+=K.default.packedLength,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._granularity,t[a++]=e._stRotation,t[a++]=e._perPositionHeightExtrude?1:0,t[a++]=e._perPositionHeight?1:0,t[a++]=e._closeTop?1:0,t[a++]=e._closeBottom?1:0,t[a++]=e._shadowVolume?1:0,t[a++]=Object(o.default)(e._offsetAttribute,-1),t[a++]=e._arcType,t[a]=e.packedLength,t};var Go=ha.default.clone(ha.default.UNIT_SPHERE),Wo=new K.default,Yo={polygonHierarchy:{}};ko.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Br.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var n=ha.default.unpack(e,t,Go);t+=ha.default.packedLength;var r=K.default.unpack(e,t,Wo);t+=K.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],c=e[t++],f=1===e[t++],h=1===e[t++],m=1===e[t++],p=1===e[t++],_=1===e[t++],g=e[t++],v=e[t++],y=e[t];return Object(s.default)(a)||(a=new ko(Yo)),a._polygonHierarchy=i,a._ellipsoid=ha.default.clone(n,a._ellipsoid),a._vertexFormat=K.default.clone(r,a._vertexFormat),a._height=l,a._extrudedHeight=u,a._granularity=d,a._stRotation=c,a._perPositionHeightExtrude=f,a._perPositionHeight=h,a._closeTop=m,a._closeBottom=p,a._shadowVolume=_,a._offsetAttribute=-1===g?void 0:g,a._arcType=v,a.packedLength=y,a},ko.computeRectangle=function(e,t){var a=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),i=Object(o.default)(e.arcType,Dr.a.GEODESIC),n=e.polygonHierarchy,r=Object(o.default)(e.ellipsoid,ha.default.WGS84);return Vo(n.positions,r,i,a,t)},ko.createGeometry=function(e){var t=e._vertexFormat,a=e._ellipsoid,i=e._granularity,r=e._stRotation,o=e._polygonHierarchy,l=e._perPositionHeight,u=e._closeTop,d=e._closeBottom,c=e._arcType,f=o.positions;if(!(f.length<3)){var h=it.default.fromPoints(f,a),m=Br.default.polygonsFromHierarchy(o,h.projectPointsOntoPlane.bind(h),!l,a),p=m.hierarchy,_=m.polygons;if(0!==p.length){f=p[0].outerRing;var g,v=Br.default.computeBoundingRectangle(h.plane.normal,h.projectPointOntoPlane.bind(h),f,r,go),y=[],b=e._height,w=e._extrudedHeight,C={perPositionHeight:l,vertexFormat:t,geometry:void 0,tangentPlane:h,boundingRectangle:v,ellipsoid:a,stRotation:r,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:c};if(e._perPositionHeightExtrude||!Le.default.equalsEpsilon(b,w,0,Le.default.EPSILON2))for(C.extrude=!0,C.top=u,C.bottom=d,C.shadowVolume=e._shadowVolume,C.offsetAttribute=e._offsetAttribute,g=0;g<_.length;g++){var O,x=Ho(a,_[g],i,p[g],l,u,d,t,c);u&&d?(O=x.topAndBottom,C.geometry=Br.default.scaleToGeodeticHeightExtruded(O.geometry,b,w,a,l)):u?((O=x.topAndBottom).geometry.attributes.position.values=va.a.scaleToGeodeticHeight(O.geometry.attributes.position.values,b,a,!l),C.geometry=O.geometry):d&&((O=x.topAndBottom).geometry.attributes.position.values=va.a.scaleToGeodeticHeight(O.geometry.attributes.position.values,w,a,!0),C.geometry=O.geometry),(u||d)&&(C.wall=!1,O.geometry=Io(C),y.push(O));var T=x.walls;C.wall=!0;for(var E=0;E<T.length;E++){var A=T[E];C.geometry=Br.default.scaleToGeodeticHeightExtruded(A.geometry,b,w,a,l),A.geometry=Io(C),y.push(A)}}else for(g=0;g<_.length;g++){var P=new de.a({geometry:Br.default.createGeometryFromPositions(a,_[g],i,l,t,c)});if(P.geometry.attributes.position.values=va.a.scaleToGeodeticHeight(P.geometry.attributes.position.values,b,a,!l),C.geometry=P.geometry,P.geometry=Io(C),Object(s.default)(e._offsetAttribute)){var S=P.geometry.attributes.position.values.length,D=new Uint8Array(S/3),F=e._offsetAttribute===ce.a.NONE?0:1;Object(Ke.a)(D,F),P.geometry.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})}y.push(P)}var M=en.a.combineInstances(y)[0];M.attributes.position.values=new Float64Array(M.attributes.position.values),M.indices=ga.a.createTypedArray(M.attributes.position.values.length/3,M.indices);var I=M.attributes,R=n.default.fromVertices(I.position.values);return t.position||delete I.position,new ma.a({attributes:I,indices:M.indices,primitiveType:M.primitiveType,boundingSphere:R,offsetAttribute:e._offsetAttribute})}}},ko.createShadowVolume=function(e,t,a){var i=e._granularity,n=e._ellipsoid,r=t(i,n),o=a(i,n);return new ko({polygonHierarchy:e._polygonHierarchy,ellipsoid:n,stRotation:e._stRotation,granularity:i,perPositionHeight:!1,extrudedHeight:r,height:o,vertexFormat:K.default.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(ko.prototype,{rectangle:{get:function(){if(!Object(s.default)(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=Vo(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var a=e._ellipsoid,i=e._polygonHierarchy.positions,n=e.rectangle;return ma.a._textureCoordinateRotationPoints(i,t,a,n)}(this)),this._textureCoordinateRotationPoints}}});var Xo=ko,Qo=[],qo=[];function Zo(e,t,a,i,n){var r,o,s=it.default.fromPoints(t,e).projectPointsOntoPlane(t,Qo);va.a.computeWindingOrder2D(s)===ho.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=0;if(i)for(r=new Float64Array(2*l*3),o=0;o<l;o++){var d=t[o],c=t[(o+1)%l];r[u++]=d.x,r[u++]=d.y,r[u++]=d.z,r[u++]=c.x,r[u++]=c.y,r[u++]=c.z}else{var f=0;if(n===Dr.a.GEODESIC)for(o=0;o<l;o++)f+=Br.default.subdivideLineCount(t[o],t[(o+1)%l],a);else if(n===Dr.a.RHUMB)for(o=0;o<l;o++)f+=Br.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],a);for(r=new Float64Array(3*f),o=0;o<l;o++){var h;n===Dr.a.GEODESIC?h=Br.default.subdivideLine(t[o],t[(o+1)%l],a,qo):n===Dr.a.RHUMB&&(h=Br.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],a,qo));for(var m=h.length,p=0;p<m;++p)r[u++]=h[p]}}var _=2*(l=r.length/3),g=ga.a.createTypedArray(l,_);for(u=0,o=0;o<l-1;o++)g[u++]=o,g[u++]=o+1;return g[u++]=l-1,g[u++]=0,new de.a({geometry:new ma.a({attributes:new _a.a({position:new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:r})}),indices:g,primitiveType:ya.a.LINES})})}function Ko(e,t,a,i,n){var r,o,s=it.default.fromPoints(t,e).projectPointsOntoPlane(t,Qo);va.a.computeWindingOrder2D(s)===ho.default.CLOCKWISE&&(s.reverse(),t=t.slice().reverse());var l=t.length,u=new Array(l),d=0;if(i)for(r=new Float64Array(2*l*3*2),o=0;o<l;++o){u[o]=d/3;var c=t[o],f=t[(o+1)%l];r[d++]=c.x,r[d++]=c.y,r[d++]=c.z,r[d++]=f.x,r[d++]=f.y,r[d++]=f.z}else{var h=0;if(n===Dr.a.GEODESIC)for(o=0;o<l;o++)h+=Br.default.subdivideLineCount(t[o],t[(o+1)%l],a);else if(n===Dr.a.RHUMB)for(o=0;o<l;o++)h+=Br.default.subdivideRhumbLineCount(e,t[o],t[(o+1)%l],a);for(r=new Float64Array(3*h*2),o=0;o<l;++o){var m;u[o]=d/3,n===Dr.a.GEODESIC?m=Br.default.subdivideLine(t[o],t[(o+1)%l],a,qo):n===Dr.a.RHUMB&&(m=Br.default.subdivideRhumbLine(e,t[o],t[(o+1)%l],a,qo));for(var p=m.length,_=0;_<p;++_)r[d++]=m[_]}}l=r.length/6;var g=u.length,v=2*(2*l+g),y=ga.a.createTypedArray(l+g,v);for(d=0,o=0;o<l;++o)y[d++]=o,y[d++]=(o+1)%l,y[d++]=o+l,y[d++]=(o+1)%l+l;for(o=0;o<g;o++){var b=u[o];y[d++]=b,y[d++]=b+l}return new de.a({geometry:new ma.a({attributes:new _a.a({position:new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:r})}),indices:y,primitiveType:ya.a.LINES})})}function Jo(e){var t=e.polygonHierarchy,a=Object(o.default)(e.ellipsoid,ha.default.WGS84),i=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.perPositionHeight,!1),r=n&&Object(s.default)(e.extrudedHeight),l=Object(o.default)(e.arcType,Dr.a.GEODESIC),u=Object(o.default)(e.height,0),d=Object(o.default)(e.extrudedHeight,u);if(!r){var c=Math.max(u,d);d=Math.min(u,d),u=c}this._ellipsoid=ha.default.clone(a),this._granularity=i,this._height=u,this._extrudedHeight=d,this._arcType=l,this._polygonHierarchy=t,this._perPositionHeight=n,this._perPositionHeightExtrude=r,this._offsetAttribute=e.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=Br.default.computeHierarchyPackedLength(t)+ha.default.packedLength+8}Jo.pack=function(e,t,a){return a=Object(o.default)(a,0),a=Br.default.packPolygonHierarchy(e._polygonHierarchy,t,a),ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,t[a++]=e._height,t[a++]=e._extrudedHeight,t[a++]=e._granularity,t[a++]=e._perPositionHeightExtrude?1:0,t[a++]=e._perPositionHeight?1:0,t[a++]=e._arcType,t[a++]=Object(o.default)(e._offsetAttribute,-1),t[a]=e.packedLength,t};var $o=ha.default.clone(ha.default.UNIT_SPHERE),es={polygonHierarchy:{}};Jo.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=Br.default.unpackPolygonHierarchy(e,t);t=i.startingIndex,delete i.startingIndex;var n=ha.default.unpack(e,t,$o);t+=ha.default.packedLength;var r=e[t++],l=e[t++],u=e[t++],d=1===e[t++],c=1===e[t++],f=e[t++],h=e[t++],m=e[t];return Object(s.default)(a)||(a=new Jo(es)),a._polygonHierarchy=i,a._ellipsoid=ha.default.clone(n,a._ellipsoid),a._height=r,a._extrudedHeight=l,a._granularity=u,a._perPositionHeight=c,a._perPositionHeightExtrude=d,a._arcType=f,a._offsetAttribute=-1===h?void 0:h,a.packedLength=m,a},Jo.fromPositions=function(e){return new Jo({polygonHierarchy:{positions:(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute})},Jo.createGeometry=function(e){var t=e._ellipsoid,a=e._granularity,i=e._polygonHierarchy,r=e._perPositionHeight,o=e._arcType,l=Br.default.polygonOutlinesFromHierarchy(i,!r,t);if(0!==l.length){var u,d,c,f=[],h=Le.default.chordLength(a,t.maximumRadius),m=e._height,p=e._extrudedHeight;if(e._perPositionHeightExtrude||!Le.default.equalsEpsilon(m,p,0,Le.default.EPSILON2))for(c=0;c<l.length;c++){if((u=Ko(t,l[c],h,r,o)).geometry=Br.default.scaleToGeodeticHeightExtruded(u.geometry,m,p,t,r),Object(s.default)(e._offsetAttribute)){var _=u.geometry.attributes.position.values.length/3,g=new Uint8Array(_);e._offsetAttribute===ce.a.TOP?g=Object(Ke.a)(g,1,0,_/2):(d=e._offsetAttribute===ce.a.NONE?0:1,g=Object(Ke.a)(g,d)),u.geometry.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:g})}f.push(u)}else for(c=0;c<l.length;c++){if((u=Zo(t,l[c],h,r,o)).geometry.attributes.position.values=va.a.scaleToGeodeticHeight(u.geometry.attributes.position.values,m,t,!r),Object(s.default)(e._offsetAttribute)){var v=u.geometry.attributes.position.values.length,y=new Uint8Array(v/3);d=e._offsetAttribute===ce.a.NONE?0:1,Object(Ke.a)(y,d),u.geometry.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})}f.push(u)}var b=en.a.combineInstances(f)[0],w=n.default.fromVertices(b.attributes.position.values);return new ma.a({attributes:b.attributes,indices:b.indices,primitiveType:b.primitiveType,boundingSphere:w,offsetAttribute:e._offsetAttribute})}};var ts=Jo,as=new y.default,is=v.default.ZERO,ns=new v.default,rs=new ba.default,os=[],ss=new g.default;function ls(e){this.id=e,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0}function us(e,t){ni.call(this,{entity:e,scene:t,geometryOptions:new ls(e),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]}),this._onEntityPropertyChanged(e,"polygon",e.polygon,void 0)}function ds(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(us.prototype=Object.create(ni.prototype),us.prototype.constructor=us),us.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,n=i.isAvailable(e),r=this._options,o={show:new me.a(n&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(t=this._materialProperty.color.getValue(e,as)),Object(s.default)(t)||(t=y.default.WHITE),o.color=oe.a.fromColor(t));return Object(s.default)(r.offsetAttribute)&&(o.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,is,ns))),a=r.perPositionHeight&&!Object(s.default)(r.extrudedHeight)?new oo(r):new Xo(r),new de.a({id:i,geometry:a,attributes:o})},us.prototype.createOutlineGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),n=this._options,r=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,as),o=this._distanceDisplayConditionProperty.getValue(e),l={show:new me.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(r),distanceDisplayCondition:ue.fromDistanceDisplayCondition(o),offset:void 0};return Object(s.default)(n.offsetAttribute)&&(l.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,is,ns))),t=n.perPositionHeight&&!Object(s.default)(n.extrudedHeight)?new co(n):new ts(n),new de.a({id:a,geometry:t,attributes:l})},us.prototype._computeCenter=function(e,t){var a=A.default.getValueOrUndefined(this._entity.polygon.hierarchy,e);if(Object(s.default)(a)){var i=a.positions;if(0!==i.length){for(var n=this._scene.mapProjection.ellipsoid,r=it.default.fromPoints(i,n),o=r.projectPointsOntoPlane(i,os),l=o.length,u=0,d=l-1,c=new g.default,f=0;f<l;d=f++){var h=o[f],m=o[d],p=h.x*m.y-m.x*h.y,_=g.default.add(h,m,ss);_=g.default.multiplyByScalar(_,p,_),c=g.default.add(c,_,c),u+=p}var v=1/(3*u);return c=g.default.multiplyByScalar(c,v,c),r.projectPointOntoEllipsoid(c,t)}}},us.prototype._isHidden=function(e,t){return!Object(s.default)(t.hierarchy)||Ie.prototype._isHidden.call(this,e,t)},us.prototype._isOnTerrain=function(e,t){var a=ni.prototype._isOnTerrain.call(this,e,t),i=t.perPositionHeight,n=Object(s.default)(i)&&(!i.isConstant||i.getValue(fe.default.MINIMUM_VALUE));return a&&!n},us.prototype._isDynamic=function(e,t){return!t.hierarchy.isConstant||!A.default.isConstant(t.height)||!A.default.isConstant(t.extrudedHeight)||!A.default.isConstant(t.granularity)||!A.default.isConstant(t.stRotation)||!A.default.isConstant(t.outlineWidth)||!A.default.isConstant(t.perPositionHeight)||!A.default.isConstant(t.closeTop)||!A.default.isConstant(t.closeBottom)||!A.default.isConstant(t.zIndex)||!A.default.isConstant(t.arcType)||this._onTerrain&&!A.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof pe.default)},us.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof pe.default,n=this._options;n.vertexFormat=a?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat;var r,o=t.hierarchy.getValue(fe.default.MINIMUM_VALUE),l=A.default.getValueOrUndefined(t.height,fe.default.MINIMUM_VALUE),u=A.default.getValueOrDefault(t.heightReference,fe.default.MINIMUM_VALUE,O.default.NONE),d=A.default.getValueOrUndefined(t.extrudedHeight,fe.default.MINIMUM_VALUE),c=A.default.getValueOrDefault(t.extrudedHeightReference,fe.default.MINIMUM_VALUE,O.default.NONE),f=A.default.getValueOrDefault(t.perPositionHeight,fe.default.MINIMUM_VALUE,!1);l=ni.getGeometryHeight(l,u),f?(Object(s.default)(l)&&(l=void 0,Object(we.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),u!==O.default.NONE&&f&&(l=void 0,Object(we.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(l)&&(l=0),r=ni.computeGeometryOffsetAttribute(l,u,d,c)),n.polygonHierarchy=o,n.granularity=A.default.getValueOrUndefined(t.granularity,fe.default.MINIMUM_VALUE),n.stRotation=A.default.getValueOrUndefined(t.stRotation,fe.default.MINIMUM_VALUE),n.perPositionHeight=f,n.closeTop=A.default.getValueOrDefault(t.closeTop,fe.default.MINIMUM_VALUE,!0),n.closeBottom=A.default.getValueOrDefault(t.closeBottom,fe.default.MINIMUM_VALUE,!0),n.offsetAttribute=r,n.height=l,n.arcType=A.default.getValueOrDefault(t.arcType,fe.default.MINIMUM_VALUE,Dr.a.GEODESIC),(d=ni.getGeometryExtrudedHeight(d,c))===ni.CLAMP_TO_GROUND&&(d=i.a.getMinimumMaximumHeights(Xo.computeRectangle(n,rs)).minimumTerrainHeight),n.extrudedHeight=d},us.prototype._getIsClosed=function(e){var t=e.height,a=e.extrudedHeight,i=Object(s.default)(a)&&a!==t;return!e.perPositionHeight&&(!i&&0===t||i&&e.closeTop&&e.closeBottom)},us.DynamicGeometryUpdater=ds,Object(s.default)(Object.create)&&(ds.prototype=Object.create(be.prototype),ds.prototype.constructor=ds),ds.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.polygonHierarchy)||be.prototype._isHidden.call(this,e,t,a)},ds.prototype._setOptions=function(e,t,a){var n=this._options;n.polygonHierarchy=A.default.getValueOrUndefined(t.hierarchy,a);var r,o=A.default.getValueOrUndefined(t.height,a),l=A.default.getValueOrDefault(t.heightReference,a,O.default.NONE),u=A.default.getValueOrDefault(t.extrudedHeightReference,a,O.default.NONE),d=A.default.getValueOrUndefined(t.extrudedHeight,a),c=A.default.getValueOrUndefined(t.perPositionHeight,a);o=ni.getGeometryHeight(o,u),c?(Object(s.default)(o)&&(o=void 0,Object(we.a)("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),l!==O.default.NONE&&c&&(o=void 0,Object(we.a)("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(Object(s.default)(d)&&!Object(s.default)(o)&&(o=0),r=ni.computeGeometryOffsetAttribute(o,l,d,u)),n.granularity=A.default.getValueOrUndefined(t.granularity,a),n.stRotation=A.default.getValueOrUndefined(t.stRotation,a),n.perPositionHeight=A.default.getValueOrUndefined(t.perPositionHeight,a),n.closeTop=A.default.getValueOrDefault(t.closeTop,a,!0),n.closeBottom=A.default.getValueOrDefault(t.closeBottom,a,!0),n.offsetAttribute=r,n.height=o,n.arcType=A.default.getValueOrDefault(t.arcType,a,Dr.a.GEODESIC),(d=ni.getGeometryExtrudedHeight(d,u))===ni.CLAMP_TO_GROUND&&(d=i.a.getMinimumMaximumHeights(Xo.computeRectangle(n,rs)).minimumTerrainHeight),n.extrudedHeight=d};var cs=us;function fs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,a=e.shapePositions;this._positions=t,this._shape=a,this._ellipsoid=ha.default.clone(Object(o.default)(e.ellipsoid,ha.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._vertexFormat=K.default.clone(Object(o.default)(e.vertexFormat,K.default.DEFAULT)),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";var i=1+t.length*v.default.packedLength;i+=1+a.length*g.default.packedLength,this.packedLength=i+ha.default.packedLength+K.default.packedLength+2}fs.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var n=e._positions,r=n.length;for(t[a++]=r,i=0;i<r;++i,a+=v.default.packedLength)v.default.pack(n[i],t,a);var s=e._shape;for(r=s.length,t[a++]=r,i=0;i<r;++i,a+=g.default.packedLength)g.default.pack(s[i],t,a);return ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,K.default.pack(e._vertexFormat,t,a),a+=K.default.packedLength,t[a++]=e._cornerType,t[a]=e._granularity,t};var hs=ha.default.clone(ha.default.UNIT_SPHERE),ms=new K.default,ps={polylinePositions:void 0,shapePositions:void 0,ellipsoid:hs,vertexFormat:ms,cornerType:void 0,granularity:void 0};fs.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var n=e[t++],r=new Array(n);for(i=0;i<n;++i,t+=v.default.packedLength)r[i]=v.default.unpack(e,t);n=e[t++];var l=new Array(n);for(i=0;i<n;++i,t+=g.default.packedLength)l[i]=g.default.unpack(e,t);var u=ha.default.unpack(e,t,hs);t+=ha.default.packedLength;var d=K.default.unpack(e,t,ms);t+=K.default.packedLength;var c=e[t++],f=e[t];return Object(s.default)(a)?(a._positions=r,a._shape=l,a._ellipsoid=ha.default.clone(u,a._ellipsoid),a._vertexFormat=K.default.clone(d,a._vertexFormat),a._cornerType=c,a._granularity=f,a):(ps.polylinePositions=r,ps.shapePositions=l,ps.cornerType=c,ps.granularity=f,new fs(ps))};var _s=new _.default;fs.createGeometry=function(e){var t=e._positions,a=Object(Je.a)(t,v.default.equalsEpsilon),i=e._shape;if(i=Ht.removeDuplicatesFromShape(i),!(a.length<2||i.length<3)){va.a.computeWindingOrder2D(i)===ho.default.CLOCKWISE&&i.reverse();var r=_.default.fromPoints(i,_s);return function(e,t,a,i){var r=new _a.a;i.position&&(r.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:e}));var o,s,l,u,d,c,f=t.length,h=e.length/3,m=(h-2*f)/(2*f),p=va.a.triangulate(t),_=(m-1)*f*6+2*p.length,g=ga.a.createTypedArray(h,_),v=2*f,y=0;for(o=0;o<m-1;o++){for(s=0;s<f-1;s++)c=(l=2*s+o*f*2)+v,d=(u=l+1)+v,g[y++]=u,g[y++]=l,g[y++]=d,g[y++]=d,g[y++]=l,g[y++]=c;d=(u=(l=2*f-2+o*f*2)+1)+v,c=l+v,g[y++]=u,g[y++]=l,g[y++]=d,g[y++]=d,g[y++]=l,g[y++]=c}if(i.st||i.tangent||i.bitangent){var b,w,C=new Float32Array(2*h),O=1/(m-1),x=1/a.height,T=a.height/2,E=0;for(o=0;o<m;o++){for(b=o*O,w=x*(t[0].y+T),C[E++]=b,C[E++]=w,s=1;s<f;s++)w=x*(t[s].y+T),C[E++]=b,C[E++]=w,C[E++]=b,C[E++]=w;w=x*(t[0].y+T),C[E++]=b,C[E++]=w}for(s=0;s<f;s++)b=0,w=x*(t[s].y+T),C[E++]=b,C[E++]=w;for(s=0;s<f;s++)b=(m-1)*O,w=x*(t[s].y+T),C[E++]=b,C[E++]=w;r.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:new Float32Array(C)})}var A=h-2*f;for(o=0;o<p.length;o+=3){var P=p[o]+A,S=p[o+1]+A,D=p[o+2]+A;g[y++]=P,g[y++]=S,g[y++]=D,g[y++]=D+f,g[y++]=S+f,g[y++]=P+f}var F=new ma.a({attributes:r,indices:g,boundingSphere:n.default.fromVertices(e),primitiveType:ya.a.TRIANGLES});if(i.normal&&(F=en.a.computeNormal(F)),i.tangent||i.bitangent){try{F=en.a.computeTangentAndBitangent(F)}catch(e){Object(we.a)("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}i.tangent||(F.attributes.tangent=void 0),i.bitangent||(F.attributes.bitangent=void 0),i.st||(F.attributes.st=void 0)}return F}(Ht.computePositions(a,i,r,e,!0),i,r,e._vertexFormat)}};var gs=fs;function vs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).polylinePositions,a=e.shapePositions;this._positions=t,this._shape=a,this._ellipsoid=ha.default.clone(Object(o.default)(e.ellipsoid,ha.default.WGS84)),this._cornerType=Object(o.default)(e.cornerType,$e.a.ROUNDED),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeOutlineGeometry";var i=1+t.length*v.default.packedLength;i+=1+a.length*g.default.packedLength,this.packedLength=i+ha.default.packedLength+2}vs.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var n=e._positions,r=n.length;for(t[a++]=r,i=0;i<r;++i,a+=v.default.packedLength)v.default.pack(n[i],t,a);var s=e._shape;for(r=s.length,t[a++]=r,i=0;i<r;++i,a+=g.default.packedLength)g.default.pack(s[i],t,a);return ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,t[a++]=e._cornerType,t[a]=e._granularity,t};var ys=ha.default.clone(ha.default.UNIT_SPHERE),bs={polylinePositions:void 0,shapePositions:void 0,ellipsoid:ys,height:void 0,cornerType:void 0,granularity:void 0};vs.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var n=e[t++],r=new Array(n);for(i=0;i<n;++i,t+=v.default.packedLength)r[i]=v.default.unpack(e,t);n=e[t++];var l=new Array(n);for(i=0;i<n;++i,t+=g.default.packedLength)l[i]=g.default.unpack(e,t);var u=ha.default.unpack(e,t,ys);t+=ha.default.packedLength;var d=e[t++],c=e[t];return Object(s.default)(a)?(a._positions=r,a._shape=l,a._ellipsoid=ha.default.clone(u,a._ellipsoid),a._cornerType=d,a._granularity=c,a):(bs.polylinePositions=r,bs.shapePositions=l,bs.cornerType=d,bs.granularity=c,new vs(bs))};var ws=new _.default;vs.createGeometry=function(e){var t=e._positions,a=Object(Je.a)(t,v.default.equalsEpsilon),i=e._shape;if(i=Ht.removeDuplicatesFromShape(i),!(a.length<2||i.length<3)){va.a.computeWindingOrder2D(i)===ho.default.CLOCKWISE&&i.reverse();var r=_.default.fromPoints(i,ws);return function(e,t){var a=new _a.a;a.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:e});var i,r,o=t.length,s=a.position.values.length/3,l=e.length/3/o,u=ga.a.createTypedArray(s,2*o*(l+1)),d=0,c=(i=0)*o;for(r=0;r<o-1;r++)u[d++]=r+c,u[d++]=r+c+1;for(u[d++]=o-1+c,u[d++]=c,c=(i=l-1)*o,r=0;r<o-1;r++)u[d++]=r+c,u[d++]=r+c+1;for(u[d++]=o-1+c,u[d++]=c,i=0;i<l-1;i++){var f=o*i,h=f+o;for(r=0;r<o;r++)u[d++]=r+f,u[d++]=r+h}return new ma.a({attributes:a,indices:ga.a.createTypedArray(s,u),boundingSphere:n.default.fromVertices(e),primitiveType:ya.a.LINES})}(Ht.computePositions(a,i,r,e,!1),i)}};var Cs=vs,Os=new y.default;function xs(e){this.id=e,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function Ts(e,t){Ie.call(this,{entity:e,scene:t,geometryOptions:new xs(e),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]}),this._onEntityPropertyChanged(e,"polylineVolume",e.polylineVolume,void 0)}function Es(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(Ts.prototype=Object.create(Ie.prototype),Ts.prototype.constructor=Ts),Ts.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,n=i.isAvailable(e),r=new me.a(n&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof pe.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(a=this._materialProperty.color.getValue(e,Os)),Object(s.default)(a)||(a=y.default.WHITE),t={show:r,distanceDisplayCondition:l,color:oe.a.fromColor(a)}):t={show:r,distanceDisplayCondition:l};return new de.a({id:i,geometry:new gs(this._options),attributes:t})},Ts.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,Os),n=this._distanceDisplayConditionProperty.getValue(e);return new de.a({id:t,geometry:new Cs(this._options),attributes:{show:new me.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(i),distanceDisplayCondition:ue.fromDistanceDisplayCondition(n)}})},Ts.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||!Object(s.default)(t.shape)||Ie.prototype._isHidden.call(this,e,t)},Ts.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&t.shape.isConstant&&A.default.isConstant(t.granularity)&&A.default.isConstant(t.outlineWidth)&&A.default.isConstant(t.cornerType))},Ts.prototype._setStaticOptions=function(e,t){var a=t.granularity,i=t.cornerType,n=this._options,r=this._materialProperty instanceof pe.default;n.vertexFormat=r?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,n.polylinePositions=t.positions.getValue(fe.default.MINIMUM_VALUE,n.polylinePositions),n.shapePositions=t.shape.getValue(fe.default.MINIMUM_VALUE,n.shape),n.granularity=Object(s.default)(a)?a.getValue(fe.default.MINIMUM_VALUE):void 0,n.cornerType=Object(s.default)(i)?i.getValue(fe.default.MINIMUM_VALUE):void 0},Ts.DynamicGeometryUpdater=Es,Object(s.default)(Object.create)&&(Es.prototype=Object.create(be.prototype),Es.prototype.constructor=Es),Es.prototype._isHidden=function(e,t,a){var i=this._options;return!Object(s.default)(i.polylinePositions)||!Object(s.default)(i.shapePositions)||be.prototype._isHidden.call(this,e,t,a)},Es.prototype._setOptions=function(e,t,a){var i=this._options;i.polylinePositions=A.default.getValueOrUndefined(t.positions,a,i.polylinePositions),i.shapePositions=A.default.getValueOrUndefined(t.shape,a),i.granularity=A.default.getValueOrUndefined(t.granularity,a),i.cornerType=A.default.getValueOrUndefined(t.cornerType,a)};var As=Ts,Ps=a(183),Ss=a(656),Ds=new v.default,Fs=new v.default,Ms=new v.default,Is=new v.default,Rs=new ba.default,Ns=new g.default,Ls=new n.default,js=new n.default;function Vs(e,t){var a=new ma.a({attributes:new _a.a,primitiveType:ya.a.TRIANGLES});return a.attributes.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:t.positions}),e.normal&&(a.attributes.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.normals})),e.tangent&&(a.attributes.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.tangents})),e.bitangent&&(a.attributes.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:t.bitangents})),a}var Us=new v.default,Bs=new v.default;function zs(e,t){var a=e._vertexFormat,i=e._ellipsoid,n=t.height,r=t.width,o=t.northCap,s=t.southCap,l=0,u=n,d=n,c=0;o&&(l=1,d-=1,c+=1),s&&(u-=1,d-=1,c+=1),c+=r*d;for(var f=a.position?new Float64Array(3*c):void 0,h=a.st?new Float32Array(2*c):void 0,m=0,p=0,_=Ds,g=Ns,y=Number.MAX_VALUE,b=Number.MAX_VALUE,w=-Number.MAX_VALUE,C=-Number.MAX_VALUE,O=l;O<u;++O)for(var x=0;x<r;++x)Ss.a.computePosition(t,i,a.st,O,x,_,g),f[m++]=_.x,f[m++]=_.y,f[m++]=_.z,a.st&&(h[p++]=g.x,h[p++]=g.y,y=Math.min(y,g.x),b=Math.min(b,g.y),w=Math.max(w,g.x),C=Math.max(C,g.y));if(o&&(Ss.a.computePosition(t,i,a.st,0,0,_,g),f[m++]=_.x,f[m++]=_.y,f[m++]=_.z,a.st&&(h[p++]=g.x,h[p++]=g.y,y=g.x,b=g.y,w=g.x,C=g.y)),s&&(Ss.a.computePosition(t,i,a.st,n-1,0,_,g),f[m++]=_.x,f[m++]=_.y,f[m]=_.z,a.st&&(h[p++]=g.x,h[p]=g.y,y=Math.min(y,g.x),b=Math.min(b,g.y),w=Math.max(w,g.x),C=Math.max(C,g.y))),a.st&&(y<0||b<0||w>1||C>1))for(var T=0;T<h.length;T+=2)h[T]=(h[T]-y)/(w-y),h[T+1]=(h[T+1]-b)/(C-b);var E=function(e,t,a,i){var n=e.length,r=t.normal?new Float32Array(n):void 0,o=t.tangent?new Float32Array(n):void 0,s=t.bitangent?new Float32Array(n):void 0,l=0,u=Is,d=Ms,c=Fs;if(t.normal||t.tangent||t.bitangent)for(var f=0;f<n;f+=3){var h=v.default.fromArray(e,f,Ds),m=l+1,p=l+2;c=a.geodeticSurfaceNormal(h,c),(t.tangent||t.bitangent)&&(v.default.cross(v.default.UNIT_Z,c,d),et.default.multiplyByVector(i,d,d),v.default.normalize(d,d),t.bitangent&&v.default.normalize(v.default.cross(c,d,u),u)),t.normal&&(r[l]=c.x,r[m]=c.y,r[p]=c.z),t.tangent&&(o[l]=d.x,o[m]=d.y,o[p]=d.z),t.bitangent&&(s[l]=u.x,s[m]=u.y,s[p]=u.z),l+=3}return Vs(t,{positions:e,normals:r,tangents:o,bitangents:s})}(f,a,i,t.tangentRotationMatrix),A=6*(r-1)*(d-1);o&&(A+=3*(r-1)),s&&(A+=3*(r-1));var P,S=ga.a.createTypedArray(c,A),D=0,F=0;for(P=0;P<d-1;++P){for(var M=0;M<r-1;++M){var I=D,R=I+r,N=R+1,L=I+1;S[F++]=I,S[F++]=R,S[F++]=L,S[F++]=L,S[F++]=R,S[F++]=N,++D}++D}if(o||s){var j,V,U=c-1,B=c-1;if(o&&s&&(U=c-2),D=0,o)for(P=0;P<r-1;P++)V=(j=D)+1,S[F++]=U,S[F++]=j,S[F++]=V,++D;if(s)for(D=(d-1)*r,P=0;P<r-1;P++)V=(j=D)+1,S[F++]=j,S[F++]=B,S[F++]=V,++D}return E.indices=S,a.st&&(E.attributes.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:h})),E}function Hs(e,t,a,i,n){return e[t++]=i[a],e[t++]=i[a+1],e[t++]=i[a+2],e[t++]=n[a],e[t++]=n[a+1],e[t]=n[a+2],e}function ks(e,t,a,i){return e[t++]=i[a],e[t++]=i[a+1],e[t++]=i[a],e[t]=i[a+1],e}var Gs=new K.default;function Ws(e,t){var a,i=e._shadowVolume,n=e._offsetAttribute,r=e._vertexFormat,o=e._extrudedHeight,l=e._surfaceHeight,u=e._ellipsoid,d=t.height,c=t.width;if(i){var f=K.default.clone(r,Gs);f.normal=!0,e._vertexFormat=f}var h=zs(e,t);i&&(e._vertexFormat=r);var m=va.a.scaleToGeodeticHeight(h.attributes.position.values,l,u,!1),p=(m=new Float64Array(m)).length,_=2*p,g=new Float64Array(_);g.set(m);var y=va.a.scaleToGeodeticHeight(h.attributes.position.values,o,u);g.set(y,p),h.attributes.position.values=g;var b,w,C,O=r.normal?new Float32Array(_):void 0,x=r.tangent?new Float32Array(_):void 0,T=r.bitangent?new Float32Array(_):void 0,E=r.st?new Float32Array(_/3*2):void 0;if(r.normal){for(w=h.attributes.normal.values,O.set(w),a=0;a<p;a++)w[a]=-w[a];O.set(w,p),h.attributes.normal.values=O}if(i){w=h.attributes.normal.values,r.normal||(h.attributes.normal=void 0);var A=new Float32Array(_);for(a=0;a<p;a++)w[a]=-w[a];A.set(w,p),h.attributes.extrudeDirection=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:A})}var P=Object(s.default)(n);if(P){var S=p/3*2,D=new Uint8Array(S);n===ce.a.TOP?D=Object(Ke.a)(D,1,0,S/2):(C=n===ce.a.NONE?0:1,D=Object(Ke.a)(D,C)),h.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:D})}if(r.tangent){var F=h.attributes.tangent.values;for(x.set(F),a=0;a<p;a++)F[a]=-F[a];x.set(F,p),h.attributes.tangent.values=x}if(r.bitangent){var M=h.attributes.bitangent.values;T.set(M),T.set(M,p),h.attributes.bitangent.values=T}r.st&&(b=h.attributes.st.values,E.set(b),E.set(b,p/3*2),h.attributes.st.values=E);var I=h.indices,R=I.length,N=p/3,L=ga.a.createTypedArray(_/3,2*R);for(L.set(I),a=0;a<R;a+=3)L[a+R]=I[a+2]+N,L[a+1+R]=I[a+1]+N,L[a+2+R]=I[a]+N;h.indices=L;var j=t.northCap,V=t.southCap,U=d,B=2,z=0,H=4,k=4;j&&(B-=1,U-=1,z+=1,H-=2,k-=1),V&&(B-=1,U-=1,z+=1,H-=2,k-=1);var G=2*((z+=B*c+2*U-H)+k),W=new Float64Array(3*G),Y=i?new Float32Array(3*G):void 0,X=P?new Uint8Array(G):void 0,Q=r.st?new Float32Array(2*G):void 0,q=n===ce.a.TOP;P&&!q&&(C=n===ce.a.ALL?1:0,X=Object(Ke.a)(X,C));var Z,J=0,$=0,ee=0,te=0,ae=c*U;for(a=0;a<ae;a+=c)W=Hs(W,J,Z=3*a,m,y),J+=6,r.st&&(Q=ks(Q,$,2*a,b),$+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);if(V){var ie=j?ae+1:ae;for(Z=3*ie,a=0;a<2;a++)W=Hs(W,J,Z,m,y),J+=6,r.st&&(Q=ks(Q,$,2*ie,b),$+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1)}else for(a=ae-c;a<ae;a++)W=Hs(W,J,Z=3*a,m,y),J+=6,r.st&&(Q=ks(Q,$,2*a,b),$+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);for(a=ae-1;a>0;a-=c)W=Hs(W,J,Z=3*a,m,y),J+=6,r.st&&(Q=ks(Q,$,2*a,b),$+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);if(j){var ne=ae;for(Z=3*ne,a=0;a<2;a++)W=Hs(W,J,Z,m,y),J+=6,r.st&&(Q=ks(Q,$,2*ne,b),$+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1)}else for(a=c-1;a>=0;a--)W=Hs(W,J,Z=3*a,m,y),J+=6,r.st&&(Q=ks(Q,$,2*a,b),$+=4),i&&(ee+=3,Y[ee++]=w[Z],Y[ee++]=w[Z+1],Y[ee++]=w[Z+2]),q&&(X[te++]=1,te+=1);var re=function(e,t,a){var i=e.length,n=t.normal?new Float32Array(i):void 0,r=t.tangent?new Float32Array(i):void 0,o=t.bitangent?new Float32Array(i):void 0,s=0,l=0,u=0,d=!0,c=Is,f=Ms,h=Fs;if(t.normal||t.tangent||t.bitangent)for(var m=0;m<i;m+=6){var p=v.default.fromArray(e,m,Ds),_=v.default.fromArray(e,(m+6)%i,Us);if(d){var g=v.default.fromArray(e,(m+3)%i,Bs);v.default.subtract(_,p,_),v.default.subtract(g,p,g),h=v.default.normalize(v.default.cross(g,_,h),h),d=!1}v.default.equalsEpsilon(_,p,Le.default.EPSILON10)&&(d=!0),(t.tangent||t.bitangent)&&(c=a.geodeticSurfaceNormal(p,c),t.tangent&&(f=v.default.normalize(v.default.cross(c,h,f),f))),t.normal&&(n[s++]=h.x,n[s++]=h.y,n[s++]=h.z,n[s++]=h.x,n[s++]=h.y,n[s++]=h.z),t.tangent&&(r[l++]=f.x,r[l++]=f.y,r[l++]=f.z,r[l++]=f.x,r[l++]=f.y,r[l++]=f.z),t.bitangent&&(o[u++]=c.x,o[u++]=c.y,o[u++]=c.z,o[u++]=c.x,o[u++]=c.y,o[u++]=c.z)}return Vs(t,{positions:e,normals:n,tangents:r,bitangents:o})}(W,r,u);r.st&&(re.attributes.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:Q})),i&&(re.attributes.extrudeDirection=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:Y})),P&&(re.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:X}));var oe,le,ue,fe,he=ga.a.createTypedArray(G,6*z);p=W.length/3;var me=0;for(a=0;a<p-1;a+=2){fe=((oe=a)+2)%p;var pe=v.default.fromArray(W,3*oe,Us),_e=v.default.fromArray(W,3*fe,Bs);v.default.equalsEpsilon(pe,_e,Le.default.EPSILON10)||(ue=((le=(oe+1)%p)+2)%p,he[me++]=oe,he[me++]=le,he[me++]=fe,he[me++]=fe,he[me++]=le,he[me++]=ue)}return re.indices=he,(re=en.a.combineInstances([new de.a({geometry:h}),new de.a({geometry:re})]))[0]}var Ys=[new v.default,new v.default,new v.default,new v.default],Xs=new Ne.default,Qs=new Ne.default;function qs(e,t,a,i,n){if(0===a)return ba.default.clone(e,n);var r=Ss.a.computeOptions(e,t,a,0,Rs,Xs),o=r.height,s=r.width,l=Ys;return Ss.a.computePosition(r,i,!1,0,0,l[0]),Ss.a.computePosition(r,i,!1,0,s-1,l[1]),Ss.a.computePosition(r,i,!1,o-1,0,l[2]),Ss.a.computePosition(r,i,!1,o-1,s-1,l[3]),ba.default.fromCartesianArray(l,i,n)}function Zs(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,a=Object(o.default)(e.height,0),i=Object(o.default)(e.extrudedHeight,a);this._rectangle=ba.default.clone(t),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._ellipsoid=ha.default.clone(Object(o.default)(e.ellipsoid,ha.default.WGS84)),this._surfaceHeight=Math.max(a,i),this._rotation=Object(o.default)(e.rotation,0),this._stRotation=Object(o.default)(e.stRotation,0),this._vertexFormat=K.default.clone(Object(o.default)(e.vertexFormat,K.default.DEFAULT)),this._extrudedHeight=Math.min(a,i),this._shadowVolume=Object(o.default)(e.shadowVolume,!1),this._workerName="createRectangleGeometry",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}Zs.packedLength=ba.default.packedLength+ha.default.packedLength+K.default.packedLength+7,Zs.pack=function(e,t,a){return a=Object(o.default)(a,0),ba.default.pack(e._rectangle,t,a),a+=ba.default.packedLength,ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,K.default.pack(e._vertexFormat,t,a),a+=K.default.packedLength,t[a++]=e._granularity,t[a++]=e._surfaceHeight,t[a++]=e._rotation,t[a++]=e._stRotation,t[a++]=e._extrudedHeight,t[a++]=e._shadowVolume?1:0,t[a]=Object(o.default)(e._offsetAttribute,-1),t};var Ks=new ba.default,Js=ha.default.clone(ha.default.UNIT_SPHERE),$s={rectangle:Ks,ellipsoid:Js,vertexFormat:Gs,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Zs.unpack=function(e,t,a){t=Object(o.default)(t,0);var i=ba.default.unpack(e,t,Ks);t+=ba.default.packedLength;var n=ha.default.unpack(e,t,Js);t+=ha.default.packedLength;var r=K.default.unpack(e,t,Gs);t+=K.default.packedLength;var l=e[t++],u=e[t++],d=e[t++],c=e[t++],f=e[t++],h=1===e[t++],m=e[t];return Object(s.default)(a)?(a._rectangle=ba.default.clone(i,a._rectangle),a._ellipsoid=ha.default.clone(n,a._ellipsoid),a._vertexFormat=K.default.clone(r,a._vertexFormat),a._granularity=l,a._surfaceHeight=u,a._rotation=d,a._stRotation=c,a._extrudedHeight=f,a._shadowVolume=h,a._offsetAttribute=-1===m?void 0:m,a):($s.granularity=l,$s.height=u,$s.rotation=d,$s.stRotation=c,$s.extrudedHeight=f,$s.shadowVolume=h,$s.offsetAttribute=-1===m?void 0:m,new Zs($s))},Zs.computeRectangle=function(e,t){var a=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).rectangle,i=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),n=Object(o.default)(e.ellipsoid,ha.default.WGS84);return qs(a,i,Object(o.default)(e.rotation,0),n,t)};var el=new et.default,tl=new rt.default,al=new Ne.default;Zs.createGeometry=function(e){if(!Le.default.equalsEpsilon(e._rectangle.north,e._rectangle.south,Le.default.EPSILON10)&&!Le.default.equalsEpsilon(e._rectangle.east,e._rectangle.west,Le.default.EPSILON10)){var t=e._rectangle,a=e._ellipsoid,i=e._rotation,r=e._stRotation,o=e._vertexFormat,l=Ss.a.computeOptions(t,e._granularity,i,r,Rs,Xs,Qs),u=el;if(0!==r||0!==i){var d=ba.default.center(t,al),c=a.geodeticSurfaceNormalCartographic(d,Us);rt.default.fromAxisAngle(c,-r,tl),et.default.fromQuaternion(tl,u)}else et.default.clone(et.default.IDENTITY,u);var f,h,m=e._surfaceHeight,p=e._extrudedHeight,_=!Le.default.equalsEpsilon(m,p,0,Le.default.EPSILON2);if(l.lonScalar=1/e._rectangle.width,l.latScalar=1/e._rectangle.height,l.tangentRotationMatrix=u,t=e._rectangle,_){f=Ws(e,l);var g=n.default.fromRectangle3D(t,a,m,js),v=n.default.fromRectangle3D(t,a,p,Ls);h=n.default.union(g,v)}else{if((f=zs(e,l)).attributes.position.values=va.a.scaleToGeodeticHeight(f.attributes.position.values,m,a,!1),Object(s.default)(e._offsetAttribute)){var y=f.attributes.position.values.length,b=new Uint8Array(y/3),w=e._offsetAttribute===ce.a.NONE?0:1;Object(Ke.a)(b,w),f.attributes.applyOffset=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:1,values:b})}h=n.default.fromRectangle3D(t,a,m)}return o.position||delete f.attributes.position,new ma.a({attributes:f.attributes,indices:f.indices,primitiveType:f.primitiveType,boundingSphere:h,offsetAttribute:e._offsetAttribute})}},Zs.createShadowVolume=function(e,t,a){var i=e._granularity,n=e._ellipsoid,r=t(i,n),o=a(i,n);return new Zs({rectangle:e._rectangle,rotation:e._rotation,ellipsoid:n,stRotation:e._stRotation,granularity:i,extrudedHeight:o,height:r,vertexFormat:K.default.POSITION_ONLY,shadowVolume:!0})};var il=new ba.default,nl=[new g.default,new g.default,new g.default],rl=new Ps.a,ol=new Ne.default;Object.defineProperties(Zs.prototype,{rectangle:{get:function(){return Object(s.default)(this._rotatedRectangle)||(this._rotatedRectangle=qs(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return Object(s.default)(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){if(0===e._stRotation)return[0,0,0,1,1,0];var t=ba.default.clone(e._rectangle,il),a=e._granularity,i=e._ellipsoid,n=qs(t,a,e._rotation-e._stRotation,i,il),r=nl;r[0].x=n.west,r[0].y=n.south,r[1].x=n.west,r[1].y=n.north,r[2].x=n.east,r[2].y=n.south;for(var o=e.rectangle,s=Ps.a.fromRotation(e._stRotation,rl),l=ba.default.center(o,ol),u=0;u<3;++u){var d=r[u];d.x-=l.longitude,d.y-=l.latitude,Ps.a.multiplyByVector(s,d,d),d.x+=l.longitude,d.y+=l.latitude,d.x=(d.x-o.west)/o.width,d.y=(d.y-o.south)/o.height}var c=r[0],f=r[1],h=r[2],m=new Array(6);return g.default.pack(c,m),g.default.pack(f,m,2),g.default.pack(h,m,4),m}(this)),this._textureCoordinateRotationPoints}}});var sl=Zs,ll=a(655),ul=new y.default,dl=v.default.ZERO,cl=new v.default,fl=new ba.default,hl=new ba.default,ml=new Ne.default;function pl(e){this.id=e,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function _l(e,t){ni.call(this,{entity:e,scene:t,geometryOptions:new pl(e),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]}),this._onEntityPropertyChanged(e,"rectangle",e.rectangle,void 0)}function gl(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(_l.prototype=Object.create(ni.prototype),_l.prototype.constructor=_l),_l.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),n={show:new me.a(i&&a.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:ue.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,ul)),Object(s.default)(t)||(t=y.default.WHITE),n.color=oe.a.fromColor(t));return Object(s.default)(this._options.offsetAttribute)&&(n.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,dl,cl))),new de.a({id:a,geometry:new sl(this._options),attributes:n})},_l.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,ul),n=this._distanceDisplayConditionProperty.getValue(e),r={show:new me.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(i),distanceDisplayCondition:ue.fromDistanceDisplayCondition(n),offset:void 0};return Object(s.default)(this._options.offsetAttribute)&&(r.offset=he.a.fromCartesian3(A.default.getValueOrDefault(this._terrainOffsetProperty,e,dl,cl))),new de.a({id:t,geometry:new ll.a(this._options),attributes:r})},_l.prototype._computeCenter=function(e,t){var a=A.default.getValueOrUndefined(this._entity.rectangle.coordinates,e,hl);if(Object(s.default)(a)){var i=ba.default.center(a,ml);return Ne.default.toCartesian(i,ha.default.WGS84,t)}},_l.prototype._isHidden=function(e,t){return!Object(s.default)(t.coordinates)||Ie.prototype._isHidden.call(this,e,t)},_l.prototype._isDynamic=function(e,t){return!t.coordinates.isConstant||!A.default.isConstant(t.height)||!A.default.isConstant(t.extrudedHeight)||!A.default.isConstant(t.granularity)||!A.default.isConstant(t.stRotation)||!A.default.isConstant(t.rotation)||!A.default.isConstant(t.outlineWidth)||!A.default.isConstant(t.zIndex)||this._onTerrain&&!A.default.isConstant(this._materialProperty)&&!(this._materialProperty instanceof pe.default)},_l.prototype._setStaticOptions=function(e,t){var a=this._materialProperty instanceof pe.default,n=A.default.getValueOrUndefined(t.height,fe.default.MINIMUM_VALUE),r=A.default.getValueOrDefault(t.heightReference,fe.default.MINIMUM_VALUE,O.default.NONE),o=A.default.getValueOrUndefined(t.extrudedHeight,fe.default.MINIMUM_VALUE),l=A.default.getValueOrDefault(t.extrudedHeightReference,fe.default.MINIMUM_VALUE,O.default.NONE);Object(s.default)(o)&&!Object(s.default)(n)&&(n=0);var u=this._options;u.vertexFormat=a?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,u.rectangle=t.coordinates.getValue(fe.default.MINIMUM_VALUE,u.rectangle),u.granularity=A.default.getValueOrUndefined(t.granularity,fe.default.MINIMUM_VALUE),u.stRotation=A.default.getValueOrUndefined(t.stRotation,fe.default.MINIMUM_VALUE),u.rotation=A.default.getValueOrUndefined(t.rotation,fe.default.MINIMUM_VALUE),u.offsetAttribute=ni.computeGeometryOffsetAttribute(n,r,o,l),u.height=ni.getGeometryHeight(n,r),(o=ni.getGeometryExtrudedHeight(o,l))===ni.CLAMP_TO_GROUND&&(o=i.a.getMinimumMaximumHeights(sl.computeRectangle(u,fl)).minimumTerrainHeight),u.extrudedHeight=o},_l.DynamicGeometryUpdater=gl,Object(s.default)(Object.create)&&(gl.prototype=Object.create(be.prototype),gl.prototype.constructor=gl),gl.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.rectangle)||be.prototype._isHidden.call(this,e,t,a)},gl.prototype._setOptions=function(e,t,a){var n=this._options,r=A.default.getValueOrUndefined(t.height,a),o=A.default.getValueOrDefault(t.heightReference,a,O.default.NONE),l=A.default.getValueOrUndefined(t.extrudedHeight,a),u=A.default.getValueOrDefault(t.extrudedHeightReference,a,O.default.NONE);Object(s.default)(l)&&!Object(s.default)(r)&&(r=0),n.rectangle=A.default.getValueOrUndefined(t.coordinates,a,n.rectangle),n.granularity=A.default.getValueOrUndefined(t.granularity,a),n.stRotation=A.default.getValueOrUndefined(t.stRotation,a),n.rotation=A.default.getValueOrUndefined(t.rotation,a),n.offsetAttribute=ni.computeGeometryOffsetAttribute(r,o,l,u),n.height=ni.getGeometryHeight(r,o),(l=ni.getGeometryExtrudedHeight(l,u))===ni.CLAMP_TO_GROUND&&(l=i.a.getMinimumMaximumHeights(sl.computeRectangle(n,fl)).minimumTerrainHeight),n.extrudedHeight=l};var vl=_l,yl=new y.default,bl=new w.a,wl=new w.a,Cl=v.default.ZERO,Ol=new v.default;function xl(e,t,a,i,n,r,o){var l;this.translucent=t,this.appearanceType=a,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=n,this.depthFailMaterial=void 0,this.closed=r,this.shadows=o,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.updaters=new p.default,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.subscriptions=new p.default,this.showsUpdated=new p.default,this.itemsToRemove=[],this.invalidated=!1,Object(s.default)(n)&&(l=n.definitionChanged.addEventListener(xl.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=l}function Tl(e,t,a,i,n){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=a,this._closed=i,this._shadows=n}function El(e,t){for(var a=e.length-1;a>=0;a--){var i=e[a];if(i.remove(t))return 0===i.updaters.length&&(e.splice(a,1),i.destroy()),!0}return!1}function Al(e,t,a){for(var i=!1,n=t.length,r=0;r<n;++r){var o=t[r],s=o.itemsToRemove,l=s.length;if(l>0)for(r=0;r<l;r++){var u=s[r];o.remove(u),e.add(a,u),i=!0}}return i}function Pl(e,t,a,i){var n,r=t.length;for(n=r-1;n>=0;n--){var o=t[n];if(o.invalidated){t.splice(n,1);for(var s=o.updaters.values,l=s.length,u=0;u<l;u++)e.add(a,s[u]);o.destroy()}}for(r=t.length,n=0;n<r;++n)i=t[n].update(a)&&i;return i}function Sl(e,t,a){for(var i=e.length,n=0;n<i;n++){var r=e[n];if(r.contains(t))return r.getBoundingSphere(t,a)}return E.default.FAILED}function Dl(e){for(var t=e.length,a=0;a<t;a++)e[a].destroy();e.length=0}xl.prototype.onMaterialChanged=function(){this.invalidated=!0},xl.prototype.isMaterial=function(e){var t=this.depthFailMaterialProperty,a=e.depthFailMaterialProperty;return a===t||!!Object(s.default)(t)&&t.equals(a)},xl.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&A.default.isConstant(e.distanceDisplayConditionProperty)&&A.default.isConstant(e.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,n,r){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},xl.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},xl.prototype.update=function(e){var t,a=!0,i=0,n=this.primitive,r=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0){var l;Object(s.default)(n)&&(Object(s.default)(this.oldPrimitive)?r.remove(n):this.oldPrimitive=n),Object(s.default)(this.depthFailAppearanceType)&&(Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),l=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),n=new _e.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:l,shadows:this.shadows}),r.add(n),a=!1}else{Object(s.default)(n)&&(r.remove(n),n=void 0);var u=this.oldPrimitive;Object(s.default)(u)&&(r.remove(u),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(n)&&n.ready){n.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0),!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof pe.default||(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var d=this.updatersWithAttributes.values,c=d.length,f=this.waitingOnCreate;for(t=0;t<c;t++){var h=d[t],m=this.geometry.get(h.id),p=this.attributes.get(m.id.id);if(Object(s.default)(p)||(p=n.getGeometryInstanceAttributes(m.id),this.attributes.set(m.id.id,p)),!h.fillMaterialProperty.isConstant||f){var _=h.fillMaterialProperty.color,g=A.default.getValueOrDefault(_,e,y.default.WHITE,yl);y.default.equals(p._lastColor,g)||(p._lastColor=y.default.clone(g,p._lastColor),p.color=oe.a.toValue(g,p.color),(this.translucent&&255===p.color[3]||!this.translucent&&255!==p.color[3])&&(this.itemsToRemove[i++]=h))}if(Object(s.default)(this.depthFailAppearanceType)&&h.depthFailMaterialProperty instanceof pe.default&&(!h.depthFailMaterialProperty.isConstant||f)){var b=h.depthFailMaterialProperty.color,C=A.default.getValueOrDefault(b,e,y.default.WHITE,yl);y.default.equals(p._lastDepthFailColor,C)||(p._lastDepthFailColor=y.default.clone(C,p._lastDepthFailColor),p.depthFailColor=oe.a.toValue(C,p.depthFailColor))}var O=h.entity.isShowing&&(h.hasConstantFill||h.isFilled(e));O!==(1===p.show[0])&&(p.show=me.a.toValue(O,p.show));var x=h.distanceDisplayConditionProperty;if(!A.default.isConstant(x)){var T=A.default.getValueOrDefault(x,e,wl,bl);w.a.equals(T,p._lastDistanceDisplayCondition)||(p._lastDistanceDisplayCondition=w.a.clone(T,p._lastDistanceDisplayCondition),p.distanceDisplayCondition=ue.toValue(T,p.distanceDisplayCondition))}var E=h.terrainOffsetProperty;if(!A.default.isConstant(E)){var P=A.default.getValueOrDefault(E,e,Cl,Ol);v.default.equals(P,p._lastOffset)||(p._lastOffset=v.default.clone(P,p._lastOffset),p.offset=he.a.toValue(P,p.offset))}}this.updateShows(n),this.waitingOnCreate=!1}else Object(s.default)(n)&&!n.ready&&(a=!1);return this.itemsToRemove.length=i,a},xl.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var n=t[i],r=this.geometry.get(n.id),o=this.attributes.get(r.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,o));var l=n.entity.isShowing;l!==(1===o.show[0])&&(o.show=me.a.toValue(l,o.show),r.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},xl.prototype.contains=function(e){return this.updaters.contains(e.id)},xl.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return E.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?E.default.FAILED:(i.boundingSphere.clone(t),E.default.DONE)},xl.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),Object(s.default)(this.removeMaterialSubscription)&&this.removeMaterialSubscription()},Tl.prototype.add=function(e,t){var a,i,n=t.createFillGeometryInstance(e);255===n.attributes.color.value[3]?(a=this._solidItems,i=!1):(a=this._translucentItems,i=!0);for(var r=a.length,o=0;o<r;o++){var s=a[o];if(s.isMaterial(t))return void s.add(t,n)}var l=new xl(this._primitives,i,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);l.add(t,n),a.push(l)},Tl.prototype.remove=function(e){El(this._solidItems,e)||El(this._translucentItems,e)},Tl.prototype.update=function(e){var t=Pl(this,this._solidItems,e,!0);t=Pl(this,this._translucentItems,e,t)&&t;var a=Al(this,this._solidItems,e),i=Al(this,this._translucentItems,e);return(a||i)&&(t=Pl(this,this._solidItems,e,t)&&t,t=Pl(this,this._translucentItems,e,t)&&t),t},Tl.prototype.getBoundingSphere=function(e,t){var a=Sl(this._solidItems,e,t);return a===E.default.FAILED?Sl(this._translucentItems,e,t):a},Tl.prototype.removeAllPrimitives=function(){Dl(this._solidItems),Dl(this._translucentItems)};var Fl=Tl,Ml=new w.a,Il=new w.a,Rl=v.default.ZERO,Nl=new v.default;function Ll(e,t,a,i,n,r,o){this.primitives=e,this.appearanceType=t,this.materialProperty=a,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=n,this.closed=r,this.shadows=o,this.updaters=new p.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(Ll.prototype.onMaterialChanged,this),this.subscriptions=new p.default,this.showsUpdated=new p.default}Ll.prototype.onMaterialChanged=function(){this.invalidated=!0},Ll.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty,i=this.depthFailMaterialProperty,n=e.depthFailMaterialProperty;if(a===t&&n===i)return!0;var r=Object(s.default)(t)&&t.equals(a);return r=(!Object(s.default)(i)&&!Object(s.default)(n)||Object(s.default)(i)&&i.equals(n))&&r},Ll.prototype.add=function(e,t){var a=t.id;if(this.updaters.set(a,t),this.geometry.set(a,t.createFillGeometryInstance(e)),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&A.default.isConstant(t.distanceDisplayConditionProperty)&&A.default.isConstant(t.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,t.entity.definitionChanged.addEventListener((function(e,a,n,r){"isShowing"===a&&i.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(a,t);this.createPrimitive=!0},Ll.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var jl=new y.default;function Vl(e,t,a,i,n){this._items=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=a,this._closed=i,this._shadows=n}Ll.prototype.update=function(e){var t,a=!0,i=this.primitive,n=this.primitives,r=this.geometry.values;if(this.createPrimitive){if(r.length>0){var o;Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?n.remove(i):this.oldPrimitive=i),this.material=ve.getValue(e,this.materialProperty,this.material),Object(s.default)(this.depthFailMaterialProperty)&&(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),o=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),i=new _e.a({show:!1,asynchronous:!0,geometryInstances:r.slice(),appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:o,shadows:this.shadows}),n.add(i),a=!1}else{Object(s.default)(i)&&(n.remove(i),i=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(n.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material,!Object(s.default)(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof pe.default||(this.depthFailMaterial=ve.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var u=this.updatersWithAttributes.values,d=u.length;for(t=0;t<d;t++){var c=u[t],f=c.entity,h=this.geometry.get(c.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),Object(s.default)(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof pe.default&&!c.depthFailMaterialProperty.isConstant){var p=c.depthFailMaterialProperty.color,_=A.default.getValueOrDefault(p,e,y.default.WHITE,jl);y.default.equals(m._lastDepthFailColor,_)||(m._lastDepthFailColor=y.default.clone(_,m._lastDepthFailColor),m.depthFailColor=oe.a.toValue(_,m.depthFailColor))}var g=f.isShowing&&(c.hasConstantFill||c.isFilled(e));g!==(1===m.show[0])&&(m.show=me.a.toValue(g,m.show));var b=c.distanceDisplayConditionProperty;if(!A.default.isConstant(b)){var C=A.default.getValueOrDefault(b,e,Il,Ml);w.a.equals(C,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(C,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(C,m.distanceDisplayCondition))}var O=c.terrainOffsetProperty;if(!A.default.isConstant(O)){var x=A.default.getValueOrDefault(O,e,Rl,Nl);v.default.equals(x,m._lastOffset)||(m._lastOffset=v.default.clone(x,m._lastOffset),m.offset=he.a.toValue(x,m.offset))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},Ll.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var n=t[i],r=n.entity,o=this.geometry.get(n.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=r.isShowing;u!==(1===l.show[0])&&(l.show=me.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},Ll.prototype.contains=function(e){return this.updaters.contains(e.id)},Ll.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return E.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?E.default.FAILED:(i.boundingSphere.clone(t),E.default.DONE)},Ll.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},Vl.prototype.add=function(e,t){for(var a=this._items,i=a.length,n=0;n<i;n++){var r=a[n];if(r.isMaterial(t))return void r.add(e,t)}var o=new Ll(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(e,t),a.push(o)},Vl.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},Vl.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var n=i.updaters.values,r=n.length,o=0;o<r;o++)this.add(e,n[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},Vl.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,n=0;n<i;n++){var r=a[n];if(r.contains(e))return r.getBoundingSphere(e,t)}return E.default.FAILED},Vl.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var Ul=Vl;function Bl(e,t,a,i,n){!function e(t,a,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,s=a-i+1,l=Math.log(o),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1),c=Math.max(i,Math.floor(a-s*u/o+d)),f=Math.min(n,Math.floor(a+(o-s)*u/o+d));e(t,a,c,f,r)}var h=t[a],m=i,p=n;for(zl(t,i,a),r(t[n],h)>0&&zl(t,i,n);m<p;){for(zl(t,m,p),m++,p--;r(t[m],h)<0;)m++;for(;r(t[p],h)>0;)p--}0===r(t[i],h)?zl(t,i,p):(p++,zl(t,p,n)),p<=a&&(i=p+1),a<=p&&(n=p-1)}}(e,t,a||0,i||e.length-1,n||Hl)}function zl(e,t,a){var i=e[t];e[t]=e[a],e[a]=i}function Hl(e,t){return e<t?-1:e>t?1:0}function kl(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}function Gl(e,t,a){if(!a)return t.indexOf(e);for(var i=0;i<t.length;i++)if(a(e,t[i]))return i;return-1}function Wl(e,t){Yl(e,0,e.children.length,t,e)}function Yl(e,t,a,i,n){n||(n=eu(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var r=t;r<a;r++){var o=e.children[r];Xl(n,e.leaf?i(o):o)}return n}function Xl(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Ql(e,t){return e.minX-t.minX}function ql(e,t){return e.minY-t.minY}function Zl(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Kl(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Jl(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function $l(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function eu(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function tu(e,t,a,i,n){for(var r=[t,a];r.length;)if(!((a=r.pop())-(t=r.pop())<=i)){var o=t+Math.ceil((a-t)/i/2)*i;Bl(e,o,t,a,n),r.push(t,o,o,a)}}kl.prototype.all=function(){return this._all(this.data,[])},kl.prototype.search=function(e){var t=this.data,a=[];if(!$l(e,t))return a;for(var i=this.toBBox,n=[];t;){for(var r=0;r<t.children.length;r++){var o=t.children[r],s=t.leaf?i(o):o;$l(e,s)&&(t.leaf?a.push(o):Jl(e,s)?this._all(o,a):n.push(o))}t=n.pop()}return a},kl.prototype.collides=function(e){var t=this.data;if(!$l(e,t))return!1;for(var a=[];t;){for(var i=0;i<t.children.length;i++){var n=t.children[i],r=t.leaf?this.toBBox(n):n;if($l(e,r)){if(t.leaf||Jl(e,r))return!0;a.push(n)}}t=a.pop()}return!1},kl.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var a=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===a.height)this._splitRoot(this.data,a);else{if(this.data.height<a.height){var i=this.data;this.data=a,a=i}this._insert(a,this.data.height-a.height-1,!0)}else this.data=a;return this},kl.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},kl.prototype.clear=function(){return this.data=eu([]),this},kl.prototype.remove=function(e,t){if(!e)return this;for(var a,i,n,r=this.data,o=this.toBBox(e),s=[],l=[];r||s.length;){if(r||(r=s.pop(),i=s[s.length-1],a=l.pop(),n=!0),r.leaf){var u=Gl(e,r.children,t);if(-1!==u)return r.children.splice(u,1),s.push(r),this._condense(s),this}n||r.leaf||!Jl(r,o)?i?(a++,r=i.children[a],n=!1):r=null:(s.push(r),l.push(a),a=0,i=r,r=r.children[0])}return this},kl.prototype.toBBox=function(e){return e},kl.prototype.compareMinX=function(e,t){return e.minX-t.minX},kl.prototype.compareMinY=function(e,t){return e.minY-t.minY},kl.prototype.toJSON=function(){return this.data},kl.prototype.fromJSON=function(e){return this.data=e,this},kl.prototype._all=function(e,t){for(var a=[];e;)e.leaf?t.push.apply(t,e.children):a.push.apply(a,e.children),e=a.pop();return t},kl.prototype._build=function(e,t,a,i){var n,r=a-t+1,o=this._maxEntries;if(r<=o)return Wl(n=eu(e.slice(t,a+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,i-1))),(n=eu([])).leaf=!1,n.height=i;var s=Math.ceil(r/o),l=s*Math.ceil(Math.sqrt(o));tu(e,t,a,l,this.compareMinX);for(var u=t;u<=a;u+=l){var d=Math.min(u+l-1,a);tu(e,u,d,s,this.compareMinY);for(var c=u;c<=d;c+=s){var f=Math.min(c+s-1,d);n.children.push(this._build(e,c,f,i-1))}}return Wl(n,this.toBBox),n},kl.prototype._chooseSubtree=function(e,t,a,i){for(;i.push(t),!t.leaf&&i.length-1!==a;){for(var n=1/0,r=1/0,o=void 0,s=0;s<t.children.length;s++){var l=t.children[s],u=Zl(l),d=(c=e,f=l,(Math.max(f.maxX,c.maxX)-Math.min(f.minX,c.minX))*(Math.max(f.maxY,c.maxY)-Math.min(f.minY,c.minY))-u);d<r?(r=d,n=u<n?u:n,o=l):d===r&&u<n&&(n=u,o=l)}t=o||t.children[0]}var c,f;return t},kl.prototype._insert=function(e,t,a){var i=a?e:this.toBBox(e),n=[],r=this._chooseSubtree(i,this.data,t,n);for(r.children.push(e),Xl(r,i);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(i,n,t)},kl.prototype._split=function(e,t){var a=e[t],i=a.children.length,n=this._minEntries;this._chooseSplitAxis(a,n,i);var r=this._chooseSplitIndex(a,n,i),o=eu(a.children.splice(r,a.children.length-r));o.height=a.height,o.leaf=a.leaf,Wl(a,this.toBBox),Wl(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(a,o)},kl.prototype._splitRoot=function(e,t){this.data=eu([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Wl(this.data,this.toBBox)},kl.prototype._chooseSplitIndex=function(e,t,a){for(var i,n,r,o,s,l,u,d=1/0,c=1/0,f=t;f<=a-t;f++){var h=Yl(e,0,f,this.toBBox),m=Yl(e,f,a,this.toBBox),p=(n=h,r=m,o=void 0,s=void 0,l=void 0,u=void 0,o=Math.max(n.minX,r.minX),s=Math.max(n.minY,r.minY),l=Math.min(n.maxX,r.maxX),u=Math.min(n.maxY,r.maxY),Math.max(0,l-o)*Math.max(0,u-s)),_=Zl(h)+Zl(m);p<d?(d=p,i=f,c=_<c?_:c):p===d&&_<c&&(c=_,i=f)}return i||a-t},kl.prototype._chooseSplitAxis=function(e,t,a){var i=e.leaf?this.compareMinX:Ql,n=e.leaf?this.compareMinY:ql;this._allDistMargin(e,t,a,i)<this._allDistMargin(e,t,a,n)&&e.children.sort(i)},kl.prototype._allDistMargin=function(e,t,a,i){e.children.sort(i);for(var n=this.toBBox,r=Yl(e,0,t,n),o=Yl(e,a-t,a,n),s=Kl(r)+Kl(o),l=t;l<a-t;l++){var u=e.children[l];Xl(r,e.leaf?n(u):u),s+=Kl(r)}for(var d=a-t-1;d>=t;d--){var c=e.children[d];Xl(o,e.leaf?n(c):c),s+=Kl(o)}return s},kl.prototype._adjustParentBBoxes=function(e,t,a){for(var i=a;i>=0;i--)Xl(t[i],e)},kl.prototype._condense=function(e){for(var t=e.length-1,a=void 0;t>=0;t--)0===e[t].children.length?t>0?(a=e[t-1].children).splice(a.indexOf(e[t]),1):this.clear():Wl(e[t],this.toBBox)};var au=kl;function iu(){this._tree=new au}function nu(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=""}function ru(e,t){return e.id===t.id}nu.fromRectangleAndId=function(e,t,a){return a.minX=t.west,a.minY=t.south,a.maxX=t.east,a.maxY=t.north,a.id=e,a},iu.prototype.insert=function(e,t){var a=nu.fromRectangleAndId(e,t,new nu);this._tree.insert(a)};var ou=new nu;iu.prototype.remove=function(e,t){var a=nu.fromRectangleAndId(e,t,ou);this._tree.remove(a,ru)};var su=new nu;iu.prototype.collides=function(e){var t=nu.fromRectangleAndId("",e,su);return this._tree.collides(t)};var lu=iu,uu=new y.default,du=new w.a,cu=new w.a;function fu(e,t,a,i){this.primitives=e,this.zIndex=i,this.classificationType=t,this.color=a,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.updaters=new p.default,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.subscriptions=new p.default,this.showsUpdated=new p.default,this.itemsToRemove=[],this.isDirty=!1,this.rectangleCollisionCheck=new lu}function hu(e,t){this._batches=[],this._primitives=e,this._classificationType=t}fu.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},fu.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),this.rectangleCollisionCheck.insert(a,t.geometry.rectangle),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&A.default.isConstant(e.distanceDisplayConditionProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,n,r){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},fu.prototype.remove=function(e){var t=e.id,a=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,a.geometry.rectangle),this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},fu.prototype.update=function(e){var t,a=!0,i=this.primitive,n=this.primitives;if(this.createPrimitive){var r=this.geometry.values;if(r.length>0)Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?n.remove(i):this.oldPrimitive=i),i=new c.a({show:!1,asynchronous:!0,geometryInstances:r.slice(),classificationType:this.classificationType}),n.add(i,this.zIndex),a=!1;else{Object(s.default)(i)&&(n.remove(i),i=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(n.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0);var l=this.updatersWithAttributes.values,u=l.length,d=this.waitingOnCreate;for(t=0;t<u;t++){var f=l[t],h=this.geometry.get(f.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),!f.fillMaterialProperty.isConstant||d){var p=f.fillMaterialProperty.color,_=A.default.getValueOrDefault(p,e,y.default.WHITE,uu);y.default.equals(m._lastColor,_)||(m._lastColor=y.default.clone(_,m._lastColor),m.color=oe.a.toValue(_,m.color))}var g=f.entity.isShowing&&(f.hasConstantFill||f.isFilled(e));g!==(1===m.show[0])&&(m.show=me.a.toValue(g,m.show));var v=f.distanceDisplayConditionProperty;if(!A.default.isConstant(v)){var b=A.default.getValueOrDefault(v,e,cu,du);w.a.equals(b,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(b,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(b,m.distanceDisplayCondition))}}this.updateShows(i),this.waitingOnCreate=!1}else Object(s.default)(i)&&!i.ready&&(a=!1);return this.itemsToRemove.length=0,a},fu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var n=t[i],r=this.geometry.get(n.id),o=this.attributes.get(r.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,o));var l=n.entity.isShowing;l!==(1===o.show[0])&&(o.show=me.a.toValue(l,o.show),r.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},fu.prototype.contains=function(e){return this.updaters.contains(e.id)},fu.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return E.default.PENDING;var i=a.getBoundingSphere(e.entity);return Object(s.default)(i)?(i.clone(t),E.default.DONE):E.default.FAILED},fu.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var a=this.oldPrimitive;Object(s.default)(a)&&(e.remove(a),this.oldPrimitive=void 0)},hu.prototype.add=function(e,t){for(var a,i=t.createFillGeometryInstance(e),n=this._batches,r=A.default.getValueOrDefault(t.zIndex,0),o=n.length,l=0;l<o;++l){var u=n[l];if(u.zIndex===r&&!u.overlapping(i.geometry.rectangle)){a=u;break}}return Object(s.default)(a)||(a=new fu(this._primitives,this._classificationType,i.attributes.color.value,r),n.push(a)),a.add(t,i),a},hu.prototype.remove=function(e){for(var t=this._batches,a=t.length,i=0;i<a;++i)if(t[i].remove(e))return},hu.prototype.update=function(e){var t,a,i=!0,n=this._batches,r=n.length;for(t=0;t<r;++t)i=n[t].update(e)&&i;for(t=0;t<r;++t)for(var o=n[t],s=o.itemsToRemove,l=s.length,u=0;u<l;u++){a=s[u],o.remove(a);var d=this.add(e,a);o.isDirty=!0,d.isDirty=!0}for(t=r-1;t>=0;--t){var c=n[t];c.isDirty&&(i=n[t].update(e)&&i,c.isDirty=!1),0===c.geometry.length&&n.splice(t,1)}return i},hu.prototype.getBoundingSphere=function(e,t){for(var a=this._batches,i=a.length,n=0;n<i;++n){var r=a[n];if(r.contains(e))return r.getBoundingSphere(e,t)}return E.default.FAILED},hu.prototype.removeAllPrimitives=function(){for(var e=this._batches,t=e.length,a=0;a<t;++a)e[a].removeAllPrimitives()};var mu=hu,pu=a(522),_u=new w.a,gu=new w.a;function vu(e,t,a,i,n,r){this.primitives=e,this.classificationType=t,this.appearanceType=a,this.materialProperty=i,this.updaters=new p.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.material=void 0,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(vu.prototype.onMaterialChanged,this),this.subscriptions=new p.default,this.showsUpdated=new p.default,this.usingSphericalTextureCoordinates=n,this.zIndex=r,this.rectangleCollisionCheck=new lu}function yu(e,t,a){this._items=[],this._primitives=e,this._classificationType=t,this._appearanceType=a}vu.prototype.onMaterialChanged=function(){this.invalidated=!0},vu.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)},vu.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty;return a===t||a instanceof pe.default&&t instanceof pe.default||Object(s.default)(t)&&t.equals(a)},vu.prototype.add=function(e,t,a){var i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,a),this.rectangleCollisionCheck.insert(i,a.geometry.rectangle),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&A.default.isConstant(t.distanceDisplayConditionProperty)){var n=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,a,i,r){"isShowing"===a&&n.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},vu.prototype.remove=function(e){var t=e.id,a=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,a.geometry.rectangle),this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);return Object(s.default)(i)&&(i(),this.subscriptions.remove(t)),!0}return!1},vu.prototype.update=function(e){var t,a=!0,i=this.primitive,n=this.primitives,r=this.geometry.values;if(this.createPrimitive){if(r.length>0)Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?n.remove(i):this.oldPrimitive=i),this.material=ve.getValue(e,this.materialProperty,this.material),i=new c.a({show:!1,asynchronous:!0,geometryInstances:r.slice(),appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),n.add(i,this.zIndex),a=!1;else{Object(s.default)(i)&&(n.remove(i),i=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(n.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material;var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var d=l[t],f=d.entity,h=this.geometry.get(d.id),m=this.attributes.get(h.id.id);Object(s.default)(m)||(m=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m));var p=f.isShowing&&(d.hasConstantFill||d.isFilled(e));p!==(1===m.show[0])&&(m.show=me.a.toValue(p,m.show));var _=d.distanceDisplayConditionProperty;if(!A.default.isConstant(_)){var g=A.default.getValueOrDefault(_,e,gu,_u);w.a.equals(g,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(g,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(g,m.distanceDisplayCondition))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},vu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var n=t[i],r=n.entity,o=this.geometry.get(n.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=r.isShowing;u!==(1===l.show[0])&&(l.show=me.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},vu.prototype.contains=function(e){return this.updaters.contains(e.id)},vu.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return E.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?E.default.FAILED:(i.boundingSphere.clone(t),E.default.DONE)},vu.prototype.destroy=function(){var e=this.primitive,t=this.primitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},yu.prototype.add=function(e,t){for(var a=this._items,i=a.length,n=t.createFillGeometryInstance(e),r=pu.a.shouldUseSphericalCoordinates(n.geometry.rectangle),o=A.default.getValueOrDefault(t.zIndex,0),s=0;s<i;++s){var l=a[s];if(l.isMaterial(t)&&l.usingSphericalTextureCoordinates===r&&l.zIndex===o&&!l.overlapping(n.geometry.rectangle))return void l.add(e,t,n)}var u=new vu(this._primitives,this._classificationType,this._appearanceType,t.fillMaterialProperty,r,o);u.add(e,t,n),a.push(u)},yu.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},yu.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var n=i.updaters.values,r=n.length,o=0;o<r;o++)this.add(e,n[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},yu.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,n=0;n<i;n++){var r=a[n];if(r.contains(e))return r.getBoundingSphere(e,t)}return E.default.FAILED},yu.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var bu=yu,wu=new y.default,Cu=new w.a,Ou=new w.a,xu=v.default.ZERO,Tu=new v.default;function Eu(e,t,a,i){this.translucent=t,this.width=a,this.shadows=i,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.updaters=new p.default,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.itemsToRemove=[],this.subscriptions=new p.default,this.showsUpdated=new p.default}function Au(e,t,a){this._primitives=e,this._scene=t,this._shadows=a,this._solidBatches=new p.default,this._translucentBatches=new p.default}Eu.prototype.add=function(e,t){var a=e.id;if(this.createPrimitive=!0,this.geometry.set(a,t),this.updaters.set(a,e),e.hasConstantOutline&&e.outlineColorProperty.isConstant&&A.default.isConstant(e.distanceDisplayConditionProperty)&&A.default.isConstant(e.terrainOffsetProperty)){var i=this;this.subscriptions.set(a,e.entity.definitionChanged.addEventListener((function(t,a,n,r){"isShowing"===a&&i.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(a,e)},Eu.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1},Eu.prototype.update=function(e){var t,a=!0,i=0,n=this.primitive,r=this.primitives;if(this.createPrimitive){var o=this.geometry.values;if(o.length>0)Object(s.default)(n)&&(Object(s.default)(this.oldPrimitive)?r.remove(n):this.oldPrimitive=n),n=new _e.a({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new ae.a({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),r.add(n),a=!1;else{Object(s.default)(n)&&(r.remove(n),n=void 0);var l=this.oldPrimitive;Object(s.default)(l)&&(r.remove(l),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Object(s.default)(n)&&n.ready){n.show=!0,Object(s.default)(this.oldPrimitive)&&(r.remove(this.oldPrimitive),this.oldPrimitive=void 0);var u=this.updatersWithAttributes.values,d=u.length,c=this.waitingOnCreate;for(t=0;t<d;t++){var f=u[t],h=this.geometry.get(f.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=n.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),!f.outlineColorProperty.isConstant||c){var p=f.outlineColorProperty,_=A.default.getValueOrDefault(p,e,y.default.WHITE,wu);y.default.equals(m._lastColor,_)||(m._lastColor=y.default.clone(_,m._lastColor),m.color=oe.a.toValue(_,m.color),(this.translucent&&255===m.color[3]||!this.translucent&&255!==m.color[3])&&(this.itemsToRemove[i++]=f))}var g=f.entity.isShowing&&(f.hasConstantOutline||f.isOutlineVisible(e));g!==(1===m.show[0])&&(m.show=me.a.toValue(g,m.show));var b=f.distanceDisplayConditionProperty;if(!A.default.isConstant(b)){var C=A.default.getValueOrDefault(b,e,Ou,Cu);w.a.equals(C,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(C,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(C,m.distanceDisplayCondition))}var O=f.terrainOffsetProperty;if(!A.default.isConstant(O)){var x=A.default.getValueOrDefault(O,e,xu,Tu);v.default.equals(x,m._lastOffset)||(m._lastOffset=v.default.clone(x,m._lastOffset),m.offset=he.a.toValue(x,m.offset))}}this.updateShows(n),this.waitingOnCreate=!1}else Object(s.default)(n)&&!n.ready&&(a=!1);return this.itemsToRemove.length=i,a},Eu.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var n=t[i],r=this.geometry.get(n.id),o=this.attributes.get(r.id.id);Object(s.default)(o)||(o=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,o));var l=n.entity.isShowing;l!==(1===o.show[0])&&(o.show=me.a.toValue(l,o.show),r.attributes.show.value[0]=o.show[0])}this.showsUpdated.removeAll()},Eu.prototype.contains=function(e){return this.updaters.contains(e.id)},Eu.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return E.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?E.default.FAILED:(i.boundingSphere.clone(t),E.default.DONE)},Eu.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;Object(s.default)(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var a=this.oldPrimitive;Object(s.default)(a)&&(e.remove(a),this.oldPrimitive=void 0)},Au.prototype.add=function(e,t){var a,i,n=t.createOutlineGeometryInstance(e),r=this._scene.clampLineWidth(t.outlineWidth);255===n.attributes.color.value[3]?(i=(a=this._solidBatches).get(r),Object(s.default)(i)||(i=new Eu(this._primitives,!1,r,this._shadows),a.set(r,i)),i.add(t,n)):(i=(a=this._translucentBatches).get(r),Object(s.default)(i)||(i=new Eu(this._primitives,!0,r,this._shadows),a.set(r,i)),i.add(t,n))},Au.prototype.remove=function(e){var t,a=this._solidBatches.values,i=a.length;for(t=0;t<i;t++)if(a[t].remove(e))return;var n=this._translucentBatches.values,r=n.length;for(t=0;t<r;t++)if(n[t].remove(e))return},Au.prototype.update=function(e){var t,a,i,n,r,o=this._solidBatches.values,s=o.length,l=this._translucentBatches.values,u=l.length,d=!0,c=!1;do{for(c=!1,a=0;a<s;a++){d=(n=o[a]).update(e);var f=(r=n.itemsToRemove).length;if(f>0)for(c=!0,t=0;t<f;t++)i=r[t],n.remove(i),this.add(e,i)}for(a=0;a<u;a++){d=(n=l[a]).update(e);var h=(r=n.itemsToRemove).length;if(h>0)for(c=!0,t=0;t<h;t++)i=r[t],n.remove(i),this.add(e,i)}}while(c);return d},Au.prototype.getBoundingSphere=function(e,t){var a,i=this._solidBatches.values,n=i.length;for(a=0;a<n;a++){var r=i[a];if(r.contains(e))return r.getBoundingSphere(e,t)}var o=this._translucentBatches.values,s=o.length;for(a=0;a<s;a++){var l=o[a];if(l.contains(e))return l.getBoundingSphere(e,t)}return E.default.FAILED},Au.prototype.removeAllPrimitives=function(){var e,t=this._solidBatches.values,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._translucentBatches.values,n=i.length;for(e=0;e<n;e++)i[e].removeAllPrimitives()};var Pu=Au,Su={};function Du(e,t){return Le.default.equalsEpsilon(e.latitude,t.latitude,Le.default.EPSILON10)&&Le.default.equalsEpsilon(e.longitude,t.longitude,Le.default.EPSILON10)}var Fu=new Ne.default,Mu=new Ne.default;var Iu=new Array(2),Ru=new Array(2),Nu={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};Su.computePositions=function(e,t,a,i,n,r){var o=function(e,t,a,i){var n=(t=Object(Je.a)(t,v.default.equalsEpsilon)).length;if(!(n<2)){var r=Object(s.default)(i),o=Object(s.default)(a),l=new Array(n),u=new Array(n),d=new Array(n),c=t[0];l[0]=c;var f=e.cartesianToCartographic(c,Fu);o&&(f.height=a[0]),u[0]=f.height,d[0]=r?i[0]:0;for(var h=u[0]===d[0],m=1,p=1;p<n;++p){var _=t[p],g=e.cartesianToCartographic(_,Mu);o&&(g.height=a[p]),h=h&&0===g.height,Du(f,g)?f.height<g.height&&(u[m-1]=g.height):(l[m]=_,u[m]=g.height,d[m]=r?i[p]:0,h=h&&u[m]===d[m],Ne.default.clone(g,f),++m)}if(!(h||m<2))return l.length=m,u.length=m,d.length=m,{positions:l,topHeights:u,bottomHeights:d}}}(e,t,a,i);if(Object(s.default)(o)){t=o.positions,a=o.topHeights,i=o.bottomHeights;var l,u,d=t.length,c=d-2,f=Le.default.chordLength(n,e.maximumRadius),h=Nu;if(h.minDistance=f,h.ellipsoid=e,r){var m,p=0;for(m=0;m<d-1;m++)p+=tt.a.numberOfPoints(t[m],t[m+1],f)+1;l=new Float64Array(3*p),u=new Float64Array(3*p);var _=Iu,g=Ru;h.positions=_,h.height=g;var y=0;for(m=0;m<d-1;m++){_[0]=t[m],_[1]=t[m+1],g[0]=a[m],g[1]=a[m+1];var b=tt.a.generateArc(h);l.set(b,y),g[0]=i[m],g[1]=i[m+1],u.set(tt.a.generateArc(h),y),y+=b.length}}else h.positions=t,h.height=a,l=new Float64Array(tt.a.generateArc(h)),h.height=i,u=new Float64Array(tt.a.generateArc(h));return{bottomPositions:u,topPositions:l,numCorners:c}}};var Lu=Su,ju=new v.default,Vu=new v.default,Uu=new v.default,Bu=new v.default,zu=new v.default,Hu=new v.default,ku=new v.default;function Gu(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.maximumHeights,i=e.minimumHeights,n=Object(o.default)(e.vertexFormat,K.default.DEFAULT),r=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),l=Object(o.default)(e.ellipsoid,ha.default.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=a,this._vertexFormat=K.default.clone(n),this._granularity=r,this._ellipsoid=ha.default.clone(l),this._workerName="createWallGeometry";var u=1+t.length*v.default.packedLength+2;Object(s.default)(i)&&(u+=i.length),Object(s.default)(a)&&(u+=a.length),this.packedLength=u+ha.default.packedLength+K.default.packedLength+1}Gu.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var n=e._positions,r=n.length;for(t[a++]=r,i=0;i<r;++i,a+=v.default.packedLength)v.default.pack(n[i],t,a);var l=e._minimumHeights;if(r=Object(s.default)(l)?l.length:0,t[a++]=r,Object(s.default)(l))for(i=0;i<r;++i)t[a++]=l[i];var u=e._maximumHeights;if(r=Object(s.default)(u)?u.length:0,t[a++]=r,Object(s.default)(u))for(i=0;i<r;++i)t[a++]=u[i];return ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,K.default.pack(e._vertexFormat,t,a),t[a+=K.default.packedLength]=e._granularity,t};var Wu=ha.default.clone(ha.default.UNIT_SPHERE),Yu=new K.default,Xu={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Wu,vertexFormat:Yu,granularity:void 0};Gu.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var n,r,l=e[t++],u=new Array(l);for(i=0;i<l;++i,t+=v.default.packedLength)u[i]=v.default.unpack(e,t);if((l=e[t++])>0)for(n=new Array(l),i=0;i<l;++i)n[i]=e[t++];if((l=e[t++])>0)for(r=new Array(l),i=0;i<l;++i)r[i]=e[t++];var d=ha.default.unpack(e,t,Wu);t+=ha.default.packedLength;var c=K.default.unpack(e,t,Yu),f=e[t+=K.default.packedLength];return Object(s.default)(a)?(a._positions=u,a._minimumHeights=n,a._maximumHeights=r,a._ellipsoid=ha.default.clone(d,a._ellipsoid),a._vertexFormat=K.default.clone(c,a._vertexFormat),a._granularity=f,a):(Xu.positions=u,Xu.minimumHeights=n,Xu.maximumHeights=r,Xu.granularity=f,new Gu(Xu))},Gu.fromConstantHeights=function(e){var t,a,i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,n=e.minimumHeight,r=e.maximumHeight,l=Object(s.default)(n),u=Object(s.default)(r);if(l||u){var d=i.length;t=l?new Array(d):void 0,a=u?new Array(d):void 0;for(var c=0;c<d;++c)l&&(t[c]=n),u&&(a[c]=r)}return new Gu({positions:i,maximumHeights:a,minimumHeights:t,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat})},Gu.createGeometry=function(e){var t=e._positions,a=e._minimumHeights,i=e._maximumHeights,r=e._vertexFormat,o=e._granularity,l=e._ellipsoid,u=Lu.computePositions(l,t,i,a,o,!0);if(Object(s.default)(u)){var d,c=u.bottomPositions,f=u.topPositions,h=u.numCorners,m=f.length,p=2*m,_=r.position?new Float64Array(p):void 0,g=r.normal?new Float32Array(p):void 0,y=r.tangent?new Float32Array(p):void 0,b=r.bitangent?new Float32Array(p):void 0,w=r.st?new Float32Array(p/3*2):void 0,C=0,O=0,x=0,T=0,E=0,A=ku,P=Hu,S=zu,D=!0,F=0,M=1/((m/=3)-h-1);for(d=0;d<m;++d){var I=3*d,R=v.default.fromArray(f,I,ju),N=v.default.fromArray(c,I,Vu);if(r.position&&(_[C++]=N.x,_[C++]=N.y,_[C++]=N.z,_[C++]=R.x,_[C++]=R.y,_[C++]=R.z),r.st&&(w[E++]=F,w[E++]=0,w[E++]=F,w[E++]=1),r.normal||r.tangent||r.bitangent){var L=v.default.clone(v.default.ZERO,Bu),j=v.default.subtract(R,l.geodeticSurfaceNormal(R,Vu),Vu);if(d+1<m&&(L=v.default.fromArray(f,I+3,Bu)),D){var V=v.default.subtract(L,R,Uu),U=v.default.subtract(j,R,ju);A=v.default.normalize(v.default.cross(U,V,A),A),D=!1}v.default.equalsEpsilon(R,L,Le.default.EPSILON10)?D=!0:(F+=M,r.tangent&&(P=v.default.normalize(v.default.subtract(L,R,P),P)),r.bitangent&&(S=v.default.normalize(v.default.cross(A,P,S),S))),r.normal&&(g[O++]=A.x,g[O++]=A.y,g[O++]=A.z,g[O++]=A.x,g[O++]=A.y,g[O++]=A.z),r.tangent&&(y[T++]=P.x,y[T++]=P.y,y[T++]=P.z,y[T++]=P.x,y[T++]=P.y,y[T++]=P.z),r.bitangent&&(b[x++]=S.x,b[x++]=S.y,b[x++]=S.z,b[x++]=S.x,b[x++]=S.y,b[x++]=S.z)}}var B=new _a.a;r.position&&(B.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:_})),r.normal&&(B.normal=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:g})),r.tangent&&(B.tangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:y})),r.bitangent&&(B.bitangent=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:3,values:b})),r.st&&(B.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:w}));var z=p/3;p-=6*(h+1);var H=ga.a.createTypedArray(z,p),k=0;for(d=0;d<z-2;d+=2){var G=d,W=d+2,Y=v.default.fromArray(_,3*G,ju),X=v.default.fromArray(_,3*W,Vu);if(!v.default.equalsEpsilon(Y,X,Le.default.EPSILON10)){var Q=d+1,q=d+3;H[k++]=Q,H[k++]=G,H[k++]=q,H[k++]=q,H[k++]=G,H[k++]=W}}return new ma.a({attributes:B,indices:H,primitiveType:ya.a.TRIANGLES,boundingSphere:new n.default.fromVertices(_)})}};var Qu=Gu,qu=new v.default,Zu=new v.default;function Ku(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.maximumHeights,i=e.minimumHeights,n=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),r=Object(o.default)(e.ellipsoid,ha.default.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=a,this._granularity=n,this._ellipsoid=ha.default.clone(r),this._workerName="createWallOutlineGeometry";var l=1+t.length*v.default.packedLength+2;Object(s.default)(i)&&(l+=i.length),Object(s.default)(a)&&(l+=a.length),this.packedLength=l+ha.default.packedLength+1}Ku.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var n=e._positions,r=n.length;for(t[a++]=r,i=0;i<r;++i,a+=v.default.packedLength)v.default.pack(n[i],t,a);var l=e._minimumHeights;if(r=Object(s.default)(l)?l.length:0,t[a++]=r,Object(s.default)(l))for(i=0;i<r;++i)t[a++]=l[i];var u=e._maximumHeights;if(r=Object(s.default)(u)?u.length:0,t[a++]=r,Object(s.default)(u))for(i=0;i<r;++i)t[a++]=u[i];return ha.default.pack(e._ellipsoid,t,a),t[a+=ha.default.packedLength]=e._granularity,t};var Ju=ha.default.clone(ha.default.UNIT_SPHERE),$u={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Ju,granularity:void 0};Ku.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var n,r,l=e[t++],u=new Array(l);for(i=0;i<l;++i,t+=v.default.packedLength)u[i]=v.default.unpack(e,t);if((l=e[t++])>0)for(n=new Array(l),i=0;i<l;++i)n[i]=e[t++];if((l=e[t++])>0)for(r=new Array(l),i=0;i<l;++i)r[i]=e[t++];var d=ha.default.unpack(e,t,Ju),c=e[t+=ha.default.packedLength];return Object(s.default)(a)?(a._positions=u,a._minimumHeights=n,a._maximumHeights=r,a._ellipsoid=ha.default.clone(d,a._ellipsoid),a._granularity=c,a):($u.positions=u,$u.minimumHeights=n,$u.maximumHeights=r,$u.granularity=c,new Ku($u))},Ku.fromConstantHeights=function(e){var t,a,i=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,n=e.minimumHeight,r=e.maximumHeight,l=Object(s.default)(n),u=Object(s.default)(r);if(l||u){var d=i.length;t=l?new Array(d):void 0,a=u?new Array(d):void 0;for(var c=0;c<d;++c)l&&(t[c]=n),u&&(a[c]=r)}return new Ku({positions:i,maximumHeights:a,minimumHeights:t,ellipsoid:e.ellipsoid})},Ku.createGeometry=function(e){var t=e._positions,a=e._minimumHeights,i=e._maximumHeights,r=e._granularity,o=e._ellipsoid,l=Lu.computePositions(o,t,i,a,r,!1);if(Object(s.default)(l)){var u,d=l.bottomPositions,c=l.topPositions,f=c.length,h=2*f,m=new Float64Array(h),p=0;for(f/=3,u=0;u<f;++u){var _=3*u,g=v.default.fromArray(c,_,qu),y=v.default.fromArray(d,_,Zu);m[p++]=y.x,m[p++]=y.y,m[p++]=y.z,m[p++]=g.x,m[p++]=g.y,m[p++]=g.z}var b=new _a.a({position:new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:m})}),w=h/3;h=2*w-4+w;var C=ga.a.createTypedArray(w,h),O=0;for(u=0;u<w-2;u+=2){var x=u,T=u+2,E=v.default.fromArray(m,3*x,qu),A=v.default.fromArray(m,3*T,Zu);if(!v.default.equalsEpsilon(E,A,Le.default.EPSILON10)){var P=u+1,S=u+3;C[O++]=P,C[O++]=x,C[O++]=P,C[O++]=S,C[O++]=x,C[O++]=T}}return C[O++]=w-2,C[O++]=w-1,new ma.a({attributes:b,indices:C,primitiveType:ya.a.LINES,boundingSphere:new n.default.fromVertices(m)})}};var ed=Ku,td=new y.default;function ad(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function id(e,t){Ie.call(this,{entity:e,scene:t,geometryOptions:new ad(e),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]}),this._onEntityPropertyChanged(e,"wall",e.wall,void 0)}function nd(e,t,a){be.call(this,e,t,a)}Object(s.default)(Object.create)&&(id.prototype=Object.create(Ie.prototype),id.prototype.constructor=id),id.prototype.createFillGeometryInstance=function(e){var t,a,i=this._entity,n=i.isAvailable(e),r=new me.a(n&&i.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),o=this._distanceDisplayConditionProperty.getValue(e),l=ue.fromDistanceDisplayCondition(o);this._materialProperty instanceof pe.default?(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(a=this._materialProperty.color.getValue(e,td)),Object(s.default)(a)||(a=y.default.WHITE),t={show:r,distanceDisplayCondition:l,color:oe.a.fromColor(a)}):t={show:r,distanceDisplayCondition:l};return new de.a({id:i,geometry:new Qu(this._options),attributes:t})},id.prototype.createOutlineGeometryInstance=function(e){var t=this._entity,a=t.isAvailable(e),i=A.default.getValueOrDefault(this._outlineColorProperty,e,y.default.BLACK,td),n=this._distanceDisplayConditionProperty.getValue(e);return new de.a({id:t,geometry:new ed(this._options),attributes:{show:new me.a(a&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:oe.a.fromColor(i),distanceDisplayCondition:ue.fromDistanceDisplayCondition(n)}})},id.prototype._isHidden=function(e,t){return!Object(s.default)(t.positions)||Ie.prototype._isHidden.call(this,e,t)},id.prototype._getIsClosed=function(e){return!1},id.prototype._isDynamic=function(e,t){return!(t.positions.isConstant&&A.default.isConstant(t.minimumHeights)&&A.default.isConstant(t.maximumHeights)&&A.default.isConstant(t.outlineWidth)&&A.default.isConstant(t.granularity))},id.prototype._setStaticOptions=function(e,t){var a=t.minimumHeights,i=t.maximumHeights,n=t.granularity,r=this._materialProperty instanceof pe.default,o=this._options;o.vertexFormat=r?ae.a.VERTEX_FORMAT:te.MaterialSupport.TEXTURED.vertexFormat,o.positions=t.positions.getValue(fe.default.MINIMUM_VALUE,o.positions),o.minimumHeights=Object(s.default)(a)?a.getValue(fe.default.MINIMUM_VALUE,o.minimumHeights):void 0,o.maximumHeights=Object(s.default)(i)?i.getValue(fe.default.MINIMUM_VALUE,o.maximumHeights):void 0,o.granularity=Object(s.default)(n)?n.getValue(fe.default.MINIMUM_VALUE):void 0},id.DynamicGeometryUpdater=nd,Object(s.default)(Object.create)&&(nd.prototype=Object.create(be.prototype),nd.prototype.constructor=nd),nd.prototype._isHidden=function(e,t,a){return!Object(s.default)(this._options.positions)||be.prototype._isHidden.call(this,e,t,a)},nd.prototype._setOptions=function(e,t,a){var i=this._options;i.positions=A.default.getValueOrUndefined(t.positions,a,i.positions),i.minimumHeights=A.default.getValueOrUndefined(t.minimumHeights,a,i.minimumHeights),i.maximumHeights=A.default.getValueOrUndefined(t.maximumHeights,a,i.maximumHeights),i.granularity=A.default.getValueOrUndefined(t.granularity,a)};var rd=[],od=[Ze,Li,fi,Yn,rr,Sr,cs,As,vl,id];function sd(e,t){this.entity=e,this.scene=t;var a=new Array(od.length),i=new q.default;function n(e){i.raiseEvent(e)}for(var r=new u.default,o=0;o<a.length;o++){var s=new od[o](e,t);r.add(s.geometryChanged,n),a[o]=s}this.updaters=a,this.geometryChanged=i,this.eventHelper=r,this._removeEntitySubscription=e.definitionChanged.addEventListener(sd.prototype._onEntityPropertyChanged,this)}function ld(e,t,a,i){a=Object(o.default)(a,e.primitives),i=Object(o.default)(i,e.groundPrimitives),this._scene=e,this._primitives=a,this._groundPrimitives=i,this._entityCollection=void 0,this._addedObjects=new p.default,this._removedObjects=new p.default,this._changedObjects=new p.default;var n=ie.default.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(2*n),this._closedColorBatches=new Array(2*n),this._closedMaterialBatches=new Array(2*n),this._openColorBatches=new Array(2*n),this._openMaterialBatches=new Array(2*n);var r,s=Oe.default.supportsMaterialsforEntitiesOnTerrain(e);for(this._supportsMaterialsforEntitiesOnTerrain=s,r=0;r<n;++r)this._outlineBatches[r]=new Pu(a,e,r,!1),this._outlineBatches[n+r]=new Pu(a,e,r,!0),this._closedColorBatches[r]=new Fl(a,ae.a,void 0,!0,r,!0),this._closedColorBatches[n+r]=new Fl(a,ae.a,void 0,!0,r,!1),this._closedMaterialBatches[r]=new Ul(a,te,void 0,!0,r,!0),this._closedMaterialBatches[n+r]=new Ul(a,te,void 0,!0,r,!1),this._openColorBatches[r]=new Fl(a,ae.a,void 0,!1,r,!0),this._openColorBatches[n+r]=new Fl(a,ae.a,void 0,!1,r,!1),this._openMaterialBatches[r]=new Ul(a,te,void 0,!1,r,!0),this._openMaterialBatches[n+r]=new Ul(a,te,void 0,!1,r,!1);var l=Z.a.NUMBER_OF_CLASSIFICATION_TYPES,u=new Array(l),d=[];if(s)for(r=0;r<l;++r)d.push(new bu(i,r,te)),u[r]=new mu(i,r);else for(r=0;r<l;++r)u[r]=new mu(i,r);this._groundColorBatches=u,this._groundMaterialBatches=d,this._dynamicBatch=new Vi(a,i),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new p.default,this._updaterSets=new p.default,this._entityCollection=t,t.collectionChanged.addEventListener(ld.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,rd)}sd.prototype._onEntityPropertyChanged=function(e,t,a,i){for(var n=this.updaters,r=0;r<n.length;r++)n[r]._onEntityPropertyChanged(e,t,a,i)},sd.prototype.forEach=function(e){for(var t=this.updaters,a=0;a<t.length;a++)e(t[a])},sd.prototype.destroy=function(){this.eventHelper.removeAll();for(var e=this.updaters,t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),Object(l.default)(this)},ld.prototype.update=function(e){var t,a,i,n,r=this._addedObjects,o=r.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values,c=this;for(t=d.length-1;t>-1;t--)i=(a=d[t]).id,(n=this._updaterSets.get(i)).entity===a?n.forEach((function(t){c._removeUpdater(t),c._insertUpdaterIntoBatch(e,t)})):(l.push(a),o.push(a));for(t=l.length-1;t>-1;t--)i=(a=l[t]).id,(n=this._updaterSets.get(i)).forEach(this._removeUpdater.bind(this)),n.destroy(),this._updaterSets.remove(i),this._subscriptions.get(i)(),this._subscriptions.remove(i);for(t=o.length-1;t>-1;t--)i=(a=o[t]).id,n=new sd(a,this._scene),this._updaterSets.set(i,n),n.forEach((function(t){c._insertUpdaterIntoBatch(e,t)})),this._subscriptions.set(i,n.geometryChanged.addEventListener(ld._onGeometryChanged,this));r.removeAll(),s.removeAll(),u.removeAll();var f=!0,h=this._batches,m=h.length;for(t=0;t<m;t++)f=h[t].update(e)&&f;return f};var ud=[],dd=new n.default;ld.prototype.getBoundingSphere=function(e,t){for(var a=ud,i=dd,r=0,o=E.default.DONE,s=this._batches,l=s.length,u=e.id,d=this._updaterSets.get(u).updaters,c=0;c<d.length;c++)for(var f=d[c],h=0;h<l;h++){if((o=s[h].getBoundingSphere(f,i))===E.default.PENDING)return E.default.PENDING;o===E.default.DONE&&(a[r]=n.default.clone(i,a[r]),r++)}return 0===r?E.default.FAILED:(a.length=r,n.default.fromBoundingSpheres(a,t),E.default.DONE)},ld.prototype.isDestroyed=function(){return!1},ld.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(ld.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._subscriptions.values;for(a=i.length,e=0;e<a;e++)i[e]();this._subscriptions.removeAll();var n=this._updaterSets.values;for(a=n.length,e=0;e<a;e++)n[e].destroy();return this._updaterSets.removeAll(),Object(l.default)(this)},ld.prototype._removeUpdater=function(e){for(var t=this._batches,a=t.length,i=0;i<a;i++)t[i].remove(e)},ld.prototype._insertUpdaterIntoBatch=function(e,t){if(t.isDynamic)this._dynamicBatch.add(e,t);else{var a;(t.outlineEnabled||t.fillEnabled)&&(a=t.shadowsProperty.getValue(e));var i=ie.default.NUMBER_OF_SHADOW_MODES;if(t.outlineEnabled&&(Object(s.default)(t.terrainOffsetProperty)?this._outlineBatches[i+a].add(e,t):this._outlineBatches[a].add(e,t)),t.fillEnabled)if(t.onTerrain){var n=t.classificationTypeProperty.getValue(e);t.fillMaterialProperty instanceof pe.default?this._groundColorBatches[n].add(e,t):this._groundMaterialBatches[n].add(e,t)}else t.isClosed?t.fillMaterialProperty instanceof pe.default?Object(s.default)(t.terrainOffsetProperty)?this._closedColorBatches[i+a].add(e,t):this._closedColorBatches[a].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._closedMaterialBatches[i+a].add(e,t):this._closedMaterialBatches[a].add(e,t):t.fillMaterialProperty instanceof pe.default?Object(s.default)(t.terrainOffsetProperty)?this._openColorBatches[i+a].add(e,t):this._openColorBatches[a].add(e,t):Object(s.default)(t.terrainOffsetProperty)?this._openMaterialBatches[i+a].add(e,t):this._openMaterialBatches[a].add(e,t)}},ld._onGeometryChanged=function(e){var t=this._removedObjects,a=this._changedObjects,i=e.entity,n=i.id;Object(s.default)(t.get(n))||Object(s.default)(a.get(n))||a.set(n,i)},ld.prototype._onCollectionChanged=function(e,t,a){var i,n,r,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(i=a.length-1;i>-1;i--)n=(r=a[i]).id,o.remove(n)||(s.set(n,r),l.remove(n));for(i=t.length-1;i>-1;i--)n=(r=t[i]).id,s.remove(n)?l.set(n,r):o.set(n,r)};var cd=ld,fd=a(232),hd=fd.a.FILL,md=y.default.WHITE,pd=y.default.BLACK,_d=new y.default(.165,.165,.165,.8),gd=new g.default(7,5),vd=g.default.ZERO,yd=v.default.ZERO,bd=O.default.NONE,wd=x.default.CENTER,Cd=T.default.CENTER,Od=new v.default,xd=new y.default,Td=new y.default,Ed=new y.default,Ad=new g.default,Pd=new v.default,Sd=new g.default,Dd=new C.a,Fd=new C.a,Md=new C.a,Id=new w.a;function Rd(e){this.entity=e,this.label=void 0,this.index=void 0}function Nd(e,t){t.collectionChanged.addEventListener(Nd.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new p.default,this._onCollectionChanged(t,t.values,[],[])}function Ld(e,t,a){Object(s.default)(e)&&(e.label=void 0,a.removeLabel(t))}Nd.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,n=t.length;i<n;i++){var r,o,l=t[i],u=l.entity,d=u._label,c=l.label,f=u.isShowing&&u.isAvailable(e)&&A.default.getValueOrDefault(d._show,e,!0);if(f&&(o=A.default.getValueOrUndefined(u._position,e,Od),r=A.default.getValueOrUndefined(d._text,e),f=Object(s.default)(o)&&Object(s.default)(r)),f){A.default.isConstant(u._position)||(a._clusterDirty=!0);var h=!1,m=A.default.getValueOrDefault(d._heightReference,e,bd);Object(s.default)(c)||((c=a.getLabel(u)).id=u,l.label=c,h=v.default.equals(c.position,o)&&c.heightReference===m),c.show=!0,c.position=o,c.text=r,c.scale=A.default.getValueOrDefault(d._scale,e,1),c.font=A.default.getValueOrDefault(d._font,e,"30px sans-serif"),c.style=A.default.getValueOrDefault(d._style,e,hd),c.fillColor=A.default.getValueOrDefault(d._fillColor,e,md,xd),c.outlineColor=A.default.getValueOrDefault(d._outlineColor,e,pd,Td),c.outlineWidth=A.default.getValueOrDefault(d._outlineWidth,e,1),c.showBackground=A.default.getValueOrDefault(d._showBackground,e,!1),c.backgroundColor=A.default.getValueOrDefault(d._backgroundColor,e,_d,Ed),c.backgroundPadding=A.default.getValueOrDefault(d._backgroundPadding,e,gd,Ad),c.pixelOffset=A.default.getValueOrDefault(d._pixelOffset,e,vd,Sd),c.eyeOffset=A.default.getValueOrDefault(d._eyeOffset,e,yd,Pd),c.heightReference=m,c.horizontalOrigin=A.default.getValueOrDefault(d._horizontalOrigin,e,wd),c.verticalOrigin=A.default.getValueOrDefault(d._verticalOrigin,e,Cd),c.translucencyByDistance=A.default.getValueOrUndefined(d._translucencyByDistance,e,Dd),c.pixelOffsetScaleByDistance=A.default.getValueOrUndefined(d._pixelOffsetScaleByDistance,e,Fd),c.scaleByDistance=A.default.getValueOrUndefined(d._scaleByDistance,e,Md),c.distanceDisplayCondition=A.default.getValueOrUndefined(d._distanceDisplayCondition,e,Id),c.disableDepthTestDistance=A.default.getValueOrUndefined(d._disableDepthTestDistance,e),h&&c._updateClamping()}else Ld(l,u,a)}return!0},Nd.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.label))return E.default.FAILED;var i=a.label;return t.center=v.default.clone(Object(o.default)(i._clampedPosition,i.position),t.center),t.radius=0,E.default.DONE},Nd.prototype.isDestroyed=function(){return!1},Nd.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Nd.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return Object(l.default)(this)},Nd.prototype._onCollectionChanged=function(e,t,a,i){var n,r,o=this._items,l=this._cluster;for(n=t.length-1;n>-1;n--)r=t[n],Object(s.default)(r._label)&&Object(s.default)(r._position)&&o.set(r.id,new Rd(r));for(n=i.length-1;n>-1;n--)r=i[n],Object(s.default)(r._label)&&Object(s.default)(r._position)?o.contains(r.id)||o.set(r.id,new Rd(r)):(Ld(o.get(r.id),r,l),o.remove(r.id));for(n=a.length-1;n>-1;n--)r=a[n],Ld(o.get(r.id),r,l),o.remove(r.id)};var jd=Nd,Vd=a(170),Ud=a(38),Bd=a(446),zd=a(288),Hd=a(271),kd=ie.default.ENABLED,Gd=O.default.NONE,Wd=y.default.RED,Yd=y.default.WHITE,Xd=Bd.a.HIGHLIGHT,Qd=new g.default(1,1),qd=Vd.default.Y,Zd=new nt.default,Kd=new nt.default;function Jd(e,t){t.collectionChanged.addEventListener(Jd.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._modelHash={},this._entitiesToVisualize=new p.default,this._onCollectionChanged(t,t.values,[],[])}function $d(e,t,a,i){var n=a[t.id];Object(s.default)(n)&&(i.removeAndDestroy(n.modelPrimitive),delete a[t.id])}function ec(e,t){var a=t[e.id];Object(s.default)(a)&&(a.nodeTransformationsScratch={},a.articulationsScratch={})}function tc(e,t,a){e.readyPromise.otherwise((function(e){console.error(e),a[t.id].loadFail=!0}))}Jd.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,a=this._modelHash,i=this._primitives,n=0,r=t.length;n<r;n++){var o,l,u=t[n],d=u._model,c=a[u.id],f=u.isShowing&&u.isAvailable(e)&&A.default.getValueOrDefault(d._show,e,!0);if(f&&(l=u.computeModelMatrix(e,Zd),o=Ud.default.createIfNeeded(A.default.getValueOrUndefined(d._uri,e)),f=Object(s.default)(l)&&Object(s.default)(o)),f){var h=Object(s.default)(c)?c.modelPrimitive:void 0;if(Object(s.default)(h)&&o.url===c.url||(Object(s.default)(h)&&(i.removeAndDestroy(h),delete a[u.id]),(h=zd.default.fromGltf({url:o,incrementallyLoadTextures:A.default.getValueOrDefault(d._incrementallyLoadTextures,e,!0),scene:this._scene})).id=u,i.add(h),c={modelPrimitive:h,url:o.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFail:!1},a[u.id]=c,tc(h,u,a)),h.show=!0,h.scale=A.default.getValueOrDefault(d._scale,e,1),h.minimumPixelSize=A.default.getValueOrDefault(d._minimumPixelSize,e,0),h.maximumScale=A.default.getValueOrUndefined(d._maximumScale,e),h.modelMatrix=nt.default.clone(l,h.modelMatrix),h.shadows=A.default.getValueOrDefault(d._shadows,e,kd),h.heightReference=A.default.getValueOrDefault(d._heightReference,e,Gd),h.distanceDisplayCondition=A.default.getValueOrUndefined(d._distanceDisplayCondition,e),h.silhouetteColor=A.default.getValueOrDefault(d._silhouetteColor,e,Wd,h._silhouetteColor),h.silhouetteSize=A.default.getValueOrDefault(d._silhouetteSize,e,0),h.color=A.default.getValueOrDefault(d._color,e,Yd,h._color),h.colorBlendMode=A.default.getValueOrDefault(d._colorBlendMode,e,Xd),h.colorBlendAmount=A.default.getValueOrDefault(d._colorBlendAmount,e,.5),h.clippingPlanes=A.default.getValueOrUndefined(d._clippingPlanes,e),h.clampAnimations=A.default.getValueOrDefault(d._clampAnimations,e,!0),h.imageBasedLightingFactor=A.default.getValueOrDefault(d._imageBasedLightingFactor,e,Qd),h.lightColor=A.default.getValueOrUndefined(d._lightColor,e),h._upAxis=A.default.getValueOrDefault(d._upAxis,e,qd),h._forwardAxis=A.default.getValueOrUndefined(d._forwardAxis,e),h.ready){var m=A.default.getValueOrDefault(d._runAnimations,e,!0);c.animationsRunning!==m&&(m?h.activeAnimations.addAll({loop:Hd.a.REPEAT}):h.activeAnimations.removeAll(),c.animationsRunning=m);var p=A.default.getValueOrUndefined(d._nodeTransformations,e,c.nodeTransformationsScratch);if(Object(s.default)(p))for(var _=Object.keys(p),g=0,v=_.length;g<v;++g){var y=_[g],b=p[y];if(Object(s.default)(b)){var w=h.getNode(y);if(Object(s.default)(w)){var C=nt.default.fromTranslationRotationScale(b,Kd);w.matrix=nt.default.multiply(w.originalMatrix,C,C)}}}var O=!1,x=A.default.getValueOrUndefined(d._articulations,e,c.articulationsScratch);if(Object(s.default)(x))for(var T=Object.keys(x),E=0,P=T.length;E<P;++E){var S=T[E],D=x[S];Object(s.default)(D)&&(O=!0,h.setArticulationStage(S,D))}O&&h.applyArticulations()}}else Object(s.default)(c)&&(c.modelPrimitive.show=!1)}return!0},Jd.prototype.isDestroyed=function(){return!1},Jd.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Jd.prototype._onCollectionChanged,this);for(var e=this._entitiesToVisualize.values,t=this._modelHash,a=this._primitives,i=e.length-1;i>-1;i--)$d(this,e[i],t,a);return Object(l.default)(this)},Jd.prototype.getBoundingSphere=function(e,t){var a=this._modelHash[e.id];if(!Object(s.default)(a)||a.loadFail)return E.default.FAILED;var i=a.modelPrimitive;if(!Object(s.default)(i)||!i.show)return E.default.FAILED;if(!i.ready)return E.default.PENDING;if(i.heightReference===O.default.NONE)n.default.transform(i.boundingSphere,i.modelMatrix,t);else{if(!Object(s.default)(i._clampedModelMatrix)||i._heightChanged)return E.default.PENDING;n.default.transform(i.boundingSphere,i._clampedModelMatrix,t)}return E.default.DONE},Jd.prototype._onCollectionChanged=function(e,t,a,i){var n,r,o=this._entitiesToVisualize,l=this._modelHash,u=this._primitives;for(n=t.length-1;n>-1;n--)r=t[n],Object(s.default)(r._model)&&Object(s.default)(r._position)&&o.set(r.id,r);for(n=i.length-1;n>-1;n--)r=i[n],Object(s.default)(r._model)&&Object(s.default)(r._position)?(ec(r,l),o.set(r.id,r)):($d(this,r,l,u),o.remove(r.id));for(n=a.length-1;n>-1;n--)$d(this,r=a[n],l,u),o.remove(r.id)};var ac=Jd,ic=a(766),nc=new nt.default;function rc(e,t){t.collectionChanged.addEventListener(rc.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._tilesetHash={},this._entitiesToVisualize=new p.default,this._onCollectionChanged(t,t.values,[],[])}function oc(e,t,a,i){var n=a[t.id];Object(s.default)(n)&&(i.removeAndDestroy(n.tilesetPrimitive),delete a[t.id])}function sc(e,t,a){e.readyPromise.otherwise((function(e){console.error(e),a[t.id].loadFail=!0}))}rc.prototype.update=function(e){for(var t=this._entitiesToVisualize.values,a=this._tilesetHash,i=this._primitives,n=0,r=t.length;n<r;n++){var o,l,u=t[n],d=u._tileset,c=a[u.id],f=u.isShowing&&u.isAvailable(e)&&A.default.getValueOrDefault(d._show,e,!0);if(f&&(l=u.computeModelMatrix(e,nc),o=Ud.default.createIfNeeded(A.default.getValueOrUndefined(d._uri,e))),f){var h=Object(s.default)(c)?c.tilesetPrimitive:void 0;Object(s.default)(h)&&o.url===c.url||(Object(s.default)(h)&&(i.removeAndDestroy(h),delete a[u.id]),(h=new ic.default({url:o})).id=u,i.add(h),c={tilesetPrimitive:h,url:o.url,loadFail:!1},a[u.id]=c,sc(h,u,a)),h.show=!0,Object(s.default)(l)&&(h.modelMatrix=l),h.maximumScreenSpaceError=A.default.getValueOrDefault(d.maximumScreenSpaceError,e,h.maximumScreenSpaceError)}else Object(s.default)(c)&&(c.tilesetPrimitive.show=!1)}return!0},rc.prototype.isDestroyed=function(){return!1},rc.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(rc.prototype._onCollectionChanged,this);for(var e=this._entitiesToVisualize.values,t=this._tilesetHash,a=this._primitives,i=e.length-1;i>-1;i--)oc(this,e[i],t,a);return Object(l.default)(this)},rc.prototype.getBoundingSphere=function(e,t){var a=this._tilesetHash[e.id];if(!Object(s.default)(a)||a.loadFail)return E.default.FAILED;var i=a.tilesetPrimitive;return Object(s.default)(i)&&i.show?i.ready?(n.default.clone(i.boundingSphere,t),E.default.DONE):E.default.PENDING:E.default.FAILED},rc.prototype._onCollectionChanged=function(e,t,a,i){var n,r,o=this._entitiesToVisualize,l=this._tilesetHash,u=this._primitives;for(n=t.length-1;n>-1;n--)r=t[n],Object(s.default)(r._tileset)&&o.set(r.id,r);for(n=i.length-1;n>-1;n--)r=i[n],Object(s.default)(r._tileset)?o.set(r.id,r):(oc(this,r,l,u),o.remove(r.id));for(n=a.length-1;n>-1;n--)oc(this,r=a[n],l,u),o.remove(r.id)};var lc=rc,uc=a(42),dc=a(140),cc=a(104),fc=a(521),hc=a(366),mc=a(328),pc=a(367),_c=a(335),gc=a(511),vc=a(435),yc=new cc.default,bc=new cc.default,wc=new cc.default;function Cc(e){this.entity=e,this.polyline=void 0,this.index=void 0,this.updater=void 0}function Oc(e,t,a,i,n,r,o,l){for(;e instanceof pc.a;)e=e.resolvedProperty;e instanceof _c.default?o=function(e,t,a,i,n,r,o,l,u){var d,c=l;d=e.getValueInReferenceFrame(t,r,u[c]),Object(s.default)(d)&&(u[c++]=d);for(var f,h,m,p=!Object(s.default)(n)||uc.default.lessThanOrEquals(n,t)||uc.default.greaterThanOrEquals(n,a),_=0,g=i.length,v=i[_],y=a,b=!1;_<g;){if(!p&&uc.default.greaterThanOrEquals(v,n)&&(d=e.getValueInReferenceFrame(n,r,u[c]),Object(s.default)(d)&&(u[c++]=d),p=!0),uc.default.greaterThan(v,t)&&uc.default.lessThan(v,y)&&!v.equals(n)&&(d=e.getValueInReferenceFrame(v,r,u[c]),Object(s.default)(d)&&(u[c++]=d)),_<g-1){if(o>0&&!b){var w=i[_+1],C=uc.default.secondsDifference(w,v);(b=C>o)&&(f=Math.ceil(C/o),h=0,m=C/Math.max(f,2),f=Math.max(f-1,1))}if(b&&h<f){v=uc.default.addSeconds(v,m,new uc.default),h++;continue}}b=!1,v=i[++_]}return d=e.getValueInReferenceFrame(a,r,u[c]),Object(s.default)(d)&&(u[c++]=d),c}(e,t,a,e._property._times,i,n,r,o,l):o=e instanceof hc.a?function(e,t,a,i,n,r,o,s){bc.start=t,bc.stop=a;for(var l=o,u=e.intervals,d=0;d<u.length;d++){var c=u.get(d);if(!cc.default.intersect(c,bc,yc).isEmpty){var f=c.start,h=c.stop,m=t;uc.default.greaterThan(f,m)&&(m=f);var p=a;uc.default.lessThan(h,p)&&(p=h),l=Oc(c.data,m,p,i,n,r,l,s)}}return l}(e,t,a,i,n,r,o,l):e instanceof vc.default?function(e,t,a,i,n,r,o,l){wc.start=t,wc.stop=a;for(var u=o,d=e.intervals,c=0;c<d.length;c++){var f=d.get(c);if(!cc.default.intersect(f,wc,yc).isEmpty){var h=f.start;f.isStartIncluded||(h=f.isStopIncluded?f.stop:uc.default.addSeconds(f.start,uc.default.secondsDifference(f.stop,f.start)/2,new uc.default));var m=e.getValueInReferenceFrame(h,n,l[u]);Object(s.default)(m)&&(l[u]=m,u++)}}return u}(e,t,a,0,n,0,o,l):e instanceof mc.a||e instanceof gc.a&&A.default.isConstant(e)?function(e,t,a,i,n,r,o,l){var u=e.getValueInReferenceFrame(t,n,l[o]);return Object(s.default)(u)&&(l[o++]=u),o}(e,t,0,0,n,0,o,l):function(e,t,a,i,n,r,o,l){for(var u,d=0,c=o,f=t,h=Math.max(r,60),m=!Object(s.default)(i)||uc.default.lessThanOrEquals(i,t)||uc.default.greaterThanOrEquals(i,a);uc.default.lessThan(f,a);)!m&&uc.default.greaterThanOrEquals(f,i)&&(m=!0,u=e.getValueInReferenceFrame(i,n,l[c]),Object(s.default)(u)&&(l[c]=u,c++)),u=e.getValueInReferenceFrame(f,n,l[c]),Object(s.default)(u)&&(l[c]=u,c++),d++,f=uc.default.addSeconds(t,h*d,new uc.default);return u=e.getValueInReferenceFrame(a,n,l[c]),Object(s.default)(u)&&(l[c]=u,c++),c}(e,t,a,i,n,r,o,l);return o}function xc(e,t,a,i,n,r,o){Object(s.default)(o)||(o=[]);var l=Oc(e,t,a,i,n,r,0,o);return o.length=l,o}var Tc=new et.default;function Ec(e,t){this._unusedIndexes=[],this._polylineCollection=new fc.a,this._scene=e,this._referenceFrame=t,e.primitives.add(this._polylineCollection)}function Ac(e,t){t.collectionChanged.addEventListener(Ac.prototype._onCollectionChanged,this),this._scene=e,this._updaters={},this._entityCollection=t,this._items=new p.default,this._onCollectionChanged(t,t.values,[],[])}Ec.prototype.update=function(e){if(this._referenceFrame===dc.a.INERTIAL){var t=ot.default.computeIcrfToFixedMatrix(e,Tc);Object(s.default)(t)||(t=ot.default.computeTemeToPseudoFixedMatrix(e,Tc)),nt.default.fromRotationTranslation(t,v.default.ZERO,this._polylineCollection.modelMatrix)}},Ec.prototype.updateObject=function(e,t){var a,i,n=t.entity,r=n._path,o=n._position,l=r._show,u=t.polyline,d=n.isShowing&&(!Object(s.default)(l)||l.getValue(e));if(d){var c=A.default.getValueOrUndefined(r._leadTime,e),f=A.default.getValueOrUndefined(r._trailTime,e),h=n._availability,m=Object(s.default)(h),p=Object(s.default)(c),_=Object(s.default)(f);if(d=m||p&&_){if(_&&(a=uc.default.addSeconds(e,-f,new uc.default)),p&&(i=uc.default.addSeconds(e,c,new uc.default)),m){var g=h.start,v=h.stop;_&&!uc.default.greaterThan(g,a)||(a=g),p&&!uc.default.lessThan(v,i)||(i=v)}d=uc.default.lessThan(a,i)}}if(d){if(!Object(s.default)(u)){var y=this._unusedIndexes;if(y.length>0){var b=y.pop();u=this._polylineCollection.get(b),t.index=b}else t.index=this._polylineCollection.length,u=this._polylineCollection.add();u.id=n,t.polyline=u}var w=A.default.getValueOrDefault(r._resolution,e,60);u.show=!0,u.positions=xc(o,a,i,e,this._referenceFrame,w,u.positions.slice()),u.material=ve.getValue(e,r._material,u.material),u.width=A.default.getValueOrDefault(r._width,e,1),u.distanceDisplayCondition=A.default.getValueOrUndefined(r._distanceDisplayCondition,e,u.distanceDisplayCondition)}else Object(s.default)(u)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,u.show=!1,t.index=void 0)},Ec.prototype.removeObject=function(e){var t=e.polyline;Object(s.default)(t)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,t.show=!1,t.id=void 0,e.index=void 0)},Ec.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),Object(l.default)(this)},Ac.prototype.update=function(e){var t=this._updaters;for(var a in t)t.hasOwnProperty(a)&&t[a].update(e);var i=this._items.values;if(0===i.length&&Object(s.default)(this._updaters)&&Object.keys(this._updaters).length>0){for(var n in t)t.hasOwnProperty(n)&&t[n].destroy();this._updaters={}}for(var r=0,o=i.length;r<o;r++){var l=i[r],u=l.entity._position,d=l.updater,c=dc.a.FIXED;this._scene.mode===je.a.SCENE3D&&(c=u.referenceFrame);var f=this._updaters[c];d===f&&Object(s.default)(f)?f.updateObject(e,l):(Object(s.default)(d)&&d.removeObject(l),Object(s.default)(f)||((f=new Ec(this._scene,c)).update(e),this._updaters[c]=f),l.updater=f,Object(s.default)(f)&&f.updateObject(e,l))}return!0},Ac.prototype.isDestroyed=function(){return!1},Ac.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Ac.prototype._onCollectionChanged,this);var e=this._updaters;for(var t in e)e.hasOwnProperty(t)&&e[t].destroy();return Object(l.default)(this)},Ac.prototype._onCollectionChanged=function(e,t,a,i){var n,r,o,l=this._items;for(n=t.length-1;n>-1;n--)r=t[n],Object(s.default)(r._path)&&Object(s.default)(r._position)&&l.set(r.id,new Cc(r));for(n=i.length-1;n>-1;n--)r=i[n],Object(s.default)(r._path)&&Object(s.default)(r._position)?l.contains(r.id)||l.set(r.id,new Cc(r)):(o=l.get(r.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(r.id)));for(n=a.length-1;n>-1;n--)r=a[n],o=l.get(r.id),Object(s.default)(o)&&(Object(s.default)(o.updater)&&o.updater.removeObject(o),l.remove(r.id))},Ac._subSample=xc;var Pc=Ac,Sc=a(654),Dc=y.default.WHITE,Fc=y.default.BLACK,Mc=new y.default,Ic=new v.default,Rc=new y.default,Nc=new C.a,Lc=new C.a,jc=new w.a;function Vc(e){this.entity=e,this.pointPrimitive=void 0,this.billboard=void 0,this.color=void 0,this.outlineColor=void 0,this.pixelSize=void 0,this.outlineWidth=void 0}function Uc(e,t){t.collectionChanged.addEventListener(Uc.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new p.default,this._onCollectionChanged(t,t.values,[],[])}function Bc(e,t,a){if(Object(s.default)(e)){var i=e.pointPrimitive;if(Object(s.default)(i))return e.pointPrimitive=void 0,void a.removePoint(t);var n=e.billboard;Object(s.default)(n)&&(e.billboard=void 0,a.removeBillboard(t))}}Uc.prototype.update=function(e){for(var t=this._items.values,a=this._cluster,i=0,n=t.length;i<n;i++){var r,o=t[i],l=o.entity,u=l._point,d=o.pointPrimitive,c=o.billboard,f=A.default.getValueOrDefault(u._heightReference,e,O.default.NONE),h=l.isShowing&&l.isAvailable(e)&&A.default.getValueOrDefault(u._show,e,!0);if(h&&(r=A.default.getValueOrUndefined(l._position,e,Ic),h=Object(s.default)(r)),h){A.default.isConstant(l._position)||(a._clusterDirty=!0);var m=!1,p=!1;if(f===O.default.NONE||Object(s.default)(c)?f!==O.default.NONE||Object(s.default)(d)||(Object(s.default)(c)&&(Bc(o,l,a),c=void 0),(d=a.getPoint(l)).id=l,o.pointPrimitive=d):(Object(s.default)(d)&&(Bc(o,l,a),d=void 0),(c=a.getBillboard(l)).id=l,c.image=void 0,o.billboard=c,m=!0,p=v.default.equals(c.position,r)&&c.heightReference===f),Object(s.default)(d))d.show=!0,d.position=r,d.scaleByDistance=A.default.getValueOrUndefined(u._scaleByDistance,e,Nc),d.translucencyByDistance=A.default.getValueOrUndefined(u._translucencyByDistance,e,Lc),d.color=A.default.getValueOrDefault(u._color,e,Dc,Mc),d.outlineColor=A.default.getValueOrDefault(u._outlineColor,e,Fc,Rc),d.outlineWidth=A.default.getValueOrDefault(u._outlineWidth,e,0),d.pixelSize=A.default.getValueOrDefault(u._pixelSize,e,1),d.distanceDisplayCondition=A.default.getValueOrUndefined(u._distanceDisplayCondition,e,jc),d.disableDepthTestDistance=A.default.getValueOrDefault(u._disableDepthTestDistance,e,0);else if(Object(s.default)(c)){c.show=!0,c.position=r,c.scaleByDistance=A.default.getValueOrUndefined(u._scaleByDistance,e,Nc),c.translucencyByDistance=A.default.getValueOrUndefined(u._translucencyByDistance,e,Lc),c.distanceDisplayCondition=A.default.getValueOrUndefined(u._distanceDisplayCondition,e,jc),c.disableDepthTestDistance=A.default.getValueOrDefault(u._disableDepthTestDistance,e,0),c.heightReference=f;var _=A.default.getValueOrDefault(u._color,e,Dc,Mc),g=A.default.getValueOrDefault(u._outlineColor,e,Fc,Rc),b=Math.round(A.default.getValueOrDefault(u._outlineWidth,e,0)),w=Math.max(1,Math.round(A.default.getValueOrDefault(u._pixelSize,e,1)));if(b>0?(c.scale=1,m=m||b!==o.outlineWidth||w!==o.pixelSize||!y.default.equals(_,o.color)||!y.default.equals(g,o.outlineColor)):(c.scale=w/50,w=50,m=m||b!==o.outlineWidth||!y.default.equals(_,o.color)||!y.default.equals(g,o.outlineColor)),m){o.color=y.default.clone(_,o.color),o.outlineColor=y.default.clone(g,o.outlineColor),o.pixelSize=w,o.outlineWidth=b;var C=_.alpha,x=_.toCssColorString(),T=g.toCssColorString(),E=JSON.stringify([x,w,T,b]);c.setImage(E,Object(Sc.a)(C,x,T,b,w))}p&&c._updateClamping()}}else Bc(o,l,a)}return!0},Uc.prototype.getBoundingSphere=function(e,t){var a=this._items.get(e.id);if(!Object(s.default)(a)||!Object(s.default)(a.pointPrimitive)&&!Object(s.default)(a.billboard))return E.default.FAILED;if(Object(s.default)(a.pointPrimitive))t.center=v.default.clone(a.pointPrimitive.position,t.center);else{var i=a.billboard;if(!Object(s.default)(i._clampedPosition))return E.default.PENDING;t.center=v.default.clone(i._clampedPosition,t.center)}return t.radius=0,E.default.DONE},Uc.prototype.isDestroyed=function(){return!1},Uc.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Uc.prototype._onCollectionChanged,this);for(var e=this._entityCollection.values,t=0;t<e.length;t++)this._cluster.removePoint(e[t]);return Object(l.default)(this)},Uc.prototype._onCollectionChanged=function(e,t,a,i){var n,r,o=this._items,l=this._cluster;for(n=t.length-1;n>-1;n--)r=t[n],Object(s.default)(r._point)&&Object(s.default)(r._position)&&o.set(r.id,new Vc(r));for(n=i.length-1;n>-1;n--)r=i[n],Object(s.default)(r._point)&&Object(s.default)(r._position)?o.contains(r.id)||o.set(r.id,new Vc(r)):(Bc(o.get(r.id),r,l),o.remove(r.id));for(n=a.length-1;n>-1;n--)r=a[n],Bc(o.get(r.id),r,l),o.remove(r.id)};var zc=Uc,Hc=a(374),kc=a(375),Gc=a(588),Wc=a(409),Yc=[];function Xc(e,t,a,i,n){var r,o=Yc;o.length=n;var s=a.red,l=a.green,u=a.blue,d=a.alpha,c=i.red,f=i.green,h=i.blue,m=i.alpha;if(y.default.equals(a,i)){for(r=0;r<n;r++)o[r]=y.default.clone(a);return o}var p=(c-s)/n,_=(f-l)/n,g=(h-u)/n,v=(m-d)/n;for(r=0;r<n;r++)o[r]=new y.default(s+r*p,l+r*_,u+r*g,d+r*v);return o}function Qc(e){var t=(e=Object(o.default)(e,o.default.EMPTY_OBJECT)).positions,a=e.colors,i=Object(o.default)(e.width,1),n=Object(o.default)(e.colorsPerVertex,!1);this._positions=t,this._colors=a,this._width=i,this._colorsPerVertex=n,this._vertexFormat=K.default.clone(Object(o.default)(e.vertexFormat,K.default.DEFAULT)),this._arcType=Object(o.default)(e.arcType,Dr.a.GEODESIC),this._granularity=Object(o.default)(e.granularity,Le.default.RADIANS_PER_DEGREE),this._ellipsoid=ha.default.clone(Object(o.default)(e.ellipsoid,ha.default.WGS84)),this._workerName="createPolylineGeometry";var r=1+t.length*v.default.packedLength;r+=Object(s.default)(a)?1+a.length*y.default.packedLength:1,this.packedLength=r+ha.default.packedLength+K.default.packedLength+4}Qc.pack=function(e,t,a){var i;a=Object(o.default)(a,0);var n=e._positions,r=n.length;for(t[a++]=r,i=0;i<r;++i,a+=v.default.packedLength)v.default.pack(n[i],t,a);var l=e._colors;for(r=Object(s.default)(l)?l.length:0,t[a++]=r,i=0;i<r;++i,a+=y.default.packedLength)y.default.pack(l[i],t,a);return ha.default.pack(e._ellipsoid,t,a),a+=ha.default.packedLength,K.default.pack(e._vertexFormat,t,a),a+=K.default.packedLength,t[a++]=e._width,t[a++]=e._colorsPerVertex?1:0,t[a++]=e._arcType,t[a]=e._granularity,t};var qc=ha.default.clone(ha.default.UNIT_SPHERE),Zc=new K.default,Kc={positions:void 0,colors:void 0,ellipsoid:qc,vertexFormat:Zc,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};Qc.unpack=function(e,t,a){var i;t=Object(o.default)(t,0);var n=e[t++],r=new Array(n);for(i=0;i<n;++i,t+=v.default.packedLength)r[i]=v.default.unpack(e,t);var l=(n=e[t++])>0?new Array(n):void 0;for(i=0;i<n;++i,t+=y.default.packedLength)l[i]=y.default.unpack(e,t);var u=ha.default.unpack(e,t,qc);t+=ha.default.packedLength;var d=K.default.unpack(e,t,Zc);t+=K.default.packedLength;var c=e[t++],f=1===e[t++],h=e[t++],m=e[t];return Object(s.default)(a)?(a._positions=r,a._colors=l,a._ellipsoid=ha.default.clone(u,a._ellipsoid),a._vertexFormat=K.default.clone(d,a._vertexFormat),a._width=c,a._colorsPerVertex=f,a._arcType=h,a._granularity=m,a):(Kc.positions=r,Kc.colors=l,Kc.width=c,Kc.colorsPerVertex=f,Kc.arcType=h,Kc.granularity=m,new Qc(Kc))};var Jc=new v.default,$c=new v.default,ef=new v.default,tf=new v.default;Qc.createGeometry=function(e){var t,a,i,r=e._width,o=e._vertexFormat,l=e._colors,u=e._colorsPerVertex,d=e._arcType,c=e._granularity,f=e._ellipsoid,h=Object(Je.a)(e._positions,v.default.equalsEpsilon),m=h.length;if(!(m<2||r<=0)){if(d===Dr.a.GEODESIC||d===Dr.a.RHUMB){var p,_;d===Dr.a.GEODESIC?(p=Le.default.chordLength(c,f.maximumRadius),_=tt.a.numberOfPoints):(p=c,_=tt.a.numberOfPointsRhumbLine);var g=tt.a.extractHeights(h,f);if(Object(s.default)(l)){var b=1;for(t=0;t<m-1;++t)b+=_(h[t],h[t+1],p);var w=new Array(b),C=0;for(t=0;t<m-1;++t){var O=h[t],x=h[t+1],T=l[t],E=_(O,x,p);if(u&&t<b){var A=Xc(0,0,T,l[t+1],E),P=A.length;for(a=0;a<P;++a)w[C++]=A[a]}else for(a=0;a<E;++a)w[C++]=y.default.clone(T)}w[C]=y.default.clone(l[l.length-1]),l=w,Yc.length=0}h=d===Dr.a.GEODESIC?tt.a.generateCartesianArc({positions:h,minDistance:p,ellipsoid:f,height:g}):tt.a.generateCartesianRhumbArc({positions:h,granularity:p,ellipsoid:f,height:g})}var S,D=4*(m=h.length)-4,F=new Float64Array(3*D),M=new Float64Array(3*D),I=new Float64Array(3*D),R=new Float32Array(2*D),N=o.st?new Float32Array(2*D):void 0,L=Object(s.default)(l)?new Uint8Array(4*D):void 0,j=0,V=0,U=0,B=0;for(a=0;a<m;++a){var z,H;0===a?(S=Jc,v.default.subtract(h[0],h[1],S),v.default.add(h[0],S,S)):S=h[a-1],v.default.clone(S,ef),v.default.clone(h[a],$c),a===m-1?(S=Jc,v.default.subtract(h[m-1],h[m-2],S),v.default.add(h[m-1],S,S)):S=h[a+1],v.default.clone(S,tf),Object(s.default)(L)&&(z=0===a||u?l[a]:l[a-1],a!==m-1&&(H=l[a]));var k=a===m-1?2:4;for(i=0===a?2:0;i<k;++i){v.default.pack($c,F,j),v.default.pack(ef,M,j),v.default.pack(tf,I,j),j+=3;var G=i-2<0?-1:1;if(R[V++]=i%2*2-1,R[V++]=G*r,o.st&&(N[U++]=a/(m-1),N[U++]=Math.max(R[V-2],0)),Object(s.default)(L)){var W=i<2?z:H;L[B++]=y.default.floatToByte(W.red),L[B++]=y.default.floatToByte(W.green),L[B++]=y.default.floatToByte(W.blue),L[B++]=y.default.floatToByte(W.alpha)}}}var Y=new _a.a;Y.position=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:F}),Y.prevPosition=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:M}),Y.nextPosition=new pa.a({componentDatatype:se.a.DOUBLE,componentsPerAttribute:3,values:I}),Y.expandAndWidth=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:R}),o.st&&(Y.st=new pa.a({componentDatatype:se.a.FLOAT,componentsPerAttribute:2,values:N})),Object(s.default)(L)&&(Y.color=new pa.a({componentDatatype:se.a.UNSIGNED_BYTE,componentsPerAttribute:4,values:L,normalize:!0}));var X=ga.a.createTypedArray(D,6*m-6),Q=0,q=0,Z=m-1;for(a=0;a<Z;++a)X[q++]=Q,X[q++]=Q+2,X[q++]=Q+1,X[q++]=Q+1,X[q++]=Q+2,X[q++]=Q+3,Q+=4;return new ma.a({attributes:Y,indices:X,primitiveType:ya.a.TRIANGLES,boundingSphere:n.default.fromPoints(h),geometryType:Wc.a.POLYLINES})}};var af=Qc,nf=new Ce.a(0),rf={},of=new y.default,sf=new pe.default(y.default.WHITE),lf=new Ce.a(!0),uf=new Ce.a(ie.default.DISABLED),df=new Ce.a(new w.a),cf=new Ce.a(Z.a.BOTH);function ff(){this.vertexFormat=void 0,this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function hf(){this.positions=void 0,this.width=void 0,this.arcType=void 0,this.granularity=void 0}function mf(e,t){this._entity=e,this._scene=t,this._entitySubscription=e.definitionChanged.addEventListener(mf.prototype._onEntityPropertyChanged,this),this._fillEnabled=!1,this._dynamic=!1,this._geometryChanged=new q.default,this._showProperty=void 0,this._materialProperty=void 0,this._shadowsProperty=void 0,this._distanceDisplayConditionProperty=void 0,this._classificationTypeProperty=void 0,this._depthFailMaterialProperty=void 0,this._geometryOptions=new ff,this._groundGeometryOptions=new hf,this._id="polyline-"+e.id,this._clampToGround=!1,this._supportsPolylinesOnTerrain=Oe.default.supportsPolylinesOnTerrain(t),this._zIndex=0,this._onEntityPropertyChanged(e,"polyline",e.polyline,void 0)}Object.defineProperties(mf.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!Object(s.default)(this._entity.availability)&&A.default.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}}),mf.prototype.isOutlineVisible=function(e){return!1},mf.prototype.isFilled=function(e){var t=this._entity,a=this._fillEnabled&&t.isAvailable(e)&&this._showProperty.getValue(e);return Object(o.default)(a,!1)},mf.prototype.createFillGeometryInstance=function(e){var t,a=this._entity,i=a.isAvailable(e),n=new me.a(i&&a.isShowing&&this._showProperty.getValue(e)),r=this._distanceDisplayConditionProperty.getValue(e),o={show:n,distanceDisplayCondition:ue.fromDistanceDisplayCondition(r)};return this._materialProperty instanceof pe.default&&(Object(s.default)(this._materialProperty.color)&&(this._materialProperty.color.isConstant||i)&&(t=this._materialProperty.color.getValue(e,of)),Object(s.default)(t)||(t=y.default.WHITE),o.color=oe.a.fromColor(t)),this.clampToGround?new de.a({id:a,geometry:new Gc.a(this._groundGeometryOptions),attributes:o}):(Object(s.default)(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof pe.default&&(Object(s.default)(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||i)&&(t=this._depthFailMaterialProperty.color.getValue(e,of)),Object(s.default)(t)||(t=y.default.WHITE),o.depthFailColor=oe.a.fromColor(t)),new de.a({id:a,geometry:new af(this._geometryOptions),attributes:o}))},mf.prototype.createOutlineGeometryInstance=function(e){},mf.prototype.isDestroyed=function(){return!1},mf.prototype.destroy=function(){this._entitySubscription(),Object(l.default)(this)},mf.prototype._onEntityPropertyChanged=function(e,t,a,i){if("availability"===t||"polyline"===t){var n=this._entity.polyline;if(Object(s.default)(n)){var r=n.positions,l=n.show;if(Object(s.default)(l)&&l.isConstant&&!l.getValue(fe.default.MINIMUM_VALUE)||!Object(s.default)(r))this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));else{var u=n.zIndex,d=Object(o.default)(n.material,sf),c=d instanceof pe.default;this._materialProperty=d,this._depthFailMaterialProperty=n.depthFailMaterial,this._showProperty=Object(o.default)(l,lf),this._shadowsProperty=Object(o.default)(n.shadows,uf),this._distanceDisplayConditionProperty=Object(o.default)(n.distanceDisplayCondition,df),this._classificationTypeProperty=Object(o.default)(n.classificationType,cf),this._fillEnabled=!0,this._zIndex=Object(o.default)(u,nf);var f=n.width,h=n.arcType,m=n.clampToGround,p=n.granularity;if(r.isConstant&&A.default.isConstant(f)&&A.default.isConstant(h)&&A.default.isConstant(p)&&A.default.isConstant(m)&&A.default.isConstant(u)){var _,g=this._geometryOptions,v=r.getValue(fe.default.MINIMUM_VALUE,g.positions);if(!Object(s.default)(v)||v.length<2)return void(this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)));_=c&&(!Object(s.default)(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof pe.default)?Hc.a.VERTEX_FORMAT:kc.a.VERTEX_FORMAT,g.vertexFormat=_,g.positions=v,g.width=Object(s.default)(f)?f.getValue(fe.default.MINIMUM_VALUE):void 0,g.arcType=Object(s.default)(h)?h.getValue(fe.default.MINIMUM_VALUE):void 0,g.granularity=Object(s.default)(p)?p.getValue(fe.default.MINIMUM_VALUE):void 0;var y=this._groundGeometryOptions;y.positions=v,y.width=g.width,y.arcType=g.arcType,y.granularity=g.granularity,this._clampToGround=!!Object(s.default)(m)&&m.getValue(fe.default.MINIMUM_VALUE),!this._clampToGround&&Object(s.default)(u)&&Object(we.a)("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this)}else this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))}}else this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this))}},mf.prototype.createDynamicUpdater=function(e,t){return new _f(e,t,this)};var pf={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};function _f(e,t,a){this._line=void 0,this._primitives=e,this._groundPrimitives=t,this._groundPolylinePrimitive=void 0,this._material=void 0,this._geometryUpdater=a,this._positions=[]}function gf(e){if(Object(s.default)(e._line))return e._line;var t=e._geometryUpdater._scene.id,a=rf[t],i=e._primitives;!Object(s.default)(a)||a.isDestroyed()?(a=new fc.a,rf[t]=a,i.add(a)):i.contains(a)||i.add(a);var n=a.add();return n.id=e._geometryUpdater._entity,e._line=n,n}_f.prototype.update=function(e){var t=this._geometryUpdater,a=t._entity,i=a.polyline,n=i.positions,r=A.default.getValueOrUndefined(n,e,this._positions);t._clampToGround=A.default.getValueOrDefault(i._clampToGround,e,!1),t._groundGeometryOptions.positions=r,t._groundGeometryOptions.width=A.default.getValueOrDefault(i._width,e,1),t._groundGeometryOptions.arcType=A.default.getValueOrDefault(i._arcType,e,Dr.a.GEODESIC),t._groundGeometryOptions.granularity=A.default.getValueOrDefault(i._granularity,e,9999);var o=this._groundPrimitives;if(Object(s.default)(this._groundPolylinePrimitive)&&(o.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0),t.clampToGround){if(!a.isShowing||!a.isAvailable(e)||!A.default.getValueOrDefault(i._show,e,!0))return;if(!Object(s.default)(r)||r.length<2)return;var l,u=t.fillMaterialProperty;if(u instanceof pe.default)l=new Hc.a;else{var c=ve.getValue(e,u,this._material);l=new kc.a({material:c,translucent:c.isTranslucent()}),this._material=c}return this._groundPolylinePrimitive=o.add(new d.a({geometryInstances:t.createFillGeometryInstance(e),appearance:l,classificationType:t.classificationTypeProperty.getValue(e),asynchronous:!1}),A.default.getValueOrUndefined(t.zIndex,e)),void(Object(s.default)(this._line)&&(this._line.show=!1))}var f=gf(this);if(a.isShowing&&a.isAvailable(e)&&A.default.getValueOrDefault(i._show,e,!0))if(!Object(s.default)(r)||r.length<2)f.show=!1;else{var h=Dr.a.GEODESIC;h=A.default.getValueOrDefault(i._arcType,e,h);var m=t._scene.globe;h!==Dr.a.NONE&&Object(s.default)(m)&&(pf.ellipsoid=m.ellipsoid,pf.positions=r,pf.granularity=A.default.getValueOrUndefined(i._granularity,e),pf.height=tt.a.extractHeights(r,m.ellipsoid),r=h===Dr.a.GEODESIC?tt.a.generateCartesianArc(pf):tt.a.generateCartesianRhumbArc(pf)),f.show=!0,f.positions=r.slice(),f.material=ve.getValue(e,t.fillMaterialProperty,f.material),f.width=A.default.getValueOrDefault(i._width,e,1),f.distanceDisplayCondition=A.default.getValueOrUndefined(i._distanceDisplayCondition,e,f.distanceDisplayCondition)}else f.show=!1},_f.prototype.getBoundingSphere=function(e){if(this._geometryUpdater.clampToGround){var t=this._groundPolylinePrimitive;if(Object(s.default)(t)&&t.show&&t.ready){var a=t.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(Object(s.default)(a)&&Object(s.default)(a.boundingSphere))return n.default.clone(a.boundingSphere,e),E.default.DONE}return Object(s.default)(t)&&!t.ready?E.default.PENDING:E.default.DONE}var i=gf(this);return i.show&&i.positions.length>0?(n.default.fromPoints(i.positions,e),E.default.DONE):E.default.FAILED},_f.prototype.isDestroyed=function(){return!1},_f.prototype.destroy=function(){var e=this._geometryUpdater._scene.id,t=rf[e];Object(s.default)(t)&&(t.remove(this._line),0===t.length&&(this._primitives.removeAndDestroy(t),delete rf[e])),Object(s.default)(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive),Object(l.default)(this)};var vf=mf,yf=new y.default,bf=new w.a,wf=new w.a;function Cf(e,t,a,i,n){var r;r=a instanceof pe.default?Hc.a:kc.a,this.orderedGroundPrimitives=e,this.classificationType=t,this.appearanceType=r,this.materialProperty=a,this.updaters=new p.default,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new p.default,this.material=void 0,this.updatersWithAttributes=new p.default,this.attributes=new p.default,this.invalidated=!1,this.removeMaterialSubscription=a.definitionChanged.addEventListener(Cf.prototype.onMaterialChanged,this),this.subscriptions=new p.default,this.showsUpdated=new p.default,this.zIndex=i,this._asynchronous=n}function Of(e,t,a){this._items=[],this._orderedGroundPrimitives=e,this._classificationType=t,this._asynchronous=Object(o.default)(a,!0)}Cf.prototype.onMaterialChanged=function(){this.invalidated=!0},Cf.prototype.isMaterial=function(e){var t=this.materialProperty,a=e.fillMaterialProperty;return a===t||a instanceof pe.default&&t instanceof pe.default||Object(s.default)(t)&&t.equals(a)},Cf.prototype.add=function(e,t,a){var i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,a),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&A.default.isConstant(t.distanceDisplayConditionProperty)){var n=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,a,i,r){"isShowing"===a&&n.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},Cf.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var a=this.subscriptions.get(t);return Object(s.default)(a)&&(a(),this.subscriptions.remove(t)),!0}return!1},Cf.prototype.update=function(e){var t,a=!0,i=this.primitive,n=this.orderedGroundPrimitives,r=this.geometry.values;if(this.createPrimitive){if(r.length>0)Object(s.default)(i)&&(Object(s.default)(this.oldPrimitive)?n.remove(i):this.oldPrimitive=i),i=new d.a({show:!1,asynchronous:this._asynchronous,geometryInstances:r.slice(),appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===kc.a&&(this.material=ve.getValue(e,this.materialProperty,this.material),i.appearance.material=this.material),n.add(i,this.zIndex),a=!1;else{Object(s.default)(i)&&(n.remove(i),i=void 0);var o=this.oldPrimitive;Object(s.default)(o)&&(n.remove(o),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1}else if(Object(s.default)(i)&&i.ready){i.show=!0,Object(s.default)(this.oldPrimitive)&&(n.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.appearanceType===kc.a&&(this.material=ve.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material);var l=this.updatersWithAttributes.values,u=l.length;for(t=0;t<u;t++){var c=l[t],f=c.entity,h=this.geometry.get(c.id),m=this.attributes.get(h.id.id);if(Object(s.default)(m)||(m=i.getGeometryInstanceAttributes(h.id),this.attributes.set(h.id.id,m)),!c.fillMaterialProperty.isConstant){var p=c.fillMaterialProperty.color,_=A.default.getValueOrDefault(p,e,y.default.WHITE,yf);y.default.equals(m._lastColor,_)||(m._lastColor=y.default.clone(_,m._lastColor),m.color=oe.a.toValue(_,m.color))}var g=f.isShowing&&(c.hasConstantFill||c.isFilled(e));g!==(1===m.show[0])&&(m.show=me.a.toValue(g,m.show));var v=c.distanceDisplayConditionProperty;if(!A.default.isConstant(v)){var b=A.default.getValueOrDefault(v,e,wf,bf);w.a.equals(b,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=w.a.clone(b,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=ue.toValue(b,m.distanceDisplayCondition))}}this.updateShows(i)}else Object(s.default)(i)&&!i.ready&&(a=!1);return a},Cf.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,a=t.length,i=0;i<a;i++){var n=t[i],r=n.entity,o=this.geometry.get(n.id),l=this.attributes.get(o.id.id);Object(s.default)(l)||(l=e.getGeometryInstanceAttributes(o.id),this.attributes.set(o.id.id,l));var u=r.isShowing;u!==(1===l.show[0])&&(l.show=me.a.toValue(u,l.show),o.attributes.show.value[0]=l.show[0])}this.showsUpdated.removeAll()},Cf.prototype.contains=function(e){return this.updaters.contains(e.id)},Cf.prototype.getBoundingSphere=function(e,t){var a=this.primitive;if(!a.ready)return E.default.PENDING;var i=a.getGeometryInstanceAttributes(e.entity);return!Object(s.default)(i)||!Object(s.default)(i.boundingSphere)||Object(s.default)(i.show)&&0===i.show[0]?E.default.FAILED:(i.boundingSphere.clone(t),E.default.DONE)},Cf.prototype.destroy=function(){var e=this.primitive,t=this.orderedGroundPrimitives;Object(s.default)(e)&&t.remove(e);var a=this.oldPrimitive;Object(s.default)(a)&&t.remove(a),this.removeMaterialSubscription()},Of.prototype.add=function(e,t){for(var a=this._items,i=a.length,n=t.createFillGeometryInstance(e),r=A.default.getValueOrDefault(t.zIndex,0),o=0;o<i;++o){var s=a[o];if(s.isMaterial(t)&&s.zIndex===r)return void s.add(e,t,n)}var l=new Cf(this._orderedGroundPrimitives,this._classificationType,t.fillMaterialProperty,r,this._asynchronous);l.add(e,t,n),a.push(l)},Of.prototype.remove=function(e){for(var t=this._items,a=t.length-1;a>=0;a--){var i=t[a];if(i.remove(e)){0===i.updaters.length&&(t.splice(a,1),i.destroy());break}}},Of.prototype.update=function(e){var t,a=this._items;for(t=a.length-1;t>=0;t--){var i=a[t];if(i.invalidated){a.splice(t,1);for(var n=i.updaters.values,r=n.length,o=0;o<r;o++)this.add(e,n[o]);i.destroy()}}var s=!0;for(t=0;t<a.length;t++)s=a[t].update(e)&&s;return s},Of.prototype.getBoundingSphere=function(e,t){for(var a=this._items,i=a.length,n=0;n<i;n++){var r=a[n];if(r.contains(e))return r.getBoundingSphere(e,t)}return E.default.FAILED},Of.prototype.removeAllPrimitives=function(){for(var e=this._items,t=e.length,a=0;a<t;a++)e[a].destroy();this._items.length=0};var xf=Of,Tf=[];function Ef(e,t){for(var a=e._batches,i=a.length,n=0;n<i;n++)a[n].remove(t)}function Af(e,t,a){if(a.isDynamic)e._dynamicBatch.add(t,a);else if(a.clampToGround&&a.fillEnabled){var i=a.classificationTypeProperty.getValue(t);e._groundBatches[i].add(t,a)}else{var n;a.fillEnabled&&(n=a.shadowsProperty.getValue(t));var r,o=0;Object(s.default)(a.depthFailMaterialProperty)&&(o=a.depthFailMaterialProperty instanceof pe.default?1:2),Object(s.default)(n)&&(r=n+o*ie.default.NUMBER_OF_SHADOW_MODES),a.fillEnabled&&(a.fillMaterialProperty instanceof pe.default?e._colorBatches[r].add(t,a):e._materialBatches[r].add(t,a))}}function Pf(e,t,a,i){var n;i=Object(o.default)(i,e.groundPrimitives),a=Object(o.default)(a,e.primitives),this._scene=e,this._primitives=a,this._entityCollection=void 0,this._addedObjects=new p.default,this._removedObjects=new p.default,this._changedObjects=new p.default;var r=ie.default.NUMBER_OF_SHADOW_MODES;for(this._colorBatches=new Array(3*r),this._materialBatches=new Array(3*r),n=0;n<r;++n)this._colorBatches[n]=new Fl(a,Hc.a,void 0,!1,n),this._materialBatches[n]=new Ul(a,kc.a,void 0,!1,n),this._colorBatches[n+r]=new Fl(a,Hc.a,Hc.a,!1,n),this._materialBatches[n+r]=new Ul(a,kc.a,Hc.a,!1,n),this._colorBatches[n+2*r]=new Fl(a,Hc.a,kc.a,!1,n),this._materialBatches[n+2*r]=new Ul(a,kc.a,kc.a,!1,n);this._dynamicBatch=new Vi(a,i);var s=Z.a.NUMBER_OF_CLASSIFICATION_TYPES;for(this._groundBatches=new Array(s),n=0;n<s;++n)this._groundBatches[n]=new xf(i,n);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches),this._subscriptions=new p.default,this._updaters=new p.default,this._entityCollection=t,t.collectionChanged.addEventListener(Pf.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,Tf)}Pf.prototype.update=function(e){var t,a,i,n,r=this._addedObjects,o=r.values,s=this._removedObjects,l=s.values,u=this._changedObjects,d=u.values;for(t=d.length-1;t>-1;t--)i=(a=d[t]).id,(n=this._updaters.get(i)).entity===a?(Ef(this,n),Af(this,e,n)):(l.push(a),o.push(a));for(t=l.length-1;t>-1;t--)i=(a=l[t]).id,Ef(this,n=this._updaters.get(i)),n.destroy(),this._updaters.remove(i),this._subscriptions.get(i)(),this._subscriptions.remove(i);for(t=o.length-1;t>-1;t--)i=(a=o[t]).id,n=new vf(a,this._scene),this._updaters.set(i,n),Af(this,e,n),this._subscriptions.set(i,n.geometryChanged.addEventListener(Pf._onGeometryChanged,this));r.removeAll(),s.removeAll(),u.removeAll();var c=!0,f=this._batches,h=f.length;for(t=0;t<h;t++)c=f[t].update(e)&&c;return c};var Sf=[],Df=new n.default;Pf.prototype.getBoundingSphere=function(e,t){for(var a=Sf,i=Df,r=0,o=E.default.DONE,s=this._batches,l=s.length,u=this._updaters.get(e.id),d=0;d<l;d++){if((o=s[d].getBoundingSphere(u,i))===E.default.PENDING)return E.default.PENDING;o===E.default.DONE&&(a[r]=n.default.clone(i,a[r]),r++)}return 0===r?E.default.FAILED:(a.length=r,n.default.fromBoundingSpheres(a,t),E.default.DONE)},Pf.prototype.isDestroyed=function(){return!1},Pf.prototype.destroy=function(){var e;this._entityCollection.collectionChanged.removeEventListener(Pf.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();var t=this._batches,a=t.length;for(e=0;e<a;e++)t[e].removeAllPrimitives();var i=this._subscriptions.values;for(a=i.length,e=0;e<a;e++)i[e]();return this._subscriptions.removeAll(),Object(l.default)(this)},Pf._onGeometryChanged=function(e){var t=this._removedObjects,a=this._changedObjects,i=e.entity,n=i.id;Object(s.default)(t.get(n))||Object(s.default)(a.get(n))||a.set(n,i)},Pf.prototype._onCollectionChanged=function(e,t,a){var i,n,r,o=this._addedObjects,s=this._removedObjects,l=this._changedObjects;for(i=a.length-1;i>-1;i--)n=(r=a[i]).id,o.remove(n)||(s.set(n,r),l.remove(n));for(i=t.length-1;i>-1;i--)n=(r=t[i]).id,s.remove(n)?l.set(n,r):o.set(n,r)};var Ff=Pf;function Mf(e){this._displayID=Object(r.default)(),c.a.initializeTerrainHeights(),d.a.initializeTerrainHeights();var t=e.scene,a=e.dataSourceCollection;this._eventHelper=new u.default,this._eventHelper.add(a.dataSourceAdded,this._onDataSourceAdded,this),this._eventHelper.add(a.dataSourceRemoved,this._onDataSourceRemoved,this),this._eventHelper.add(a.dataSourceMoved,this._onDataSourceMoved,this),this._eventHelper.add(t.postRender,this._postRender,this),this._dataSourceCollection=a,this._scene=t,this._visualizersCallback=Object(o.default)(e.visualizersCallback,Mf.defaultVisualizersCallback);var i=!1,n=new f.a,s=new f.a;a.length>0&&(t.primitives.add(n),t.groundPrimitives.add(s),i=!0),this._primitives=n,this._groundPrimitives=s;for(var l=0,h=a.length;l<h;l++)this._onDataSourceAdded(a,a.get(l));var m,p,_=new Q.default;if(this._onDataSourceAdded(void 0,_),this._defaultDataSource=_,!i){var g=this,v=function(){t.primitives.add(n),t.groundPrimitives.add(s),m(),p(),g._removeDefaultDataSourceListener=void 0,g._removeDataSourceCollectionListener=void 0};m=_.entities.collectionChanged.addEventListener(v),p=a.dataSourceAdded.addEventListener(v)}this._removeDefaultDataSourceListener=m,this._removeDataSourceCollectionListener=p,this._ready=!1}Mf.defaultVisualizersCallback=function(e,t,a){var i=a.entities;return[new X(t,i),new cd(e,i,a._primitives,a._groundPrimitives),new jd(t,i),new ac(e,i),new lc(e,i),new zc(t,i),new Pc(e,i),new Ff(e,i,a._primitives,a._groundPrimitives)]},Object.defineProperties(Mf.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}}),Mf.prototype.isDestroyed=function(){return!1},Mf.prototype.destroy=function(){this._eventHelper.removeAll();for(var e=this._dataSourceCollection,t=0,a=e.length;t<a;++t)this._onDataSourceRemoved(this._dataSourceCollection,e.get(t));return this._onDataSourceRemoved(void 0,this._defaultDataSource),Object(s.default)(this._removeDefaultDataSourceListener)?(this._removeDefaultDataSourceListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),Object(l.default)(this)},Mf.prototype.update=function(e){if(!i.a.initialized)return this._ready=!1,!1;var t,a,n,r,o=!0,l=this._dataSourceCollection,u=l.length;for(t=0;t<u;t++){var d=l.get(t);for(Object(s.default)(d.update)&&(o=d.update(e)&&o),r=(n=d._visualizersByDisplayID[this._displayID]).length,a=0;a<r;a++)o=n[a].update(e)&&o}for(r=(n=this._defaultDataSource._visualizersByDisplayID[this._displayID]).length,a=0;a<r;a++)o=n[a].update(e)&&o;return this._ready=o,o},Mf.prototype._postRender=function(){for(var e=this._scene.frameState,t=this._dataSourceCollection,a=t.length,i=0;i<a;i++){var n=t.get(i),r=n.credit;Object(s.default)(r)&&e.creditDisplay.addCredit(r);var o=n._resourceCredits;if(Object(s.default)(o))for(var l=o.length,u=0;u<l;u++)e.creditDisplay.addCredit(o[u])}};var If=[],Rf=new n.default;Mf.prototype.getBoundingSphere=function(e,t,a){if(!this._ready)return E.default.PENDING;var i,r,o=this._defaultDataSource;if(!o.entities.contains(e)){o=void 0;var l=this._dataSourceCollection;for(r=l.length,i=0;i<r;i++){var u=l.get(i);if(u.entities.contains(e)){o=u;break}}}if(!Object(s.default)(o))return E.default.FAILED;var d=If,c=Rf,f=0,h=E.default.DONE,m=o._visualizers,p=m.length;for(i=0;i<p;i++){var _=m[i];if(Object(s.default)(_.getBoundingSphere)){if(h=m[i].getBoundingSphere(e,c),!t&&h===E.default.PENDING)return E.default.PENDING;h===E.default.DONE&&(d[f]=n.default.clone(c,d[f]),f++)}}return 0===f?E.default.FAILED:(d.length=f,n.default.fromBoundingSpheres(d,a),E.default.DONE)},Mf.prototype._onDataSourceAdded=function(e,t){var a=this._scene,i=this._primitives,n=this._groundPrimitives,r=i.add(new f.a),o=n.add(new m);t._primitives=r,t._groundPrimitives=o;var s=t.clustering;s._initialize(a),r.add(s);var l=this._visualizersCallback(a,s,t);t._visualizersByDisplayID=t._visualizersByDisplayID||{},t._visualizersByDisplayID[this._displayID]=l,t._visualizers=t._visualizers||[],t._visualizers=t._visualizers.concat(l)},Mf.prototype._onDataSourceRemoved=function(e,t){var a=this._primitives,i=this._groundPrimitives,n=t._primitives,r=t._groundPrimitives,o=t.clustering;n.remove(o);var l=t._visualizersByDisplayID[this._displayID];if(Object(s.default)(l)){for(var u=l.length,d=0;d<u;d++){var c=l[d];c.destroy();var f=t._visualizers.indexOf(c);t._visualizers.splice(f,1)}delete t._visualizersByDisplayID[this._displayID],a.remove(n),i.remove(r)}},Mf.prototype._onDataSourceMoved=function(e,t,a){var i=this._primitives,n=this._groundPrimitives,r=e._primitives,o=e._groundPrimitives;t===a+1?(i.raise(r),n.raise(o)):t===a-1?(i.lower(r),n.lower(o)):0===t?(i.lowerToBottom(r),n.lowerToBottom(o),i.raise(r),n.raise(o)):(i.raiseToTop(r),n.raiseToTop(o))};t.default=Mf},90:function(e,t,a){"use strict";var i=a(35),n=a(9),r=a(8);a(10);function o(e){e=Object(n.default)(e,!0),this.value=o.toValue(e)}Object.defineProperties(o.prototype,{componentDatatype:{get:function(){return i.a.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 1}},normalize:{get:function(){return!1}}}),o.toValue=function(e,t){return Object(r.default)(t)?(t[0]=e,t):new Uint8Array([e])},t.a=o}}]);
//# sourceMappingURL=3.TerriaMap.js.map